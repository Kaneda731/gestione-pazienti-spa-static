import{j as e}from"./ui-vendor-S6RcKJ66.js";import{u as i}from"./useQuery-CNQtQYAC.js";import{b as a}from"./index-DwWAzvfw.js";import{u as s}from"./useMutation-jLTzKA8C.js";import{b as l,u as n}from"./react-vendor-Bp2pLdQf.js";import{n as r,a as c}from"./notificationErrorHandler-D255PCgB.js";import{B as o,p as d}from"./patientService-LAnBYNdr.js";import{C as t}from"./CustomSelect-Dr_IEZU9.js";import{D as m}from"./DateRangePicker-LGWbpNzS.js";import"./supabase-BkmsdzLq.js";const h=[{value:"dimissione",label:"Dimissione"},{value:"trasferimento_interno",label:"Trasferimento interno"},{value:"trasferimento_esterno",label:"Trasferimento esterno"},{value:"decesso",label:"Decesso"}],p=[{value:"0",label:"0 - Ordinaria"},{value:"6",label:"6 - Protetta"}],u=[{value:"",label:"Seleziona..."},{value:"56",label:"56 - Riabilitazione Motoria"},{value:"60",label:"60 - Lunga Degenza"}],j=[{value:"",label:"Seleziona..."},{value:"Cardiologia",label:"Cardiologia"},{value:"CR1",label:"CR1"},{value:"CR3",label:"CR3"},{value:"Gastroenterologia",label:"Gastroenterologia"},{value:"Ginecologia",label:"Ginecologia"},{value:"Medicina Interna",label:"Medicina Interna"},{value:"Neurologia",label:"Neurologia"},{value:"Pediatria",label:"Pediatria"},{value:"Pneumologia",label:"Pneumologia"},{value:"UGI",label:"UGI"},{value:"Urologia",label:"Urologia"}],x={data_dimissione:"",tipo_dimissione:"dimissione",codice_dimissione:"0"},v=({onSubmit:i,onCancel:a,isSubmitting:s})=>{const[n,r]=l.useState(x),c=l.useRef(null),d=e=>i=>{r("tipo_dimissione"===e?a=>{const s={...a,[e]:i};return"dimissione"===i?s.codice_dimissione="0":"trasferimento_esterno"===i?s.codice_dimissione="3":"trasferimento_interno"!==i&&"decesso"!==i||(s.codice_dimissione=null),s}:a=>({...a,[e]:i}))};return e.jsxs("form",{id:"discharge-form",ref:c,onSubmit:async e=>{e.preventDefault(),s||i(n)},className:"d-flex flex-column gap-3",children:[e.jsx(m,{value:n.data_dimissione,onChange:e=>{r(i=>({...i,data_dimissione:e||""}))},label:"Data dimissione",placeholder:"gg/mm/aaaa",isRequired:!0,allowInput:!0,clearable:!0}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"dismissal-type",children:"Tipo dimissione"}),e.jsx(t,{id:"dismissal-type",value:n.tipo_dimissione,options:h.map(e=>({value:e.value,label:e.label})),onChange:d("tipo_dimissione"),placeholder:"Seleziona..."})]}),"dimissione"===n.tipo_dimissione&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"dismissal-code",children:"Codice dimissione"}),e.jsx(t,{id:"dismissal-code",value:n.codice_dimissione??"",options:p.map(e=>({value:e.value,label:e.label})),onChange:d("codice_dimissione"),placeholder:"Seleziona..."})]}),"trasferimento_interno"===n.tipo_dimissione&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"dismissal-dept",children:"Reparto destinazione"}),e.jsx(t,{id:"dismissal-dept",value:n.reparto_destinazione??"",options:j.map(e=>({value:e.value,label:e.label})),onChange:d("reparto_destinazione"),placeholder:"Seleziona..."})]}),"trasferimento_esterno"===n.tipo_dimissione&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"dismissal-clinic",children:"Clinica destinazione"}),e.jsx("input",{id:"dismissal-clinic",name:"clinica_destinazione",className:"form-control",value:n.clinica_destinazione??"",onChange:e=>{const{name:i,value:a}=e.target;r(e=>({...e,[i]:a}))}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"dismissal-clinic-code",children:"Codice clinica"}),e.jsx(t,{id:"dismissal-clinic-code",value:n.codice_clinica??"",options:u.map(e=>({value:e.value,label:e.label})),onChange:d("codice_clinica"),placeholder:"Seleziona..."})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(o,{type:"submit",disabled:s,children:"Conferma dimissione"}),e.jsx(o,{type:"button",variant:"secondary",onClick:a,children:"Annulla"})]})]})};const g=()=>{const t=n(),[m,h]=l.useState(""),[p,u]=l.useState(null),j=l.useCallback(()=>{t("/list")},[t]),{data:x=[],isLoading:g,refetch:b}=i({queryKey:["patients","search",m],queryFn:()=>async function(e,i={}){const a=e.trim();return a?d.searchPatients(a,i.activeOnly??!1,i.limit??50):[]}(m,{activeOnly:!0,limit:20}),enabled:!!m.trim()}),N=l.useMemo(()=>Boolean(p),[p]),f=a(),_=s({mutationFn:({patientId:e,data:i})=>d.dischargePatientWithTransfer(e,i),onSuccess:()=>{c("Dimissione registrata con successo"),u(null),f.invalidateQueries({queryKey:["patients"]}),f.invalidateQueries({queryKey:["patients","search"]})},onError:e=>{r(e.message||"Errore durante la dimissione")}});return e.jsxs("div",{className:"discharge-page-container",children:[e.jsx("div",{className:"discharge-hero",children:e.jsx("div",{className:"discharge-hero-content",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"discharge-title",children:"Dimissioni Paziente"}),e.jsx("p",{className:"discharge-subtitle",children:"Cerca un paziente e registra i dati di dimissione o trasferimento"})]}),e.jsxs("button",{type:"button",className:"discharge-back-button",onClick:j,"aria-label":"Torna alla lista",children:[e.jsx("span",{className:"material-icons align-middle me-1",children:"arrow_back"}),e.jsx("span",{className:"back-button-text",children:"Torna alla lista"})]})]})})}),e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12 col-lg-10 col-xl-8 mx-auto",children:[e.jsxs("div",{className:"discharge-main-card",children:[e.jsx("div",{className:"discharge-card-header",children:e.jsxs("div",{className:"discharge-card-title-wrapper",children:[e.jsx("div",{className:"discharge-card-icon",children:e.jsx("span",{className:"material-icons",children:"person_search"})}),e.jsx("h2",{className:"discharge-card-title",children:"Dimissione Paziente"})]})}),e.jsxs("div",{className:"discharge-card-body",children:[e.jsxs("div",{className:"discharge-search-section",children:[e.jsx("div",{className:"search-header",children:e.jsx("h3",{className:"search-section-title",children:"Ricerca Paziente"})}),e.jsxs("div",{className:"search-body",children:[e.jsxs("div",{className:"row g-3 align-items-end",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",htmlFor:"discharge-search",children:"Cerca paziente"}),e.jsx("input",{id:"discharge-search",type:"search",className:"form-control",value:m,onChange:e=>h(e.target.value),placeholder:"Inserisci nome o cognome"})]}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{variant:"primary",onClick:()=>b(),disabled:g||!m.trim(),children:g?"Ricerca...":"Cerca"})})]}),x.length>0&&e.jsx("div",{className:"patient-results-list",children:x.map(i=>e.jsxs("div",{className:"patient-result-item",children:[e.jsxs("div",{className:"patient-info",children:[e.jsx("div",{className:"patient-icon",children:e.jsx("span",{className:"material-icons",children:"person"})}),e.jsxs("div",{className:"patient-details",children:[e.jsxs("div",{className:"patient-name",children:[i.nome," ",i.cognome]}),i.reparto_appartenenza&&e.jsx("div",{className:"patient-department",children:i.reparto_appartenenza})]})]}),e.jsx(o,{size:"sm",onClick:()=>(e=>{const i=x.find(i=>i.id===e)??null;u(i),h("")})(i.id),children:"Seleziona"})]},i.id))})]})]}),N&&e.jsxs("div",{className:"discharge-form-section",children:[e.jsxs("div",{className:"form-header",children:[e.jsx("h3",{className:"form-section-title",children:"Registra Dimissione"}),e.jsxs("div",{className:"selected-patient-badge",children:[e.jsx("span",{className:"material-icons",children:"person"}),e.jsx("span",{children:e.jsxs("strong",{children:[p?.nome," ",p?.cognome]})})]})]}),e.jsx("div",{className:"form-body",children:e.jsx(v,{patientId:p.id,onSubmit:e=>_.mutate({patientId:p.id,data:e}),onCancel:()=>u(null),isSubmitting:_.isPending})})]}),!N&&e.jsxs("div",{className:"discharge-empty-state-inline",children:[e.jsx("div",{className:"empty-icon",children:e.jsx("span",{className:"material-icons",children:"person_search"})}),e.jsx("div",{className:"empty-title",children:"Nessun paziente selezionato"}),e.jsx("p",{className:"empty-description",children:"Seleziona un paziente dalla ricerca per procedere con la dimissione."})]})]})]}),e.jsx("div",{className:"discharge-help-card card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"discharge-help-header",children:[e.jsx("div",{className:"help-icon",children:e.jsx("span",{className:"material-icons",children:"info"})}),e.jsx("h3",{className:"help-title",children:"Informazioni"})]}),e.jsxs("ul",{className:"discharge-help-list",children:[e.jsx("li",{children:"Cerca il paziente per nome o cognome"}),e.jsx("li",{children:"Seleziona il paziente dalla lista dei risultati"}),e.jsx("li",{children:"Compila i dati di dimissione o trasferimento"}),e.jsx("li",{children:"La dimissione non può essere registrata per pazienti già dimessi"})]})]})})]})})]})};export{g as DischargePage,g as default};
