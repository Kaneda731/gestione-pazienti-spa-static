import{j as e}from"./shared-DM1owLfs.js";import{e as s,l as a,a as i,z as n,A as t}from"./core-services-CSrwUk3W.js";import{u as r}from"./react-vendor-DMMrM9kC.js";import"./ui-vendor-CKm97sqn.js";import"./supabase-D6dgNb7x.js";const o=()=>{const o=r(),[l,c]=i.useState([]),[d,m]=i.useState(!0),[g,u]=i.useState({nome:""}),[h,x]=i.useState(null),[b,p]=i.useState(!1);i.useEffect(()=>{j()},[]);const j=async()=>{try{m(!0);const e=await async function(){const{data:e,error:i}=await s.from("diagnosi").select("id, nome").order("nome",{ascending:!0});if(i)throw a.error("Errore caricamento diagnosi:",i),new Error("Impossibile caricare le diagnosi.");return e||[]}();c(e)}catch(e){const s=e instanceof Error?e.message:"Impossibile caricare le diagnosi.";n(s)}finally{m(!1)}},f=async e=>{if(window.confirm(`Sei sicuro di voler eliminare la diagnosi "${e.nome}"?`))try{await async function(e){const i="string"==typeof e?parseInt(e,10):e,{error:n}=await s.from("diagnosi").delete().eq("id",i);if(n)throw a.error("Errore eliminazione diagnosi:",n),new Error("Impossibile eliminare la diagnosi.")}(e.id),t("Diagnosi eliminata con successo!"),await j()}catch(i){const e=i instanceof Error?i.message:"Impossibile eliminare la diagnosi.";n(e)}};return e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsxs("h3",{className:"mb-0",children:[e.jsx("span",{className:"material-icons me-2",style:{verticalAlign:"text-bottom"},children:"medical_information"}),"Gestione Diagnosi"]}),e.jsxs("button",{className:"btn btn-back-menu btn-sm",onClick:()=>o("/#/home"),children:[e.jsx("span",{className:"material-icons me-1",style:{verticalAlign:"text-bottom"},children:"arrow_back"}),"Torna al Menu"]})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("form",{onSubmit:async e=>{e.preventDefault();const i=g.nome.trim();if(!i)return n("Il nome della diagnosi non puÃ² essere vuoto."),void 0;p(!0);try{await async function(e,i){let n;if(e){const a="string"==typeof e?parseInt(e,10):e;n=await s.from("diagnosi").update({nome:i}).eq("id",a).select().single()}else n=await s.from("diagnosi").insert({nome:i}).select().single();if(n.error)throw a.error("Errore salvataggio diagnosi:",n.error),new Error("Impossibile salvare la diagnosi.");return n.data}(h,i);t(`Diagnosi ${h?"aggiornata":"aggiunta"} con successo!`),u({nome:""}),x(null),await j()}catch(r){const e=r instanceof Error?r.message:"Impossibile salvare la diagnosi.";n(e)}finally{p(!1)}},className:"mb-4 modern-form",children:e.jsxs("div",{className:"diagnosi-form-container d-flex gap-2",children:[e.jsx("input",{type:"text",id:"diagnosi-name-input",className:"form-control",placeholder:"Nome nuova diagnosi",value:g.nome,onChange:e=>u({nome:e.target.value}),required:!0,disabled:b}),e.jsxs("div",{className:"d-flex gap-2",children:[h&&e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>{u({nome:""}),x(null)},disabled:b,children:[e.jsx("span",{className:"material-icons",children:"cancel"}),"Annulla"]}),e.jsxs("button",{type:"submit",className:"btn btn-primary",disabled:b||!g.nome.trim(),children:[e.jsx("span",{className:"material-icons",children:h?"edit":"add"}),e.jsx("span",{children:h?"Aggiorna":"Aggiungi Diagnosi"})]})]})]})}),e.jsx("div",{className:"table-responsive",children:d?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Caricamento..."})})}):0===l.length?e.jsx("div",{className:"text-center py-5",children:e.jsx("p",{className:"text-muted mb-0",children:"Nessuna diagnosi trovata."})}):e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome Diagnosi"}),e.jsx("th",{className:"text-end",children:"Azioni"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Nome Diagnosi",children:s.nome}),e.jsxs("td",{"data-label":"Azioni",className:"text-end",children:[e.jsx("button",{className:"btn btn-sm btn-warning me-2",onClick:()=>(e=>{u({nome:e.nome}),x(e.id),setTimeout(()=>{const e=document.getElementById("diagnosi-name-input");e&&e.focus()},100)})(s),title:"Modifica diagnosi",children:e.jsx("span",{className:"material-icons",children:"edit"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>f(s),title:"Elimina diagnosi",children:e.jsx("span",{className:"material-icons",children:"delete"})})]})]},s.id))})]})})]})]})})};export{o as DiagnosiPage,o as default};
