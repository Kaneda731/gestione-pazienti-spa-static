import{j as e}from"./ui-vendor-CgDpQ-gO.js";import{u as a}from"./useQuery-DHgbAv0-.js";import{b as i,u as s,k as n}from"./react-vendor-bU8fvvPN.js";import{f as l}from"./helpers-DX8-z5jj.js";import{p as t}from"./patientService-oe8gV68P.js";import"./index-Dqbc-UpZ.js";import"./supabase-DpMRTrmd.js";import"./CentralizedStatisticsService-CVcbLe3Q.js";const r=({onEdit:a,onAddIntervention:i,onAddInfection:s,onDischarge:n,isDischarged:l=!1})=>e.jsxs("div",{className:"patient-detail-bottom-actions d-flex d-lg-none",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:a,title:"Modifica paziente","aria-label":"Modifica paziente",children:"âœï¸"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-info",onClick:i,title:"Aggiungi intervento","aria-label":"Aggiungi intervento",children:"â•"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:s,title:"Aggiungi infezione","aria-label":"Aggiungi infezione",children:"ğŸ¦ "}),!l&&n&&e.jsx("button",{type:"button",className:"btn btn-sm btn-danger",onClick:n,title:"Dimetti paziente","aria-label":"Dimetti paziente",children:"ğŸ“‹"})]}),c=({patient:a})=>e.jsxs("div",{className:"anagrafica-tab",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome"}),e.jsx("p",{className:"form-control-plaintext",children:a.nome||"-"})]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Cognome"}),e.jsx("p",{className:"form-control-plaintext",children:a.cognome||"-"})]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Data Nascita"}),e.jsx("p",{className:"form-control-plaintext",children:a.data_nascita?l(a.data_nascita):"-"})]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Codice Fiscale"}),e.jsx("p",{className:"form-control-plaintext",title:a.codice_fiscale||"",children:a.codice_fiscale||"-"})]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Codice RAD"}),e.jsx("p",{className:"form-control-plaintext",children:a.codice_rad||"-"})]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Stato Paziente"}),e.jsx("p",{className:"form-control-plaintext",children:e.jsx("span",a.data_dimissione?{className:"badge bg-secondary",children:"Dimesso"}:{className:"badge bg-success",children:"Ricoverato"})})]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Diagnosi"}),e.jsx("p",{className:"form-control-plaintext",children:a.diagnosi||"-"})]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Infetto"}),e.jsx("p",{className:"form-control-plaintext",children:e.jsx("span",a.infetto?{className:"badge bg-danger",children:"SÃ¬"}:{className:"badge bg-success",children:"No"})})]})})]}),a.note&&e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Note"}),e.jsx("p",{className:"form-control-plaintext",children:a.note})]})})})]}),d=({event:a,index:s})=>{const[n,t]=i.useState(!1),r="intervento"===a.tipo_evento,c="infezione"===a.tipo_evento,d=c&&null!=a.data_fine_evento;return e.jsxs("div",{className:"events-timeline__item",children:[e.jsx("div",{className:"events-timeline__marker",style:{color:r?"var(--color-primary)":"var(--color-danger)"},children:e.jsx("span",{className:"events-timeline__icon",children:r?"ğŸ”µ":"ğŸ”´"})}),s<99&&e.jsx("div",{className:"events-timeline__line"}),e.jsxs("div",{className:"events-timeline__content",children:[e.jsxs("div",{className:"events-timeline__header",children:[e.jsx("h6",{className:"events-timeline__title",children:r?"Intervento":"Infezione"}),e.jsx("span",{className:"events-timeline__date",children:l(a.data_evento)})]}),e.jsxs("div",{className:"events-timeline__meta",children:[r&&a.tipo_intervento&&e.jsx("span",{className:"badge bg-info",children:a.tipo_intervento}),c&&a.agente_patogeno&&e.jsx("span",{className:"badge bg-danger",children:a.agente_patogeno}),c&&e.jsx("span",{className:"badge "+(d?"bg-success":"bg-warning text-dark"),children:d?"Risolto":"Attivo"})]}),a.descrizione&&e.jsxs("div",{className:"events-timeline__description",children:[n||a.descrizione.length<=100?e.jsx("p",{className:"mb-0",children:a.descrizione}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-2",children:[a.descrizione.substring(0,100),"â€¦"]}),e.jsx("button",{onClick:()=>t(!0),"aria-expanded":!1,className:"btn btn-link btn-sm p-0",children:"Mostra dettagli"})]}),n&&a.descrizione.length>100&&e.jsx("button",{onClick:()=>t(!1),"aria-expanded":!0,className:"btn btn-link btn-sm p-0 ms-2",children:"Nascondi"})]}),c&&a.data_fine_evento&&e.jsx("div",{className:"events-timeline__end-date",children:e.jsxs("small",{className:"text-muted",children:["Risolto il: ",l(a.data_fine_evento)]})})]})]},a.id)},o=({events:a,initialLimit:s=20})=>{const[n,l]=i.useState(s),t=i.useMemo(()=>[...a].sort((e,a)=>{const i=new Date(e.data_evento).getTime();return new Date(a.data_evento).getTime()-i}),[a]),r=t.slice(0,n),c=n<t.length;return e.jsx("div",{className:"events-timeline",children:r.length>0?e.jsxs(e.Fragment,{children:[r.map((a,i)=>e.jsx(d,{event:a,index:i},a.id)),c&&e.jsx("div",{className:"events-timeline__load-more",children:e.jsxs("button",{onClick:()=>{l(e=>e+20)},className:"btn btn-outline-primary btn-sm",children:["Carica altri ",20," eventi",e.jsxs("span",{className:"ms-2",children:["(",n," di ",t.length,")"]})]})})]}):e.jsx("div",{className:"alert alert-info",children:"Nessun evento clinico disponibile"})})},m=({clinicalEvents:a})=>0===a.length?e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Nessun evento clinico registrato"}),e.jsx("p",{className:"mb-0 mt-2",children:"Aggiungi un intervento o un'infezione dalla scheda del paziente."})]}):e.jsx("div",{className:"events-tab",children:e.jsx(o,{events:a,initialLimit:20})}),h=({patient:a})=>{const s=i.useMemo(()=>{if(!a.data_ricovero)return null;const e=new Date(a.data_ricovero),i=a.data_dimissione?new Date(a.data_dimissione):new Date,s=Math.abs(i.getTime()-e.getTime());return Math.ceil(s/864e5)},[a.data_ricovero,a.data_dimissione]);return e.jsxs("div",{className:"ricovero-tab",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Data Ricovero"}),e.jsx("p",{className:"form-control-plaintext",children:a.data_ricovero?l(a.data_ricovero):"-"})]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Durata Ricovero"}),e.jsx("p",{className:"form-control-plaintext",children:s?`${s} giorni`:"-"})]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Reparto Appartenenza"}),e.jsx("p",{className:"form-control-plaintext",children:a.reparto_appartenenza||"-"})]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Reparto Provenienza"}),e.jsx("p",{className:"form-control-plaintext",children:a.reparto_provenienza||"-"})]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Livello Assistenza"}),e.jsx("p",{className:"form-control-plaintext",children:a.livello_assistenza||"-"})]})})}),a.data_dimissione&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-4"}),e.jsx("h5",{className:"mb-3",children:"Informazioni Dimissione"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Data Dimissione"}),e.jsx("p",{className:"form-control-plaintext",children:l(a.data_dimissione)})]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Tipo Dimissione"}),e.jsx("p",{className:"form-control-plaintext",children:a.tipo_dimissione?e.jsxs("span",{className:"badge bg-primary",children:["dimissione"===a.tipo_dimissione&&"Dimissione","trasferimento_interno"===a.tipo_dimissione&&"Trasferimento Interno","trasferimento_esterno"===a.tipo_dimissione&&"Trasferimento Esterno","decesso"===a.tipo_dimissione&&"Decesso"]}):"-"})]})})]}),("trasferimento_interno"===a.tipo_dimissione||"trasferimento_esterno"===a.tipo_dimissione||"dimissione"===a.tipo_dimissione)&&e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Reparto/Clinica Destinazione"}),e.jsx("p",{className:"form-control-plaintext",children:a.reparto_destinazione||a.clinica_destinazione||"-"})]})}),a.codice_clinica&&e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Codice Clinica"}),e.jsx("p",{className:"form-control-plaintext",children:a.codice_clinica})]})})]}),a.codice_dimissione&&e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Codice Dimissione"}),e.jsx("p",{className:"form-control-plaintext",children:a.codice_dimissione})]})})})]})]})},x=({patientData:a})=>{const[s,n]=i.useState("anagrafica");return e.jsxs("div",{className:"patient-detail-tabs",children:[e.jsx("ul",{className:"patient-detail-tabs__nav",role:"tablist",children:[{key:"anagrafica",label:"Anagrafica"},{key:"eventi",label:"Eventi Clinici"},{key:"ricovero",label:"Ricovero"}].map(a=>e.jsx("li",{className:"patient-detail-tabs__tab",role:"presentation",children:e.jsx("button",{type:"button",role:"tab",id:`tab-${a.key}`,"aria-selected":s===a.key,"aria-controls":`tab-panel-${a.key}`,onClick:()=>n(a.key),className:s===a.key?"active":"",children:a.label})},a.key))}),e.jsxs("div",{className:"patient-detail-tabs__content",children:["anagrafica"===s&&e.jsx("div",{id:"tab-panel-anagrafica",role:"tabpanel","aria-labelledby":"tab-anagrafica",children:e.jsx(c,{patient:a.patient})}),"eventi"===s&&e.jsx("div",{id:"tab-panel-eventi",role:"tabpanel","aria-labelledby":"tab-eventi",children:e.jsx(m,{clinicalEvents:a.clinicalEvents})}),"ricovero"===s&&e.jsx("div",{id:"tab-panel-ricovero",role:"tabpanel","aria-labelledby":"tab-ricovero",children:e.jsx(h,{patient:a.patient})})]})]})},p=({patient:a,onAddEvent:i})=>{const n=s(),t="decesso"===a.tipo_dimissione,r="trasferimento_esterno"===a.tipo_dimissione||"trasferimento_interno"===a.tipo_dimissione,c=null!=a.data_dimissione;return e.jsxs("div",{className:"patient-info-card",children:[e.jsxs("h3",{children:[a.cognome," ",a.nome]}),e.jsxs("div",{className:"patient-info-card__badges",children:[c&&e.jsxs(e.Fragment,{children:[t&&e.jsx("span",{className:"badge bg-danger",children:"Deceduto"}),r&&!t&&e.jsx("span",{className:"badge bg-warning text-dark",children:"Trasferito"}),!t&&!r&&e.jsx("span",{className:"badge bg-secondary",children:"Dimesso"})]}),!c&&e.jsx("span",{className:"badge bg-success",children:"Ricoverato"}),a.infetto&&e.jsx("span",{className:"badge bg-danger",children:"Infetto"})]}),e.jsxs("div",{className:"patient-info-card__info",style:{marginTop:"1.5rem"},children:[a.data_nascita&&e.jsxs("div",{className:"patient-info-card__item",children:[e.jsx("strong",{children:"Data Nascita:"}),e.jsx("span",{children:l(a.data_nascita)})]}),a.codice_rad&&e.jsxs("div",{className:"patient-info-card__item",children:[e.jsx("strong",{children:"Codice RAD:"}),e.jsx("span",{children:a.codice_rad})]}),a.codice_fiscale&&e.jsxs("div",{className:"patient-info-card__item",children:[e.jsx("strong",{children:"Codice Fiscale:"}),e.jsxs("span",{title:a.codice_fiscale,children:[a.codice_fiscale.substring(0,8),"..."]})]}),a.reparto_appartenenza&&e.jsxs("div",{className:"patient-info-card__item",children:[e.jsx("strong",{children:"Reparto:"}),e.jsx("span",{children:a.reparto_appartenenza})]}),a.data_ricovero&&e.jsxs("div",{className:"patient-info-card__item",children:[e.jsx("strong",{children:"Data Ricovero:"}),e.jsx("span",{children:l(a.data_ricovero)})]}),c&&a.data_dimissione&&e.jsxs("div",{className:"patient-info-card__item",children:[e.jsx("strong",{children:"Data Dimissione:"}),e.jsx("span",{children:l(a.data_dimissione)})]})]}),e.jsxs("div",{className:"patient-info-card__actions d-none d-lg-flex",children:[e.jsxs("button",{onClick:()=>{n(`/inserimento?id=${a.id}`)},className:"btn btn-sm btn-primary",title:"Modifica dati paziente",children:[e.jsx("span",{className:"material-icons","aria-hidden":"true",style:{fontSize:"1rem",verticalAlign:"middle",marginRight:"4px"},children:"edit"}),"Modifica"]}),e.jsxs("button",{onClick:()=>{i?.("intervento")},className:"btn btn-sm btn-info",title:"Aggiungi intervento chirurgico",children:[e.jsx("span",{className:"material-icons","aria-hidden":"true",style:{fontSize:"1rem",verticalAlign:"middle",marginRight:"4px"},children:"add_circle"}),"Intervento"]}),e.jsxs("button",{onClick:()=>{i?.("infezione")},className:"btn btn-sm btn-warning",title:"Aggiungi infezione",children:[e.jsx("span",{className:"material-icons","aria-hidden":"true",style:{fontSize:"1rem",verticalAlign:"middle",marginRight:"4px"},children:"bug_report"}),"Infezione"]}),!c&&e.jsxs("button",{onClick:()=>{n(`/dimissione?id=${a.id}`)},className:"btn btn-sm btn-danger",title:"Dimetti paziente",children:[e.jsx("span",{className:"material-icons","aria-hidden":"true",style:{fontSize:"1rem",verticalAlign:"middle",marginRight:"4px"},children:"logout"}),"Dimetti"]}),e.jsxs("button",{onClick:()=>{window.print()},className:"btn btn-sm btn-secondary",title:"Stampa la pagina",children:[e.jsx("span",{className:"material-icons","aria-hidden":"true",style:{fontSize:"1rem",verticalAlign:"middle",marginRight:"4px"},children:"print"}),"Stampa"]})]})]})},j=()=>{const{id:l}=n(),c=s(),{data:d,isPending:o,isError:m,error:h}=a({queryKey:["patient-detail",l],queryFn:()=>t.getPatientFullData(l),enabled:!!l}),j=i.useCallback(e=>{c(`/eventi-clinici/nuovo?type=${e}&patientId=${l}`)},[c,l]);return i.useEffect(()=>{if(m||!d){const e=setTimeout(()=>c("/list"),3e3);return()=>clearTimeout(e)}},[m,d,c]),l?e.jsxs("div",o?{role:"status","aria-live":"polite","aria-label":"Caricamento dati paziente",children:[e.jsxs("div",{className:"patient-detail-page__skeleton",children:[e.jsx("div",{className:"patient-detail-page__hero",style:{minHeight:"120px"},children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"placeholder-glow",children:e.jsx("span",{className:"placeholder",style:{height:"2.5rem",width:"50%"}})})})}),e.jsx("div",{className:"container-fluid mt-5 mb-5",children:e.jsxs("div",{className:"patient-detail-page__layout",children:[e.jsx("aside",{className:"patient-detail-page__sidebar",children:e.jsx("div",{className:"placeholder-glow",style:{minHeight:"400px"},children:e.jsx("div",{className:"placeholder",style:{height:"100%",minHeight:"300px"}})})}),e.jsx("main",{className:"patient-detail-page__content",children:e.jsx("div",{className:"placeholder-glow",style:{minHeight:"400px"},children:e.jsx("div",{className:"placeholder",style:{height:"100%",minHeight:"300px"}})})})]})})]}),e.jsx("span",{className:"visually-hidden",children:"Caricamento dati paziente in corso..."})]}:m||!d?{className:"container mt-5",role:"alert","aria-live":"assertive",children:[e.jsxs("div",{className:"alert alert-danger",role:"status",children:[e.jsx("h4",{className:"alert-heading",children:"Errore nel caricamento"}),e.jsx("p",{children:h?.message||"Paziente non trovato. Torna alla lista in 3 secondi..."})]}),e.jsx("button",{onClick:()=>c("/list"),className:"btn btn-primary","aria-label":"Torna alla lista pazienti",children:"â† Torna alla lista"})]}:{className:"patient-detail-page",children:[e.jsx("nav",{"aria-label":"Breadcrumb",className:"patient-detail-page__breadcrumb",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("ol",{className:"breadcrumb mb-0",children:[e.jsx("li",{className:"breadcrumb-item",children:e.jsxs("button",{onClick:()=>c("/home"),className:"btn btn-link p-0",style:{textDecoration:"none"},"aria-label":"Home",children:[e.jsx("span",{className:"material-icons","aria-hidden":"true",style:{fontSize:"1rem",verticalAlign:"middle"},children:"home"})," Home"]})}),e.jsx("li",{className:"breadcrumb-item",children:e.jsxs("button",{onClick:()=>c("/list"),className:"btn btn-link p-0",style:{textDecoration:"none"},"aria-label":"Lista pazienti",children:[e.jsx("span",{className:"material-icons","aria-hidden":"true",style:{fontSize:"1rem",verticalAlign:"middle"},children:"people"})," Pazienti"]})}),e.jsxs("li",{className:"breadcrumb-item active","aria-current":"page",children:[d.patient.cognome," ",d.patient.nome]})]})})}),e.jsx("div",{className:"patient-detail-page__hero",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("h1",{className:"patient-detail-page__title",children:[d.patient.cognome," ",d.patient.nome]})})}),e.jsx("div",{className:"container-fluid mt-5 mb-5",children:e.jsxs("div",{className:"patient-detail-page__layout",children:[e.jsx("aside",{className:"patient-detail-page__sidebar",children:e.jsx(p,{patient:d.patient,onAddEvent:j})}),e.jsx("main",{className:"patient-detail-page__content",children:e.jsx(x,{patientData:d})})]})}),e.jsx(r,{onEdit:()=>c(`/inserimento?id=${l}`),onAddIntervention:()=>j("intervento"),onAddInfection:()=>j("infezione"),onDischarge:()=>c(`/dimissione?id=${l}`),isDischarged:!!d.patient.data_dimissione})]}):e.jsx("div",{className:"container mt-5",children:e.jsxs("div",{className:"alert alert-danger",children:["ID paziente non trovato."," ",e.jsx("button",{onClick:()=>c("/list"),className:"btn btn-link",children:"Torna alla lista"})]})})};export{j as PatientDetailPage,j as default};
