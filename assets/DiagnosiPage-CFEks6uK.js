import{j as e}from"./ui-vendor-CgDpQ-gO.js";import{u as s,b as a}from"./react-vendor-bU8fvvPN.js";import{s as i,l as n}from"./index-CV8IAmz6.js";import{u as t}from"./useNotification-DRPixuBw.js";import"./supabase-DpMRTrmd.js";const r=()=>{const r=s(),{notify:o}=t(),[l,c]=a.useState([]),[d,m]=a.useState(!0),[u,g]=a.useState({nome:""}),[h,x]=a.useState(null),[b,p]=a.useState(!1);a.useEffect(()=>{j()},[]);const j=async()=>{try{m(!0);const e=await async function(){const{data:e,error:s}=await i.from("diagnosi").select("id, nome").order("nome",{ascending:!0});if(s)throw n.error("Errore caricamento diagnosi:",s),new Error("Impossibile caricare le diagnosi.");return e||[]}();c(e)}catch(e){const s=e instanceof Error?e.message:"Impossibile caricare le diagnosi.";o.error(s).show()}finally{m(!1)}},f=async e=>{if(window.confirm(`Sei sicuro di voler eliminare la diagnosi "${e.nome}"?`))try{await async function(e){const s="string"==typeof e?parseInt(e,10):e,{error:a}=await i.from("diagnosi").delete().eq("id",s);if(a)throw n.error("Errore eliminazione diagnosi:",a),new Error("Impossibile eliminare la diagnosi.")}(e.id),o.success("Diagnosi eliminata con successo!").show(),await j()}catch(s){const e=s instanceof Error?s.message:"Impossibile eliminare la diagnosi.";o.error(e).show()}};return e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsxs("h3",{className:"mb-0",children:[e.jsx("span",{className:"material-icons me-2",style:{verticalAlign:"text-bottom"},children:"medical_information"}),"Gestione Diagnosi"]}),e.jsxs("button",{className:"btn btn-back-menu btn-sm",onClick:()=>r("/home"),children:[e.jsx("span",{className:"material-icons me-1",style:{verticalAlign:"text-bottom"},children:"arrow_back"}),"Torna al Menu"]})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("form",{onSubmit:async e=>{e.preventDefault();const s=u.nome.trim();if(!s)return o.error("Il nome della diagnosi non puÃ² essere vuoto.").show(),void 0;p(!0);try{await async function(e,s){let a;if(e){const n="string"==typeof e?parseInt(e,10):e;a=await i.from("diagnosi").update({nome:s}).eq("id",n).select().single()}else a=await i.from("diagnosi").insert({nome:s}).select().single();if(a.error)throw n.error("Errore salvataggio diagnosi:",a.error),new Error("Impossibile salvare la diagnosi.");return a.data}(h,s);o.success(`Diagnosi ${h?"aggiornata":"aggiunta"} con successo!`).show(),g({nome:""}),x(null),await j()}catch(a){const e=a instanceof Error?a.message:"Impossibile salvare la diagnosi.";o.error(e).show()}finally{p(!1)}},className:"mb-4 modern-form",children:e.jsxs("div",{className:"diagnosi-form-container d-flex gap-2",children:[e.jsx("input",{type:"text",id:"diagnosi-name-input",className:"form-control",placeholder:"Nome nuova diagnosi",value:u.nome,onChange:e=>g({nome:e.target.value}),required:!0,disabled:b}),e.jsxs("div",{className:"d-flex gap-2",children:[h&&e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>{g({nome:""}),x(null)},disabled:b,children:[e.jsx("span",{className:"material-icons",children:"cancel"}),"Annulla"]}),e.jsxs("button",{type:"submit",className:"btn btn-primary",disabled:b||!u.nome.trim(),children:[e.jsx("span",{className:"material-icons",children:h?"edit":"add"}),e.jsx("span",{children:h?"Aggiorna":"Aggiungi Diagnosi"})]})]})]})}),e.jsx("div",{className:"table-responsive",children:d?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Caricamento..."})})}):0===l.length?e.jsx("div",{className:"text-center py-5",children:e.jsx("p",{className:"text-muted mb-0",children:"Nessuna diagnosi trovata."})}):e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome Diagnosi"}),e.jsx("th",{className:"text-end",children:"Azioni"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Nome Diagnosi",children:s.nome}),e.jsxs("td",{"data-label":"Azioni",className:"text-end",children:[e.jsx("button",{className:"btn btn-sm btn-warning me-2",onClick:()=>(e=>{g({nome:e.nome}),x(e.id),setTimeout(()=>{const e=document.getElementById("diagnosi-name-input");e&&e.focus()},100)})(s),title:"Modifica diagnosi",children:e.jsx("span",{className:"material-icons",children:"edit"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>f(s),title:"Elimina diagnosi",children:e.jsx("span",{className:"material-icons",children:"delete"})})]})]},s.id))})]})})]})]})})};export{r as DiagnosiPage,r as default};
