const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotificationContainer-I5YRnCf9.js","assets/index-Tu0R_pQ1.js","assets/ui-vendor-S6RcKJ66.js","assets/react-vendor-Bp2pLdQf.js","assets/supabase-Zkii_ZbW.js","assets/index-X8jeTIBP.css"])))=>i.map(i=>d[i]);
import{_ as t,l as e,E as i,q as r}from"./index-Tu0R_pQ1.js";let n=null,s=null;async function o(){return n||(s||(s=(async()=>{try{const{notificationService:e}=await t(async()=>{const{notificationService:t}=await Promise.resolve().then(()=>F);return{notificationService:t}},void 0);return n=e,n&&"function"==typeof n.init&&await n.init(),n}catch(e){if(console.error("Failed to initialize NotificationService:",e),n)return n;throw e}})(),s))}const a=async(t,e)=>(await o()).success(t,e),c=async(t,e)=>(await o()).info(t,e),l=async(t,e)=>(await o()).warning(t,e),u=async(t,e)=>(await o()).error(t,e);const d=new class{notifications=[];settings;subscribers=new Map;cleanupTimer=null;constructor(){this.settings=this.getDefaultSettings(),this.loadPersistedSettings(),this.startAutoCleanup(),e.debug("NotificationStateManager initialized")}getDefaultSettings(){return{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:!0,autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}}}loadPersistedSettings(){try{const t=localStorage.getItem("notificationSettings");if(t){const e=JSON.parse(t);this.settings={...this.settings,...e}}}catch(t){e.warn("Failed to load persisted notification settings:",t)}}persistSettings(){try{localStorage.setItem("notificationSettings",JSON.stringify(this.settings))}catch(t){e.warn("Failed to persist notification settings:",t)}}subscribe(t){const e=Symbol("notificationSubscriber");return this.subscribers.set(e,t),()=>{this.subscribers.delete(e)}}notifySubscribers(){this.subscribers.forEach((t,i)=>{try{t(this.notifications,this.settings)}catch(r){e.error(`Error in notification subscriber ${String(i)}:`,r)}})}addNotification(t,i,r={}){let n={};n="number"==typeof r?{duration:r}:r;const s=function(t){const e=String(t||"").toLowerCase().trim();return["error","errore","err","danger","fatal"].includes(e)?"error":["success","ok","successo"].includes(e)?"success":["warning","warn","avviso","alert"].includes(e)?"warning":"info"}(t),o=void 0!==this.settings.customDurations[s]?this.settings.customDurations[s]:this.settings.defaultDuration,a=n.persistent??this.settings.persistentTypes.includes(s),c={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:s,title:n.title||"",message:i,timestamp:new Date,isVisible:!0,isRemoving:!1,isPersistent:a,options:{duration:o,persistent:a,...n}};return c.options.persistent&&(c.options.duration=0),e.debug(`[NotificationStateManager] Current notifications before adding: ${this.notifications.length}`,this.notifications),this.handleDeduplication(s,i)?"":(this.notifications=[...this.notifications,c],this.enforceMaxNotifications(),this.notifySubscribers(),e.debug(`[NotificationStateManager] Notification added. New notifications array length: ${this.notifications.length}`,this.notifications),c.id)}handleDeduplication(t,i){try{const e=Date.now(),r=1500;if("success"===t||"info"===t){const n=[...this.notifications].reverse().findIndex(n=>{const s=new Date(n.timestamp).getTime();return n.type===t&&n.message===i&&e-s<=r});if(-1!==n){const t=this.notifications.length-1-n,e=this.notifications[t],i={...e,timestamp:new Date,options:{...e.options,duplicateCount:(e.options.duplicateCount||1)+1}};return this.notifications=[...this.notifications],this.notifications[t]=i,this.notifySubscribers(),!0}}}catch(r){e.warn("Deduplication failed:",r)}return!1}enforceMaxNotifications(){if(this.notifications.length>this.settings.maxStoredNotifications){e.warn(`[NotificationStateManager] Max stored notifications (${this.settings.maxStoredNotifications}) exceeded. Trimming old notifications.`);const t=[...this.notifications].sort((t,e)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,this.notifications.length-this.settings.maxStoredNotifications);this.notifications=this.notifications.filter(e=>!t.includes(e)||e.options.persistent&&"error"===e.type),e.debug(`[NotificationStateManager] Notifications after trimming: ${this.notifications.length}`,this.notifications)}}removeNotification(t){const i=this.notifications.length;this.notifications=this.notifications.filter(e=>e.id!==t),this.notifications.length!==i&&(e.debug(`[NotificationStateManager] Notification ${t} removed`),this.notifySubscribers())}clearAllNotifications(){this.notifications.length>0&&(this.notifications=[],this.notifySubscribers(),e.debug("[NotificationStateManager] All notifications cleared"))}clearNotificationsByType(t){const i=this.notifications.length;this.notifications=this.notifications.filter(e=>e.type!==t),this.notifications.length!==i&&(e.debug(`[NotificationStateManager] Notifications of type '${t}' cleared`),this.notifySubscribers())}updateSettings(t){const i={...this.settings,...t};this.settings=i,this.persistSettings(),void 0!==t.autoCleanupInterval&&this.startAutoCleanup(),this.notifySubscribers(),e.debug("[NotificationStateManager] Settings updated:",i)}getSettings(){return{...this.settings}}getNotifications(){return[...this.notifications]}getNotificationsByType(t){return this.notifications.filter(e=>e.type===t)}getVisibleNotifications(){return this.notifications.filter(t=>t.isVisible&&!t.isRemoving).slice(-this.settings.maxVisible)}hasErrorNotifications(){return this.notifications.some(t=>"error"===t.type)}getStats(){const t={success:0,error:0,warning:0,info:0};let e=0,i=null,r=null;if(this.notifications.length>0){const t=this.notifications.map(t=>new Date(t.timestamp).getTime());i=Math.min(...t),r=Math.max(...t)}return this.notifications.forEach(i=>{t[i.type]=(t[i.type]||0)+1,i.options.persistent&&e++}),{total:this.notifications.length,visible:this.getVisibleNotifications().length,byType:t,persistent:e,oldest:i,newest:r}}clearOldNotifications(t=3e5){const i=Date.now(),r=this.notifications.length;this.notifications=this.notifications.filter(e=>{const r=new Date(e.timestamp).getTime();if(!Number.isFinite(r))return!0;return!(i-r>t&&!e.options.persistent)});const n=r-this.notifications.length;return n>0&&(e.debug(`[NotificationStateManager] Cleaned up ${n} old notifications`),this.notifySubscribers()),n}startAutoCleanup(){this.cleanupTimer&&clearInterval(this.cleanupTimer);const t=this.settings.autoCleanupInterval;t>0&&(this.cleanupTimer=setInterval(()=>{this.clearOldNotifications()},t),e.debug(`[NotificationStateManager] Auto cleanup started with interval: ${t}ms`))}exportSettings(){return{version:"2.0",timestamp:(new Date).toISOString(),settings:{...this.settings},exportedBy:"NotificationStateManager"}}importSettings(t){try{return!(!t||"object"!=typeof t||!t.settings)&&(t.version&&"2.0"!==t.version&&"1.0"!==t.version&&e.warn(`Unsupported backup version: ${t.version}`),this.settings={...this.getDefaultSettings(),...t.settings},this.persistSettings(),this.startAutoCleanup(),this.notifySubscribers(),e.debug("[NotificationStateManager] Settings imported successfully"),!0)}catch(i){return e.error("Failed to import notification settings:",i),!1}}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.subscribers.clear(),this.notifications=[],e.debug("[NotificationStateManager] Destroyed")}};function h(t,e){u(t,e).catch(t=>{console.error("Failed to show error notification:",t)})}function m(t,e){a(t,e).catch(t=>{console.error("Failed to show success notification:",t)})}function p(t,e){c(t,e).catch(t=>{console.error("Failed to show info notification:",t)})}function g(t,e){l(t,e).catch(t=>{console.error("Failed to show warning notification:",t)})}function f(t){return"object"==typeof t&&null!==t}class y{timers;onTimeout;constructor(t){this.timers=new Map,this.onTimeout=t??(t=>e.debug(`Timer expired for notification ${t}`)),e.debug("NotificationTimerManager initialized")}startAutoCloseTimer(t,e,i){if(this.timers.has(t)){const e=this.timers.get(t);e&&clearTimeout(e.timerId)}const r=Date.now(),n=setTimeout(()=>{this.timers.delete(t),i(t)},e);this.timers.set(t,{timerId:n,originalDuration:e,startTime:r,remainingTime:e,isPaused:!1,pausedAt:null,callback:i})}pauseAutoCloseTimer(t){const i=this.timers.get(t);i&&!i.isPaused&&(clearTimeout(i.timerId),i.isPaused=!0,i.pausedAt=Date.now(),i.remainingTime=i.remainingTime-(i.pausedAt-i.startTime),e.debug(`‚è∏Ô∏è Timer paused for notification: ${t}`))}resumeAutoCloseTimer(t){const i=this.timers.get(t);i&&i.isPaused&&(i.isPaused=!1,i.startTime=Date.now(),i.timerId=setTimeout(()=>{this.timers.delete(t),i.callback&&i.callback(t)},i.remainingTime),e.debug(`‚ñ∂Ô∏è Timer resumed for notification: ${t}`))}stopAutoCloseTimer(t,i){const r=this.timers.get(t);if(r){clearTimeout(r.timerId),this.timers.delete(t);try{"function"==typeof i&&i(t)}catch(n){e.warn("Timer onStop callback error:",n)}e.debug(`‚èπÔ∏è Timer stopped for notification: ${t}`)}}start(t,i,r){try{if(this.stop(t),i<=0)return e.debug(`[TimerManager] No timer set for notification ${t} (duration: ${i})`),!1;const n=r??this.onTimeout;return this.startAutoCloseTimer(t,i,t=>{e.debug(`[TimerManager] Timer ${t} expired`),n(t)}),e.debug(`[TimerManager] Timer started for notification ${t} (${i}ms)`),!0}catch(n){return e.error(`[TimerManager] Failed to start timer for ${t}:`,n),!1}}pause(t){try{return this.timers.has(t)?(this.pauseAutoCloseTimer(t),e.debug(`[TimerManager] Timer paused for notification ${t}`),!0):(e.debug(`[TimerManager] No timer to pause for notification ${t}`),!1)}catch(i){return e.error(`[TimerManager] Failed to pause timer for ${t}:`,i),!1}}resume(t){try{return this.timers.has(t)?(this.resumeAutoCloseTimer(t),e.debug(`[TimerManager] Timer resumed for notification ${t}`),!0):(e.debug(`[TimerManager] No timer to resume for notification ${t}`),!1)}catch(i){return e.error(`[TimerManager] Failed to resume timer for ${t}:`,i),!1}}stop(t,i){try{return!!this.timers.has(t)&&(this.stopAutoCloseTimer(t,i),e.debug(`[TimerManager] Timer stopped for notification ${t}`),!0)}catch(r){return e.error(`[TimerManager] Failed to stop timer for ${t}:`,r),!1}}pauseAll(){let t=0;try{this.timers.forEach((e,i)=>{this.pause(i)&&t++}),e.debug(`[TimerManager] Paused ${t}/${this.timers.size} timers`)}catch(i){e.error("[TimerManager] Failed to pause all timers:",i)}return t}resumeAll(){let t=0;try{this.timers.forEach((e,i)=>{this.resume(i)&&t++}),e.debug(`[TimerManager] Resumed ${t}/${this.timers.size} timers`)}catch(i){e.error("[TimerManager] Failed to resume all timers:",i)}return t}stopAll(t){let i=0;try{Array.from(this.timers.keys()).forEach(e=>{this.stop(e,t)&&i++}),e.debug(`[TimerManager] Stopped ${i} timers`)}catch(r){e.error("[TimerManager] Failed to stop all timers:",r)}return i}cleanupOrphanedTimers(t=[]){let i=0;try{const r=new Set(t);Array.from(this.timers.keys()).forEach(t=>{r.has(t)||this.stop(t)&&i++}),i>0&&e.debug(`[TimerManager] Cleaned up ${i} orphaned timers`)}catch(r){e.error("[TimerManager] Failed to cleanup orphaned timers:",r)}return i}getStats(){try{const t={total:this.timers.size,active:0,paused:0,activeIds:[],pausedIds:[]};return this.timers.forEach((e,i)=>{f(e)&&(e.isPaused??e.paused?(t.paused++,t.pausedIds.push(i)):(t.active++,t.activeIds.push(i)))}),t}catch(t){return e.error("[TimerManager] Failed to get stats:",t),{total:0,active:0,paused:0,activeIds:[],pausedIds:[],error:t instanceof Error?t.message:"Unknown error"}}}hasTimer(t){return this.timers.has(t)}isPaused(t){try{const e=this.timers.get(t);return!!f(e)&&Boolean(e.isPaused??e.paused)}catch(i){return e.error(`[TimerManager] Failed to check if timer ${t} is paused:`,i),!1}}getRemainingTime(t){try{const e=this.timers.get(t);if(!f(e))return-1;if((e.isPaused??e.paused)&&"number"==typeof e.remainingTime)return e.remainingTime;if("number"==typeof e.remainingTime&&"number"==typeof e.startTime){const t=Date.now()-e.startTime;return Math.max(e.remainingTime-t,0)}return-1}catch(i){return e.error(`[TimerManager] Failed to get remaining time for ${t}:`,i),-1}}cleanup(){try{const t=this.stopAll();this.timers.clear(),e.debug(`[TimerManager] Cleanup completed (${t} timers stopped)`)}catch(t){e.error("[TimerManager] Failed to cleanup:",t)}}destroy(){this.cleanup(),this.onTimeout=()=>{},e.debug("[TimerManager] Manager destroyed")}}class b{timerManager;progressBarManager;constructor({timerManager:t,progressBarManager:e}={}){this.timerManager=t??new y,this.progressBarManager=e??null}start(t,e,i){return this.timerManager.start(t,e,i)}pause(t){return this.timerManager.pause(t)}resume(t){return this.timerManager.resume(t)}stop(t,e){return this.timerManager.stop(t,e??(t=>this.progressBarManager?.stop(t)))}pauseAll(){return this.timerManager.pauseAll()}resumeAll(){return this.timerManager.resumeAll()}stopAll(t){return this.timerManager.stopAll(t)}cleanupOrphans(t=[]){return this.timerManager.cleanupOrphanedTimers(t)}hasTimer(t){return this.timerManager.hasTimer(t)}}class v{element;duration;type;startTime;animationId;isPaused;pausedTime;isDestroyed;timing;progressBar;progressFill;pauseStartTime;lastLoggedProgress;constructor(t,e=4e3,i="success"){this.element=t,this.duration=e,this.type=i,this.startTime=null,this.animationId=null,this.isPaused=!1,this.pausedTime=0,this.isDestroyed=!1,this.timing=this.createEasingFunction("linear"),this.progressBar=null,this.progressFill=null,this.pauseStartTime=null,this.lastLoggedProgress=-1,this.init()}createEasingFunction(t="linear"){const e={linear:t=>t,easeOut:t=>1-Math.pow(1-t,3),easeIn:t=>Math.pow(t,3),easeInOut:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2};return e[t]||e.linear}init(){if(this.isDestroyed)return;const t=this.element.querySelector(".notification__progress--js-placeholder");t?this.replaceProgressBarPlaceholder(t):this.element.querySelector(".notification__progress")||this.createProgressBar(),this.progressBar=this.element.querySelector(".notification__progress"),this.progressFill=this.element.querySelector(".notification__progress-fill"),this.progressBar&&this.progressFill&&this.start()}replaceProgressBarPlaceholder(t){t.classList.remove("notification__progress--js-placeholder"),t.classList.add("notification__progress--js-controlled"),t.setAttribute("aria-valuenow","100");const e={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"};t.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${e[this.type]||e.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const i=document.createElement("div");i.className="notification__progress-fill";const r={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"};i.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${r[this.type]||r.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,t.innerHTML="",t.appendChild(i)}createProgressBar(){const t={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"},e={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"},i=document.createElement("div");i.className="notification__progress notification__progress--js-controlled",i.setAttribute("role","progressbar"),i.setAttribute("aria-label","Tempo rimanente prima della chiusura automatica"),i.setAttribute("aria-valuemin","0"),i.setAttribute("aria-valuemax","100"),i.setAttribute("aria-valuenow","100"),i.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${t[this.type]||t.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const r=document.createElement("div");r.className="notification__progress-fill",r.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${e[this.type]||e.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,i.appendChild(r),this.element.appendChild(i)}start(){this.isDestroyed||(this.startTime=performance.now(),this.lastLoggedProgress=-1,this.animate({timing:this.timing,draw:t=>this.draw(t),duration:this.duration}))}animate({timing:t,draw:e,duration:i}){if(this.isDestroyed)return;const r=this.startTime,n=s=>{if(this.isDestroyed)return;if(this.isPaused)return this.animationId=requestAnimationFrame(n),void 0;let o=(s-(r??0)-this.pausedTime)/i;o>1&&(o=1),o<0&&(o=0);let a=t(o);e(a),this.updateAccessibility(o),o<1?this.animationId=requestAnimationFrame(n):this.onComplete()};this.animationId=requestAnimationFrame(n)}draw(t){if(this.isDestroyed||!this.progressFill)return;this.progressFill.style.transform=`scaleX(${1-t})`}updateAccessibility(t){if(this.progressBar){const e=Math.round(100*(1-t));this.progressBar.setAttribute("aria-valuenow",e.toString())}}pause(){this.isPaused||this.isDestroyed||(this.isPaused=!0,this.pauseStartTime=performance.now())}resume(){this.isPaused&&!this.isDestroyed&&(this.isPaused=!1,this.pauseStartTime&&(this.pausedTime+=performance.now()-this.pauseStartTime,this.pauseStartTime=null))}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.progressFill&&!this.isDestroyed&&(this.progressFill.style.transform="scaleX(0)")}onComplete(){if(this.isDestroyed)return;const t=new CustomEvent("progressComplete",{detail:{element:this.element,type:this.type,duration:this.duration}});this.element.dispatchEvent(t)}destroy(){this.isDestroyed=!0,this.stop(),this.progressBar&&this.progressBar.parentNode&&this.progressBar.parentNode.removeChild(this.progressBar),this.element=null,this.progressBar=null,this.progressFill=null}}function w(t,e,i){return new v(t,e,i)}class M{container;progressBars;constructor(t){this.container=t,this.progressBars=new Map,e.debug("NotificationProgressBarManager initialized")}start(t,i,r){if(i<=0)return null;try{this.stop(t);const n=this.queryElement(t);if(!n)return e.warn(`[ProgressBarManager] Element not found for notification ${t}`),null;const s=this.createProgressBar(n,i,r);return s&&(this.progressBars.set(t,s),n._progressBarInstance=s,e.debug(`[ProgressBarManager] Progress bar started for notification ${t}`)),s}catch(n){return e.error(`[ProgressBarManager] Failed to start progress bar for ${t}:`,n),null}}pause(t){try{const i=this.progressBars.get(t);i&&(i.pause(),e.debug(`[ProgressBarManager] Progress bar paused for notification ${t}`))}catch(i){e.error(`[ProgressBarManager] Failed to pause progress bar for ${t}:`,i)}}resume(t){try{const i=this.progressBars.get(t);i&&(i.resume(),e.debug(`[ProgressBarManager] Progress bar resumed for notification ${t}`))}catch(i){e.error(`[ProgressBarManager] Failed to resume progress bar for ${t}:`,i)}}stop(t){try{const i=this.progressBars.get(t);if(i){i.destroy(),this.progressBars.delete(t);const r=this.queryElement(t);r&&r._progressBarInstance&&(r._progressBarInstance=null),e.debug(`[ProgressBarManager] Progress bar stopped for notification ${t}`)}}catch(i){e.error(`[ProgressBarManager] Failed to stop progress bar for ${t}:`,i)}}pauseAll(){try{this.progressBars.forEach((t,e)=>this.pause(e)),e.debug(`[ProgressBarManager] All progress bars paused (${this.progressBars.size})`)}catch(t){e.error("[ProgressBarManager] Failed to pause all progress bars:",t)}}resumeAll(){try{this.progressBars.forEach((t,e)=>this.resume(e)),e.debug(`[ProgressBarManager] All progress bars resumed (${this.progressBars.size})`)}catch(t){e.error("[ProgressBarManager] Failed to resume all progress bars:",t)}}cleanup(){try{const t=this.progressBars.size;this.progressBars.forEach((t,e)=>this.stop(e)),this.progressBars.clear(),e.debug(`[ProgressBarManager] Cleanup completed (${t} progress bars destroyed)`)}catch(t){e.error("[ProgressBarManager] Failed to cleanup progress bars:",t)}}getStats(){return{active:this.progressBars.size,activeIds:Array.from(this.progressBars.keys())}}isActive(t){return this.progressBars.has(t)}destroy(){this.cleanup(),this.container=null,e.debug("[ProgressBarManager] Manager destroyed")}createProgressBar(t,i,r){try{const e=t.querySelector(".notification__progress--js-placeholder"),n=w(t,i,e?.dataset?.type||t.dataset?.type||"info");if(r){const e=()=>{try{r(t.dataset?.id??"")}catch{}t.removeEventListener("progressComplete",e)};t.addEventListener("progressComplete",e)}return{pause:()=>{try{n?.pause?.()}catch{}},resume:()=>{try{n?.resume?.()}catch{}},destroy:()=>{try{n?.destroy?.()}catch{}},get isPaused(){return Boolean(n?.isPaused)},get isDestroyed(){return Boolean(n?.isDestroyed)},get progress(){try{return n?.progress??0}catch{return 0}}}}catch(n){return e.error("[ProgressBarManager] Failed to create progress bar:",n),null}}queryElement(t){const e=this.container?.querySelector(`[data-id="${t}"]`);return e??null}}const E={SUCCESS:{icon:"check_circle",ariaRole:"status",ariaLive:"polite",defaultDuration:4e3},ERROR:{icon:"error",ariaRole:"alert",ariaLive:"assertive",defaultDuration:0},WARNING:{icon:"warning",ariaRole:"alert",ariaLive:"assertive",defaultDuration:6e3},INFO:{icon:"info",ariaRole:"status",ariaLive:"polite",defaultDuration:5e3}},T={maxWidth:768};function S(t,e){if(void 0!==e)return e;const i=E[t.toUpperCase()];return i?i.defaultDuration:5e3}class A{element=null;queue=[];isProcessing=!1;currentTimeout=null;static _instance=null;options;constructor(t={}){this.options={id:t.id||"notification-announcer",className:t.className||"notification__sr-only",defaultLive:t.defaultLive||"polite",enableQueue:!1!==t.enableQueue,queueDelay:t.queueDelay||150,maxQueueSize:t.maxQueueSize||10,...t},this.init()}init(){this.createElement(),this.setupAccessibility()}createElement(){const t=document.getElementById(this.options.id||"notification-announcer");t&&t.remove(),this.element=document.createElement("div"),this.element.id=this.options.id||"notification-announcer",this.element.className=this.options.className||"notification__sr-only",document.body.appendChild(this.element)}setupAccessibility(){this.element&&(this.element.setAttribute("aria-live",this.options.defaultLive||"polite"),this.element.setAttribute("aria-atomic","true"),this.element.setAttribute("role","status"),this.element.style.cssText="\n            position: absolute !important;\n            width: 1px !important;\n            height: 1px !important;\n            padding: 0 !important;\n            margin: -1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n        ")}announce(t,i={}){if(!t||"string"!=typeof t)return e.warn("NotificationLiveRegion: messaggio non valido",t),void 0;const r={message:t.trim(),live:i.live||this.options.defaultLive||"polite",priority:i.priority||0,timestamp:Date.now(),id:this.generateAnnouncementId()};this.options.enableQueue?this.addToQueue(r):this.processAnnouncement(r)}announceSuccess(t,e=""){this.announce(e?`Successo: ${e}. ${t}`:`Successo: ${t}`,{live:"polite",priority:1})}announceError(t,e=""){this.announce(e?`Errore: ${e}. ${t}`:`Errore: ${t}`,{live:"assertive",priority:3})}announceWarning(t,e=""){this.announce(e?`Attenzione: ${e}. ${t}`:`Attenzione: ${t}`,{live:"assertive",priority:2})}announceInfo(t,e=""){this.announce(e?`Informazione: ${e}. ${t}`:`Informazione: ${t}`,{live:"polite",priority:1})}announceNotification(t,e,i="",r={}){const n={success:"Successo",error:"Errore",warning:"Attenzione",info:"Informazione"}[t]||"Notifica";this.announce(i?`${n}: ${i}. ${e}`:`${n}: ${e}`,{live:{success:"polite",error:"assertive",warning:"assertive",info:"polite"}[t]||"polite",priority:{success:1,error:3,warning:2,info:1}[t]||1,...r})}addToQueue(t){const e=Date.now()-3e3;this.queue=this.queue.filter(i=>i.timestamp<e||i.message!==t.message);this.queue.length>=(this.options.maxQueueSize||10)&&this.queue.shift();const i=this.queue.findIndex(e=>e.priority<t.priority);-1===i?this.queue.push(t):this.queue.splice(i,0,t),this.processQueue()}processQueue(){if(this.isProcessing||0===this.queue.length)return;this.isProcessing=!0;const t=this.queue.shift();t&&this.processAnnouncement(t),this.currentTimeout=setTimeout(()=>{this.isProcessing=!1,this.processQueue()},this.options.queueDelay||150)}processAnnouncement(t){if(!this.element)return;this.element.getAttribute("aria-live")!==t.live&&this.element.setAttribute("aria-live",t.live),this.element.textContent="",setTimeout(()=>{this.element&&(this.element.textContent=t.message,this.dispatchEvent("announced",{announcement:t}))},50)}clearQueue(){this.queue=[],this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.isProcessing=!1,this.dispatchEvent("queueCleared")}clear(){this.element&&(this.element.textContent=""),this.dispatchEvent("cleared")}updateSettings(t){this.options={...this.options,...t},t.defaultLive&&this.element&&this.element.setAttribute("aria-live",t.defaultLive),this.dispatchEvent("settingsUpdated",{options:this.options})}getState(){if(!this.element)throw new Error("LiveRegion not initialized");return{id:this.options.id||"notification-announcer",queueLength:this.queue.length,isProcessing:this.isProcessing,currentContent:this.element.textContent||"",currentLive:this.element.getAttribute("aria-live")||"",options:{...this.options}}}generateAnnouncementId(){return`announcement-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}dispatchEvent(t,e={}){const i=new CustomEvent(`notificationLiveRegion:${t}`,{detail:{liveRegion:this,...e}});document.dispatchEvent(i)}destroy(){this.clearQueue(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchEvent("destroyed"),this.element=null,this.queue=[]}static getInstance(t={}){return A._instance||(A._instance=new A(t)),A._instance}static destroyInstance(){A._instance&&(A._instance.destroy(),A._instance=null)}static exists(){return!!A._instance}}let C=null;function _(t,e,i=""){try{C||(C=A.getInstance({id:"notification-announcer"})),C.announceNotification?.(t,e,i)}catch(r){const i=document.getElementById("notification-announcer");i&&(i.textContent=`${t}: ${e}`)}}function N(t,e,{removeNotification:i}){const r=t.querySelector(".notification__close");r&&r.addEventListener("click",t=>{t.stopPropagation(),i(e.id)}),t.addEventListener("keydown",t=>{"Escape"===t.key&&(t.preventDefault(),i(e.id))})}function x(t,e,{pauseAutoCloseTimer:i}){let r=0;t.addEventListener("touchstart",()=>{r=Date.now()}),t.addEventListener("touchend",()=>{Date.now()-r>500&&i?.(e.id)})}class B{static DEBUG=!1;static notificationQueue=[];static isDOMReady=!1;static domReadyCallbacks=[];static animationSupport=null;static reducedMotionPreference=null;static errorCounts={render:0,animation:0,dom:0,service:0,total:0};static init(){this.checkDOMReady(),this.checkAnimationSupport(),this.checkReducedMotionPreference(),this.setupErrorRecovery(),this.DEBUG&&e.debug("‚úÖ NotificationErrorHandler initialized")}static handleRenderError(t,i,r=null){if(this.errorCounts.render++,this.errorCounts.total++,e.error("‚ùå Notification render error:",t,i),"undefined"!=typeof window&&window.appLogger){const e=window.appLogger;e&&e.error("Notification render failed",{error:t.message,notificationId:i?.id,notificationType:i?.type,stack:t.stack})}try{return r&&"function"==typeof r?r(i):this.createSimpleFallback(i)}catch(n){return e.error("‚ùå Fallback renderer also failed:",n),this.showConsoleFallback(i),null}}static handleAnimationError(t,i,r="unknown"){if(this.errorCounts.animation++,this.errorCounts.total++,e.warn("‚ö†Ô∏è Animation error:",t,r),i)try{i.style.animation="none",i.style.transition="none","entrance"===r?(i.style.opacity="1",i.style.transform="translateX(0)",i.classList.add("notification--visible"),i.classList.remove("notification--entering")):"exit"===r&&(i.style.opacity="0",i.classList.add("notification--hidden"),i.classList.remove("notification--exiting")),this.DEBUG&&e.debug("‚úÖ Animation fallback applied to element")}catch(n){e.error("‚ùå Animation fallback failed:",n)}}static handleServiceError(t,i,r=null){if(this.errorCounts.service++,this.errorCounts.total++,this.errorCounts.service%10==1&&e.error(`‚ùå NotificationService error in ${i} (${this.errorCounts.service} total):`,t),"undefined"!=typeof window&&window.appLogger){const e=window.appLogger;e&&e.error(`NotificationService ${i} failed`,{error:t.message,operation:i,data:r,stack:t.stack})}try{switch(i){case"show":this.recoverFromShowError(r);break;case"remove":this.recoverFromRemoveError(r);break;case"clear":this.recoverFromClearError();break;case"init":this.recoverFromInitError();break;default:e.warn(`‚ö†Ô∏è No recovery strategy for operation: ${i}`)}}catch(n){e.error("‚ùå Error recovery failed:",n)}}static handleDOMError(t,i,r=null){return this.errorCounts.dom++,this.errorCounts.total++,e.error(`‚ùå DOM error in ${i}:`,t),!(!this.isDOMReady&&"render"===i)||(e.debug("üìã DOM not ready, queueing notification"),!1)}static queueNotification(t,i){if(this.isDOMReady)try{return t(i)}catch(r){return this.handleRenderError(r,i)}return this.notificationQueue.push({renderFunction:t,notification:i,timestamp:Date.now()}),this.DEBUG&&e.debug(`üìã Queued notification ${i?.id}, queue size: ${this.notificationQueue.length}`),null}static processNotificationQueue(){if(!this.isDOMReady||0===this.notificationQueue.length)return;e.debug(`üöÄ Processing ${this.notificationQueue.length} queued notifications`);const t=[...this.notificationQueue];this.notificationQueue=[],t.forEach(({renderFunction:t,notification:i,timestamp:r})=>{try{if(Date.now()-r>3e4)return e.warn("‚ö†Ô∏è Skipping old queued notification:",i?.id),void 0;t(i)}catch(n){this.handleRenderError(n,i)}})}static createSimpleFallback(t){const i=document.createElement("div");i.className=`notification notification--${t.type} notification--fallback`,i.setAttribute("data-id",t.id),i.setAttribute("role","error"===t.type?"alert":"status"),i.setAttribute("aria-live","error"===t.type?"assertive":"polite"),i.style.cssText="\n            position: relative;\n            padding: 12px 16px;\n            margin: 8px 0;\n            border-radius: 4px;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 14px;\n            line-height: 1.4;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n            max-width: 400px;\n            word-wrap: break-word;\n        ";const r={success:{bg:"#d4edda",text:"#155724",border:"#c3e6cb"},error:{bg:"#f8d7da",text:"#721c24",border:"#f5c6cb"},warning:{bg:"#fff3cd",text:"#856404",border:"#ffeaa7"},info:{bg:"#d1ecf1",text:"#0c5460",border:"#bee5eb"}},n=r[t.type]||r.info;i.style.backgroundColor=n.bg,i.style.color=n.text,i.style.border=`1px solid ${n.border}`;const s=document.createElement("div");s.style.cssText="display: flex; align-items: flex-start; gap: 8px;";const o=document.createElement("span");o.style.cssText="flex-shrink: 0; font-weight: bold; font-size: 16px;";const a={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"};o.textContent=a[t.type]||a.info;const c=document.createElement("div");if(c.style.cssText="flex: 1; min-width: 0;",t.title){const e=document.createElement("div");e.style.cssText="font-weight: bold; margin-bottom: 4px;",e.textContent=t.title,c.appendChild(e)}const l=document.createElement("div");l.textContent=t.message||`Notifica ${t.type||"info"} - Messaggio non disponibile`,c.appendChild(l);const u=document.createElement("button");return u.style.cssText=`\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            padding: 0;\n            margin-left: 8px;\n            color: ${n.text};\n            opacity: 0.7;\n            flex-shrink: 0;\n        `,u.textContent="√ó",u.setAttribute("aria-label","Chiudi notifica"),u.onclick=()=>{i.remove();try{d&&"function"==typeof d.removeNotification&&d.removeNotification(t.id)}catch(r){e.debug("Could not remove from state:",r)}},s.appendChild(o),s.appendChild(c),s.appendChild(u),i.appendChild(s),this.DEBUG&&e.debug("‚úÖ Created simple fallback notification"),i}static showConsoleFallback(t){const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},r=`${i[t.type]||i.info} NOTIFICATION: ${t.message||`Notifica ${t.type||"info"} - Messaggio non disponibile`}`;"error"===t.type?e.error(r):"warning"===t.type?e.warn(r):e.info(r)}static checkDOMReady(){if("undefined"==typeof document)return this.isDOMReady=!1,void 0;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.isDOMReady=!0,this.processNotificationQueue(),this.domReadyCallbacks.forEach(t=>{try{t()}catch(i){e.error("‚ùå DOM ready callback error:",i)}}),this.domReadyCallbacks=[]}):this.isDOMReady=!0}static checkAnimationSupport(){if("undefined"==typeof window||"undefined"==typeof document)return this.animationSupport=!1,void 0;try{const t=document.createElement("div");t.style.animation="test 1s",this.animationSupport=""!==t.style.animation}catch(t){this.animationSupport=!1}this.DEBUG&&e.debug("üé¨ Animation support:",this.animationSupport)}static checkReducedMotionPreference(){if("undefined"==typeof window||!window.matchMedia)return this.reducedMotionPreference=!1,void 0;try{const t=window.matchMedia("(prefers-reduced-motion: reduce)");this.reducedMotionPreference=t.matches,t.addEventListener("change",t=>{this.reducedMotionPreference=t.matches,this.DEBUG&&e.debug("üé¨ Reduced motion preference changed:",this.reducedMotionPreference)})}catch(t){this.reducedMotionPreference=!1}this.DEBUG&&e.debug("üé¨ Reduced motion preference:",this.reducedMotionPreference)}static setupErrorRecovery(){setInterval(()=>{this.cleanupOldQueuedNotifications()},6e4),"undefined"!=typeof window&&window.addEventListener("error",t=>{t.message&&t.message.includes("notification")&&e.warn("‚ö†Ô∏è Possible notification-related error detected")})}static cleanupOldQueuedNotifications(){const t=Date.now(),i=this.notificationQueue.length;this.notificationQueue=this.notificationQueue.filter(e=>t-e.timestamp<6e4);const r=i-this.notificationQueue.length;r>0&&this.DEBUG&&e.debug(`üßπ Cleaned up ${r} old queued notifications`)}static recoverFromShowError(t){e.debug("üîÑ Attempting recovery from show error");try{const i=this.createSimpleFallback(t);if(i){const t=document.querySelector(".notification-container")||document.querySelector("#notification-container")||document.body;if(t)return t.appendChild(i),e.debug("‚úÖ Fallback notification added to DOM"),!0}}catch(i){e.error("‚ùå Show recovery failed:",i)}return this.showConsoleFallback(t),!1}static recoverFromRemoveError(t){e.debug("üîÑ Attempting recovery from remove error");try{const i=document.querySelector(`[data-id="${t}"]`);if(i)return i.remove(),e.debug("‚úÖ Notification removed via DOM recovery"),!0}catch(i){e.error("‚ùå Remove recovery failed:",i)}return!1}static recoverFromClearError(){e.debug("üîÑ Attempting recovery from clear error");try{const t=document.querySelectorAll('.notification, [class*="notification"]');return t.forEach(t=>{try{t.remove()}catch(i){e.debug("Could not remove notification element:",i)}}),e.debug(`‚úÖ Cleared ${t.length} notifications via DOM recovery`),!0}catch(t){e.error("‚ùå Clear recovery failed:",t)}return!1}static recoverFromInitError(){e.debug("üîÑ Attempting recovery from init error");try{let t=document.querySelector(".notification-container");if(!t)return t=document.createElement("div"),t.className="notification-container notification-container--fallback",t.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    z-index: 9999;\n                    pointer-events: none;\n                ",document.body.appendChild(t),e.debug("‚úÖ Fallback notification container created"),!0}catch(t){e.error("‚ùå Init recovery failed:",t)}return!1}static getErrorStats(){return{...this.errorCounts,queueSize:this.notificationQueue.length,isDOMReady:this.isDOMReady,animationSupport:this.animationSupport,reducedMotionPreference:this.reducedMotionPreference}}static resetErrorStats(){this.errorCounts={render:0,animation:0,dom:0,service:0,total:0}}static shouldDisableAnimations(){return!this.animationSupport||!0===this.reducedMotionPreference}static onDOMReady(t){if(this.isDOMReady)try{t()}catch(i){e.error("‚ùå DOM ready callback error:",i)}else this.domReadyCallbacks.push(t)}}function $(t,{allowHTML:e=!1}={}){if(!e){const e=document.createElement("div");return e.textContent=String(t??""),e.innerHTML}return r(String(t??""),{allowedTags:["b","strong","i","em","u","br","code","pre","span","p","ul","ol","li","a"],allowedAttributes:{a:["href","title"],"*":["title"]},allowedSchemes:["http","https","mailto"],allowComments:!1})}function D({notification:t,_index:r=0,settings:n,timers:s,timerManager:o,progressBarManager:a,removeNotification:c,startAutoCloseTimer:l,pauseAutoCloseTimer:u,resumeAutoCloseTimer:d,announceNotification:h,attachNotificationEvents:m,attachTouchEvents:p,notificationContainer:g,errorHandler:f=B}){const y=l||((t,e,i,r)=>{o?.start(e,i,r)}),b=u||((t,e)=>{o?.pause(e)}),v=d||((t,e)=>{o?.resume(e)});try{const r=E[t.type.toUpperCase()]||E.INFO,l=t.options||{},u=S(t.type,l.duration),d=document.createElement("div");let B=`notification notification--${t.type}`;if(u>0&&!l.persistent&&(B+=" notification--autoclose"),d.className=B,d.dataset.id=t.id,d.setAttribute("role",r.ariaRole),d.setAttribute("aria-live",r.ariaLive),d.setAttribute("aria-atomic","true"),d.setAttribute("tabindex","0"),n.enableAnimations&&!f.shouldDisableAnimations())try{d.classList.add("notification--entering"),d.addEventListener("animationend",t=>{(t.animationName.includes("slideIn")||t.animationName.includes("fadeIn"))&&(d.classList.remove("notification--entering"),d.classList.add("notification--visible"))}),d.addEventListener("animationerror",t=>{f.handleAnimationError(new Error("Animation failed"),d,"entrance")})}catch(M){f.handleAnimationError(M instanceof Error?M:new Error(String(M)),d,"entrance")}else d.classList.add("notification--visible","notification--no-animations");let D="";try{D=`\n                <div class="notification__content">\n                    <span class="material-icons notification__icon" aria-hidden="true">${r.icon}</span>\n                    <div class="notification__body">\n                        ${l.title?`<div class="notification__title">${$(l.title,{allowHTML:!1})}</div>`:""}\n                        <div class="notification__message">${$(t.message,{allowHTML:!!l.allowHTML})}</div>\n                    </div>\n                </div>\n            `,l.duplicateCount&&l.duplicateCount>1&&(D=D.replace('<span class="material-icons notification__icon" aria-hidden="true">',`<span class="notification__count" aria-label="Ripetuta ${l.duplicateCount} volte">√ó${l.duplicateCount}</span><span class="material-icons notification__icon" aria-hidden="true">`)),(!1!==l.closable||l.actions)&&(D+='<div class="notification__actions">',l.actions&&Array.isArray(l.actions)&&l.actions.forEach((t,e)=>{D+=`\n                            <button class="notification__action-btn ${"primary"===t.style?"notification__action-btn--primary":"secondary"===t.style?"notification__action-btn--secondary":""}" \n                                    data-action-index="${e}"\n                                    aria-label="${$(t.label,{allowHTML:!1})}">\n                                ${$(t.label,{allowHTML:!1})}\n                            </button>\n                        `}),!1!==l.closable&&(D+='\n                        <button class="notification__close" \n                                aria-label="Chiudi notifica"\n                                title="Chiudi notifica">\n                            <span class="material-icons" aria-hidden="true">close</span>\n                        </button>\n                    '),D+="</div>");const n=u;n>0&&!l.persistent&&(e.debug(`üîß Creating progress bar placeholder for ${t.type} (${n}ms)`),D+=`\n                    <div class="notification__progress notification__progress--js-placeholder" \n                         aria-hidden="true" \n                         role="progressbar"\n                         aria-label="Tempo rimanente prima della chiusura automatica"\n                         data-duration="${n}"\n                         data-type="${t.type}"></div>\n                `),d.innerHTML=i(D,{ALLOWED_TAGS:["div","span","button"],ALLOWED_ATTR:["class","role","aria-hidden","aria-label","data-duration","data-type","data-action-index","title"],KEEP_CONTENT:!0})}catch(A){e.error("‚ùå Error building notification HTML:",A),d.innerHTML=$(`\n                <div class="notification__content">\n                    <span class="notification__icon">!</span>\n                    <div class="notification__body">\n                        <div class="notification__message">${t.message||"Notifica"}</div>\n                    </div>\n                    <button class="notification__close" aria-label="Chiudi">√ó</button>\n                </div>\n            `,{allowHTML:!1})}try{m(d,t,{timers:s,removeNotification:c,pauseAutoCloseTimer:b,resumeAutoCloseTimer:v,notificationContainer:g})}catch(C){e.error("‚ùå Error attaching notification events:",C);const i=d.querySelector(".notification__close");i&&i.addEventListener("click",()=>{try{c(t.id)}catch(e){d.remove()}})}try{window.innerWidth<=T.maxWidth&&p(d,t,{pauseAutoCloseTimer:b,resumeAutoCloseTimer:v,removeNotification:c})}catch(_){e.error("‚ùå Error attaching touch events:",_)}try{const i=u;if(i>0&&!l.persistent){const r=d.querySelector(".notification__progress--js-placeholder");if(e.debug("üîç Looking for progress bar placeholder:",r),o&&a)window.innerWidth>768&&(d.addEventListener("mouseenter",()=>{try{o.pause(t.id)}catch{}try{a.pause(t.id)}catch{}}),d.addEventListener("mouseleave",()=>{try{o.resume(t.id)}catch{}try{a.resume(t.id)}catch{}})),e.debug(`üïí Managers provided; start deferred until mount (${t.type})`);else if(r){const r=w(d,i,t.type);y(s,t.id,i,()=>{try{c(t.id)}catch(i){e.error("‚ùå Error in progress complete callback:",i),d.parentNode&&d.remove()}}),window.innerWidth>768&&(d.addEventListener("mouseenter",()=>{r&&r.pause()}),d.addEventListener("mouseleave",()=>{r&&r.resume()})),d._progressBarInstance=r,e.debug(`‚úÖ JavaScript progress bar initialized for ${t.type} (${i}ms)`)}else y(s,t.id,i,()=>{try{c(t.id)}catch(i){e.error("‚ùå Error in auto-close callback:",i),d.parentNode&&d.remove()}}),e.debug(`‚úÖ Fallback timer used for ${t.type} (${i}ms)`)}}catch(N){e.error("‚ùå Error setting up auto-close timer:",N)}try{h(t.type,t.message,l.title||"")}catch(x){e.warn("‚ùå Error announcing notification:",x)}return d}catch(D){return e.error("‚ùå Critical error in createNotificationElement:",D),f.createSimpleFallback(t)}}"undefined"!=typeof window&&B.init();class R{containerEl;timerManager;progressBarManager;settings;onRemove;timersMap;isRendering;_lastRenderedIds;_renderCount;_lastRenderTime;_avgRenderTime;constructor({containerEl:t,timerManager:e,progressBarManager:i,settings:r,onRemove:n,timersMap:s}){this.containerEl=t||null,this.timerManager=e||null,this.progressBarManager=i||null,this.settings=r||{},this.onRemove="function"==typeof n?n:null,this.timersMap=s||new Map,this.isRendering=!1,this._lastRenderedIds=[],this._renderCount=0,this._lastRenderTime=0,this._avgRenderTime=0}setContainer(t){this.containerEl=t,this.progressBarManager&&(this.progressBarManager.container=t)}render(t=[]){if(Array.isArray(t)&&this.containerEl&&!this.isRendering){this.isRendering=!0;try{const i="undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?()=>window.performance.now():()=>Date.now(),r=i(),n=new Set(t.map(t=>t.id)),s=new Set(this._lastRenderedIds);s.forEach(t=>{if(!n.has(t))try{this.removeElement(t)}catch(e){B.handleDOMError(e,"remove",null)}}),t.forEach(t=>{if(!s.has(t.id))try{this.addElement(t)}catch(e){B.handleRenderError(e,t,t=>{const e=B.createSimpleFallback(t);return null!=e&&null!=this.containerEl&&this.containerEl.appendChild(e),e})}}),t.forEach(t=>{if(s.has(t.id))try{const e=this.getElementById(t.id);if(!e)return;const i=t?.options?.duplicateCount||1;let r=e.querySelector(".notification__count");if(i>1)if(r)r.textContent=`√ó${i}`,r.setAttribute("aria-label",`Ripetuta ${i} volte`);else{const t=e.querySelector(".notification__icon");r=document.createElement("span"),r.className="notification__count",r.setAttribute("aria-label",`Ripetuta ${i} volte`),r.textContent=`√ó${i}`,t&&t.parentNode?t.parentNode.insertBefore(r,t):e.querySelector(".notification__content")?.prepend(r)}else r&&r.remove()}catch(e){}});const o=t.length,a=Number(this.settings?.maxVisible??5),c=Math.max(0,o-a),l=c>0?t.slice(0,c):[];e=t=>{try{this.onRemove?.(t)}catch{}},void l.forEach(t=>{"success"!==t.type&&"info"!==t.type||setTimeout(()=>{e(t.id)},1e3)}),this._lastRenderedIds=t.map(t=>t.id);const u=Math.max(0,i()-r);this._lastRenderTime=u,this._renderCount+=1,this._avgRenderTime=1===this._renderCount?u:(this._avgRenderTime*(this._renderCount-1)+u)/this._renderCount}finally{this.isRendering=!1}var e}}addElement(t){const e=this.createElement(t);if(!e)throw new Error("createElement returned null");this.containerEl.appendChild(e),this.afterMount(t,e)}removeElement(t){const e=this.getElementById(t);e&&e.parentNode&&e.parentNode.removeChild(e)}getStats(){return{renderCount:this._renderCount,averageRenderTime:this._avgRenderTime,lastRenderTime:this._lastRenderTime}}updateSettings(t){this.settings=t||this.settings}createElement(t){try{return D({notification:t,settings:this.settings,timers:this.timersMap,timerManager:this.timerManager,progressBarManager:this.progressBarManager,removeNotification:t=>{try{this.onRemove?.(t)}catch{}},announceNotification:_,attachNotificationEvents:N,attachTouchEvents:x,notificationContainer:{container:this.containerEl},errorHandler:B})}catch(i){e.error("[RenderEngine] Failed to create notification element:",i);try{return B.createSimpleFallback(t)}catch(r){return null}}}afterMount(t,i){try{if(!t||!i)return;const e=t.options||{},r=S(t.type,e.duration);r>0&&!e.persistent&&this.timerManager&&this.progressBarManager&&(this.progressBarManager.start(t.id,r,()=>{try{this.onRemove?.(t.id)}catch{}}),this.timerManager.start(t.id,r),"undefined"!=typeof window&&window.innerWidth>768&&(i.addEventListener("mouseenter",()=>{try{this.timerManager.pause(t.id)}catch{}try{this.progressBarManager.pause(t.id)}catch{}}),i.addEventListener("mouseleave",()=>{try{this.timerManager.resume(t.id)}catch{}try{this.progressBarManager.resume(t.id)}catch{}})))}catch(r){e.error("[RenderEngine] afterMount failed:",r)}}getElementById(t){try{return this.containerEl?.querySelector(`[data-id="${t}"]`)||null}catch(e){return null}}pauseAll(){try{this.timerManager?.pauseAll()}catch{}try{this.progressBarManager?.pauseAll()}catch{}}resumeAll(){try{this.timerManager?.resumeAll()}catch{}try{this.progressBarManager?.resumeAll()}catch{}}cleanupAll(){try{this.timerManager?.stopAll()}catch{}try{this.progressBarManager?.cleanup()}catch{}}removeAnimated(t,e,i){try{const r=this.getElementById(t);if(r&&e)try{r.classList.remove("notification--entering"),r.classList.add("notification--exiting");const e=r.querySelector(".notification__progress");return e&&e.classList.remove("notification__progress--active","notification__progress--paused","notification__progress--resumed"),setTimeout(()=>{try{this.removeElement(t)}catch{}try{i?.()}catch{}},300),void 0}catch{}this.removeElement(t);try{i?.()}catch{}}catch(r){try{i?.()}catch{}}}}class P{onHidden;onVisible;_handler;_attached;constructor({onHidden:t,onVisible:e}={}){this.onHidden="function"==typeof t?t:null,this.onVisible="function"==typeof e?e:null,this._handler=this._handleVisibilityChange.bind(this),this._attached=!1}attach(){this._attached||"undefined"==typeof document||(document.addEventListener("visibilitychange",this._handler,{passive:!0}),this._attached=!0)}detach(){this._attached&&"undefined"!=typeof document&&(document.removeEventListener("visibilitychange",this._handler),this._attached=!1)}_handleVisibilityChange(){try{document.hidden?this.onHidden?.():this.onVisible?.()}catch{}}}function I(t){const e=String(t||"").toLowerCase();switch(e){case"errore":case"danger":case"err":case"error":return"error";case"successo":case"ok":case"success":return"success";case"avviso":case"warn":case"warning":return"warning";default:return"info"===e||"informazione"===e?"info":e||"info"}}class L{static DEBUG=!1;notificationContainer;timers;initialized;isRendering;settings;_lastRenderedNotificationIds;_renderCount;_lastRenderTime;_averageRenderTime;_unsubscribe;_unsubscribeSettings;timerManager;progressBarManager;renderEngine;visibilityManager;timerAdapter;constructor(){this.notificationContainer=null,this.timers=new Map,this.initialized=!1,this.isRendering=!1,this.settings=d.getSettings(),this._lastRenderedNotificationIds=[],this._renderCount=0,this._lastRenderTime=0,this._averageRenderTime=0,this._unsubscribe=null,this._unsubscribeSettings=null,this.timerManager=null,this.progressBarManager=null,this.renderEngine=null,this.visibilityManager=null,this.timerAdapter=null}flush(){try{const t=d.getNotifications();this.renderNotifications(t)}catch{}}async init(){if(!this.initialized&&"undefined"!=typeof window)try{await this.#t(),function(){try{C=A.getInstance({id:"notification-announcer"})}catch(t){if(!document.getElementById("notification-announcer")){const t=document.createElement("div");t.id="notification-announcer",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;",document.body.appendChild(t)}}}(),this._unsubscribe=d.subscribe(this.#e),this._unsubscribeSettings=d.subscribe((t,e)=>{try{if(this.settings=e,this.notificationContainer){this.notificationContainer.updateSettings({position:this.settings.position,maxVisible:this.settings.maxVisible})}}catch{}}),this.initialized=!0,this.visibilityManager=new P({onHidden:()=>{try{this.renderEngine?.pauseAll(),this.#i()}catch{}},onVisible:()=>{try{this.renderEngine?.resumeAll(),this.#r()}catch{}}}),this.visibilityManager.attach()}catch(t){B.handleServiceError(t,"init"),this.initialized=!0}}async#t(){if(this.notificationContainer)return;const{NotificationContainer:e}=await t(async()=>{const{NotificationContainer:t}=await import("./NotificationContainer-I5YRnCf9.js");return{NotificationContainer:t}},__vite__mapDeps([0,1,2,3,4,5]));this.notificationContainer=new e({position:this.settings.position,maxVisible:this.settings.maxVisible});const i=this.notificationContainer?.container||null;this.timerManager=new y(t=>this.removeNotification(t)),this.progressBarManager=new M(i),this.renderEngine=new R({containerEl:i,timerManager:this.timerManager,progressBarManager:this.progressBarManager,settings:this.settings,onRemove:t=>this.removeNotification(t),timersMap:this.timers}),this.timerAdapter=new b({timerManager:this.timerManager,progressBarManager:this.progressBarManager})}show(t,e,i={}){try{const r=I(t),n=String(e||"").trim();if(!n){return this.show(r,`Notifica ${r} - Messaggio non disponibile`,i)}const s=function(t,e){const i=t||{},r=(i.customDurations||{})[e];return(i.persistentTypes||[]).includes(e)?0:"number"==typeof r?r:"number"==typeof i.defaultDuration?i.defaultDuration:5e3}(this.settings,r),o=function(t,e,i){const r=e||{};return{duration:void 0!==r.duration?r.duration:i,closable:!1!==r.closable,position:r.position||t&&t.position,priority:r.priority||0,title:r.title,actions:r.actions,persistent:r.persistent,...r}}(this.settings,"number"==typeof i?{duration:i}:i,s);return d.addNotification(r,n,o)}catch(r){B.handleServiceError(r,"show",{type:t,message:e,options:i});const n=B.recoverFromShowError({type:I(t),message:e,options:i,id:Date.now().toString()});return"string"==typeof n?n:Date.now().toString()}}success(t,e={}){return"number"==typeof e&&(e={duration:e}),this.show("success",t,e)}info(t,e={}){return"number"==typeof e&&(e={duration:e}),this.show("info",t,e)}warning(t,e={}){return"number"==typeof e&&(e={duration:e}),this.show("warning",t,e)}error(t,e={}){return"number"==typeof e&&(e={duration:e}),this.show("error",t,e)}renderNotifications(t=[]){Array.isArray(t)&&this.notificationContainer&&(this.renderEngine?.setContainer(this.notificationContainer.container),this.renderEngine?.updateSettings(this.settings),this.renderEngine?.render(t))}#n(t){const e=this.renderEngine?.createElement(t)||D({notification:t,settings:this.settings,timers:this.timers,timerManager:this.timerManager,progressBarManager:this.progressBarManager,removeNotification:t=>this.removeNotification(t),announceNotification:_,attachNotificationEvents:N,attachTouchEvents:x,notificationContainer:this.notificationContainer,errorHandler:B});if(!e)throw new Error("createNotificationElement returned null");this.notificationContainer.addNotification(e);try{this.renderEngine?.afterMount(t,e)}catch{}}#e=this.#s(t=>{Array.isArray(t)&&this.renderNotifications(t)},16);removeNotification(t){try{if(this.timerAdapter?.stop(t,()=>this.progressBarManager?.stop(t)),!this.notificationContainer)return d.removeNotification(t),void 0;const e=this.settings.enableAnimations&&!B.shouldDisableAnimations();this.renderEngine?.removeAnimated(t,e,()=>this.#o(t))}catch(e){B.handleServiceError(e,"remove",t),B.recoverFromRemoveError(t)}}#o(t){this.#a(t)}#a(t){try{d.removeNotification(t)}catch{}}clear(){try{this.timerAdapter?.stopAll(t=>this.progressBarManager?.stop(t)),this.timers.clear(),this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications(),d.clearAllNotifications()}catch(t){B.handleServiceError(t,"clear"),B.recoverFromClearError()}}clearByType(t){d.getNotifications().forEach(e=>{e.type===t&&this.timerAdapter?.stop(e.id,()=>this.progressBarManager?.stop(e.id))}),d.clearNotificationsByType(t)}startAutoCloseTimer(t,e){try{this.timerAdapter?.start(t,e,t=>this.removeNotification(t))}catch{}}pauseAutoCloseTimer(t){try{this.timerAdapter?.pause(t)}catch{}}resumeAutoCloseTimer(t){try{this.timerAdapter?.resume(t)}catch{}}stopAutoCloseTimer(t){try{this.timerAdapter?.stop(t,()=>this.progressBarManager?.stop(t))}catch{}}handleAction(t,e){try{const i=d.getNotifications().find(e=>e.id===t),r=i?.options?.actions?.[e];r&&"function"==typeof r.onClick&&r.onClick({id:t,index:e,notification:i})}catch{}}setCustomDurations(t){this.updateSettings({customDurations:{...this.settings.customDurations||{},...t}})}setPersistentTypes(t){this.updateSettings({persistentTypes:[...t]})}setAutoCleanupInterval(t){this.updateSettings({autoCleanupInterval:t})}updatePosition(t){this.updateSettings({position:t})}setMaxVisible(t){this.updateSettings({maxVisible:t});const e=d.getNotifications();this.renderNotifications(e)}enableSounds(t=!0){this.updateSettings({enableSounds:!!t})}updateSettings(t){try{const e=this._validateSettings(t);if(d.updateSettings(e),this.settings=d.getSettings(),this.notificationContainer){const t={};"position"in e&&(t.position=this.settings.position),"maxVisible"in e&&(t.maxVisible=this.settings.maxVisible),Object.keys(t).length&&this.notificationContainer.updateSettings(t)}return this.renderEngine?.updateSettings(this.settings),!0}catch{return!1}}getStats(){try{return{...d.getStats(),settings:this.settings,activeTimers:this.timerManager?this.timerManager.timers.size:this.timers.size,containerInitialized:!!this.notificationContainer,serviceInitialized:this.initialized,performance:this.renderEngine?.getStats?.()||{renderCount:this._renderCount,averageRenderTime:this._averageRenderTime,lastRenderTime:this._lastRenderTime}}}catch(t){const e=t;return{total:0,visible:0,byType:{success:0,error:0,warning:0,info:0},persistent:0,error:e?.message}}}exportSettings(){try{const t=d.exportSettings();return t.serviceMetadata={version:"2.0",exportedBy:"NotificationService"},t}catch(t){return null}}importSettings(t){try{if(!t||"object"!=typeof t||!t.settings)return!1;t.version&&"1.0"!==t.version&&e.warn(`Versione backup non supportata: ${t.version}`);const i=d.importSettings(t);return i&&(this.settings=d.getSettings()),i}catch(i){return!1}}cleanupOldNotifications(t=3e5){try{const e=d.clearOldNotifications(t),i=new Set(d.getNotifications().map(t=>t.id));return Array.from(this.timers.keys()).forEach(t=>{i.has(t)||this.timers.delete(t)}),e}catch{return 0}}_validateSettings(t){const e={},i=t=>"number"==typeof t&&!Number.isNaN(t),r=t=>"boolean"==typeof t;if(void 0!==t.maxVisible){if(!Number.isInteger(t.maxVisible)||t.maxVisible<1||t.maxVisible>20)throw new Error("maxVisible must be between 1 and 20");e.maxVisible=t.maxVisible}if(void 0!==t.defaultDuration){if(!i(t.defaultDuration)||t.defaultDuration<0)throw new Error("defaultDuration must be >= 0");e.defaultDuration=t.defaultDuration}if(void 0!==t.position){if(!["top-right","top-left","bottom-right","bottom-left","top-center","bottom-center"].includes(t.position))throw new Error("invalid position");e.position=t.position}if(void 0!==t.enableSounds){if(!r(t.enableSounds))throw new Error("enableSounds must be boolean");e.enableSounds=t.enableSounds}if(void 0!==t.enableAnimations){if(!r(t.enableAnimations))throw new Error("enableAnimations must be boolean");e.enableAnimations=t.enableAnimations}if(void 0!==t.autoCleanupInterval){if(!i(t.autoCleanupInterval)||t.autoCleanupInterval<6e4)throw new Error("autoCleanupInterval must be >= 60000");e.autoCleanupInterval=t.autoCleanupInterval}if(void 0!==t.maxStoredNotifications){if(!Number.isInteger(t.maxStoredNotifications)||t.maxStoredNotifications<10)throw new Error("maxStoredNotifications must be >= 10");e.maxStoredNotifications=t.maxStoredNotifications}if(void 0!==t.persistentTypes){if(!Array.isArray(t.persistentTypes))throw new Error("persistentTypes must be array");e.persistentTypes=[...t.persistentTypes]}if(void 0!==t.soundVolume){if(!i(t.soundVolume)||t.soundVolume<0||t.soundVolume>1)throw new Error("soundVolume must be between 0 and 1");e.soundVolume=t.soundVolume}if(void 0!==t.customDurations){const r=["success","error","warning","info"],n=t.customDurations;if(!n||"object"!=typeof n)throw new Error("customDurations must be object");for(const t of Object.keys(n))if(!r.includes(t)||!i(n[t])||n[t]<0)throw new Error("invalid customDurations entry");e.customDurations={...n}}return e}getNotificationsByType(t){try{return d.getNotificationsByType(t)}catch{return[]}}getVisibleNotifications(){try{return d.getVisibleNotifications()}catch{return[]}}hasErrors(){try{return d.hasErrorNotifications()}catch{return!1}}destroy(){try{try{this.timerAdapter?.stopAll()}catch{}try{this.progressBarManager?.cleanup()}catch{}try{this.timers.clear()}catch{}this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications();try{this.visibilityManager?.detach()}catch{}if("function"==typeof this._unsubscribe){try{this._unsubscribe()}catch{}this._unsubscribe=null}if("function"==typeof this._unsubscribeSettings){try{this._unsubscribeSettings()}catch{}this._unsubscribeSettings=null}try{this.timerManager?.destroy()}catch{}try{this.progressBarManager?.destroy()}catch{}this.renderEngine=null}finally{this.notificationContainer=null,this.initialized=!1}}#c(t){try{this.progressBarManager?.stop(t)}catch{}}#l(t){try{this.progressBarManager?.pause(t)}catch{}}#u(t){try{this.progressBarManager?.resume(t)}catch{}}#i(){try{this.timerAdapter?.pauseAll(),this.progressBarManager?.pauseAll()}catch{}}#r(){try{this.timerAdapter?.resumeAll(),this.progressBarManager?.resumeAll()}catch{}}#s(t,e){let i=!1;return(...r)=>{i||(t.apply(this,r),i=!0,setTimeout(()=>i=!1,e))}}}const k=new L,F=Object.freeze(Object.defineProperty({__proto__:null,notificationService:k},Symbol.toStringTag,{value:"Module"}));export{g as a,p as b,m as c,h as n};
