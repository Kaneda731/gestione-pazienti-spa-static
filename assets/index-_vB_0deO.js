import{j as e}from"./ui-vendor-CgDpQ-gO.js";import{R as i,u as t,b as a}from"./react-vendor-bU8fvvPN.js";import{u as s,l as n,s as r,a as o,b as c,c as l}from"./index-dr_qUKEf.js";import{p as d}from"./patientService-DujFtk8E.js";import{h as m}from"./healthcare-illustration-CgJ1tzue.js";import"./supabase-DpMRTrmd.js";import"./CentralizedStatisticsService-B5FDLWH-.js";const h=i.memo(({icon:i,title:t,description:a,meta:s,variant:n,onClick:r,showAdminBadge:o=!1})=>e.jsx("div",{className:`home-card card-${n}`,onClick:r,role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r())},"aria-label":`Vai a ${t}`,children:e.jsxs("div",{className:"home-card-body",children:[e.jsx("div",{className:"home-card-icon",children:e.jsx("span",{className:"material-icons","aria-hidden":"true",children:i})}),e.jsxs("h5",{className:"home-card-title",children:[t,o&&e.jsx("span",{className:"badge-admin","aria-label":"Solo amministratori",children:"Admin"})]}),e.jsx("p",{className:"home-card-text",children:a}),e.jsx("p",{className:"home-card-meta",children:s})]})}));h.displayName="HomeCard";const p=({stats:i,isAdmin:a})=>{const s=t();return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"home-section","aria-labelledby":"quick-actions-section",children:[e.jsxs("h2",{className:"section-title",id:"quick-actions-section",children:[e.jsx("span",{className:"section-icon material-icons","aria-hidden":"true",children:"bolt"}),"Azioni Rapide"]}),e.jsxs("div",{className:"home-cards-grid",children:[e.jsx(h,{icon:"person_add",title:"Inserimento Pazienti",description:"Registra un nuovo paziente nel sistema",meta:`Pazienti recenti: ${i.patientsThisWeek} questa settimana`,variant:"action-primary",onClick:()=>s("/inserimento")}),e.jsx(h,{icon:"medical_services",title:"Evento Clinico",description:"Registra un nuovo evento clinico",meta:`Ultimi 7 giorni: ${i.eventsLastDays} eventi`,variant:"action-secondary",onClick:()=>s("/eventi-clinici")}),e.jsx(h,{icon:"logout",title:"Dimissioni",description:"Processa le dimissioni pazienti",meta:`In sospeso: ${i.pendingDismissals}`,variant:"action-tertiary",onClick:()=>s("/dimissione")})]})]}),e.jsxs("section",{className:"home-section","aria-labelledby":"support-section",children:[e.jsxs("h2",{className:"section-title",id:"support-section",children:[e.jsx("span",{className:"section-icon material-icons","aria-hidden":"true",children:"bar_chart"}),"Consultazione"]}),e.jsxs("div",{className:"home-cards-grid",children:[e.jsx(h,{icon:"list",title:"Elenco Pazienti",description:"Visualizza e ricerca pazienti ricoverati",meta:`Pazienti attuali: ${i.totalActivePatients}`,variant:"support-primary",onClick:()=>s("/list")}),e.jsx(h,{icon:"query_stats",title:"Grafici & Analisi",description:"Visualizza trend e statistiche cliniche",meta:"Analisi dati e trend",variant:"support-secondary",onClick:()=>s("/unified-charts")})]})]}),a&&e.jsxs("section",{className:"home-section","aria-labelledby":"admin-section",children:[e.jsxs("h2",{className:"section-title",id:"admin-section",children:[e.jsx("span",{className:"section-icon material-icons","aria-hidden":"true",children:"settings"}),"Amministrazione"]}),e.jsx("div",{className:"home-cards-grid",children:e.jsx(h,{icon:"medical_information",title:"Gestione Diagnosi",description:"Configura le diagnosi disponibili",meta:"Configurazione sistema",variant:"admin",onClick:()=>s("/diagnosi"),showAdminBadge:!0})})]})]})};function u(e){return`${e.cognome} ${e.nome}`.trim()}function x(e){return e.codice_rad||e.id?.slice(0,6)||"N/A"}function g(e){if(!e)return"Data non disponibile";try{const i=new Date(e+"T00:00:00");if(isNaN(i.getTime()))return e;const t=new Date,a=new Date(t);a.setDate(a.getDate()-1);const s=i.toDateString()===t.toDateString(),n=i.toDateString()===a.toDateString(),r=i.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),o=i.toLocaleDateString("it-IT",{month:"2-digit",day:"2-digit"});return s?`Oggi ${r}`:n?`Ieri ${r}`:o}catch{return e}}function j(){const e=new Date,i=e.getMinutes(),t=e.getHours();return 0===i?"Adesso":1===i?"1 min fa":i<5?`${i} min fa`:i<60?5*Math.floor(i/5)+" min fa":1===t?"1 ora fa":`${t} ore fa`}const v={patientsThisWeek:0,eventsLastDays:0,pendingDismissals:0,totalActivePatients:0};async function N(){return(await d.getPatients({stato:"attivo"},{limit:3,sortColumn:"data_ricovero",sortDirection:"desc",page:0})).patients.map(e=>({id:e.id||"",nome:e.nome||"",cognome:e.cognome||"",codice_rad:e.codice_rad,data_ricovero:e.data_ricovero,data_dimissione:e.data_dimissione}))}async function f(){return(await d.getPatients({stato:"dimesso"},{limit:2,sortColumn:"data_ricovero",sortDirection:"desc",page:0})).patients.map(e=>({id:e.id||"",nome:e.nome||"",cognome:e.cognome||"",codice_rad:e.codice_rad,data_ricovero:e.data_ricovero,data_dimissione:e.data_dimissione}))}function b(){const{user:e}=s(),[i,t]=a.useState([]),[o,c]=a.useState([]),[l,m]=a.useState(v),[h,p]=a.useState("Caricamento..."),[u,x]=a.useState(!0);return a.useEffect(()=>{if(!e)return;(async()=>{try{x(!0);const[i,a]=await Promise.all([N(),f()]);t(i),c(a);try{const e=await d.getPatients({stato:"attivo"},{limit:1,page:0}),i=await async function(e){const i=new Date;i.setDate(i.getDate()-7);const t=i.toISOString().split("T")[0],[a,s,n]=await Promise.all([r.from("pazienti").select("id",{count:"exact"}).gte("data_ricovero",t).is("data_dimissione",null),r.from("eventi_clinici").select("id",{count:"exact"}).gte("data_evento",t),r.from("pazienti").select("id",{count:"exact"}).not("data_dimissione","is",null).is("codice_dimissione",null)]);return{patientsThisWeek:a.error?0:a.data?.length||0,eventsLastDays:s.error?0:s.data?.length||0,pendingDismissals:n.error?0:n.data?.length||0,totalActivePatients:e}}(e.totalCount);m(i)}catch(e){n.warn("Errore caricamento statistiche:",e)}p(j())}catch(i){n.error("Errore caricamento dati home:",i),p("Errore caricamento"),t([]),c([])}finally{x(!1)}})();const i=setInterval(()=>{p(j())},6e4);return()=>clearInterval(i)},[e]),{recentPatients:i,recentDismissals:o,stats:l,lastUpdate:h,isLoading:u}}const y=()=>{const{user:i,isAuthenticated:a}=s(),[r,d]=o(),m=t();if(!a||!i)return null;const h=i.ruolo??i.role??"utente",p=i.email?.split("@")[0]||"User",u=p.charAt(0).toUpperCase()+p.slice(1),x=u.charAt(0).toUpperCase(),g=e=>({admin:"#6366f1",medico:"#0891b2",infermiere:"#059669",operatore:"#ea580c",lettore:"#8b5cf6"}[e.toLowerCase()]||"#64748b"),j="dark"===r?"light_mode":"dark_mode";return e.jsxs("div",{className:"sidebar-user-section",children:[e.jsx("div",{className:"sidebar-avatar",style:{background:`linear-gradient(135deg, ${g(h)}, ${g(h)}cc)`},children:x}),e.jsxs("div",{className:"sidebar-user-info",children:[e.jsx("span",{className:"sidebar-user-name",children:u}),e.jsx("span",{className:"sidebar-user-role",style:{color:g(h)},children:h})]}),e.jsx("button",{className:"sidebar-icon-btn",onClick:()=>{const e="dark"===r?"light":"dark";d(e),c(e)},title:"dark"===r?"Tema chiaro":"Tema scuro",children:e.jsx("span",{className:"material-icons",children:j})}),e.jsx("button",{className:"sidebar-icon-btn sidebar-icon-btn--danger",onClick:async()=>{try{await l(),m("/login")}catch(e){n.error("Logout failed",e)}},title:"Esci",children:e.jsx("span",{className:"material-icons",children:"logout"})})]})},k=({title:i,icon:a,patients:s,isLoading:n,dateField:r,variant:o="registrati"})=>{const c=t();return e.jsxs("div",n?{className:`compact-patient-card compact-patient-card--${o}`,children:[e.jsxs("h3",{className:"compact-patient-title",children:[e.jsx("span",{className:"material-icons compact-patient-title-icon","aria-hidden":"true",children:a})," ",i]}),e.jsx("div",{className:"compact-patient-list",children:e.jsx("div",{className:"compact-patient-item compact-patient-item--loading",children:"Caricamento..."})})]}:0===s.length?{className:`compact-patient-card compact-patient-card--${o}`,children:[e.jsxs("h3",{className:"compact-patient-title",children:[e.jsx("span",{className:"material-icons compact-patient-title-icon","aria-hidden":"true",children:a})," ",i]}),e.jsx("div",{className:"compact-patient-list",children:e.jsx("div",{className:"compact-patient-item compact-patient-item--empty",children:"Nessun paziente"})})]}:{className:`compact-patient-card compact-patient-card--${o}`,children:[e.jsxs("h3",{className:"compact-patient-title",children:[e.jsx("span",{className:"material-icons compact-patient-title-icon","aria-hidden":"true",children:a})," ",i]}),e.jsx("div",{className:"compact-patient-list",children:s.slice(0,5).map(i=>e.jsxs("div",{className:"compact-patient-item",children:[e.jsx("button",{type:"button",className:"compact-patient-name",onClick:()=>c(`/patient/${i.id}`),"aria-label":`Visualizza dettagli paziente ${u(i)}`,children:u(i)}),e.jsxs("span",{className:"compact-patient-meta",children:["ID: ",x(i)," â€¢ ",g(i[r])]})]},i.id))})]})},C=()=>{const i=t(),{user:n}=s(),{recentPatients:r,recentDismissals:o,stats:c,lastUpdate:l,isLoading:d}=b(),h="admin"===a.useMemo(()=>n?n.ruolo??n.role??null:null,[n]);return e.jsxs("div",{className:"home-split-layout",children:[e.jsx("aside",{className:"home-left-panel",children:e.jsxs("div",{className:"home-left-content",children:[e.jsxs("div",{className:"home-logo-section",children:[e.jsx("img",{src:"/favicon.png",alt:"PATIENTRAK Logo",className:"home-logo-img"}),e.jsx("p",{className:"home-logo-subtitle",children:"Gestione pazienti"})]}),e.jsxs("div",{className:"home-cta-section",children:[e.jsxs("button",{className:"home-cta home-cta--primary",onClick:()=>i("/inserimento"),"aria-label":"Registra nuovo paziente",children:[e.jsx("span",{className:"material-icons",children:"person_add"}),"Nuovo Paziente"]}),e.jsxs("button",{className:"home-cta home-cta--secondary",onClick:()=>i("/eventi-clinici"),"aria-label":"Registra evento clinico",children:[e.jsx("span",{className:"material-icons",children:"add_circle"}),"Evento Clinico"]})]}),e.jsx("div",{className:"home-illustration",children:e.jsx("img",{src:m,alt:"Personale sanitario",loading:"lazy"})}),e.jsx("div",{className:"home-user-section",children:e.jsx(y,{})}),e.jsxs("div",{className:"home-left-footer",children:[e.jsx("span",{className:"material-icons",children:"schedule"}),"Aggiornato: ",l]})]})}),e.jsxs("main",{className:"home-right-panel",children:[e.jsxs("section",{className:"home-recent-section",children:[e.jsx(k,{title:"Ultimi Registrati",icon:"person_add",patients:r,isLoading:d,dateField:"data_ricovero",variant:"registrati"}),e.jsx(k,{title:"Ultimi Dimessi",icon:"exit_to_app",patients:o,isLoading:d,dateField:"data_dimissione",variant:"dimessi"})]}),e.jsx(p,{stats:c,isAdmin:h})]})]})},_=()=>{const{user:i,isAuthenticated:r}=s(),[d,m]=o(),[h,p]=a.useState(d),[u,x]=a.useState(!1),g=a.useRef(null),j=t();if(a.useEffect(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&x(!1)};if(u)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[u]),!r||!i)return null;const v=i.ruolo??i.role??"caricamento...",N=i.email?.split("@")[0]||"User",f=N.charAt(0).toUpperCase(),b=e=>({admin:"#6366f1",medico:"#0891b2",infermiere:"#059669",operatore:"#ea580c",lettore:"#8b5cf6"}[e.toLowerCase()]||"#64748b"),y="dark"===h?"light_mode":"dark_mode",k="dark"===h?"Tema chiaro":"Tema scuro";return e.jsxs("div",{ref:g,className:"user-avatar-menu",style:{position:"relative"},children:[e.jsx("button",{className:"user-avatar-button",onClick:()=>x(!u),"aria-label":"Menu utente",style:{width:"48px",height:"48px",borderRadius:"50%",border:"none",background:`linear-gradient(135deg, ${b(v)}, ${b(v)}dd)`,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.25)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)"},children:f}),u&&e.jsxs("div",{className:"user-avatar-dropdown",style:{position:"absolute",top:"56px",right:"0",background:"#fff",borderRadius:"8px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.12)",minWidth:"280px",zIndex:1e3,overflow:"hidden",animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:`linear-gradient(135deg, ${b(v)}, ${b(v)}dd)`,color:"#fff",padding:"16px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold"},children:f}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"14px"},children:N}),e.jsx("div",{style:{fontSize:"12px",opacity:.9},children:i.email}),e.jsx("div",{style:{display:"inline-block",marginTop:"4px",fontSize:"10px",fontWeight:"600",background:"rgba(255, 255, 255, 0.25)",padding:"2px 8px",borderRadius:"4px",textTransform:"uppercase"},children:v})]})]}),e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsxs("button",{onClick:()=>{const e="dark"===h?"light":"dark";m(e),c(e),p(e)},style:{width:"100%",border:"none",background:"none",padding:"12px 16px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",color:"#1f2937",fontSize:"14px",transition:"background-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f3f4f6"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},title:k,children:[e.jsx("span",{className:"material-icons",style:{fontSize:"20px"},children:y}),e.jsx("span",{children:k})]}),e.jsx("div",{style:{height:"1px",background:"#e5e7eb",margin:"4px 0"}}),e.jsxs("button",{onClick:async()=>{try{await l(),j("/login")}catch(e){n.error("Logout failed",e)}},style:{width:"100%",border:"none",background:"none",padding:"12px 16px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",color:"#ef4444",fontSize:"14px",fontWeight:"500",transition:"background-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#fee2e2"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("span",{className:"material-icons",style:{fontSize:"20px"},children:"logout"}),e.jsx("span",{children:"Esci"})]})]})]})]})},z=({title:i,icon:t,patients:a,isLoading:s,dateField:n})=>e.jsxs("div",s?{className:"hero-recent-section",children:[e.jsxs("h2",{className:"hero-section-title",children:[t," ",i]}),e.jsx("div",{className:"hero-recent-list",children:e.jsx("div",{className:"hero-recent-item",style:{opacity:.6},children:e.jsx("div",{className:"hero-recent-name",children:"Caricamento..."})})})]}:0===a.length?{className:"hero-recent-section",children:[e.jsxs("h2",{className:"hero-section-title",children:[t," ",i]}),e.jsx("div",{className:"hero-recent-list",children:e.jsx("div",{className:"hero-recent-item",style:{opacity:.5},children:e.jsx("div",{className:"hero-recent-name",children:"Nessun paziente"})})})]}:{className:"hero-recent-section",children:[e.jsxs("h2",{className:"hero-section-title",children:[t," ",i]}),e.jsx("div",{className:"hero-recent-list",children:a.map(i=>e.jsxs("div",{className:"hero-recent-item",children:[e.jsx("div",{className:"hero-recent-name",children:u(i)}),e.jsxs("div",{className:"hero-recent-meta",children:["ID: ",x(i)," â€¢ ",g(i[n])]})]},i.id))})]}),D=({recentPatients:i,recentDismissals:a,isLoading:s,lastUpdate:n})=>{const r=t();return e.jsxs("div",{className:"home-hero",style:{position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"20px",right:"20px",zIndex:100},children:e.jsx(_,{})}),e.jsxs("div",{className:"home-hero-content",children:[e.jsxs("h1",{className:"home-title",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1.5rem"},children:[e.jsx("img",{src:"/favicon.png",alt:"PATIENTRAK Logo",width:"144",height:"144"}),"PATIENTRAK"]}),e.jsxs("div",{className:"hero-cta-group",children:[e.jsxs("button",{className:"hero-cta hero-cta-primary",onClick:()=>r("/inserimento"),"aria-label":"Registra nuovo paziente",children:[e.jsx("span",{className:"material-icons",children:"person_add"}),"Registra Nuovo Paziente"]}),e.jsxs("button",{className:"hero-cta hero-cta-secondary",onClick:()=>r("/eventi-clinici"),"aria-label":"Registra evento clinico",children:[e.jsx("span",{className:"material-icons",children:"add_circle"}),"Evento Clinico"]})]}),e.jsx("div",{className:"hero-divider"}),e.jsx(z,{title:"Ultimi Registrati",icon:"ðŸ“¥",patients:i,isLoading:s,dateField:"data_ricovero"}),e.jsx("div",{className:"hero-divider"}),e.jsx(z,{title:"Ultimi Dimessi",icon:"ðŸ“¤",patients:a,isLoading:s,dateField:"data_dimissione"}),e.jsxs("div",{className:"hero-footer",children:[e.jsx("span",{className:"material-icons",children:"schedule"}),"Ultimo aggiornamento: ",n]})]})]})};export{h as HomeCard,p as HomeCardsGrid,D as HomeHero,C as HomePage,C as default,g as formatDateTime,j as formatLastUpdate,x as formatPatientId,u as formatPatientName,b as useHomeData};
