class t{constructor(t={}){this.options={enabled:!0,volume:.5,respectSystemSettings:!0,...t},this.audioContext=null,this.sounds=new Map,this.isInitialized=!1,this.init()}async init(){try{if(!this.isAudioSupported())return;await this.initializeAudioContext(),await this.loadDefaultSounds(),this.isInitialized=!0}catch(t){}}isAudioSupported(){return!!(window.AudioContext||window.webkitAudioContext||window.Audio)}async initializeAudioContext(){try{const t=window.AudioContext||window.webkitAudioContext;t&&(this.audioContext=new t,"suspended"===this.audioContext.state&&await this.audioContext.resume())}catch(t){}}async loadDefaultSounds(){const t={success:{frequency:800,duration:.2,type:"sine",volume:.3},error:{frequency:300,duration:.4,type:"square",volume:.4},warning:{frequency:600,duration:.3,type:"triangle",volume:.35},info:{frequency:500,duration:.25,type:"sine",volume:.25}};for(const[e,i]of Object.entries(t))this.sounds.set(e,i)}async playSound(t,e={}){if(this.shouldPlaySound(t))try{if(this.audioContext){const i=this.sounds.get(t)||{frequency:500,duration:.2,type:"sine",volume:.3};await this.playWebAudioSound(i,e)}else await this.playHTMLAudioSound(t,e)}catch(i){}}async playWebAudioSound(t,e={}){if(!this.audioContext||"running"!==this.audioContext.state)return;const i=this.audioContext.createOscillator(),o=this.audioContext.createGain();i.type=t.type,i.frequency.setValueAtTime(t.frequency,this.audioContext.currentTime);const n=(e.volume??t.volume)*this.options.volume;o.gain.setValueAtTime(0,this.audioContext.currentTime),o.gain.linearRampToValueAtTime(n,this.audioContext.currentTime+.01),o.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+t.duration),i.connect(o),o.connect(this.audioContext.destination),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+t.duration),i.onended=()=>{i.disconnect(),o.disconnect()}}async playHTMLAudioSound(t,e={}){const i=new Audio;i.volume=this.options.volume*(e.volume??.3);const o=this.generateSoundDataUrl(t);i.src=o;try{await i.play()}catch(n){if("NotAllowedError"!==n.name)throw n}}generateSoundDataUrl(t){const e={success:800,error:300,warning:600,info:500}[t]||500,i=Math.floor(1600);let o="";for(let n=0;n<i;n++){const t=Math.sin(2*Math.PI*e*n/8e3),i=Math.floor(127*(t+1));o+=String.fromCharCode(i)}return`data:audio/wav;base64,${btoa(o)}`}shouldPlaySound(t){if(!this.options.enabled)return!1;if(!this.isInitialized){if(!("undefined"!=typeof window&&"function"==typeof window.Audio||"undefined"!=typeof globalThis&&"function"==typeof globalThis.Audio))return!1}if(this.options.respectSystemSettings&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return!1;const e=this.getUserSoundPreferences();return!e||!1!==e[t]}getUserSoundPreferences(){try{const t=localStorage.getItem("notification-sound-preferences");return t?JSON.parse(t):null}catch(t){return null}}updateSettings(t){this.options={...this.options,...t};try{localStorage.setItem("notification-sound-preferences",JSON.stringify({enabled:this.options.enabled,volume:this.options.volume,success:!1!==t.success,error:!1!==t.error,warning:!1!==t.warning,info:!1!==t.info}))}catch(e){}}setVolume(t){this.options.volume=Math.max(0,Math.min(1,t))}enable(){this.options.enabled=!0,this.updateSettings({enabled:!0})}disable(){this.options.enabled=!1,this.updateSettings({enabled:!1})}isEnabled(){return this.options.enabled}getVolume(){return this.options.volume}async testSound(t="info"){await this.playSound(t,{volume:.5})}async testAllSounds(){const t=["success","info","warning","error"];for(let e=0;e<t.length;e++)setTimeout(()=>{this.testSound(t[e])},500*e)}destroy(){this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null,this.sounds.clear(),this.isInitialized=!1}}let e=null;const i=()=>(e||(e=new t),e);export{t as NotificationSoundManager,t as default,i as getSoundManager};
