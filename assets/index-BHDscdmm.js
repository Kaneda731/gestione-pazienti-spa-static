const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/form-DU3KUOxl.js","assets/supabase-B8WzuNbi.js","assets/infectionDataManager-7jjaPoYQ.js","assets/CustomDatepicker-6By5cdaM.js","assets/utils-BtSsRyB2.js","assets/CustomSelect-KFb8dyEE.js","assets/post-operative-calculator-C3z7C_vm.js","assets/ResolveInfectionModal-gs4cqb_S.js","assets/vendor-CQCqr9ER.js","assets/surgeryDataManager-CbtGeuzn.js","assets/date-CcL_Wp-e.js","assets/lookupService-COkLmSMC.js","assets/dimissione-BzgXw22v.js","assets/patientService-CNi4cEOA.js","assets/PatientAutocomplete-DzA78nWe.js","assets/formatting-C7G90sDQ.js","assets/grafico-pb-cjPjY.js","assets/helpers-ot-kNF9g.js","assets/list-D48ncHuG.js","assets/diagnosi-CHZto78Z.js","assets/eventi-clinici-owmronH9.js"])))=>i.map(i=>d[i]);
import{Dropdown as e,Collapse as t,Modal as i}from"./vendor-CQCqr9ER.js";import{c as n,_ as o}from"./supabase-B8WzuNbi.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),t.credentials="use-credentials"===e.crossOrigin?"include":"anonymous"===e.crossOrigin?"omit":"same-origin",t}(e);fetch(e.href,t)}}(),"undefined"!=typeof window&&(window.bootstrap={Modal:i,Collapse:t,Dropdown:e}),"undefined"!=typeof window&&(window.EMERGENCY_STOP=function(){console.log("üö® EMERGENCY STOP ACTIVATED");try{window.notificationService&&(window.notificationService.timers?.forEach(e=>clearTimeout(e)),window.notificationService.timers?.clear(),window.notificationService.emergencyReset&&window.notificationService.emergencyReset()),window.stateService&&window.stateService.subscribers?.clear()}catch(e){console.error("‚ùå Emergency stop failed:",e)}},window.EMERGENCY_RELOAD=function(){console.log("üîÑ Emergency reload..."),location.reload()});const{entries:r,setPrototypeOf:s,isFrozen:a,getPrototypeOf:c,getOwnPropertyDescriptor:l}=Object;let{freeze:d,seal:u,create:m}=Object,{apply:h,construct:p}="undefined"!=typeof Reflect&&Reflect;d||(d=function(e){return e}),u||(u=function(e){return e}),h||(h=function(e,t,i){return e.apply(t,i)}),p||(p=function(e,t){return new e(...t)});const f=L(Array.prototype.forEach),g=L(Array.prototype.lastIndexOf),y=L(Array.prototype.pop),w=L(Array.prototype.push),v=L(Array.prototype.splice),b=L(String.prototype.toLowerCase),E=L(String.prototype.toString),S=L(String.prototype.match),_=L(String.prototype.replace),T=L(String.prototype.indexOf),A=L(String.prototype.trim),C=L(Object.prototype.hasOwnProperty),N=L(RegExp.prototype.test),I=(x=TypeError,function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return p(x,t)});var x;function L(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return h(e,t,n)}}function k(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b;s&&s(e,null);let n=t.length;for(;n--;){let o=t[n];if("string"==typeof o){const e=i(o);e!==o&&(a(t)||(t[n]=e),o=e)}e[o]=!0}return e}function D(e){for(let t=0;t<e.length;t++){C(e,t)||(e[t]=null)}return e}function R(e){const t=m(null);for(const[i,n]of r(e)){C(e,i)&&(t[i]=Array.isArray(n)?D(n):n&&"object"==typeof n&&n.constructor===Object?R(n):n)}return t}function M(e,t){for(;null!==e;){const i=l(e,t);if(i){if(i.get)return L(i.get);if("function"==typeof i.value)return L(i.value)}e=c(e)}return function(){return null}}const O=d(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),z=d(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),P=d(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),F=d(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),$=d(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),B=d(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),U=d(["#text"]),H=d(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),V=d(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),q=d(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),j=d(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),G=u(/\{\{[\w\W]*|[\w\W]*\}\}/gm),W=u(/<%[\w\W]*|[\w\W]*%>/gm),Q=u(/\$\{[\w\W]*/gm),Y=u(/^data-[\-\w.\u00B7-\uFFFF]+$/),J=u(/^aria-[\-\w]+$/),X=u(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),K=u(/^(?:\w+script|data):/i),Z=u(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ee=u(/^html$/i),te=u(/^[a-z][.\w]*(-[.\w]+)+$/i);var ie=Object.freeze({__proto__:null,ARIA_ATTR:J,ATTR_WHITESPACE:Z,CUSTOM_ELEMENT:te,DATA_ATTR:Y,DOCTYPE_NAME:ee,ERB_EXPR:W,IS_ALLOWED_URI:X,IS_SCRIPT_OR_DATA:K,MUSTACHE_EXPR:G,TMPLIT_EXPR:Q});const ne=1,oe=3,re=7,se=8,ae=9;var ce=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const i=t=>e(t);if(i.version="3.2.6",i.removed=[],!t||!t.document||t.document.nodeType!==ae||!t.Element)return i.isSupported=!1,i;let{document:n}=t;const o=n,s=o.currentScript,{DocumentFragment:a,HTMLTemplateElement:c,Node:l,Element:u,NodeFilter:h,NamedNodeMap:p=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:x,DOMParser:L,trustedTypes:D}=t,G=u.prototype,W=M(G,"cloneNode"),Q=M(G,"remove"),Y=M(G,"nextSibling"),J=M(G,"childNodes"),K=M(G,"parentNode");if("function"==typeof c){const e=n.createElement("template");e.content&&e.content.ownerDocument&&(n=e.content.ownerDocument)}let Z,te="";const{implementation:ce,createNodeIterator:le,createDocumentFragment:de,getElementsByTagName:ue}=n,{importNode:me}=o;let he={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};i.isSupported="function"==typeof r&&"function"==typeof K&&ce&&void 0!==ce.createHTMLDocument;const{MUSTACHE_EXPR:pe,ERB_EXPR:fe,TMPLIT_EXPR:ge,DATA_ATTR:ye,ARIA_ATTR:we,IS_SCRIPT_OR_DATA:ve,ATTR_WHITESPACE:be,CUSTOM_ELEMENT:Ee}=ie;let{IS_ALLOWED_URI:Se}=ie,_e=null;const Te=k({},[...O,...z,...P,...$,...U]);let Ae=null;const Ce=k({},[...H,...V,...q,...j]);let Ne=Object.seal(m(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ie=null,xe=null,Le=!0,ke=!0,De=!1,Re=!0,Me=!1,Oe=!0,ze=!1,Pe=!1,Fe=!1,$e=!1,Be=!1,Ue=!1,He=!0,Ve=!1,qe=!0,je=!1,Ge={},We=null;const Qe=k({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ye=null;const Je=k({},["audio","video","img","source","image","track"]);let Xe=null;const Ke=k({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ze="http://www.w3.org/1998/Math/MathML",et="http://www.w3.org/2000/svg",tt="http://www.w3.org/1999/xhtml";let it=tt,nt=!1,ot=null;const rt=k({},[Ze,et,tt],E);let st=k({},["mi","mo","mn","ms","mtext"]),at=k({},["annotation-xml"]);const ct=k({},["title","style","font","a","script"]);let lt=null;const dt=["application/xhtml+xml","text/html"];let ut=null,mt=null;const ht=n.createElement("form"),pt=function(e){return e instanceof RegExp||e instanceof Function},ft=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!mt||mt!==e){if(e&&"object"==typeof e||(e={}),e=R(e),lt=-1===dt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,ut="application/xhtml+xml"===lt?E:b,_e=C(e,"ALLOWED_TAGS")?k({},e.ALLOWED_TAGS,ut):Te,Ae=C(e,"ALLOWED_ATTR")?k({},e.ALLOWED_ATTR,ut):Ce,ot=C(e,"ALLOWED_NAMESPACES")?k({},e.ALLOWED_NAMESPACES,E):rt,Xe=C(e,"ADD_URI_SAFE_ATTR")?k(R(Ke),e.ADD_URI_SAFE_ATTR,ut):Ke,Ye=C(e,"ADD_DATA_URI_TAGS")?k(R(Je),e.ADD_DATA_URI_TAGS,ut):Je,We=C(e,"FORBID_CONTENTS")?k({},e.FORBID_CONTENTS,ut):Qe,Ie=C(e,"FORBID_TAGS")?k({},e.FORBID_TAGS,ut):R({}),xe=C(e,"FORBID_ATTR")?k({},e.FORBID_ATTR,ut):R({}),Ge=!!C(e,"USE_PROFILES")&&e.USE_PROFILES,Le=!1!==e.ALLOW_ARIA_ATTR,ke=!1!==e.ALLOW_DATA_ATTR,De=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Re=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Me=e.SAFE_FOR_TEMPLATES||!1,Oe=!1!==e.SAFE_FOR_XML,ze=e.WHOLE_DOCUMENT||!1,$e=e.RETURN_DOM||!1,Be=e.RETURN_DOM_FRAGMENT||!1,Ue=e.RETURN_TRUSTED_TYPE||!1,Fe=e.FORCE_BODY||!1,He=!1!==e.SANITIZE_DOM,Ve=e.SANITIZE_NAMED_PROPS||!1,qe=!1!==e.KEEP_CONTENT,je=e.IN_PLACE||!1,Se=e.ALLOWED_URI_REGEXP||X,it=e.NAMESPACE||tt,st=e.MATHML_TEXT_INTEGRATION_POINTS||st,at=e.HTML_INTEGRATION_POINTS||at,Ne=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&pt(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Ne.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&pt(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Ne.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Ne.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Me&&(ke=!1),Be&&($e=!0),Ge&&(_e=k({},U),Ae=[],!0===Ge.html&&(k(_e,O),k(Ae,H)),!0===Ge.svg&&(k(_e,z),k(Ae,V),k(Ae,j)),!0===Ge.svgFilters&&(k(_e,P),k(Ae,V),k(Ae,j)),!0===Ge.mathMl&&(k(_e,$),k(Ae,q),k(Ae,j))),e.ADD_TAGS&&(_e===Te&&(_e=R(_e)),k(_e,e.ADD_TAGS,ut)),e.ADD_ATTR&&(Ae===Ce&&(Ae=R(Ae)),k(Ae,e.ADD_ATTR,ut)),e.ADD_URI_SAFE_ATTR&&k(Xe,e.ADD_URI_SAFE_ATTR,ut),e.FORBID_CONTENTS&&(We===Qe&&(We=R(We)),k(We,e.FORBID_CONTENTS,ut)),qe&&(_e["#text"]=!0),ze&&k(_e,["html","head","body"]),_e.table&&(k(_e,["tbody"]),delete Ie.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw I('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw I('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');Z=e.TRUSTED_TYPES_POLICY,te=Z.createHTML("")}else void 0===Z&&(Z=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let i=null;const n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(i=t.getAttribute(n));const o="dompurify"+(i?"#"+i:"");try{return e.createPolicy(o,{createHTML:e=>e,createScriptURL:e=>e})}catch(r){return console.warn("TrustedTypes policy "+o+" could not be created."),null}}(D,s)),null!==Z&&"string"==typeof te&&(te=Z.createHTML(""));d&&d(e),mt=e}},gt=k({},[...z,...P,...F]),yt=k({},[...$,...B]),wt=function(e){w(i.removed,{element:e});try{K(e).removeChild(e)}catch(t){Q(e)}},vt=function(e,t){try{w(i.removed,{attribute:t.getAttributeNode(e),from:t})}catch(n){w(i.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if($e||Be)try{wt(t)}catch(n){}else try{t.setAttribute(e,"")}catch(n){}},bt=function(e){let t=null,i=null;if(Fe)e="<remove></remove>"+e;else{const t=S(e,/^[\r\n\t ]+/);i=t&&t[0]}"application/xhtml+xml"===lt&&it===tt&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const o=Z?Z.createHTML(e):e;if(it===tt)try{t=(new L).parseFromString(o,lt)}catch(s){}if(!t||!t.documentElement){t=ce.createDocument(it,"template",null);try{t.documentElement.innerHTML=nt?te:o}catch(s){}}const r=t.body||t.documentElement;return e&&i&&r.insertBefore(n.createTextNode(i),r.childNodes[0]||null),it===tt?ue.call(t,ze?"html":"body")[0]:ze?t.documentElement:r},Et=function(e){return le.call(e.ownerDocument||e,e,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},St=function(e){return e instanceof x&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof p)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},_t=function(e){return"function"==typeof l&&e instanceof l};function Tt(e,t,n){f(e,e=>{e.call(i,t,n,mt)})}const At=function(e){let t=null;if(Tt(he.beforeSanitizeElements,e,null),St(e))return wt(e),!0;const n=ut(e.nodeName);if(Tt(he.uponSanitizeElement,e,{tagName:n,allowedTags:_e}),Oe&&e.hasChildNodes()&&!_t(e.firstElementChild)&&N(/<[/\w!]/g,e.innerHTML)&&N(/<[/\w!]/g,e.textContent))return wt(e),!0;if(e.nodeType===re)return wt(e),!0;if(Oe&&e.nodeType===se&&N(/<[/\w]/g,e.data))return wt(e),!0;if(!_e[n]||Ie[n]){if(!Ie[n]&&Nt(n)){if(Ne.tagNameCheck instanceof RegExp&&N(Ne.tagNameCheck,n))return!1;if(Ne.tagNameCheck instanceof Function&&Ne.tagNameCheck(n))return!1}if(qe&&!We[n]){const t=K(e)||e.parentNode,i=J(e)||e.childNodes;if(i&&t){for(let n=i.length-1;n>=0;--n){const o=W(i[n],!0);o.__removalCount=(e.__removalCount||0)+1,t.insertBefore(o,Y(e))}}}return wt(e),!0}return e instanceof u&&!function(e){let t=K(e);t&&t.tagName||(t={namespaceURI:it,tagName:"template"});const i=b(e.tagName),n=b(t.tagName);return!!ot[e.namespaceURI]&&(e.namespaceURI===et?t.namespaceURI===tt?"svg"===i:t.namespaceURI===Ze?"svg"===i&&("annotation-xml"===n||st[n]):Boolean(gt[i]):e.namespaceURI===Ze?t.namespaceURI===tt?"math"===i:t.namespaceURI===et?"math"===i&&at[n]:Boolean(yt[i]):e.namespaceURI===tt?!(t.namespaceURI===et&&!at[n])&&!(t.namespaceURI===Ze&&!st[n])&&!yt[i]&&(ct[i]||!gt[i]):!("application/xhtml+xml"!==lt||!ot[e.namespaceURI]))}(e)?(wt(e),!0):"noscript"!==n&&"noembed"!==n&&"noframes"!==n||!N(/<\/no(script|embed|frames)/i,e.innerHTML)?(Me&&e.nodeType===oe&&(t=e.textContent,f([pe,fe,ge],e=>{t=_(t,e," ")}),e.textContent!==t&&(w(i.removed,{element:e.cloneNode()}),e.textContent=t)),Tt(he.afterSanitizeElements,e,null),!1):(wt(e),!0)},Ct=function(e,t,i){if(He&&("id"===t||"name"===t)&&(i in n||i in ht))return!1;if(ke&&!xe[t]&&N(ye,t));else if(Le&&N(we,t));else if(!Ae[t]||xe[t]){if(!(Nt(e)&&(Ne.tagNameCheck instanceof RegExp&&N(Ne.tagNameCheck,e)||Ne.tagNameCheck instanceof Function&&Ne.tagNameCheck(e))&&(Ne.attributeNameCheck instanceof RegExp&&N(Ne.attributeNameCheck,t)||Ne.attributeNameCheck instanceof Function&&Ne.attributeNameCheck(t))||"is"===t&&Ne.allowCustomizedBuiltInElements&&(Ne.tagNameCheck instanceof RegExp&&N(Ne.tagNameCheck,i)||Ne.tagNameCheck instanceof Function&&Ne.tagNameCheck(i))))return!1}else if(Xe[t]);else if(N(Se,_(i,be,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==T(i,"data:")||!Ye[e]){if(De&&!N(ve,_(i,be,"")));else if(i)return!1}else;return!0},Nt=function(e){return"annotation-xml"!==e&&S(e,Ee)},It=function(e){Tt(he.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||St(e))return;const n={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ae,forceKeepAttr:void 0};let o=t.length;for(;o--;){const s=t[o],{name:a,namespaceURI:c,value:l}=s,d=ut(a),u=l;let m="value"===a?u:A(u);if(n.attrName=d,n.attrValue=m,n.keepAttr=!0,n.forceKeepAttr=void 0,Tt(he.uponSanitizeAttribute,e,n),m=n.attrValue,!Ve||"id"!==d&&"name"!==d||(vt(a,e),m="user-content-"+m),Oe&&N(/((--!?|])>)|<\/(style|title)/i,m)){vt(a,e);continue}if(n.forceKeepAttr)continue;if(!n.keepAttr){vt(a,e);continue}if(!Re&&N(/\/>/i,m)){vt(a,e);continue}Me&&f([pe,fe,ge],e=>{m=_(m,e," ")});const h=ut(e.nodeName);if(Ct(h,d,m)){if(Z&&"object"==typeof D&&"function"==typeof D.getAttributeType)if(c);else switch(D.getAttributeType(h,d)){case"TrustedHTML":m=Z.createHTML(m);break;case"TrustedScriptURL":m=Z.createScriptURL(m)}if(m!==u)try{c?e.setAttributeNS(c,a,m):e.setAttribute(a,m),St(e)?wt(e):y(i.removed)}catch(r){vt(a,e)}}else vt(a,e)}Tt(he.afterSanitizeAttributes,e,null)},xt=function e(t){let i=null;const n=Et(t);for(Tt(he.beforeSanitizeShadowDOM,t,null);i=n.nextNode();)Tt(he.uponSanitizeShadowNode,i,null),At(i),It(i),i.content instanceof a&&e(i.content);Tt(he.afterSanitizeShadowDOM,t,null)};return i.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null,s=null,c=null;if(nt=!e,nt&&(e="\x3c!--\x3e"),"string"!=typeof e&&!_t(e)){if("function"!=typeof e.toString)throw I("toString is not a function");if("string"!=typeof(e=e.toString()))throw I("dirty is not a string, aborting")}if(!i.isSupported)return e;if(Pe||ft(t),i.removed=[],"string"==typeof e&&(je=!1),je){if(e.nodeName){const t=ut(e.nodeName);if(!_e[t]||Ie[t])throw I("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)n=bt("\x3c!----\x3e"),r=n.ownerDocument.importNode(e,!0),r.nodeType===ne&&"BODY"===r.nodeName||"HTML"===r.nodeName?n=r:n.appendChild(r);else{if(!$e&&!Me&&!ze&&-1===e.indexOf("<"))return Z&&Ue?Z.createHTML(e):e;if(n=bt(e),!n)return $e?null:Ue?te:""}n&&Fe&&wt(n.firstChild);const d=Et(je?e:n);for(;s=d.nextNode();)At(s),It(s),s.content instanceof a&&xt(s.content);if(je)return e;if($e){if(Be)for(c=de.call(n.ownerDocument);n.firstChild;)c.appendChild(n.firstChild);else c=n;return(Ae.shadowroot||Ae.shadowrootmode)&&(c=me.call(o,c,!0)),c}let u=ze?n.outerHTML:n.innerHTML;return ze&&_e["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&N(ee,n.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+u),Me&&f([pe,fe,ge],e=>{u=_(u,e," ")}),Z&&Ue?Z.createHTML(u):u},i.setConfig=function(){ft(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Pe=!0},i.clearConfig=function(){mt=null,Pe=!1},i.isValidAttribute=function(e,t,i){mt||ft({});const n=ut(e),o=ut(t);return Ct(n,o,i)},i.addHook=function(e,t){"function"==typeof t&&w(he[e],t)},i.removeHook=function(e,t){if(void 0!==t){const i=g(he[e],t);return-1===i?void 0:v(he[e],i,1)[0]}return y(he[e])},i.removeHooks=function(e){he[e]=[]},i.removeAllHooks=function(){he={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},i}();function le(e){if(!e)return"";try{return ce.sanitize(e)}catch(t){return console.warn("Error sanitizing HTML:",t),String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;")}}const de=new class{constructor(){this.loadingInstances=new Map}showLoading(e,t="Caricamento..."){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const i=this.generateId(),n=this.createLoadingElement(t);return this.loadingInstances.set(i,{container:e,originalContent:e.innerHTML}),e.innerHTML=le(""),e.appendChild(n),i}hideLoading(e){const t=this.loadingInstances.get(e);t&&(t.container.innerHTML=le(t.originalContent),this.loadingInstances.delete(e))}showEmpty(e,t="Nessun dato disponibile",i="inbox"){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const n=this.createEmptyElement(t,i);e.innerHTML=le(""),e.appendChild(n)}showError(e,t="Si √® verificato un errore",i=!1,n=null){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const o=this.createErrorElement(t,i,n);e.innerHTML=le(""),e.appendChild(o)}createLoadingElement(e){const t=document.createElement("div");return t.className="ui-state loading-state",t.innerHTML=le(`\n            <div class="loading-content">\n                <div class="spinner">\n                    <div class="spinner-border text-primary" role="status">\n                        <span class="visually-hidden">Loading...</span>\n                    </div>\n                </div>\n                <div class="loading-message">${e}</div>\n            </div>\n            <style>\n                .ui-state {\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    min-height: 200px;\n                    text-align: center;\n                    padding: 2rem;\n                }\n                \n                .loading-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                }\n                \n                .loading-message {\n                    color: #6c757d;\n                    font-size: 0.9rem;\n                }\n                \n                .empty-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                    color: #6c757d;\n                }\n                \n                .empty-icon {\n                    font-size: 3rem;\n                    opacity: 0.5;\n                }\n                \n                .empty-message {\n                    font-size: 1.1rem;\n                    font-weight: 500;\n                }\n                \n                .error-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                    color: #dc3545;\n                }\n                \n                .error-icon {\n                    font-size: 3rem;\n                    opacity: 0.7;\n                }\n                \n                .error-message {\n                    font-size: 1.1rem;\n                    font-weight: 500;\n                    text-align: center;\n                }\n                \n                .retry-button {\n                    margin-top: 0.5rem;\n                }\n            </style>\n        `),t}createEmptyElement(e,t){const i=document.createElement("div");return i.className="ui-state empty-state",i.innerHTML=le(`\n            <div class="empty-content">\n                <span class="material-icons empty-icon">${t}</span>\n                <div class="empty-message">${e}</div>\n            </div>\n        `),i}createErrorElement(e,t,i){const n=document.createElement("div");n.className="ui-state error-state";if(n.innerHTML=le(`\n            <div class="error-content">\n                <span class="material-icons error-icon">error_outline</span>\n                <div class="error-message">${e}</div>\n                ${t&&i?'\n            <button class="btn btn-outline-danger btn-sm retry-button">\n                <span class="material-icons me-1">refresh</span>\n                Riprova\n            </button>\n        ':""}\n            </div>\n        `),t&&i){n.querySelector(".retry-button").addEventListener("click",i)}return n}showPageLoading(e="Caricamento..."){const t=document.createElement("div");t.id="page-loading-overlay",t.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(255, 255, 255, 0.9);\n            z-index: 9998;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        ";const i=this.createLoadingElement(e);return t.appendChild(i),document.body.appendChild(t),()=>{const e=document.getElementById("page-loading-overlay");e&&e.remove()}}hidePageLoading(){const e=document.getElementById("page-loading-overlay");e&&e.remove()}generateId(){return"loading_"+Math.random().toString(36).substr(2,9)}async withLoading(e,t,i="Caricamento..."){const n=this.showLoading(e,i);try{const e=await t();return this.hideLoading(n),e}catch(o){throw this.hideLoading(n),this.showError(e,`Errore: ${o.message}`,!0,()=>{this.withLoading(e,t,i)}),o}}renderConditional(e,t,i,n="Nessun dato disponibile"){if(!t||Array.isArray(t)&&0===t.length)return this.showEmpty(e,n),void 0;"string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),e&&(e.innerHTML=le(""),i(e,t))}};"undefined"!=typeof window&&(window.uiStateService=de);const ue=new class{constructor(){this.errorPatterns=["message channel closed before a response was received","A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received","Extension context invalidated","Could not establish connection","The message port closed before a response was received","Receiving end does not exist","chrome-extension://","moz-extension://","safari-extension://","edge-extension://"],this.suppressedErrors=new Set,this.errorCount=0,this.maxErrorsToLog=5,this.init()}init(){window.addEventListener("error",this.handleError.bind(this)),window.addEventListener("unhandledrejection",this.handleRejection.bind(this)),this.interceptExtensionListeners()}isExtensionError(e,t=""){if(!e)return!1;const i=e.toString().toLowerCase(),n=t.toString().toLowerCase();return this.errorPatterns.some(e=>i.includes(e.toLowerCase())||n.includes(e.toLowerCase()))}handleError(e){const{message:t,filename:i}=e;return!this.isExtensionError(t,i)||(this.suppressExtensionError(e,"JavaScript Error"),void 0)}handleRejection(e){const t=e.reason;let i="";return t instanceof Error?i=t.message:"string"==typeof t?i=t:t&&t.toString&&(i=t.toString()),!this.isExtensionError(i)||(this.suppressExtensionError(e,"Promise Rejection"),void 0)}suppressExtensionError(e,t){e.preventDefault(),e.stopPropagation();const i=`${t}:${e.message||e.reason}`;return!this.suppressedErrors.has(i)&&this.errorCount<this.maxErrorsToLog&&(console.warn("[ExtensionErrorHandler] Errore di estensione soppresso:",t,{message:e.message||e.reason,filename:e.filename,type:t}),this.suppressedErrors.add(i),this.errorCount++),!1}interceptExtensionListeners(){"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage&&this.wrapChromeListeners(),"undefined"!=typeof browser&&browser.runtime&&browser.runtime.onMessage&&this.wrapFirefoxListeners(),this.wrapPostMessage()}wrapChromeListeners(){const e=chrome.runtime.onMessage.addListener;chrome.runtime.onMessage.addListener=function(t){return e.call(this,function(e,i,n){try{const o=t(e,i,n);if(!0===o){const e=setTimeout(()=>{try{n({_extensionErrorHandlerResponse:!0})}catch(e){}},100),t=n;n=function(...i){clearTimeout(e);try{return t(...i)}catch(n){}}}return o}catch(o){return console.warn("[ExtensionErrorHandler] Errore nel message listener:",o),!1}})}}wrapFirefoxListeners(){const e=browser.runtime.onMessage.addListener;browser.runtime.onMessage.addListener=function(t){return e.call(this,function(e,i,n){try{return t(e,i,n)}catch(o){return console.warn("[ExtensionErrorHandler] Errore nel message listener Firefox:",o),Promise.resolve()}})}}wrapPostMessage(){const e=window.postMessage;window.postMessage=function(t,i,n){try{return e.call(this,t,i,n)}catch(o){if(this.isExtensionError(o.message))return console.warn("[ExtensionErrorHandler] Errore postMessage di estensione soppresso:",o),void 0;throw o}}.bind(this)}getStats(){return{suppressedErrorTypes:this.suppressedErrors.size,totalErrorCount:this.errorCount,maxErrorsToLog:this.maxErrorsToLog}}resetStats(){this.suppressedErrors.clear(),this.errorCount=0}};"undefined"!=typeof window&&(window.extensionErrorHandler=ue);const me="PatientTrack",he="1.0.0",pe="development"==="production",fe="warn";const ge=new class{constructor(){const e={error:0,warn:1,info:2,debug:3};this.level=e[fe.toLowerCase()]??1,this.levels=e}sanitizeArgs(e){const t=new Set(["password","token","auth","secret","nome","cognome","codice_fiscale","codice_rad","telefono","email","indirizzo","indirizzo_residenza","citta","cap","note","descrizione"]),i=e=>{if(null==e)return e;if("string"==typeof e)return e.length>200?e.slice(0,200)+"‚Ä¶":e;if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(i);if("object"==typeof e){const n={};for(const[o,r]of Object.entries(e))n[o]=t.has(o)?"[REDACTED]":i(r);return n}return e};return e.map(i)}log(...e){}warn(...e){}error(...e){const t=this.sanitizeArgs(e);console.error(...t)}info(...e){}debug(...e){}group(e){}groupEnd(){}table(e){}time(e){}timeEnd(e){}},ye=n("https://aiguzywadjzyrwandgba.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpZ3V6eXdhZGp6eXJ3YW5kZ2JhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyMDM1MzQsImV4cCI6MjA2Njc3OTUzNH0.pezVt3-xxkHBYK2V6ryHUtj_givF_TA9xwEzuK2essw",{auth:{flowType:"pkce",detectSessionInUrl:!0,persistSession:!0,autoRefreshToken:!0,storage:window.localStorage,storageKey:"supabase.auth.token",debug:!1},global:{headers:{"X-Client-Info":"supabase-js-vite"}}});const we=new class{constructor(){this.readyPromise=new Promise(e=>{this.resolveReady=e}),this.init()}async init(){await this.waitForViteReady(),await this.waitForSupabaseReady(),this.notifyReady()}async waitForViteReady(){return new Promise(e=>{"complete"===document.readyState?(ge.log("Vite √® pronto"),e()):window.addEventListener("load",()=>{setTimeout(()=>{ge.log("Vite √® pronto (dopo load)"),e()},100)},{once:!0})})}async waitForSupabaseReady(){return new Promise(async e=>{try{await ye.auth.getSession(),ge.log("Supabase √® pronto"),e()}catch(t){console.error("Errore nell'inizializzazione Supabase:",t),this.clearCorruptedState(),setTimeout(async()=>{try{await ye.auth.getSession(),ge.log("Supabase √® pronto (dopo retry)"),e()}catch(t){console.error("Errore nel retry Supabase:",t),e()}},500)}})}clearCorruptedState(){ge.log("Pulisco stato corrotto..."),["supabase.auth.token","sb-aiguzywadjzyrwandgba-auth-token"].forEach(e=>{localStorage.removeItem(e),sessionStorage.removeItem(e)}),document.cookie.split(";").forEach(e=>{const t=e.indexOf("="),i=t>-1?e.substr(0,t):e;(i.trim().includes("supabase")||i.trim().includes("sb-"))&&(document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/")})}onReady(){return this.readyPromise}notifyReady(){ge.log("Middleware Vite-Supabase pronto"),this.resolveReady()}};const ve=new class{constructor(){this.isInitialized=!1,this.authState="idle",this.errorState=null,this.init()}async init(){if(!this.isInitialized){await new Promise(e=>{we.onReady(e)});try{const e=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.substring(1));t.has("access_token")||t.has("refresh_token")||e.has("code")||t.has("error")?(ge.log("Rilevato redirect OAuth con parametri reali, gestisco la sessione..."),this.authState="authenticating",await this.handleOAuthCallback()):ge.log("Nessun parametro OAuth rilevato, inizializzazione normale"),this.isInitialized=!0}catch(e){console.error("Errore nell'inizializzazione OAuth:",e),this.errorState=e,this.authState="error"}}}async handleOAuthCallback(){try{ge.log("Gestisco callback OAuth...");if(new URLSearchParams(window.location.search).has("code")){ge.log("Rilevato parametro code, eseguo exchangeCodeForSession...");const{data:e,error:t}=await ye.auth.exchangeCodeForSession(window.location.href);if(t)throw console.error("Errore in exchangeCodeForSession:",t),this.clearCorruptedState(),t;ge.log("exchangeCodeForSession completato:",!!e?.session)}const{data:e,error:t}=await ye.auth.getSession();if(t)throw console.error("Errore nel callback OAuth:",t),this.clearCorruptedState(),t;if(e.session){ge.log("Sessione OAuth recuperata con successo"),this.authState="authenticated",this.cleanupOAuthUrl();const e=sessionStorage.getItem("redirectUrl");e?(sessionStorage.removeItem("redirectUrl"),window.location.hash=e):window.location.hash="#home"}return e.session}catch(e){throw console.error("Errore nella gestione del callback OAuth:",e),this.clearCorruptedState(),e}}clearCorruptedState(){ge.log("Pulisco stato corrotto OAuth..."),we.clearCorruptedState(),this.cleanupOAuthUrl(),this.authState="idle",this.errorState=null}cleanupOAuthUrl(){if(window.location.hash.includes("access_token")||window.location.search.includes("code")){const e=window.location.hash.split("&")[0],t=window.location.pathname+(e&&"#"!==e?e:"");window.history.replaceState({},document.title,t),ge.log("URL pulito da parametri OAuth, nuovo URL:",t)}}async signInWithGoogle(){try{await we.onReady(),"error"===this.authState&&(ge.log("Stato di errore rilevato, pulisco..."),this.clearCorruptedState(),await new Promise(e=>setTimeout(e,100))),this.authState="authenticating";const e=window.location.origin+window.location.pathname+window.location.hash;ge.log("Iniziando login OAuth con redirect:",e);const{data:t,error:i}=await ye.auth.signInWithOAuth({provider:"google",options:{redirectTo:e,queryParams:{}}});if(i)throw console.error("Errore nella chiamata OAuth:",i),this.authState="error",this.errorState=i,i;return ge.log("Login OAuth iniziato con successo:",t),{success:!0,data:t}}catch(e){return console.error("Errore completo nel login OAuth:",e),401===e.status&&(ge.log("Errore 401 rilevato, pulisco stato corrotto..."),this.clearCorruptedState()),this.authState="error",this.errorState=e,{success:!1,error:e.message}}}getAuthState(){return{state:this.authState,error:this.errorState,isInitialized:this.isInitialized}}};let be={session:void 0,profile:null,isLoading:!0};async function Ee(e){try{if("undefined"!=typeof window&&window.__PW_E2E_AUTH_MOCK){e?.user?(be.session=e,be.profile={id:e.user.id,username:e.user.email?.split("@")[0]||"e2e-user",full_name:e.user.user_metadata?.full_name||e.user.user_metadata?.name||e.user.email||"E2E User",role:"editor",email:e.user.email,fallback:!0}):(be.session=null,be.profile=null);try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:e}}))}catch{}return window.dispatchEvent(new CustomEvent("auth-profile-loaded")),void 0}}catch{}if(e?.user){const t=await async function(e){if(!e)return null;try{const{data:t,error:i,status:n}=await ye.from("profiles").select("username, full_name, role").eq("id",e.id).single();if(i&&406!==n)throw i;return t}catch(t){ge.error("Errore nel recuperare il profilo utente:",t),ge.warn("üîÑ Uso profilo di fallback per utente:",e.email?.substring(0,3)+"***");try{const{data:t}=await ye.rpc("get_user_role_safe",{user_uuid:e.id}),i=t||"editor";return ge.info("‚úÖ Ruolo recuperato con funzione sicura:",i),{id:e.id,username:e.email?.split("@")[0]||"utente",full_name:e.user_metadata?.full_name||e.user_metadata?.name||e.email||"Utente",role:i,email:e.email,fallback:!0}}catch(i){return ge.error("‚ùå Errore nel recupero ruolo sicuro, uso fallback minimo:",i),null}}}(e.user);be.session=e,t?be.profile=t:(ge.warn("‚ö†Ô∏è Profilo non disponibile, uso fallback per utente:",e.user.email?.substring(0,3)+"***"),be.profile={id:e.user.id,username:e.user.email?.split("@")[0]||"utente",full_name:e.user.user_metadata?.full_name||e.user.user_metadata?.name||e.user.email||"Utente",role:"editor",email:e.user.email,fallback:!0}),be.profile?.fallback?ge.info("‚úÖ Utente autenticato con profilo di fallback:",be.profile.username):ge.info("‚úÖ Utente autenticato:",be.profile?.username||"sconosciuto")}else be.session=null,be.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:e}}))}catch{}window.dispatchEvent(new CustomEvent("auth-profile-loaded"))}async function Se(){try{be.session=null,be.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:null}}))}catch{}window.dispatchEvent(new CustomEvent("auth-profile-loaded"));try{const{error:e}=await ye.auth.signOut();if(e&&"Auth session missing!"!==e.message)throw e}catch(e){if("Auth session missing!"!==e.message&&"AuthSessionMissingError"!==e.name)throw e;ge.warn("Sessione gi√† mancante durante logout, continuando...")}return setTimeout(()=>{window.location.hash="login-required"},100),{success:!0}}catch(t){console.error("Errore durante il signOut:",t),be.session=null,be.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:null}}))}catch{}return window.dispatchEvent(new CustomEvent("auth-profile-loaded")),{success:!1,error:t.message}}}async function _e(e,t){try{const i=t||function(e=32){const t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}(32),{data:n,error:o}=await ye.auth.signInWithIdToken({provider:"google",token:e,nonce:i});if(o)throw o;return ge.log("Login BYO Google (GIS) via ID token completato"),{success:!0,data:n}}catch(i){return console.error("Errore login via ID token:",i),{success:!1,error:i.message}}}let Te=!1;void(window.innerWidth>767||document.addEventListener("DOMContentLoaded",()=>{!function(){if(Te)return;const e=()=>{Te=!0,document.removeEventListener("touchstart",e),document.removeEventListener("click",e)};document.addEventListener("touchstart",e,{once:!0,passive:!0}),document.addEventListener("click",e,{once:!0,passive:!0})}(),document.querySelectorAll(".card").forEach(e=>{e.addEventListener("touchstart",e=>{if(!e.target.closest("button, a, input, select, .custom-select-wrapper"))try{"vibrate"in navigator&&Te&&navigator.vibrate(10)}catch(t){console.debug("Vibrazione non disponibile o bloccata.",t.message)}},{passive:!0})}),window.addEventListener("resize",()=>{window.innerWidth<=480?document.querySelectorAll(".cards-grid-mobile").forEach(e=>{e.style.gridTemplateColumns="1fr"}):document.querySelectorAll(".cards-grid-mobile").forEach(e=>{e.style.gridTemplateColumns=""})},{passive:!0})}));const Ae="redirectUrl";let Ce=window.innerWidth<=767;function Ne(){const e=document.querySelector(".navbar"),t=document.querySelector(".mobile-navbar");if(!e||!t)return;const i=window.innerWidth<=767;if(i===Ce)return e.classList.toggle("d-none",i),t.classList.toggle("d-none",!i),void 0;Ce=i,ge.log("Mode changed to: "+(i?"mobile":"desktop"));const n=new CustomEvent("mode:change",{detail:{isMobile:i}});window.dispatchEvent(n),e.classList.toggle("d-none",i),t.classList.toggle("d-none",!i),i&&Ie()}function Ie(){const e=document.getElementById("mobile-auth-container"),t=document.getElementById("mobile-home-link");if(!e||!t)return;if(be.session){const i=document.createElement("span");i.className="material-icons",i.title="Logout",i.textContent="logout",e.replaceChildren(i),e.onclick=async e=>{e.preventDefault(),await Se()},t.classList.add("navbar-home-logged")}else{const i=document.createElement("span");i.className="material-icons",i.title="Login",i.textContent="login",e.replaceChildren(i),e.onclick=e=>{e.preventDefault();const t=document.getElementById("login-modal-trigger");t&&t.click()},t.classList.remove("navbar-home-logged")}}let xe=null;async function Le({clientId:e}){var t;await(t="https://accounts.google.com/gsi/client",xe||(xe=new Promise((e,i)=>{if("undefined"!=typeof window&&window.google&&window.google.accounts&&window.google.accounts.id)return e(),void 0;const n=document.createElement("script");n.src=t,n.async=!0,n.defer=!0,n.onload=()=>e(),n.onerror=()=>i(new Error("Failed to load Google Identity Services script")),document.head.appendChild(n)}),xe));const i=function(e=32){const t=new Uint8Array(e);return window.crypto.getRandomValues(t),btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}(32);return new Promise((t,n)=>{const o=setTimeout(()=>n(new Error("GIS prompt not available")),4e3),r=setTimeout(()=>n(new Error("Google One Tap timed out")),2e4);try{window.google.accounts.id.initialize({client_id:e,ux_mode:"popup",itp_support:!0,use_fedcm_for_prompt:!1,callback:e=>{try{e&&e.credential?(clearTimeout(o),clearTimeout(r),t({idToken:e.credential,nonce:i})):e&&e.error&&(clearTimeout(o),clearTimeout(r),n(new Error(e.error)))}catch(s){clearTimeout(o),clearTimeout(r),n(s)}},nonce:i}),window.google.accounts.id.prompt(e=>{try{if(e?.isNotDisplayed?.()){const t=e.getNotDisplayedReason?.();clearTimeout(o),n(new Error(`GIS not displayed: ${t||"unknown"}`))}else if(e?.isSkippedMoment?.()){const t=e.getSkippedReason?.();clearTimeout(o),n(new Error(`GIS skipped: ${t||"unknown"}`))}else if(e?.isDismissedMoment?.()){const t=e.getDismissedReason?.();clearTimeout(o),n(new Error(`GIS dismissed: ${t||"unknown"}`))}}catch(t){}})}catch(s){clearTimeout(o),clearTimeout(r),n(s)}})}function ke(e){const t=document.getElementById("auth-container");if(t){if(e){const i=be.profile?.role||"caricamento...",n=e.user.email;t.innerHTML=le(`\n            <div class="d-flex align-items-center text-light">\n                <span class="navbar-text me-3" title="${n}">\n                    <i class="material-icons me-1" style="font-size: 1.1em; vertical-align: text-bottom;">account_circle</i>\n                    ${n.split("@")[0]}\n                </span>\n                <span class="badge bg-info me-3 text-uppercase" style="font-size: 0.75em; padding: 0.4em 0.6em;">\n                    ${i}\n                </span>\n                <button id="logout-button" class="btn btn-outline-light btn-sm">\n                    <i class="material-icons" style="font-size: 1em; vertical-align: middle;">logout</i>\n                </button>\n            </div>\n        `)}else t.innerHTML=le('\n            <button id="login-modal-trigger" class="btn btn-outline-light">\n                <i class="material-icons me-1" style="font-size: 1em;">login</i>\n                Accedi\n            </button>\n        ');Ie()}}function De(){window.addEventListener("auth:session-changed",e=>{ke(e.detail?.session||null)}),void 0!==be&&ke(be.session||null),document.body.addEventListener("click",async e=>{if(e.target.closest("#logout-button")&&(e.preventDefault(),await Se()),e.target.closest("#login-modal-trigger")&&(e.preventDefault(),Re()),e.target.closest("#google-login-btn")){e.preventDefault(),ge.log("Pulsante Google cliccato");const o=e.target.closest("#google-login-btn"),r=o.querySelector(".spinner-border"),s=o.querySelector(".material-icons");o.disabled=!0,r&&(r.style.display="inline-block"),s&&(s.style.display="none");try{const e=!0,i="1096813530815-bk23h9jv77okogb6pb2k0mtqbb5fo1n0.apps.googleusercontent.com";console.log("üîß Config GIS:",{useGIS:"true",clientId:"1096813530815-bk23h9jv77okogb6pb2k0mtqbb5fo1n0.apps.googleusercontent.com",strict:void 0,renderOfficial:void 0,currentDomain:window.location.origin,hostname:window.location.hostname,protocol:window.location.protocol});const n=await(async()=>{try{const e=window.RequestFileSystem||window.webkitRequestFileSystem;if(e){if(await new Promise(t=>{e(window.TEMPORARY,100,()=>t(!1),()=>t(!0))}))return!0}if("storage"in navigator&&"estimate"in navigator.storage){return(await navigator.storage.estimate()).quota<12e7}return new Promise(e=>{const t=indexedDB.open("test");t.onerror=()=>e(!0),t.onsuccess=()=>{e(!1),t.result.close(),indexedDB.deleteDatabase("test")}})}catch{return!1}})();if(e&&i&&!n){console.log("üöÄ Tentativo login GIS..."),window,window,window;try{console.log("üîÑ Chiamando getGoogleIdToken...");const{idToken:e,nonce:t}=await Le({clientId:i});console.log("‚úÖ Token GIS ottenuto:",{tokenLength:e?.length,nonceLength:t?.length,tokenPreview:e?.substring(0,20)+"..."});const{error:n}=await ye.auth.signInWithIdToken({provider:"google",token:e,nonce:t});if(n)throw console.log("‚ùå Errore Supabase signInWithIdToken:",n),n;return console.log("‚úÖ Login GIS completato con successo"),Me(),void 0}catch(t){console.log("‚ùå Errore GIS dettagliato:",{message:t.message,stack:t.stack,name:t.name,cause:t.cause})}}else n?console.log("üïµÔ∏è Modalit√† incognito rilevata, uso OAuth redirect direttamente"):console.log("‚ö†Ô∏è GIS non abilitato o Client ID mancante:",{useGis:e,hasClientId:!!i});await async function(){return await ve.signInWithGoogle()}(),Me()}catch(i){console.error("Errore durante l'accesso:",i);const e={timestamp:(new Date).toISOString(),message:i?.message||"Unknown error",stack:i?.stack||"No stack trace",name:i?.name||"Unknown",cause:i?.cause||null,useGis:!0,hasClientId:!0,userAgent:navigator.userAgent,url:window.location.href,env:"production"};try{const t=JSON.parse(localStorage.getItem("auth_errors")||"[]");t.push(e),t.length>10&&t.shift(),localStorage.setItem("auth_errors",JSON.stringify(t)),window.lastAuthError=e}catch(n){console.warn("Failed to persist error details:",n)}const t=document.getElementById("auth-error");if(t){const e=i&&(i.message||i.error||i.toString())||"Errore durante l'accesso. Riprova.";t.textContent=e,t.style.display="block"}}finally{o.disabled=!1,r&&(r.style.display="none"),s&&(s.style.display="inline-block")}}})}async function Re(){let e=document.getElementById("auth-modal");if(!e){const{default:t}=await o(async()=>{const{default:e}=await import("./auth-modal-Dgd2BaX-.js");return{default:e}},[]),i=document.createElement("div");i.innerHTML=le(t),document.body.appendChild(i.firstElementChild),e=document.getElementById("auth-modal")}const t=document.getElementById("auth-error-message");t&&(t.style.display="none");const n=new i(e);try{const t=!0,i="1096813530815-bk23h9jv77okogb6pb2k0mtqbb5fo1n0.apps.googleusercontent.com";t&&!i;const n=await(async()=>{try{const e=window.RequestFileSystem||window.webkitRequestFileSystem;if(e){if(await new Promise(t=>{e(window.TEMPORARY,100,()=>t(!1),()=>t(!0))}))return!0}if("storage"in navigator&&"estimate"in navigator.storage){return(await navigator.storage.estimate()).quota<12e7}return new Promise(e=>{const t=indexedDB.open("test");t.onerror=()=>e(!0),t.onsuccess=()=>{e(!1),t.result.close(),indexedDB.deleteDatabase("test")}})}catch{return!1}})();if(n){const t=document.createElement("div");t.className="alert alert-info mt-2",t.innerHTML='\n                <i class="material-icons me-2" style="vertical-align: middle;">info</i>\n                <strong>Modalit√† incognito rilevata:</strong> Il login popup potrebbe non funzionare. \n                Usa il login con redirect se hai problemi.\n            ';const i=e.querySelector(".modal-body");i&&i.insertBefore(t,i.firstChild)}t&&i&&!0&&!n&&(await new Promise((e,t)=>{if(window.google?.accounts?.id)return e();const i=document.createElement("script");i.src="https://accounts.google.com/gsi/client",i.async=!0,i.defer=!0,i.onload=()=>e(),i.onerror=()=>t(new Error("Impossibile caricare Google Identity Services")),document.head.appendChild(i)}),window.google.accounts.id.initialize({client_id:i,ux_mode:"popup",itp_support:!0,use_fedcm_for_prompt:!1,callback:async e=>{try{if(e?.credential){const t=new Uint8Array(32);window.crypto.getRandomValues(t);const i=btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""),n=await _e(e.credential,i);if(n?.success){try{document.activeElement&&document.activeElement.blur()}catch{}Me()}}}catch(t){console.error("Errore GIS callback:",t);const o={timestamp:(new Date).toISOString(),context:"GIS_CALLBACK",message:t?.message||"Unknown GIS error",stack:t?.stack||"No stack trace",name:t?.name||"Unknown",response:e,clientId:i?.substring(0,10)+"...",env:"production"};try{const e=JSON.parse(localStorage.getItem("auth_errors")||"[]");e.push(o),e.length>10&&e.shift(),localStorage.setItem("auth_errors",JSON.stringify(e)),window.lastGisError=o}catch(n){console.warn("Failed to persist GIS error:",n)}}}}))}catch(r){}n.show()}function Me(){const e=document.getElementById("auth-modal");if(e){const t=i.getInstance(e);t&&t.hide()}}let Oe=null,ze=!1;const Pe={inserimento:()=>o(()=>import("./form-DU3KUOxl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])),dimissione:()=>o(()=>import("./dimissione-BzgXw22v.js"),__vite__mapDeps([12,13,2,1,11,3,4,5,14,15,8])),grafico:()=>o(()=>import("./grafico-pb-cjPjY.js"),__vite__mapDeps([16,17,1,3,4,5,8])),list:()=>o(()=>import("./list-D48ncHuG.js"),__vite__mapDeps([18,1,13,2,6,15,5,17,8])),diagnosi:()=>o(()=>import("./diagnosi-CHZto78Z.js"),__vite__mapDeps([19,1,8])),"eventi-clinici":()=>o(()=>import("./eventi-clinici-owmronH9.js"),__vite__mapDeps([20,1,15,2,13,14,17,10,3,4,5,8]))},Fe=new Map,$e=Object.assign({"/src/views/access-denied.html":()=>o(()=>import("./access-denied-qNA2WfrE.js"),[]).then(e=>e.default),"/src/views/auth-modal.html":()=>o(()=>import("./auth-modal-Dgd2BaX-.js"),[]).then(e=>e.default),"/src/views/diagnosi.html":()=>o(()=>import("./diagnosi-Cwkqnh9y.js"),[]).then(e=>e.default),"/src/views/dimissione.html":()=>o(()=>import("./dimissione-CVLz7l64.js"),[]).then(e=>e.default),"/src/views/eventi-clinici.html":()=>o(()=>import("./eventi-clinici-agWXjxbt.js"),[]).then(e=>e.default),"/src/views/grafico.html":()=>o(()=>import("./grafico-DyPZBtMB.js"),[]).then(e=>e.default),"/src/views/home.html":()=>o(()=>import("./home-fApaPaO7.js"),[]).then(e=>e.default),"/src/views/inserimento.html":()=>o(()=>import("./inserimento-DlpKbTqD.js"),[]).then(e=>e.default),"/src/views/list.html":()=>o(()=>import("./list-CYDwbkna.js"),[]).then(e=>e.default),"/src/views/login-required.html":()=>o(()=>import("./login-required-DkOrvptO.js"),[]).then(e=>e.default)});function Be(){const e=be.profile?.role;ge.log("Updating UI visibility based on role:",e);const t={inserimento:["admin","editor"],list:["admin","editor","viewer"],grafico:["admin","editor","viewer"],diagnosi:["admin"],dimissione:["admin","editor"],"eventi-clinici":["admin","editor"]};document.querySelectorAll(".menu-card").forEach(i=>{const n=i.dataset.view;t[n]&&(i.style.display=e&&t[n].includes(e)?"block":"none")})}async function Ue(e){if(Fe.has(e))return Fe.get(e);const t=`/src/views/${e}.html`;if(!$e[t])return console.error(`Vista non trovata: ${e} (path cercato: ${t})`),ge.error(`Vista HTML non trovata: ${e}`),"home"!==e?await Ue("home"):'\n                <div class="container mt-4">\n                    <div class="alert alert-danger" role="alert">\n                        <h4 class="alert-heading">Errore critico</h4>\n                        <p>Impossibile caricare le viste dell\'applicazione.</p>\n                        <button class="btn btn-primary" onclick="location.reload()">Ricarica pagina</button>\n                    </div>\n                </div>\n            ';try{const i=await $e[t]();if(!i||"string"!=typeof i)throw new Error(`Contenuto vista ${e} non valido`);return Fe.set(e,i),i}catch(i){return console.error("Errore nel caricamento della vista:",e,i),ge.error(`Fallimento caricamento vista HTML ${e}:`,i),"home"!==e?await Ue("home"):'\n                <div class="container mt-4">\n                    <div class="alert alert-danger" role="alert">\n                        <h4 class="alert-heading">Errore di caricamento</h4>\n                        <p>Si √® verificato un errore nel caricamento della vista.</p>\n                        <button class="btn btn-primary" onclick="location.reload()">Ricarica pagina</button>\n                        \n                    </div>\n                </div>\n            '}}function He(e){window.location.hash=e}async function Ve(){if(ze)return ge.warn("Navigazione gi√† in corso, interrotta."),void 0;ze=!0;const e=document.getElementById("view-container");try{if("function"==typeof Oe&&(Oe(),Oe=null),window.location.hash.includes("access_token="))return;if(be.isLoading)return ge.log("Sessione in caricamento, aspetto..."),e&&(e.innerHTML=le('<div class="d-flex justify-content-center align-items-center" style="height: 80vh;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Caricamento sessione...</span></div></div>')),void 0;if(void 0===be.session)return;const i=window.location.hash.replace(/^#\/?/,"");if((""===i||"home"===i||"list"===i)&&!be.session)return window.location.hash="login-required",void 0;if(!e)return console.error("Fatal: #view-container non trovato."),void 0;e.innerHTML=le('<div class="d-flex justify-content-center align-items-center" style="height: 80vh;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>');const n=window.location.hash.replace(/^#\/?/,"")||"home",[o,r]=n.split("?"),s=new URLSearchParams(r),a={inserimento:["admin","editor"],list:["admin","editor","viewer"],grafico:["admin","editor","viewer"],diagnosi:["admin"],dimissione:["admin","editor"],"eventi-clinici":["admin","editor"]};let c=o;Object.keys(a).includes(o)&&!be.session?(sessionStorage.setItem("redirectUrl",n),c="login-required"):a[o]&&!a[o].includes(be.profile?.role)&&be.profile&&(c="access-denied");const l=await Ue(c);e.innerHTML=le(l);const d=e.querySelector(".view");d.offsetHeight,d&&d.classList.add("active");const u=Pe[c];if(u)try{const e=await async function(e,t=3,i=1e3){let n;for(let r=1;r<=t;r++)try{return await e()}catch(o){if(n=o,ge.warn(`Tentativo ${r}/${t} fallito per import dinamico:`,o.message),r===t)throw n;const e=i*Math.pow(2,r-1);await new Promise(t=>setTimeout(t,e))}}(u);if(!e)throw new Error(`Modulo ${c} caricato ma vuoto`);if("list"===c){const t=await e.fetchListData();Oe=await e.initListView(t)}else if("diagnosi"===c)Oe=await e.initDiagnosiView(s);else if("grafico"===c)Oe=await e.initGraficoView(s);else if("inserimento"===c)Oe=await e.initInserimentoView(s);else if("dimissione"===c)Oe=await e.initDimissioneView(s);else if("eventi-clinici"===c)Oe=await e.initEventiCliniciView(s);else{const t=Object.values(e).find(e=>"function"==typeof e&&e.name.startsWith("init"));t&&(Oe=await t(s))}}catch(t){return console.error("Errore nel caricamento del modulo:",c,t),ge.error(`Fallimento caricamento modulo ${c}:`,t),e.innerHTML=le(`\n                    <div class="container mt-4">\n                        <div class="alert alert-warning" role="alert">\n                            <h4 class="alert-heading">\n                                <span class="material-icons me-2" style="vertical-align: middle;">warning</span>\n                                Problema di caricamento\n                            </h4>\n                            <p>Si √® verificato un problema nel caricamento di questa sezione dell'applicazione.</p>\n                            <hr>\n                            <div class="d-flex gap-2">\n                                <button class="btn btn-primary" onclick="location.reload()">\n                                    <span class="material-icons me-1" style="vertical-align: middle;">refresh</span>\n                                    Ricarica pagina\n                                </button>\n                                <button class="btn btn-outline-secondary" onclick="window.location.hash = 'home'">\n                                    <span class="material-icons me-1" style="vertical-align: middle;">home</span>\n                                    Torna alla home\n                                </button>\n                            </div>\n                            ${pe?`<details class="mt-3"><summary>Dettagli tecnici (solo sviluppo)</summary><pre class="small mt-2">${t.stack||t.message}</pre></details>`:""}\n                        </div>\n                    </div>\n                `),void 0}else if("home"===c)Be(),document.querySelectorAll(".menu-card").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.view;"inserimento"===t&&sessionStorage.removeItem("editPazienteId"),He(t)})});else if("login-required"===c){const e=document.getElementById("login-prompt-button");e&&e.addEventListener("click",async()=>{await Re()})}const m=new CustomEvent("viewChanged",{detail:{view:c,params:s}});document.dispatchEvent(m)}catch(i){console.error("Errore durante il rendering della vista:",i),e&&(e.innerHTML=le('<div class="alert alert-danger m-3">Si √® verificato un errore critico. Si prega di ricaricare la pagina.</div>'))}finally{ze=!1}}function qe(){void window.addEventListener("error",e=>{if(["A listener indicated an asynchronous response by returning true","Extension context invalidated","Could not establish connection","chrome-extension://","moz-extension://"].some(t=>e.message&&e.message.includes(t)))return console.debug("Browser extension error ignored:",e.message),e.preventDefault(),!1;console.error("Application error:",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{const t=e.reason?.message||e.reason?.toString()||"";if(["A listener indicated an asynchronous response by returning true","message channel closed before a response was received","Extension context invalidated","Could not establish connection"].some(e=>t.includes(e)))return console.debug("Browser extension promise rejection ignored:",t),e.preventDefault(),void 0;console.error("Unhandled promise rejection:",e.reason)}),window.appLogger={info:(e,t=null)=>{ge.log(`[APP] ${e}`,t||"")},warn:(e,t=null)=>{ge.warn(`[APP WARNING] ${e}`,t||"")},error:(e,t=null)=>{console.error("[APP ERROR]",e,t||"")},debug:(e,t=null)=>{"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||ge.log(`[APP DEBUG] ${e}`,t||"")}},window.appLogger.info("Error service and logger initialized.",{timestamp:(new Date).toISOString()})}function je(){document.addEventListener("click",e=>{const t=e.target.closest(".btn-back-menu");if(t){e.preventDefault(),t.style.transform="scale(0.95)",t.style.transition="transform 0.1s ease",setTimeout(()=>{t.style.transform="",t.style.transition=""},150);const i=t.getAttribute("data-view")||"home";"home"===i&&(sessionStorage.removeItem("editPazienteId"),sessionStorage.removeItem("formData"),sessionStorage.removeItem("currentFilters")),setTimeout(()=>He(i),100)}})}window.addEventListener("auth-profile-loaded",Be),window.renderView=Ve;class Ge{constructor(e={}){this.options={id:e.id||"notification-announcer",className:e.className||"notification__sr-only",defaultLive:e.defaultLive||"polite",enableQueue:!1!==e.enableQueue,queueDelay:e.queueDelay||150,maxQueueSize:e.maxQueueSize||10,...e},this.element=null,this.queue=[],this.isProcessing=!1,this.currentTimeout=null,this.init()}init(){this.createElement(),this.setupAccessibility()}createElement(){const e=document.getElementById(this.options.id);e&&e.remove(),this.element=document.createElement("div"),this.element.id=this.options.id,this.element.className=this.options.className,document.body.appendChild(this.element)}setupAccessibility(){this.element.setAttribute("aria-live",this.options.defaultLive),this.element.setAttribute("aria-atomic","true"),this.element.setAttribute("role","status"),this.element.style.cssText="\n            position: absolute !important;\n            width: 1px !important;\n            height: 1px !important;\n            padding: 0 !important;\n            margin: -1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n        "}announce(e,t={}){if(!e||"string"!=typeof e)return console.warn("NotificationLiveRegion: messaggio non valido",e),void 0;const i={message:e.trim(),live:t.live||this.options.defaultLive,priority:t.priority||0,timestamp:Date.now(),id:this.generateAnnouncementId()};this.options.enableQueue?this.addToQueue(i):this.processAnnouncement(i)}announceSuccess(e,t=""){this.announce(t?`Successo: ${t}. ${e}`:`Successo: ${e}`,{live:"polite",priority:1})}announceError(e,t=""){this.announce(t?`Errore: ${t}. ${e}`:`Errore: ${e}`,{live:"assertive",priority:3})}announceWarning(e,t=""){this.announce(t?`Attenzione: ${t}. ${e}`:`Attenzione: ${e}`,{live:"assertive",priority:2})}announceInfo(e,t=""){this.announce(t?`Informazione: ${t}. ${e}`:`Informazione: ${e}`,{live:"polite",priority:1})}announceNotification(e,t,i="",n={}){const o={success:"Successo",error:"Errore",warning:"Attenzione",info:"Informazione"}[e]||"Notifica";this.announce(i?`${o}: ${i}. ${t}`:`${o}: ${t}`,{live:{success:"polite",error:"assertive",warning:"assertive",info:"polite"}[e]||"polite",priority:{success:1,error:3,warning:2,info:1}[e]||1,...n})}addToQueue(e){const t=Date.now()-3e3;this.queue=this.queue.filter(i=>i.timestamp<t||i.message!==e.message),this.queue.length>=this.options.maxQueueSize&&this.queue.shift();const i=this.queue.findIndex(t=>t.priority<e.priority);-1===i?this.queue.push(e):this.queue.splice(i,0,e),this.processQueue()}processQueue(){if(this.isProcessing||0===this.queue.length)return;this.isProcessing=!0;const e=this.queue.shift();this.processAnnouncement(e),this.currentTimeout=setTimeout(()=>{this.isProcessing=!1,this.processQueue()},this.options.queueDelay)}processAnnouncement(e){this.element.getAttribute("aria-live")!==e.live&&this.element.setAttribute("aria-live",e.live),this.element.textContent="",setTimeout(()=>{this.element.textContent=e.message,this.dispatchEvent("announced",{announcement:e})},50)}clearQueue(){this.queue=[],this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.isProcessing=!1,this.dispatchEvent("queueCleared")}clear(){this.element.textContent="",this.dispatchEvent("cleared")}updateSettings(e){this.options={...this.options,...e},e.defaultLive&&this.element.setAttribute("aria-live",e.defaultLive),this.dispatchEvent("settingsUpdated",{options:this.options})}getState(){return{id:this.options.id,queueLength:this.queue.length,isProcessing:this.isProcessing,currentContent:this.element.textContent,currentLive:this.element.getAttribute("aria-live"),options:{...this.options}}}generateAnnouncementId(){return`announcement-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}dispatchEvent(e,t={}){const i=new CustomEvent(`notificationLiveRegion:${e}`,{detail:{liveRegion:this,...t}});document.dispatchEvent(i)}destroy(){this.clearQueue(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchEvent("destroyed"),this.element=null,this.queue=[]}static getInstance(e={}){return Ge._instance||(Ge._instance=new Ge(e)),Ge._instance}static destroyInstance(){Ge._instance&&(Ge._instance.destroy(),Ge._instance=null)}static exists(){return!!Ge._instance}}Ge._instance=null;let We=null;function Qe(e,t,i=""){try{We||(We=Ge.getInstance({id:"notification-announcer"})),We.announceNotification?.(e,t,i)}catch(n){const i=document.getElementById("notification-announcer");i&&(i.textContent=`${e}: ${t}`)}}function Ye(e,t,{removeNotification:i}){const n=e.querySelector(".notification__close");n&&n.addEventListener("click",e=>{e.stopPropagation(),i(t.id)}),e.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),i(t.id))})}function Je(e,t,{pauseAutoCloseTimer:i}){let n=0;e.addEventListener("touchstart",()=>{n=Date.now()}),e.addEventListener("touchend",()=>{Date.now()-n>500&&i?.(t.id)})}class Xe{static DEBUG=!1;static notificationQueue=[];static isDOMReady=!1;static domReadyCallbacks=[];static animationSupport=null;static reducedMotionPreference=null;static errorCounts={render:0,animation:0,dom:0,service:0,total:0};static init(){this.checkDOMReady(),this.checkAnimationSupport(),this.checkReducedMotionPreference(),this.setupErrorRecovery()}static handleRenderError(e,t,i=null){this.errorCounts.render++,this.errorCounts.total++,ge.error("‚ùå Notification render error:",e,t),"undefined"!=typeof window&&window.appLogger&&window.appLogger.error("Notification render failed",{error:e.message,notificationId:t?.id,notificationType:t?.type,stack:e.stack});try{return i&&"function"==typeof i?i(t):this.createSimpleFallback(t)}catch(n){return ge.error("‚ùå Fallback renderer also failed:",n),this.showConsoleFallback(t),null}}static handleAnimationError(e,t,i="unknown"){if(this.errorCounts.animation++,this.errorCounts.total++,ge.warn("‚ö†Ô∏è Animation error:",e,i),t)try{t.style.animation="none",t.style.transition="none","entrance"===i?(t.style.opacity="1",t.style.transform="translateX(0)",t.classList.add("notification--visible"),t.classList.remove("notification--entering")):"exit"===i&&(t.style.opacity="0",t.classList.add("notification--hidden"),t.classList.remove("notification--exiting")),this.DEBUG&&ge.debug("‚úÖ Animation fallback applied to element")}catch(n){ge.error("‚ùå Animation fallback failed:",n)}}static handleServiceError(e,t,i=null){this.errorCounts.service++,this.errorCounts.total++,this.errorCounts.service%10==1&&ge.error(`‚ùå NotificationService error in ${t} (${this.errorCounts.service} total):`,e),"undefined"!=typeof window&&window.appLogger&&window.appLogger.error(`NotificationService ${t} failed`,{error:e.message,operation:t,data:i,stack:e.stack});try{switch(t){case"show":this.recoverFromShowError(i);break;case"remove":this.recoverFromRemoveError(i);break;case"clear":this.recoverFromClearError();break;case"init":this.recoverFromInitError();break;default:ge.warn(`‚ö†Ô∏è No recovery strategy for operation: ${t}`)}}catch(n){ge.error("‚ùå Error recovery failed:",n)}}static handleDOMError(e,t,i=null){return this.errorCounts.dom++,this.errorCounts.total++,ge.error(`‚ùå DOM error in ${t}:`,e),!(!this.isDOMReady&&"render"===t)||(ge.debug("üìã DOM not ready, queueing notification"),!1)}static queueNotification(e,t){if(this.isDOMReady)try{return e(t)}catch(i){return this.handleRenderError(i,t)}return this.notificationQueue.push({renderFunction:e,notification:t,timestamp:Date.now()}),this.DEBUG&&ge.debug(`üìã Queued notification ${t?.id}, queue size: ${this.notificationQueue.length}`),null}static processNotificationQueue(){if(!this.isDOMReady||0===this.notificationQueue.length)return;ge.debug(`üöÄ Processing ${this.notificationQueue.length} queued notifications`);const e=[...this.notificationQueue];this.notificationQueue=[],e.forEach(({renderFunction:e,notification:t,timestamp:i})=>{try{if(Date.now()-i>3e4)return ge.warn("‚ö†Ô∏è Skipping old queued notification:",t?.id),void 0;e(t)}catch(n){this.handleRenderError(n,t)}})}static createSimpleFallback(e){const t=document.createElement("div");t.className=`notification notification--${e.type} notification--fallback`,t.setAttribute("data-id",e.id),t.setAttribute("role","error"===e.type?"alert":"status"),t.setAttribute("aria-live","error"===e.type?"assertive":"polite"),t.style.cssText="\n            position: relative;\n            padding: 12px 16px;\n            margin: 8px 0;\n            border-radius: 4px;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 14px;\n            line-height: 1.4;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n            max-width: 400px;\n            word-wrap: break-word;\n        ";const i={success:{bg:"#d4edda",text:"#155724",border:"#c3e6cb"},error:{bg:"#f8d7da",text:"#721c24",border:"#f5c6cb"},warning:{bg:"#fff3cd",text:"#856404",border:"#ffeaa7"},info:{bg:"#d1ecf1",text:"#0c5460",border:"#bee5eb"}},n=i[e.type]||i.info;t.style.backgroundColor=n.bg,t.style.color=n.text,t.style.border=`1px solid ${n.border}`;const o=document.createElement("div");o.style.cssText="display: flex; align-items: flex-start; gap: 8px;";const r=document.createElement("span");r.style.cssText="flex-shrink: 0; font-weight: bold; font-size: 16px;";const s={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"};r.textContent=s[e.type]||s.info;const a=document.createElement("div");if(a.style.cssText="flex: 1; min-width: 0;",e.title){const t=document.createElement("div");t.style.cssText="font-weight: bold; margin-bottom: 4px;",t.textContent=e.title,a.appendChild(t)}const c=document.createElement("div");c.textContent=e.message||`Notifica ${e.type||"info"} - Messaggio non disponibile`,a.appendChild(c);const l=document.createElement("button");return l.style.cssText=`\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            padding: 0;\n            margin-left: 8px;\n            color: ${n.text};\n            opacity: 0.7;\n            flex-shrink: 0;\n        `,l.textContent="√ó",l.setAttribute("aria-label","Chiudi notifica"),l.onclick=()=>{t.remove();try{window.stateService&&"function"==typeof window.stateService.removeNotification&&window.stateService.removeNotification(e.id)}catch(i){console.debug("Could not remove from state:",i)}},o.appendChild(r),o.appendChild(a),o.appendChild(l),t.appendChild(o),t}static showConsoleFallback(e){const t={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},i=`${t[e.type]||t.info} NOTIFICATION: ${e.message||`Notifica ${e.type||"info"} - Messaggio non disponibile`}`;"error"===e.type?console.error(i):"warning"===e.type?console.warn(i):console.log(i)}static checkDOMReady(){if("undefined"==typeof document)return this.isDOMReady=!1,void 0;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.isDOMReady=!0,this.processNotificationQueue(),this.domReadyCallbacks.forEach(e=>{try{e()}catch(t){console.error("‚ùå DOM ready callback error:",t)}}),this.domReadyCallbacks=[]}):this.isDOMReady=!0}static checkAnimationSupport(){if("undefined"==typeof window||"undefined"==typeof document)return this.animationSupport=!1,void 0;try{const e=document.createElement("div");e.style.animation="test 1s",this.animationSupport=""!==e.style.animation}catch(e){this.animationSupport=!1}this.DEBUG&&console.log("üé¨ Animation support:",this.animationSupport)}static checkReducedMotionPreference(){if("undefined"==typeof window||!window.matchMedia)return this.reducedMotionPreference=!1,void 0;try{const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.reducedMotionPreference=e.matches,e.addEventListener("change",e=>{this.reducedMotionPreference=e.matches})}catch(e){this.reducedMotionPreference=!1}this.DEBUG&&console.log("üé¨ Reduced motion preference:",this.reducedMotionPreference)}static setupErrorRecovery(){setInterval(()=>{this.cleanupOldQueuedNotifications()},6e4),"undefined"!=typeof window&&window.addEventListener("error",e=>{e.message&&e.message.includes("notification")&&console.warn("‚ö†Ô∏è Possible notification-related error detected")})}static cleanupOldQueuedNotifications(){const e=Date.now(),t=this.notificationQueue.length;this.notificationQueue=this.notificationQueue.filter(t=>e-t.timestamp<6e4);const i=t-this.notificationQueue.length;i>0&&this.DEBUG&&console.log(`üßπ Cleaned up ${i} old queued notifications`)}static recoverFromShowError(e){console.log("üîÑ Attempting recovery from show error");try{const t=this.createSimpleFallback(e);if(t){const e=document.querySelector(".notification-container")||document.querySelector("#notification-container")||document.body;if(e)return e.appendChild(t),!0}}catch(t){console.error("‚ùå Show recovery failed:",t)}return this.showConsoleFallback(e),!1}static recoverFromRemoveError(e){console.log("üîÑ Attempting recovery from remove error");try{const t=document.querySelector(`[data-id="${e}"]`);if(t)return t.remove(),ge.debug("‚úÖ Notification removed via DOM recovery"),!0}catch(t){console.error("‚ùå Remove recovery failed:",t)}return!1}static recoverFromClearError(){ge.debug("üîÑ Attempting recovery from clear error");try{const e=document.querySelectorAll('.notification, [class*="notification"]');return e.forEach(e=>{try{e.remove()}catch(t){ge.debug("Could not remove notification element:",t)}}),ge.debug(`‚úÖ Cleared ${e.length} notifications via DOM recovery`),!0}catch(e){ge.error("‚ùå Clear recovery failed:",e)}return!1}static recoverFromInitError(){ge.debug("üîÑ Attempting recovery from init error");try{let e=document.querySelector(".notification-container");if(!e)return e=document.createElement("div"),e.className="notification-container notification-container--fallback",e.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    z-index: 9999;\n                    pointer-events: none;\n                ",document.body.appendChild(e),ge.debug("‚úÖ Fallback notification container created"),!0}catch(e){ge.error("‚ùå Init recovery failed:",e)}return!1}static getErrorStats(){return{...this.errorCounts,queueSize:this.notificationQueue.length,isDOMReady:this.isDOMReady,animationSupport:this.animationSupport,reducedMotionPreference:this.reducedMotionPreference}}static resetErrorStats(){this.errorCounts={render:0,animation:0,dom:0,service:0,total:0}}static shouldDisableAnimations(){return!this.animationSupport||this.reducedMotionPreference}static onDOMReady(e){if(this.isDOMReady)try{e()}catch(t){ge.error("‚ùå DOM ready callback error:",t)}else this.domReadyCallbacks.push(e)}}"undefined"!=typeof window&&Xe.init();const Ke={SUCCESS:{icon:"check_circle",ariaRole:"status",ariaLive:"polite",defaultDuration:4e3},ERROR:{icon:"error",ariaRole:"alert",ariaLive:"assertive",defaultDuration:0},WARNING:{icon:"warning",ariaRole:"alert",ariaLive:"assertive",defaultDuration:6e3},INFO:{icon:"info",ariaRole:"status",ariaLive:"polite",defaultDuration:5e3}},Ze={maxWidth:768};class et{constructor(e,t=4e3,i="success"){this.element=e,this.duration=t,this.type=i,this.startTime=null,this.animationId=null,this.isPaused=!1,this.pausedTime=0,this.isDestroyed=!1,this.timing=this.createEasingFunction("linear"),this.init()}createEasingFunction(e="linear"){const t={linear:e=>e,easeOut:e=>1-Math.pow(1-e,3),easeIn:e=>Math.pow(e,3),easeInOut:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2};return t[e]||t.linear}init(){if(this.isDestroyed)return;const e=this.element.querySelector(".notification__progress--js-placeholder");e?this.replaceProgressBarPlaceholder(e):this.element.querySelector(".notification__progress")||this.createProgressBar(),this.progressBar=this.element.querySelector(".notification__progress"),this.progressFill=this.element.querySelector(".notification__progress-fill"),this.progressBar&&this.progressFill&&this.start()}replaceProgressBarPlaceholder(e){e.classList.remove("notification__progress--js-placeholder"),e.classList.add("notification__progress--js-controlled"),e.setAttribute("aria-valuenow","100");const t={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"};e.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${t[this.type]||t.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const i=document.createElement("div");i.className="notification__progress-fill";const n={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"};i.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${n[this.type]||n.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,e.innerHTML="",e.appendChild(i)}createProgressBar(){const e={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"},t={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"},i=document.createElement("div");i.className="notification__progress notification__progress--js-controlled",i.setAttribute("role","progressbar"),i.setAttribute("aria-label","Tempo rimanente prima della chiusura automatica"),i.setAttribute("aria-valuemin","0"),i.setAttribute("aria-valuemax","100"),i.setAttribute("aria-valuenow","100"),i.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${e[this.type]||e.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const n=document.createElement("div");n.className="notification__progress-fill",n.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${t[this.type]||t.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,i.appendChild(n),this.element.appendChild(i)}start(){this.isDestroyed||(this.startTime=performance.now(),this.lastLoggedProgress=-1,this.animate({timing:this.timing,draw:e=>this.draw(e),duration:this.duration}))}animate({timing:e,draw:t,duration:i}){if(this.isDestroyed)return;const n=this.startTime,o=r=>{if(this.isDestroyed)return;if(this.isPaused)return this.animationId=requestAnimationFrame(o),void 0;let s=(r-n-this.pausedTime)/i;s>1&&(s=1),s<0&&(s=0);let a=e(s);t(a),this.updateAccessibility(s),s<1?this.animationId=requestAnimationFrame(o):this.onComplete()};this.animationId=requestAnimationFrame(o)}draw(e){if(this.isDestroyed||!this.progressFill)return;this.progressFill.style.transform=`scaleX(${1-e})`}updateAccessibility(e){if(this.progressBar){const t=Math.round(100*(1-e));this.progressBar.setAttribute("aria-valuenow",t.toString())}}pause(){this.isPaused||this.isDestroyed||(this.isPaused=!0,this.pauseStartTime=performance.now())}resume(){this.isPaused&&!this.isDestroyed&&(this.isPaused=!1,this.pauseStartTime&&(this.pausedTime+=performance.now()-this.pauseStartTime,this.pauseStartTime=null))}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.progressFill&&!this.isDestroyed&&(this.progressFill.style.transform="scaleX(0)")}onComplete(){if(this.isDestroyed)return;const e=new CustomEvent("progressComplete",{detail:{element:this.element,type:this.type,duration:this.duration}});this.element.dispatchEvent(e)}destroy(){this.isDestroyed=!0,this.stop(),this.progressBar&&this.progressBar.parentNode&&this.progressBar.parentNode.removeChild(this.progressBar),this.element=null,this.progressBar=null,this.progressFill=null}}function tt(e,{allowHTML:t=!1}={}){if(!t){const t=document.createElement("div");return t.textContent=String(e??""),t.innerHTML}const i=document.createElement("div");i.innerHTML=String(e??"");const n=new Set(["b","strong","i","em","u","br","code","pre","span","p","ul","ol","li","a"]),o=e=>{if(e.nodeType===Node.COMMENT_NODE)return e.remove(),void 0;if(e.nodeType===Node.ELEMENT_NODE){const t=e;if(!n.has(t.tagName.toLowerCase())){const e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);return e.removeChild(t),void 0}[...t.attributes].forEach(e=>{const i=e.name.toLowerCase(),n=String(e.value||"");if(i.startsWith("on")||"style"===i)t.removeAttribute(e.name);else if("a"===t.tagName.toLowerCase()&&"href"===i){/^(https?:|mailto:)/i.test(n)||t.removeAttribute("href")}else"href"!==i&&"title"!==i&&t.removeAttribute(e.name)})}let t=e.firstChild;for(;t;){const e=t.nextSibling;o(t),t=e}};return o(i),i.innerHTML}function it({notification:e,_index:t=0,settings:i,timers:n,removeNotification:o,startAutoCloseTimer:r,pauseAutoCloseTimer:s,resumeAutoCloseTimer:a,announceNotification:c,attachNotificationEvents:l,attachTouchEvents:d,notificationContainer:u,errorHandler:m=Xe}){try{const t=Ke[e.type.toUpperCase()]||Ke.INFO,v=e.options||{},b=function(e,t){if(void 0!==t)return t;const i=Ke[e.toUpperCase()];return i?i.defaultDuration:5e3}(e.type,v.duration),E=document.createElement("div");let S=`notification notification--${e.type}`;if(b>0&&!v.persistent&&(S+=" notification--autoclose"),E.className=S,E.dataset.id=e.id,E.setAttribute("role",t.ariaRole),E.setAttribute("aria-live",t.ariaLive),E.setAttribute("aria-atomic","true"),E.setAttribute("tabindex","0"),i.enableAnimations&&!m.shouldDisableAnimations())try{E.classList.add("notification--entering"),E.addEventListener("animationend",e=>{(e.animationName.includes("slideIn")||e.animationName.includes("fadeIn"))&&(E.classList.remove("notification--entering"),E.classList.add("notification--visible"))}),E.addEventListener("animationerror",e=>{m.handleAnimationError(new Error("Animation failed"),E,"entrance")})}catch(h){m.handleAnimationError(h,E,"entrance")}else E.classList.add("notification--visible","notification--no-animations");let _="";try{_=`\n                <div class="notification__content">\n                    <span class="material-icons notification__icon" aria-hidden="true">${t.icon}</span>\n                    <div class="notification__body">\n                        ${v.title?`<div class="notification__title">${tt(v.title,{allowHTML:!1})}</div>`:""}\n                        <div class="notification__message">${tt(e.message,{allowHTML:!!v.allowHTML})}</div>\n                    </div>\n                </div>\n            `,v.duplicateCount&&v.duplicateCount>1&&(_=_.replace('<span class="material-icons notification__icon" aria-hidden="true">',`<span class="notification__count" aria-label="Ripetuta ${v.duplicateCount} volte">√ó${v.duplicateCount}</span><span class="material-icons notification__icon" aria-hidden="true">`)),(!1!==v.closable||v.actions)&&(_+='<div class="notification__actions">',v.actions&&Array.isArray(v.actions)&&v.actions.forEach((e,t)=>{_+=`\n                            <button class="notification__action-btn ${"primary"===e.style?"notification__action-btn--primary":"secondary"===e.style?"notification__action-btn--secondary":""}" \n                                    data-action-index="${t}"\n                                    aria-label="${tt(e.label,{allowHTML:!1})}">\n                                ${tt(e.label,{allowHTML:!1})}\n                            </button>\n                        `}),!1!==v.closable&&(_+='\n                        <button class="notification__close" \n                                aria-label="Chiudi notifica"\n                                title="Chiudi notifica">\n                            <span class="material-icons" aria-hidden="true">close</span>\n                        </button>\n                    '),_+="</div>");const i=b;i>0&&!v.persistent&&(ge.debug(`üîß Creating progress bar placeholder for ${e.type} (${i}ms)`),_+=`\n                    <div class="notification__progress notification__progress--js-placeholder" \n                         aria-hidden="true" \n                         role="progressbar"\n                         aria-label="Tempo rimanente prima della chiusura automatica"\n                         data-duration="${i}"\n                         data-type="${e.type}"></div>\n                `),E.innerHTML=_}catch(p){ge.error("‚ùå Error building notification HTML:",p),E.innerHTML=`\n                <div class="notification__content">\n                    <span class="notification__icon">!</span>\n                    <div class="notification__body">\n                        <div class="notification__message">${e.message||"Notifica"}</div>\n                    </div>\n                    <button class="notification__close" aria-label="Chiudi">√ó</button>\n                </div>\n            `}try{l(E,e,{timers:n,removeNotification:o,pauseAutoCloseTimer:s,resumeAutoCloseTimer:a,notificationContainer:u})}catch(f){ge.error("‚ùå Error attaching notification events:",f);const t=E.querySelector(".notification__close");t&&t.addEventListener("click",()=>{try{o(e.id)}catch(t){E.remove()}})}try{window.innerWidth<=Ze.maxWidth&&d(E,e,{pauseAutoCloseTimer:s,resumeAutoCloseTimer:a,removeNotification:o})}catch(g){ge.error("‚ùå Error attaching touch events:",g)}try{const t=b;if(t>0&&!v.persistent){const i=E.querySelector(".notification__progress--js-placeholder");if(ge.debug("üîç Looking for progress bar placeholder:",i),i){const i=new et(E,t,e.type);r(n,e.id,t,()=>{try{o(e.id)}catch(t){ge.error("‚ùå Error in progress complete callback:",t),E.parentNode&&E.remove()}}),window.innerWidth>768&&(E.addEventListener("mouseenter",()=>{i&&i.pause()}),E.addEventListener("mouseleave",()=>{i&&i.resume()})),E.addEventListener("progressComplete",()=>{try{o(e.id)}catch(t){ge.error("‚ùå Error in progress complete callback:",t),E.parentNode&&E.remove()}}),E._progressBarInstance=i,ge.debug(`‚úÖ JavaScript progress bar initialized for ${e.type} (${t}ms)`)}else r(n,e.id,t,()=>{try{o(e.id)}catch(t){console.error("‚ùå Error in auto-close callback:",t),E.parentNode&&E.remove()}}),ge.debug(`‚úÖ Fallback timer used for ${e.type} (${t}ms)`)}}catch(y){ge.error("‚ùå Error setting up auto-close timer:",y)}try{c(e.type,e.message,v.title||"")}catch(w){ge.warn("‚ùå Error announcing notification:",w)}return E}catch(v){return ge.error("‚ùå Critical error in createNotificationElement:",v),m.createSimpleFallback(e)}}function nt(e,t,i,n){if(e.has(t)){const i=e.get(t);clearTimeout(i.timerId)}const o=Date.now(),r=setTimeout(()=>{e.delete(t),n(t)},i);e.set(t,{timerId:r,originalDuration:i,startTime:o,remainingTime:i,isPaused:!1,pausedAt:null,callback:n})}function ot(e,t){const i=e.get(t);i&&!i.isPaused&&(clearTimeout(i.timerId),i.isPaused=!0,i.pausedAt=Date.now(),i.remainingTime=i.remainingTime-(i.pausedAt-i.startTime),ge.debug(`‚è∏Ô∏è Timer paused for notification: ${t}`))}function rt(e,t){const i=e.get(t);i&&i.isPaused&&(i.isPaused=!1,i.startTime=Date.now(),i.timerId=setTimeout(()=>{e.delete(t),i.callback&&i.callback(t)},i.remainingTime),ge.debug(`‚ñ∂Ô∏è Timer resumed for notification: ${t}`))}function st(e,t,i){const n=e.get(t);if(n){clearTimeout(n.timerId),e.delete(t);try{"function"==typeof i&&i(t)}catch(o){ge.warn("Timer onStop callback error:",o)}ge.debug(`‚èπÔ∏è Timer stopped for notification: ${t}`)}}const at=new class{getDefaultAnimationSetting(){try{return"undefined"==typeof window||!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches}catch(e){return!0}}constructor(){this.state={currentView:"home",previousView:null,editPazienteId:null,selectedPazienteId:null,listFilters:{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"},eventiCliniciFilters:{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"},formData:{},isLoading:!1,loadingMessage:"",errors:[],notifications:[],notificationSettings:{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:this.getDefaultAnimationSetting(),autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}},user:null,isAuthenticated:!1},this.subscribers=new Map,this.persistentKeys=["listFilters","editPazienteId","formData","eventiCliniciFilters","notificationSettings"],this.cleanupTimer=null,this.loadPersistedState(),this.startAutoCleanup()}loadPersistedState(){try{this.persistentKeys.forEach(e=>{const t=localStorage.getItem(`app_state_${e}`);t&&(this.state[e]=JSON.parse(t))});const e=this.state.notificationSettings||{};Array.isArray(e.persistentTypes)?e.persistentTypes.includes("error")||e.persistentTypes.unshift("error"):e.persistentTypes=["error"],e.customDurations=e.customDurations||{},(void 0===e.customDurations.error||e.customDurations.error>0)&&(e.customDurations.error=0),this.state.notificationSettings=e}catch(e){ge.warn("Errore durante il caricamento dello stato persistente:",e)}}persistState(){try{this.persistentKeys.forEach(e=>{null!=this.state[e]&&localStorage.setItem(`app_state_${e}`,JSON.stringify(this.state[e]))})}catch(e){ge.warn("Errore durante il salvataggio dello stato persistente:",e)}}getState(e){return e?this.state[e]:{...this.state}}setState(e,t){const i="string"==typeof e?{[e]:t}:e,n={...this.state};void 0===i.notifications||Array.isArray(i.notifications)||(console.warn("‚ö†Ô∏è StateService: notifications must be an array, got:",typeof i.notifications),i.notifications=[]),Object.assign(this.state,i);const o=Object.keys(i);o.some(e=>this.persistentKeys.includes(e))&&this.persistState(),this.notifySubscribers(o,n)}subscribe(e,t){const i=Array.isArray(e)?e:[e],n=Symbol("subscriber");return this.subscribers.set(n,{keys:i,callback:t}),()=>{this.subscribers.delete(n)}}notifySubscribers(e,t){this.subscribers.forEach(({keys:i,callback:n},o)=>{if(i.some(t=>e.includes(t)))try{const r=n(this.state,t,e);r&&"function"==typeof r.then&&r.catch(r=>{console.error(`Errore async in subscriber callback [${n.name||"(anonymous)"}] (subscriberId: ${String(o)}):`,r,"\nchangedKeys:",e,"\nsubscriber keys:",i,"\ncurrent state:",this.state,"\nold state:",t,"\ncallback:",n.toString())})}catch(r){console.error(`Errore in subscriber callback [${n.name||"(anonymous)"}] (subscriberId: ${String(o)}):`,r,"\nchangedKeys:",e,"\nsubscriber keys:",i,"\ncurrent state:",this.state,"\nold state:",t,"\ncallback:",n.toString())}})}clearState(e=["user","isAuthenticated"]){this.stopAutoCleanup();const t={};e.forEach(e=>{void 0!==this.state[e]&&(t[e]=this.state[e])});const i={currentView:"home",previousView:null,editPazienteId:null,selectedPazienteId:null,listFilters:{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"},eventiCliniciFilters:{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"},formData:{},isLoading:!1,loadingMessage:"",errors:[],notifications:[],notificationSettings:{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:this.getDefaultAnimationSetting(),autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}},user:null,isAuthenticated:!1};this.state={...i,...t},this.persistentKeys.forEach(t=>{e.includes(t)||localStorage.removeItem(`app_state_${t}`)}),e.includes("notificationSettings")&&this.startAutoCleanup()}setEditPatient(e){this.setState("editPazienteId",e)}getEditPatientId(){return this.getState("editPazienteId")}clearEditPatient(){this.setState("editPazienteId",null)}updateFilters(e){this.setState("listFilters",{...this.getState("listFilters"),...e})}getFilters(){return this.getState("listFilters")}resetFilters(){this.setState("listFilters",{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"})}setFormData(e){this.setState("formData",e)}getFormData(){return this.getState("formData")}clearFormData(){this.setState("formData",{})}setLoading(e,t=""){this.setState({isLoading:e,loadingMessage:t})}addNotification(e,t,i={}){"number"==typeof i&&(i={duration:i});const n=this.normalizeNotificationType(e),o={maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:!0,autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0},...this.getState("notificationSettings")},r=o.customDurations&&void 0!==o.customDurations[n]?o.customDurations[n]:o.defaultDuration,s={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:n,message:t,timestamp:new Date,isVisible:!0,isRemoving:!1,options:{duration:r,persistent:o.persistentTypes.includes(n),closable:!0,position:o.position,priority:0,duplicateCount:1,...i}};s.options.persistent&&(s.options.duration=0);const a=this.getState("notifications");ge.debug(`[StateService] Current notifications before adding: ${a.length}`,a);try{const e=Date.now(),o=1500;if(("success"===n||"info"===n)&&!1!==i.dedupe){const i=[...a].reverse().findIndex(i=>{const r=new Date(i.timestamp).getTime();return i.type===n&&i.message===t&&e-r<=o});if(-1!==i){const e=a.length-1-i,t=a[e],n={...t,timestamp:new Date,options:{...t.options,duplicateCount:(t.options?.duplicateCount||1)+1}},o=a.slice();return o[e]=n,this.setState("notifications",o),void 0}}}catch(l){}let c=[...a,s];if(c.length>o.maxStoredNotifications){ge.warn(`[StateService] Max stored notifications (${o.maxStoredNotifications}) exceeded. Trimming old notifications.`);const e=c.sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)).slice(0,c.length-o.maxStoredNotifications);c=c.filter(t=>!e.includes(t)||t.options.persistent&&"error"===t.type),ge.debug(`[StateService] Notifications after trimming: ${c.length}`,c)}return this.setState("notifications",c),ge.debug(`[StateService] Notification added. New notifications array length: ${this.getState("notifications").length}`,this.getState("notifications")),s.id}normalizeNotificationType(e){const t=String(e||"").toLowerCase().trim();return t?["error","errore","err","danger","fatal"].includes(t)?"error":["success","ok","successo"].includes(t)?"success":["warning","warn","avviso","alert"].includes(t)?"warning":(["info","informazione","notice"].includes(t),"info"):"info"}removeNotification(e){const t=this.getState("notifications");ge.debug("[StateService] Notifiche prima della rimozione:",t);const i=t.filter(t=>t.id!==e);this.setState("notifications",i);const n=this.getState("notifications");ge.debug("[StateService] Notifiche dopo la rimozione:",n)}updateNotificationSettings(e){const t={...this.getState("notificationSettings"),...e};this.setState("notificationSettings",t),void 0!==e.autoCleanupInterval&&this.startAutoCleanup()}getNotificationSettings(){return this.getState("notificationSettings")}clearAllNotifications(){this.setState("notifications",[])}clearNotificationsByType(e){const t=this.getState("notifications").filter(t=>t.type!==e);this.setState("notifications",t)}clearOldNotifications(e=3e5){const t=new Date,i=this.getState("notifications"),n=i.filter(i=>{const n=t-new Date(i.timestamp);return!(!i.options.persistent||"error"!==i.type)||n<e});return this.setState("notifications",n),i.length-n.length}markNotificationRemoving(e){const t=this.getState("notifications").map(t=>t.id===e?{...t,isRemoving:!0}:t);this.setState("notifications",t)}getNotificationsByType(e){return this.getState("notifications").filter(t=>t.type===e)}getVisibleNotifications(){return this.getState("notifications").filter(e=>e.isVisible&&!e.isRemoving)}countNotificationsByType(e){return this.getNotificationsByType(e).length}hasErrorNotifications(){return this.countNotificationsByType("error")>0}startAutoCleanup(){this.cleanupTimer&&clearInterval(this.cleanupTimer);const e=this.getState("notificationSettings");this.cleanupTimer=setInterval(()=>{const t=this.clearOldNotifications(e.autoCleanupInterval);t>0&&ge.debug(`Cleanup automatico: rimosse ${t} notifiche vecchie`)},e.autoCleanupInterval)}stopAutoCleanup(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}getNotificationStats(){const e=this.getState("notifications");return{total:e.length,visible:e.filter(e=>e.isVisible&&!e.isRemoving).length,byType:{success:e.filter(e=>"success"===e.type).length,error:e.filter(e=>"error"===e.type).length,warning:e.filter(e=>"warning"===e.type).length,info:e.filter(e=>"info"===e.type).length},persistent:e.filter(e=>e.options.persistent).length,oldest:e.length>0?Math.min(...e.map(e=>new Date(e.timestamp).getTime())):null,newest:e.length>0?Math.max(...e.map(e=>new Date(e.timestamp).getTime())):null}}exportNotificationSettings(){return{settings:this.getState("notificationSettings"),timestamp:(new Date).toISOString(),version:"1.0"}}importNotificationSettings(e){try{return!("1.0"!==e.version||!e.settings)&&(this.updateNotificationSettings(e.settings),!0)}catch(t){return ge.error("Errore durante importazione impostazioni notifiche:",t),!1}}setCurrentView(e,t=null){this.setState({currentView:e,previousView:t||this.getState("currentView")})}getCurrentView(){return this.getState("currentView")}setUser(e){this.setState({user:e,isAuthenticated:!!e})}getUser(){return this.getState("user")}isAuthenticated(){return this.getState("isAuthenticated")}updateEventiCliniciFilters(e){this.setState("eventiCliniciFilters",{...this.getState("eventiCliniciFilters"),...e})}getEventiCliniciFilters(){return this.getState("eventiCliniciFilters")}resetEventiCliniciFilters(){this.setState("eventiCliniciFilters",{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"})}destroy(){this.stopAutoCleanup(),this.subscribers.clear(),this.persistentKeys.forEach(e=>{localStorage.removeItem(`app_state_${e}`)})}};class ct{static DEBUG=!1;constructor(){this.notificationContainer=null,this.timers=new Map,this.initialized=!1,this.isRendering=!1,this.settings=at.getNotificationSettings(),this._lastRenderedNotificationIds=[],this._renderCount=0,this._lastRenderTime=0,this._averageRenderTime=0,this._unsubscribe=null,this._unsubscribeSettings=null}flush(){try{const e=at.getState("notifications")||[];this.renderNotifications(e)}catch{}}async init(){if(!this.initialized&&"undefined"!=typeof window)try{await this.#e(),function(){try{We=Ge.getInstance({id:"notification-announcer"})}catch(e){if(!document.getElementById("notification-announcer")){const e=document.createElement("div");e.id="notification-announcer",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;",document.body.appendChild(e)}}}(),this._unsubscribe=at.subscribe("notifications",this.#t),this._unsubscribeSettings=at.subscribe("notificationSettings",e=>{try{if(this.settings=at.getNotificationSettings(),this.notificationContainer){this.notificationContainer.updateSettings({position:this.settings.position,maxVisible:this.settings.maxVisible})}}catch{}}),this.initialized=!0,"undefined"!=typeof document&&(this._visibilityHandler=()=>{try{document.hidden?this.#i():this.#n()}catch{}},document.addEventListener("visibilitychange",this._visibilityHandler,{passive:!0}))}catch(e){Xe.handleServiceError(e,"init"),this.initialized=!0}}async#e(){if(this.notificationContainer)return;const{NotificationContainer:e}=await o(async()=>{const{NotificationContainer:e}=await import("./NotificationContainer-CzhXFxPx.js");return{NotificationContainer:e}},[]);this.notificationContainer=new e({position:this.settings.position,maxVisible:this.settings.maxVisible})}show(e,t,i={}){try{const n=this.#o(e),o=String(t||"").trim();if(!o){return this.show(n,`Notifica ${n} - Messaggio non disponibile`,i)}const r=this.#r(n),s=this.#s(i,r);return at.addNotification(n,o,s)}catch(n){return Xe.handleServiceError(n,"show",{type:e,message:t,options:i}),Xe.recoverFromShowError({type:this.#o(e),message:t,options:i,id:Date.now().toString()})}}success(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("success",e,t)}info(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("info",e,t)}warning(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("warning",e,t)}error(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("error",e,t)}renderNotifications(e=[]){if(Array.isArray(e)&&this.notificationContainer&&!this.isRendering){this.isRendering=!0;try{const i="undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?()=>window.performance.now():()=>Date.now(),n=i(),o=new Set(e.map(e=>e.id)),r=new Set(this._lastRenderedNotificationIds);r.forEach(e=>{if(!o.has(e))try{this.notificationContainer.removeNotification(e)}catch(t){Xe.handleDOMError(t,"remove",null)}}),e.forEach(e=>{if(!r.has(e.id))try{this.#a(e)}catch(t){Xe.handleRenderError(t,e,e=>{const t=Xe.createSimpleFallback(e);return t&&this.notificationContainer.addNotification(t),t})}}),e.forEach(e=>{if(r.has(e.id))try{const t=this.notificationContainer.container?.querySelector(`[data-id="${e.id}"]`);if(!t)return;const i=e?.options?.duplicateCount||1;let n=t.querySelector(".notification__count");if(i>1)if(n)n.textContent=`√ó${i}`,n.setAttribute("aria-label",`Ripetuta ${i} volte`);else{const e=t.querySelector(".notification__icon");n=document.createElement("span"),n.className="notification__count",n.setAttribute("aria-label",`Ripetuta ${i} volte`),n.textContent=`√ó${i}`,e&&e.parentNode?e.parentNode.insertBefore(n,e):t.querySelector(".notification__content")?.prepend(n)}else n&&n.remove()}catch(t){}});const s=Math.max(0,e.length-this.settings.maxVisible),a=s>0?e.slice(0,s):[];t=e=>this.removeNotification(e),void a.forEach(e=>{"success"!==e.type&&"info"!==e.type||setTimeout(()=>{t(e.id)},1e3)}),this._lastRenderedNotificationIds=e.map(e=>e.id);const c=i(),l=Math.max(0,c-n);this._lastRenderTime=l,this._renderCount+=1,this._averageRenderTime=1===this._renderCount?l:(this._averageRenderTime*(this._renderCount-1)+l)/this._renderCount}finally{this.isRendering=!1}var t}}#a(e){const t=it({notification:e,settings:this.settings,timers:this.timers,removeNotification:e=>this.removeNotification(e),handleAction:(e,t)=>this.handleAction(e,t),startAutoCloseTimer:nt,pauseAutoCloseTimer:ot,resumeAutoCloseTimer:rt,announceNotification:Qe,attachNotificationEvents:Ye,attachTouchEvents:Je,notificationContainer:this.notificationContainer,errorHandler:Xe});if(!t)throw new Error("createNotificationElement returned null");this.notificationContainer.addNotification(t)}#t=this.#c(e=>{let t=[];Array.isArray(e)?t=e:e&&"object"==typeof e&&(t=e.notifications||[]),this.renderNotifications(t)},16);removeNotification(e){try{if(st(this.timers,e,()=>this.#l(e)),!this.notificationContainer)return at.removeNotification(e),void 0;const t=this.notificationContainer.container?.querySelector(`[data-id="${e}"]`),i=this.settings.enableAnimations&&!Xe.shouldDisableAnimations();if(t&&i)try{t.classList.remove("notification--entering"),t.classList.add("notification--exiting");const i=t.querySelector(".notification__progress");return i&&i.classList.remove("notification__progress--active","notification__progress--paused","notification__progress--resumed"),setTimeout(()=>this.#d(e),300),void 0}catch{}this.#d(e)}catch(t){Xe.handleServiceError(t,"remove",e),Xe.recoverFromRemoveError(e)}}#d(e){try{this.notificationContainer&&this.notificationContainer.removeNotification(e)}catch{}at.removeNotification(e)}clear(){try{this.timers.forEach((e,t)=>st(this.timers,t,()=>this.#l(t))),this.timers.clear(),this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications(),at.clearAllNotifications()}catch(e){Xe.handleServiceError(e,"clear"),Xe.recoverFromClearError()}}clearByType(e){(at.getState("notifications")||[]).forEach(t=>{t.type===e&&this.timers.has(t.id)&&st(this.timers,t.id,()=>this.#l(t.id))}),at.clearNotificationsByType(e)}startAutoCloseTimer(e,t){try{nt(this.timers,e,t,e=>this.removeNotification(e))}catch{}}pauseAutoCloseTimer(e){try{ot(this.timers,e)}catch{}}resumeAutoCloseTimer(e){try{rt(this.timers,e)}catch{}}stopAutoCloseTimer(e){try{st(this.timers,e,()=>this.#l(e))}catch{}}handleAction(e,t){try{const i=(at.getState("notifications")||[]).find(t=>t.id===e),n=i?.options?.actions?.[t];n&&"function"==typeof n.onClick&&n.onClick({id:e,index:t,notification:i})}catch{}}setCustomDurations(e){this.updateSettings({customDurations:{...this.settings.customDurations||{},...e}})}setPersistentTypes(e){this.updateSettings({persistentTypes:[...e]})}setAutoCleanupInterval(e){this.updateSettings({autoCleanupInterval:e})}updatePosition(e){this.updateSettings({position:e})}setMaxVisible(e){this.updateSettings({maxVisible:e});const t=at.getState("notifications")||[];this.renderNotifications(t)}enableSounds(e=!0){this.updateSettings({enableSounds:!!e})}updateSettings(e){try{const t=this._validateSettings(e);if(at.updateNotificationSettings(t),this.settings=at.getNotificationSettings(),this.notificationContainer){const e={};"position"in t&&(e.position=this.settings.position),"maxVisible"in t&&(e.maxVisible=this.settings.maxVisible),Object.keys(e).length&&this.notificationContainer.updateSettings(e)}return!0}catch{return!1}}getStats(){try{return{..."function"==typeof at.getNotificationStats?at.getNotificationStats():{total:0,visible:0,byType:{success:0,error:0,warning:0,info:0},persistent:0},settings:this.settings,activeTimers:this.timers.size,containerInitialized:!!this.notificationContainer,serviceInitialized:this.initialized,performance:{renderCount:this._renderCount,averageRenderTime:this._averageRenderTime,lastRenderTime:this._lastRenderTime}}}catch(e){return{total:0,visible:0,byType:{success:0,error:0,warning:0,info:0},persistent:0,error:e?.message}}}exportSettings(){try{const e=at.exportNotificationSettings();return e.serviceMetadata={version:"2.0",exportedBy:"NotificationService"},e}catch(e){return null}}importSettings(e){try{if(!e||"object"!=typeof e||!e.settings)return!1;e.version&&"1.0"!==e.version&&ge.warn(`Versione backup non supportata: ${e.version}`);const t=at.importNotificationSettings(e);return t&&(this.settings=at.getNotificationSettings()),t}catch(t){return!1}}cleanupOldNotifications(e=3e5){try{if("function"==typeof at.clearOldNotifications){const t=at.clearOldNotifications(e)??0,i=new Set((at.getState("notifications")||[]).map(e=>e.id));return Array.from(this.timers.keys()).forEach(e=>{i.has(e)||this.timers.delete(e)}),t}const t=Date.now(),i=at.getState("notifications")||[];let n=0;i.forEach(i=>{const o=new Date(i.timestamp).getTime();if(Number.isFinite(o)&&t-o>e)try{at.removeNotification(i.id),n+=1}catch{}});const o=new Set((at.getState("notifications")||[]).map(e=>e.id));return Array.from(this.timers.keys()).forEach(e=>{o.has(e)||this.timers.delete(e)}),n}catch{return 0}}_validateSettings(e){const t={},i=e=>"number"==typeof e&&!Number.isNaN(e),n=e=>"boolean"==typeof e;if(void 0!==e.maxVisible){if(!Number.isInteger(e.maxVisible)||e.maxVisible<1||e.maxVisible>20)throw new Error("maxVisible must be between 1 and 20");t.maxVisible=e.maxVisible}if(void 0!==e.defaultDuration){if(!i(e.defaultDuration)||e.defaultDuration<0)throw new Error("defaultDuration must be >= 0");t.defaultDuration=e.defaultDuration}if(void 0!==e.position){if(!["top-right","top-left","bottom-right","bottom-left","top-center","bottom-center"].includes(e.position))throw new Error("invalid position");t.position=e.position}if(void 0!==e.enableSounds){if(!n(e.enableSounds))throw new Error("enableSounds must be boolean");t.enableSounds=e.enableSounds}if(void 0!==e.enableAnimations){if(!n(e.enableAnimations))throw new Error("enableAnimations must be boolean");t.enableAnimations=e.enableAnimations}if(void 0!==e.autoCleanupInterval){if(!i(e.autoCleanupInterval)||e.autoCleanupInterval<6e4)throw new Error("autoCleanupInterval must be >= 60000");t.autoCleanupInterval=e.autoCleanupInterval}if(void 0!==e.maxStoredNotifications){if(!Number.isInteger(e.maxStoredNotifications)||e.maxStoredNotifications<10)throw new Error("maxStoredNotifications must be >= 10");t.maxStoredNotifications=e.maxStoredNotifications}if(void 0!==e.persistentTypes){if(!Array.isArray(e.persistentTypes))throw new Error("persistentTypes must be array");t.persistentTypes=[...e.persistentTypes]}if(void 0!==e.soundVolume){if(!i(e.soundVolume)||e.soundVolume<0||e.soundVolume>1)throw new Error("soundVolume must be between 0 and 1");t.soundVolume=e.soundVolume}if(void 0!==e.customDurations){const n=["success","error","warning","info"],o=e.customDurations;if(!o||"object"!=typeof o)throw new Error("customDurations must be object");for(const e of Object.keys(o))if(!n.includes(e)||!i(o[e])||o[e]<0)throw new Error("invalid customDurations entry");t.customDurations={...o}}return t}getNotificationsByType(e){try{return at.getNotificationsByType(e)}catch{return[]}}getVisibleNotifications(){try{return at.getVisibleNotifications()}catch{return[]}}hasErrors(){try{return at.hasErrorNotifications()}catch{return!1}}destroy(){try{if(this.timers.forEach((e,t)=>st(this.timers,t)),this.timers.clear(),this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications(),this._visibilityHandler&&"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this._visibilityHandler),"function"==typeof this._unsubscribe){try{this._unsubscribe()}catch{}this._unsubscribe=null}if("function"==typeof this._unsubscribeSettings){try{this._unsubscribeSettings()}catch{}this._unsubscribeSettings=null}}finally{this.notificationContainer=null,this.initialized=!1}}#r(e){const t=this.settings||{},i=(t.customDurations||{})[e];return(t.persistentTypes||[]).includes(e)?0:"number"==typeof i?i:"number"==typeof t.defaultDuration?t.defaultDuration:5e3}#s(e,t){return{duration:void 0!==e.duration?e.duration:t,closable:!1!==e.closable,position:e.position||this.settings.position,priority:e.priority||0,title:e.title,actions:e.actions,persistent:e.persistent,...e}}#l(e){try{const t=this.notificationContainer?.container?.querySelector(`[data-id="${e}"]`);t&&t._progressBarInstance&&(t._progressBarInstance.destroy(),t._progressBarInstance=null)}catch{}}#u(e){try{const t=this.notificationContainer?.container?.querySelector(`[data-id="${e}"]`);t&&t._progressBarInstance&&"function"==typeof t._progressBarInstance.pause&&t._progressBarInstance.pause()}catch{}}#m(e){try{const t=this.notificationContainer?.container?.querySelector(`[data-id="${e}"]`);t&&t._progressBarInstance&&"function"==typeof t._progressBarInstance.resume&&t._progressBarInstance.resume()}catch{}}#i(){try{this.timers.forEach((e,t)=>{try{ot(this.timers,t)}catch{}this.#u(t)})}catch{}}#n(){try{this.timers.forEach((e,t)=>{try{rt(this.timers,t)}catch{}this.#m(t)})}catch{}}#c(e,t){let i=!1;return(...n)=>{i||(e.apply(this,n),i=!0,setTimeout(()=>i=!1,t))}}#o(e){const t=String(e||"").toLowerCase();switch(t){case"errore":case"danger":case"err":case"error":return"error";case"successo":case"ok":case"success":return"success";case"avviso":case"warn":case"warning":return"warning";default:return"info"===t||"informazione"===t?"info":t||"info"}}}const lt=new ct;function dt(){!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("theme-icon");if(!e||!t)return;ut(localStorage.getItem("theme")||"light"),e.addEventListener("click",()=>{ut("dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?"light":"dark")})}(),function(){const e=document.getElementById("mobile-theme-toggle"),t=document.getElementById("mobile-theme-icon");if(!e||!t)return;function i(){"dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?(t.textContent="light_mode",e.setAttribute("title","Modalit√† chiara")):(t.textContent="dark_mode",e.setAttribute("title","Modalit√† scura"))}e.addEventListener("click",e=>{e.preventDefault();ut("dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?"light":"dark")});new MutationObserver(i).observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),i()}()}function ut(e){document.documentElement.setAttribute("data-bs-theme",e),localStorage.setItem("theme",e);const t=document.getElementById("theme-icon"),i=document.getElementById("theme-toggle");t&&i&&("dark"===e?(t.textContent="light_mode",i.setAttribute("title","Modalit√† chiara")):(t.textContent="dark_mode",i.setAttribute("title","Modalit√† scura")))}function mt(e){const t=sessionStorage.getItem(Ae);e&&t?(console.log("üîÑ Redirect a pagina salvata:",t),sessionStorage.removeItem(Ae),window.location.hash=t):e?(console.log("üîÑ Redirect a home dopo login"),window.location.hash="home"):Ve()}window.addEventListener("error",e=>{const t={timestamp:(new Date).toISOString(),context:"GLOBAL_ERROR",message:e.error?.message||e.message||"Unknown global error",filename:e.filename||"Unknown file",lineno:e.lineno||"Unknown line",colno:e.colno||"Unknown column",stack:e.error?.stack||"No stack trace",env:"production",url:window.location.href};try{const e=JSON.parse(localStorage.getItem("auth_errors")||"[]");e.push(t),e.length>10&&e.shift(),localStorage.setItem("auth_errors",JSON.stringify(e)),window.lastGlobalError=t}catch(i){console.warn("Failed to persist global error")}}),window.addEventListener("unhandledrejection",e=>{const t={timestamp:(new Date).toISOString(),context:"UNHANDLED_PROMISE",message:e.reason?.message||e.reason||"Unknown promise rejection",stack:e.reason?.stack||"No stack trace",env:"production",url:window.location.href};try{const e=JSON.parse(localStorage.getItem("auth_errors")||"[]");e.push(t),e.length>10&&e.shift(),localStorage.setItem("auth_errors",JSON.stringify(e)),window.lastPromiseError=t}catch(i){console.warn("Failed to persist promise error")}}),window.addEventListener("load",async function(){try{ge.log(`üöÄ Inizializzazione ${me} v${he}`),qe(),dt(),je(),function(){Ne(),window.addEventListener("resize",Ne);const e=document.getElementById("auth-container");e&&new MutationObserver(Ie).observe(e,{childList:!0,subtree:!0});setTimeout(Ie,150),window.addEventListener("auth:session-changed",()=>{Ie()})}(),window.authUIListenersInitialized||(De(),window.authUIListenersInitialized=!0),lt.init(),window.addEventListener("hashchange",Ve),await async function(e){ve.init(),be.isLoading=!0;try{if("undefined"!=typeof window&&window.__PW_E2E_AUTH_MOCK){const t={user:{id:"e2e-user-123",email:"e2e@example.com",user_metadata:{name:"E2E User"}},access_token:"e2e-token"};return await Ee(t),be.isLoading=!1,e&&e(t),ge.log("E2E auth mock attivo: sessione e profilo impostati"),void 0}}catch{}let t=null,i=null;for(let o=1;o<=3;o++)try{const{data:{session:e},error:n}=await ye.auth.getSession();if(!n){t=e;break}if(i=n,ge.warn(`Tentativo ${o}/3 - Errore nel recupero sessione:`,n),o<3){await new Promise(e=>setTimeout(e,1e3*o));continue}}catch(n){if(i=n,ge.warn(`Tentativo ${o}/3 - Errore critico:`,n),o<3){await new Promise(e=>setTimeout(e,1e3*o));continue}}i&&!t&&ge.error("Fallimento definitivo nel recupero sessione dopo",3,"tentativi:",i),ge.log("Sessione iniziale recuperata:",t),await Ee(t),be.isLoading=!1,e&&e(t),ye.auth.onAuthStateChange(async(t,i)=>{ge.log("Auth event:",t,"Session:",i),"SIGNED_OUT"===t&&"error"===ve.getAuthState().state&&ve.clearCorruptedState(),i?.access_token!==be.session?.access_token&&(await Ee(i),e&&e(i))}),ge.log("Sistema di autenticazione inizializzato")}(e=>{mt(e),sessionStorage.getItem(Ae)||setTimeout(()=>Ve(),50)}),window.addEventListener("auth:session-changed",e=>{const t=e.detail?.session;t?setTimeout(()=>mt(t),100):setTimeout(()=>Ve(),50)}),ge.log("‚úÖ Applicazione inizializzata con successo")}catch(e){console.error("‚ùå Errore durante l'inizializzazione dell'applicazione:",e),document.body.innerHTML=le('\n      <div class="container mt-5">\n        <div class="alert alert-danger" role="alert">\n          <h4 class="alert-heading">Errore di inizializzazione</h4>\n          <p>Si √® verificato un errore durante l\'avvio dell\'applicazione.</p>\n          \n          <hr>\n          <p class="mb-0">Ricarica la pagina per riprovare.</p>\n        </div>\n      </div>\n    ')}});export{le as a,at as b,be as c,He as d,je as i,ge as l,lt as n,ce as p,ye as s};
