const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/notificationService-CVOZiiiE.js","assets/supabase-BkmsdzLq.js","assets/react-vendor-Bp2pLdQf.js","assets/index-DUIktawL.js","assets/ui-vendor-S6RcKJ66.js","assets/index-ghrdPQhP.css"])))=>i.map(i=>d[i]);
import{_ as t}from"./supabase-BkmsdzLq.js";import{l as i}from"./index-DUIktawL.js";let e=null,n=null;async function o(){return e||(n||(n=(async()=>{try{const{notificationService:i}=await t(async()=>{const{notificationService:t}=await import("./notificationService-CVOZiiiE.js");return{notificationService:t}},__vite__mapDeps([0,1,2,3,4,5]));return e=i,e&&"function"==typeof e.init&&await e.init(),e}catch(i){if(console.error("Failed to initialize NotificationService:",i),e)return e;throw i}})(),n))}const r=async(t,i)=>(await o()).success(t,i),s=async(t,i)=>(await o()).info(t,i),a=async(t,i)=>(await o()).warning(t,i),c=async(t,i)=>(await o()).error(t,i);const d=new class{notifications=[];settings;subscribers=new Map;cleanupTimer=null;constructor(){this.settings=this.getDefaultSettings(),this.loadPersistedSettings(),this.startAutoCleanup(),i.debug("NotificationStateManager initialized")}getDefaultSettings(){return{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:!0,autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}}}loadPersistedSettings(){try{const t=localStorage.getItem("notificationSettings");if(t){const i=JSON.parse(t);this.settings={...this.settings,...i}}}catch(t){i.warn("Failed to load persisted notification settings:",t)}}persistSettings(){try{localStorage.setItem("notificationSettings",JSON.stringify(this.settings))}catch(t){i.warn("Failed to persist notification settings:",t)}}subscribe(t){const i=Symbol("notificationSubscriber");return this.subscribers.set(i,t),()=>{this.subscribers.delete(i)}}notifySubscribers(){this.subscribers.forEach((t,e)=>{try{t(this.notifications,this.settings)}catch(n){i.error(`Error in notification subscriber ${String(e)}:`,n)}})}addNotification(t,e,n={}){"number"==typeof n&&(n={duration:n});const o=this.normalizeNotificationType(t),r=void 0!==this.settings.customDurations[o]?this.settings.customDurations[o]:this.settings.defaultDuration,s={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:o,message:e,timestamp:new Date,isVisible:!0,isRemoving:!1,options:{duration:r,persistent:this.settings.persistentTypes.includes(o),...n}};return s.options.persistent&&(s.options.duration=0),i.debug(`[NotificationStateManager] Current notifications before adding: ${this.notifications.length}`,this.notifications),this.handleDeduplication(o,e)?"":(this.notifications=[...this.notifications,s],this.enforceMaxNotifications(),this.notifySubscribers(),i.debug(`[NotificationStateManager] Notification added. New notifications array length: ${this.notifications.length}`,this.notifications),s.id)}handleDeduplication(t,e){try{const i=Date.now(),n=1500;if("success"===t||"info"===t){const o=[...this.notifications].reverse().findIndex(o=>{const r=new Date(o.timestamp).getTime();return o.type===t&&o.message===e&&i-r<=n});if(-1!==o){const t=this.notifications.length-1-o,i=this.notifications[t],e={...i,timestamp:new Date,options:{...i.options,duplicateCount:(i.options.duplicateCount||1)+1}};return this.notifications=[...this.notifications],this.notifications[t]=e,this.notifySubscribers(),!0}}}catch(n){i.warn("Deduplication failed:",n)}return!1}enforceMaxNotifications(){if(this.notifications.length>this.settings.maxStoredNotifications){i.warn(`[NotificationStateManager] Max stored notifications (${this.settings.maxStoredNotifications}) exceeded. Trimming old notifications.`);const t=[...this.notifications].sort((t,i)=>new Date(t.timestamp).getTime()-new Date(i.timestamp).getTime()).slice(0,this.notifications.length-this.settings.maxStoredNotifications);this.notifications=this.notifications.filter(i=>!t.includes(i)||i.options.persistent&&"error"===i.type),i.debug(`[NotificationStateManager] Notifications after trimming: ${this.notifications.length}`,this.notifications)}}normalizeNotificationType(t){const i=String(t||"").toLowerCase().trim();return i?["error","errore","err","danger","fatal"].includes(i)?"error":["success","ok","successo"].includes(i)?"success":["warning","warn","avviso","alert"].includes(i)?"warning":(["info","informazione","notice"].includes(i),"info"):"info"}removeNotification(t){const e=this.notifications.length;this.notifications=this.notifications.filter(i=>i.id!==t),this.notifications.length!==e&&(i.debug(`[NotificationStateManager] Notification ${t} removed`),this.notifySubscribers())}clearAllNotifications(){this.notifications.length>0&&(this.notifications=[],this.notifySubscribers(),i.debug("[NotificationStateManager] All notifications cleared"))}clearNotificationsByType(t){const e=this.notifications.length;this.notifications=this.notifications.filter(i=>i.type!==t),this.notifications.length!==e&&(i.debug(`[NotificationStateManager] Notifications of type '${t}' cleared`),this.notifySubscribers())}updateSettings(t){const e={...this.settings,...t};this.settings=e,this.persistSettings(),void 0!==t.autoCleanupInterval&&this.startAutoCleanup(),this.notifySubscribers(),i.debug("[NotificationStateManager] Settings updated:",e)}getSettings(){return{...this.settings}}getNotifications(){return[...this.notifications]}getNotificationsByType(t){return this.notifications.filter(i=>i.type===t)}getVisibleNotifications(){return this.notifications.filter(t=>t.isVisible&&!t.isRemoving).slice(-this.settings.maxVisible)}hasErrorNotifications(){return this.notifications.some(t=>"error"===t.type)}getStats(){const t={success:0,error:0,warning:0,info:0};let i=0;return this.notifications.forEach(e=>{t[e.type]=(t[e.type]||0)+1,e.options.persistent&&i++}),{total:this.notifications.length,visible:this.getVisibleNotifications().length,byType:t,persistent:i}}clearOldNotifications(t=3e5){const e=Date.now(),n=this.notifications.length;this.notifications=this.notifications.filter(i=>{const n=new Date(i.timestamp).getTime();if(!Number.isFinite(n))return!0;return!(e-n>t&&!i.options.persistent)});const o=n-this.notifications.length;return o>0&&(i.debug(`[NotificationStateManager] Cleaned up ${o} old notifications`),this.notifySubscribers()),o}startAutoCleanup(){this.cleanupTimer&&clearInterval(this.cleanupTimer);const t=this.settings.autoCleanupInterval;t>0&&(this.cleanupTimer=setInterval(()=>{this.clearOldNotifications()},t),i.debug(`[NotificationStateManager] Auto cleanup started with interval: ${t}ms`))}exportSettings(){return{version:"2.0",timestamp:(new Date).toISOString(),settings:{...this.settings},exportedBy:"NotificationStateManager"}}importSettings(t){try{return!(!t||"object"!=typeof t||!t.settings)&&(t.version&&"2.0"!==t.version&&"1.0"!==t.version&&i.warn(`Unsupported backup version: ${t.version}`),this.settings={...this.getDefaultSettings(),...t.settings},this.persistSettings(),this.startAutoCleanup(),this.notifySubscribers(),i.debug("[NotificationStateManager] Settings imported successfully"),!0)}catch(e){return i.error("Failed to import notification settings:",e),!1}}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.subscribers.clear(),this.notifications=[],i.debug("[NotificationStateManager] Destroyed")}};function l(t,i){c(t,i).catch(t=>{console.error("Failed to show error notification:",t)})}function u(t,i){r(t,i).catch(t=>{console.error("Failed to show success notification:",t)})}function f(t,i){s(t,i).catch(t=>{console.error("Failed to show info notification:",t)})}function h(t,i){a(t,i).catch(t=>{console.error("Failed to show warning notification:",t)})}class p{static DEBUG=!1;static notificationQueue=[];static isDOMReady=!1;static domReadyCallbacks=[];static animationSupport=null;static reducedMotionPreference=null;static errorCounts={render:0,animation:0,dom:0,service:0,total:0};static init(){this.checkDOMReady(),this.checkAnimationSupport(),this.checkReducedMotionPreference(),this.setupErrorRecovery(),this.DEBUG&&i.debug("‚úÖ NotificationErrorHandler initialized")}static handleRenderError(t,e,n=null){if(this.errorCounts.render++,this.errorCounts.total++,i.error("‚ùå Notification render error:",t,e),"undefined"!=typeof window&&window.appLogger){const i=window.appLogger;i&&i.error("Notification render failed",{error:t.message,notificationId:e?.id,notificationType:e?.type,stack:t.stack})}try{return n&&"function"==typeof n?n(e):this.createSimpleFallback(e)}catch(o){return i.error("‚ùå Fallback renderer also failed:",o),this.showConsoleFallback(e),null}}static handleAnimationError(t,e,n="unknown"){if(this.errorCounts.animation++,this.errorCounts.total++,i.warn("‚ö†Ô∏è Animation error:",t,n),e)try{e.style.animation="none",e.style.transition="none","entrance"===n?(e.style.opacity="1",e.style.transform="translateX(0)",e.classList.add("notification--visible"),e.classList.remove("notification--entering")):"exit"===n&&(e.style.opacity="0",e.classList.add("notification--hidden"),e.classList.remove("notification--exiting")),this.DEBUG&&i.debug("‚úÖ Animation fallback applied to element")}catch(o){i.error("‚ùå Animation fallback failed:",o)}}static handleServiceError(t,e,n=null){if(this.errorCounts.service++,this.errorCounts.total++,this.errorCounts.service%10==1&&i.error(`‚ùå NotificationService error in ${e} (${this.errorCounts.service} total):`,t),"undefined"!=typeof window&&window.appLogger){const i=window.appLogger;i&&i.error(`NotificationService ${e} failed`,{error:t.message,operation:e,data:n,stack:t.stack})}try{switch(e){case"show":this.recoverFromShowError(n);break;case"remove":this.recoverFromRemoveError(n);break;case"clear":this.recoverFromClearError();break;case"init":this.recoverFromInitError();break;default:i.warn(`‚ö†Ô∏è No recovery strategy for operation: ${e}`)}}catch(o){i.error("‚ùå Error recovery failed:",o)}}static handleDOMError(t,e,n=null){return this.errorCounts.dom++,this.errorCounts.total++,i.error(`‚ùå DOM error in ${e}:`,t),!(!this.isDOMReady&&"render"===e)||(i.debug("üìã DOM not ready, queueing notification"),!1)}static queueNotification(t,e){if(this.isDOMReady)try{return t(e)}catch(n){return this.handleRenderError(n,e)}return this.notificationQueue.push({renderFunction:t,notification:e,timestamp:Date.now()}),this.DEBUG&&i.debug(`üìã Queued notification ${e?.id}, queue size: ${this.notificationQueue.length}`),null}static processNotificationQueue(){if(!this.isDOMReady||0===this.notificationQueue.length)return;i.debug(`üöÄ Processing ${this.notificationQueue.length} queued notifications`);const t=[...this.notificationQueue];this.notificationQueue=[],t.forEach(({renderFunction:t,notification:e,timestamp:n})=>{try{if(Date.now()-n>3e4)return i.warn("‚ö†Ô∏è Skipping old queued notification:",e?.id),void 0;t(e)}catch(o){this.handleRenderError(o,e)}})}static createSimpleFallback(t){const e=document.createElement("div");e.className=`notification notification--${t.type} notification--fallback`,e.setAttribute("data-id",t.id),e.setAttribute("role","error"===t.type?"alert":"status"),e.setAttribute("aria-live","error"===t.type?"assertive":"polite"),e.style.cssText="\n            position: relative;\n            padding: 12px 16px;\n            margin: 8px 0;\n            border-radius: 4px;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 14px;\n            line-height: 1.4;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n            max-width: 400px;\n            word-wrap: break-word;\n        ";const n={success:{bg:"#d4edda",text:"#155724",border:"#c3e6cb"},error:{bg:"#f8d7da",text:"#721c24",border:"#f5c6cb"},warning:{bg:"#fff3cd",text:"#856404",border:"#ffeaa7"},info:{bg:"#d1ecf1",text:"#0c5460",border:"#bee5eb"}},o=n[t.type]||n.info;e.style.backgroundColor=o.bg,e.style.color=o.text,e.style.border=`1px solid ${o.border}`;const r=document.createElement("div");r.style.cssText="display: flex; align-items: flex-start; gap: 8px;";const s=document.createElement("span");s.style.cssText="flex-shrink: 0; font-weight: bold; font-size: 16px;";const a={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"};s.textContent=a[t.type]||a.info;const c=document.createElement("div");if(c.style.cssText="flex: 1; min-width: 0;",t.title){const i=document.createElement("div");i.style.cssText="font-weight: bold; margin-bottom: 4px;",i.textContent=t.title,c.appendChild(i)}const l=document.createElement("div");l.textContent=t.message||`Notifica ${t.type||"info"} - Messaggio non disponibile`,c.appendChild(l);const u=document.createElement("button");return u.style.cssText=`\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            padding: 0;\n            margin-left: 8px;\n            color: ${o.text};\n            opacity: 0.7;\n            flex-shrink: 0;\n        `,u.textContent="√ó",u.setAttribute("aria-label","Chiudi notifica"),u.onclick=()=>{e.remove();try{d&&"function"==typeof d.removeNotification&&d.removeNotification(t.id)}catch(n){i.debug("Could not remove from state:",n)}},r.appendChild(s),r.appendChild(c),r.appendChild(u),e.appendChild(r),this.DEBUG&&i.debug("‚úÖ Created simple fallback notification"),e}static showConsoleFallback(t){const e={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},n=`${e[t.type]||e.info} NOTIFICATION: ${t.message||`Notifica ${t.type||"info"} - Messaggio non disponibile`}`;"error"===t.type?i.error(n):"warning"===t.type?i.warn(n):i.info(n)}static checkDOMReady(){if("undefined"==typeof document)return this.isDOMReady=!1,void 0;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.isDOMReady=!0,this.processNotificationQueue(),this.domReadyCallbacks.forEach(t=>{try{t()}catch(e){i.error("‚ùå DOM ready callback error:",e)}}),this.domReadyCallbacks=[]}):this.isDOMReady=!0}static checkAnimationSupport(){if("undefined"==typeof window||"undefined"==typeof document)return this.animationSupport=!1,void 0;try{const t=document.createElement("div");t.style.animation="test 1s",this.animationSupport=""!==t.style.animation}catch(t){this.animationSupport=!1}this.DEBUG&&i.debug("üé¨ Animation support:",this.animationSupport)}static checkReducedMotionPreference(){if("undefined"==typeof window||!window.matchMedia)return this.reducedMotionPreference=!1,void 0;try{const t=window.matchMedia("(prefers-reduced-motion: reduce)");this.reducedMotionPreference=t.matches,t.addEventListener("change",t=>{this.reducedMotionPreference=t.matches,this.DEBUG&&i.debug("üé¨ Reduced motion preference changed:",this.reducedMotionPreference)})}catch(t){this.reducedMotionPreference=!1}this.DEBUG&&i.debug("üé¨ Reduced motion preference:",this.reducedMotionPreference)}static setupErrorRecovery(){setInterval(()=>{this.cleanupOldQueuedNotifications()},6e4),"undefined"!=typeof window&&window.addEventListener("error",t=>{t.message&&t.message.includes("notification")&&i.warn("‚ö†Ô∏è Possible notification-related error detected")})}static cleanupOldQueuedNotifications(){const t=Date.now(),e=this.notificationQueue.length;this.notificationQueue=this.notificationQueue.filter(i=>t-i.timestamp<6e4);const n=e-this.notificationQueue.length;n>0&&this.DEBUG&&i.debug(`üßπ Cleaned up ${n} old queued notifications`)}static recoverFromShowError(t){i.debug("üîÑ Attempting recovery from show error");try{const e=this.createSimpleFallback(t);if(e){const t=document.querySelector(".notification-container")||document.querySelector("#notification-container")||document.body;if(t)return t.appendChild(e),i.debug("‚úÖ Fallback notification added to DOM"),!0}}catch(e){i.error("‚ùå Show recovery failed:",e)}return this.showConsoleFallback(t),!1}static recoverFromRemoveError(t){i.debug("üîÑ Attempting recovery from remove error");try{const e=document.querySelector(`[data-id="${t}"]`);if(e)return e.remove(),i.debug("‚úÖ Notification removed via DOM recovery"),!0}catch(e){i.error("‚ùå Remove recovery failed:",e)}return!1}static recoverFromClearError(){i.debug("üîÑ Attempting recovery from clear error");try{const t=document.querySelectorAll('.notification, [class*="notification"]');return t.forEach(t=>{try{t.remove()}catch(e){i.debug("Could not remove notification element:",e)}}),i.debug(`‚úÖ Cleared ${t.length} notifications via DOM recovery`),!0}catch(t){i.error("‚ùå Clear recovery failed:",t)}return!1}static recoverFromInitError(){i.debug("üîÑ Attempting recovery from init error");try{let t=document.querySelector(".notification-container");if(!t)return t=document.createElement("div"),t.className="notification-container notification-container--fallback",t.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    z-index: 9999;\n                    pointer-events: none;\n                ",document.body.appendChild(t),i.debug("‚úÖ Fallback notification container created"),!0}catch(t){i.error("‚ùå Init recovery failed:",t)}return!1}static getErrorStats(){return{...this.errorCounts,queueSize:this.notificationQueue.length,isDOMReady:this.isDOMReady,animationSupport:this.animationSupport,reducedMotionPreference:this.reducedMotionPreference}}static resetErrorStats(){this.errorCounts={render:0,animation:0,dom:0,service:0,total:0}}static shouldDisableAnimations(){return!this.animationSupport||!0===this.reducedMotionPreference}static onDOMReady(t){if(this.isDOMReady)try{t()}catch(e){i.error("‚ùå DOM ready callback error:",e)}else this.domReadyCallbacks.push(t)}}"undefined"!=typeof window&&p.init();export{p as N,u as a,h as b,f as c,d,l as n};
