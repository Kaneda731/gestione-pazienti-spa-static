const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotificationContainer-DxM56sch.js","assets/index-BcsZgNVH.js","assets/ui-vendor-S6RcKJ66.js","assets/react-vendor-Bp2pLdQf.js","assets/supabase-Zkii_ZbW.js","assets/index-Dwr7N1w_.css"])))=>i.map(i=>d[i]);
import{l as e,_ as t}from"./index-BcsZgNVH.js";import{N as i,d as r}from"./notificationErrorHandler-DCWY3Txy.js";import"./ui-vendor-S6RcKJ66.js";import"./react-vendor-Bp2pLdQf.js";import"./supabase-Zkii_ZbW.js";const n={SUCCESS:{icon:"check_circle",ariaRole:"status",ariaLive:"polite",defaultDuration:4e3},ERROR:{icon:"error",ariaRole:"alert",ariaLive:"assertive",defaultDuration:0},WARNING:{icon:"warning",ariaRole:"alert",ariaLive:"assertive",defaultDuration:6e3},INFO:{icon:"info",ariaRole:"status",ariaLive:"polite",defaultDuration:5e3}},s={maxWidth:768};function a(e,t){if(void 0!==t)return t;const i=n[e.toUpperCase()];return i?i.defaultDuration:5e3}class o{element;duration;type;startTime;animationId;isPaused;pausedTime;isDestroyed;timing;progressBar;progressFill;pauseStartTime;lastLoggedProgress;constructor(e,t=4e3,i="success"){this.element=e,this.duration=t,this.type=i,this.startTime=null,this.animationId=null,this.isPaused=!1,this.pausedTime=0,this.isDestroyed=!1,this.timing=this.createEasingFunction("linear"),this.progressBar=null,this.progressFill=null,this.pauseStartTime=null,this.lastLoggedProgress=-1,this.init()}createEasingFunction(e="linear"){const t={linear:e=>e,easeOut:e=>1-Math.pow(1-e,3),easeIn:e=>Math.pow(e,3),easeInOut:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2};return t[e]||t.linear}init(){if(this.isDestroyed)return;const e=this.element.querySelector(".notification__progress--js-placeholder");e?this.replaceProgressBarPlaceholder(e):this.element.querySelector(".notification__progress")||this.createProgressBar(),this.progressBar=this.element.querySelector(".notification__progress"),this.progressFill=this.element.querySelector(".notification__progress-fill"),this.progressBar&&this.progressFill&&this.start()}replaceProgressBarPlaceholder(e){e.classList.remove("notification__progress--js-placeholder"),e.classList.add("notification__progress--js-controlled"),e.setAttribute("aria-valuenow","100");const t={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"};e.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${t[this.type]||t.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const i=document.createElement("div");i.className="notification__progress-fill";const r={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"};i.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${r[this.type]||r.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,e.innerHTML="",e.appendChild(i)}createProgressBar(){const e={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"},t={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"},i=document.createElement("div");i.className="notification__progress notification__progress--js-controlled",i.setAttribute("role","progressbar"),i.setAttribute("aria-label","Tempo rimanente prima della chiusura automatica"),i.setAttribute("aria-valuemin","0"),i.setAttribute("aria-valuemax","100"),i.setAttribute("aria-valuenow","100"),i.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${e[this.type]||e.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const r=document.createElement("div");r.className="notification__progress-fill",r.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${t[this.type]||t.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,i.appendChild(r),this.element.appendChild(i)}start(){this.isDestroyed||(this.startTime=performance.now(),this.lastLoggedProgress=-1,this.animate({timing:this.timing,draw:e=>this.draw(e),duration:this.duration}))}animate({timing:e,draw:t,duration:i}){if(this.isDestroyed)return;const r=this.startTime,n=s=>{if(this.isDestroyed)return;if(this.isPaused)return this.animationId=requestAnimationFrame(n),void 0;let a=(s-(r??0)-this.pausedTime)/i;a>1&&(a=1),a<0&&(a=0);let o=e(a);t(o),this.updateAccessibility(a),a<1?this.animationId=requestAnimationFrame(n):this.onComplete()};this.animationId=requestAnimationFrame(n)}draw(e){if(this.isDestroyed||!this.progressFill)return;this.progressFill.style.transform=`scaleX(${1-e})`}updateAccessibility(e){if(this.progressBar){const t=Math.round(100*(1-e));this.progressBar.setAttribute("aria-valuenow",t.toString())}}pause(){this.isPaused||this.isDestroyed||(this.isPaused=!0,this.pauseStartTime=performance.now())}resume(){this.isPaused&&!this.isDestroyed&&(this.isPaused=!1,this.pauseStartTime&&(this.pausedTime+=performance.now()-this.pauseStartTime,this.pauseStartTime=null))}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.progressFill&&!this.isDestroyed&&(this.progressFill.style.transform="scaleX(0)")}onComplete(){if(this.isDestroyed)return;const e=new CustomEvent("progressComplete",{detail:{element:this.element,type:this.type,duration:this.duration}});this.element.dispatchEvent(e)}destroy(){this.isDestroyed=!0,this.stop(),this.progressBar&&this.progressBar.parentNode&&this.progressBar.parentNode.removeChild(this.progressBar),this.element=null,this.progressBar=null,this.progressFill=null}}function c(e,t,i){return new o(e,t,i)}class l{element=null;queue=[];isProcessing=!1;currentTimeout=null;static _instance=null;options;constructor(e={}){this.options={id:e.id||"notification-announcer",className:e.className||"notification__sr-only",defaultLive:e.defaultLive||"polite",enableQueue:!1!==e.enableQueue,queueDelay:e.queueDelay||150,maxQueueSize:e.maxQueueSize||10,...e},this.init()}init(){this.createElement(),this.setupAccessibility()}createElement(){const e=document.getElementById(this.options.id||"notification-announcer");e&&e.remove(),this.element=document.createElement("div"),this.element.id=this.options.id||"notification-announcer",this.element.className=this.options.className||"notification__sr-only",document.body.appendChild(this.element)}setupAccessibility(){this.element&&(this.element.setAttribute("aria-live",this.options.defaultLive||"polite"),this.element.setAttribute("aria-atomic","true"),this.element.setAttribute("role","status"),this.element.style.cssText="\n            position: absolute !important;\n            width: 1px !important;\n            height: 1px !important;\n            padding: 0 !important;\n            margin: -1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n        ")}announce(t,i={}){if(!t||"string"!=typeof t)return e.warn("NotificationLiveRegion: messaggio non valido",t),void 0;const r={message:t.trim(),live:i.live||this.options.defaultLive||"polite",priority:i.priority||0,timestamp:Date.now(),id:this.generateAnnouncementId()};this.options.enableQueue?this.addToQueue(r):this.processAnnouncement(r)}announceSuccess(e,t=""){this.announce(t?`Successo: ${t}. ${e}`:`Successo: ${e}`,{live:"polite",priority:1})}announceError(e,t=""){this.announce(t?`Errore: ${t}. ${e}`:`Errore: ${e}`,{live:"assertive",priority:3})}announceWarning(e,t=""){this.announce(t?`Attenzione: ${t}. ${e}`:`Attenzione: ${e}`,{live:"assertive",priority:2})}announceInfo(e,t=""){this.announce(t?`Informazione: ${t}. ${e}`:`Informazione: ${e}`,{live:"polite",priority:1})}announceNotification(e,t,i="",r={}){const n={success:"Successo",error:"Errore",warning:"Attenzione",info:"Informazione"}[e]||"Notifica";this.announce(i?`${n}: ${i}. ${t}`:`${n}: ${t}`,{live:{success:"polite",error:"assertive",warning:"assertive",info:"polite"}[e]||"polite",priority:{success:1,error:3,warning:2,info:1}[e]||1,...r})}addToQueue(e){const t=Date.now()-3e3;this.queue=this.queue.filter(i=>i.timestamp<t||i.message!==e.message);this.queue.length>=(this.options.maxQueueSize||10)&&this.queue.shift();const i=this.queue.findIndex(t=>t.priority<e.priority);-1===i?this.queue.push(e):this.queue.splice(i,0,e),this.processQueue()}processQueue(){if(this.isProcessing||0===this.queue.length)return;this.isProcessing=!0;const e=this.queue.shift();e&&this.processAnnouncement(e),this.currentTimeout=setTimeout(()=>{this.isProcessing=!1,this.processQueue()},this.options.queueDelay||150)}processAnnouncement(e){if(!this.element)return;this.element.getAttribute("aria-live")!==e.live&&this.element.setAttribute("aria-live",e.live),this.element.textContent="",setTimeout(()=>{this.element&&(this.element.textContent=e.message,this.dispatchEvent("announced",{announcement:e}))},50)}clearQueue(){this.queue=[],this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.isProcessing=!1,this.dispatchEvent("queueCleared")}clear(){this.element&&(this.element.textContent=""),this.dispatchEvent("cleared")}updateSettings(e){this.options={...this.options,...e},e.defaultLive&&this.element&&this.element.setAttribute("aria-live",e.defaultLive),this.dispatchEvent("settingsUpdated",{options:this.options})}getState(){if(!this.element)throw new Error("LiveRegion not initialized");return{id:this.options.id||"notification-announcer",queueLength:this.queue.length,isProcessing:this.isProcessing,currentContent:this.element.textContent||"",currentLive:this.element.getAttribute("aria-live")||"",options:{...this.options}}}generateAnnouncementId(){return`announcement-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}dispatchEvent(e,t={}){const i=new CustomEvent(`notificationLiveRegion:${e}`,{detail:{liveRegion:this,...t}});document.dispatchEvent(i)}destroy(){this.clearQueue(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchEvent("destroyed"),this.element=null,this.queue=[]}static getInstance(e={}){return l._instance||(l._instance=new l(e)),l._instance}static destroyInstance(){l._instance&&(l._instance.destroy(),l._instance=null)}static exists(){return!!l._instance}}let u=null;function d(e,t,i=""){try{u||(u=l.getInstance({id:"notification-announcer"})),u.announceNotification?.(e,t,i)}catch(r){const i=document.getElementById("notification-announcer");i&&(i.textContent=`${e}: ${t}`)}}function h(e,t,{removeNotification:i}){const r=e.querySelector(".notification__close");r&&r.addEventListener("click",e=>{e.stopPropagation(),i(t.id)}),e.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),i(t.id))})}function m(e,t,{pauseAutoCloseTimer:i}){let r=0;e.addEventListener("touchstart",()=>{r=Date.now()}),e.addEventListener("touchend",()=>{Date.now()-r>500&&i?.(t.id)})}function p(e,{allowHTML:t=!1}={}){if(!t){const t=document.createElement("div");return t.textContent=String(e??""),t.innerHTML}const i=document.createElement("div");i.innerHTML=String(e??"");const r=new Set(["b","strong","i","em","u","br","code","pre","span","p","ul","ol","li","a"]),n=e=>{if(e.nodeType===Node.COMMENT_NODE)return e.remove(),void 0;if(e.nodeType===Node.ELEMENT_NODE){const t=e;if(!r.has(t.tagName.toLowerCase())){const e=t.parentNode;if(!e)return;for(;t.firstChild;)e.insertBefore(t.firstChild,t);return e.removeChild(t),void 0}[...t.attributes].forEach(e=>{const i=e.name.toLowerCase(),r=String(e.value||"");if(i.startsWith("on")||"style"===i)t.removeAttribute(e.name);else if("a"===t.tagName.toLowerCase()&&"href"===i){/^(https?:|mailto:)/i.test(r)||t.removeAttribute("href")}else"href"!==i&&"title"!==i&&t.removeAttribute(e.name)})}let t=e.firstChild;for(;t;){const e=t.nextSibling;n(t),t=e}};return n(i),i.innerHTML}function g({notification:t,_index:r=0,settings:o,timers:l,timerManager:u,progressBarManager:d,removeNotification:h,startAutoCloseTimer:m,pauseAutoCloseTimer:g,resumeAutoCloseTimer:f,announceNotification:y,attachNotificationEvents:b,attachTouchEvents:v,notificationContainer:T,errorHandler:M=i}){const E=m||((e,t,i,r)=>{u?.start(t,i,r)}),_=g||((e,t)=>{u?.pause(t)}),w=f||((e,t)=>{u?.resume(t)});try{const i=n[t.type.toUpperCase()]||n.INFO,r=t.options||{},m=a(t.type,r.duration),g=document.createElement("div");let f=`notification notification--${t.type}`;if(m>0&&!r.persistent&&(f+=" notification--autoclose"),g.className=f,g.dataset.id=t.id,g.setAttribute("role",i.ariaRole),g.setAttribute("aria-live",i.ariaLive),g.setAttribute("aria-atomic","true"),g.setAttribute("tabindex","0"),o.enableAnimations&&!M.shouldDisableAnimations())try{g.classList.add("notification--entering"),g.addEventListener("animationend",e=>{(e.animationName.includes("slideIn")||e.animationName.includes("fadeIn"))&&(g.classList.remove("notification--entering"),g.classList.add("notification--visible"))}),g.addEventListener("animationerror",e=>{M.handleAnimationError(new Error("Animation failed"),g,"entrance")})}catch(A){M.handleAnimationError(A instanceof Error?A:new Error(String(A)),g,"entrance")}else g.classList.add("notification--visible","notification--no-animations");let x="";try{x=`\n                <div class="notification__content">\n                    <span class="material-icons notification__icon" aria-hidden="true">${i.icon}</span>\n                    <div class="notification__body">\n                        ${r.title?`<div class="notification__title">${p(r.title,{allowHTML:!1})}</div>`:""}\n                        <div class="notification__message">${p(t.message,{allowHTML:!!r.allowHTML})}</div>\n                    </div>\n                </div>\n            `,r.duplicateCount&&r.duplicateCount>1&&(x=x.replace('<span class="material-icons notification__icon" aria-hidden="true">',`<span class="notification__count" aria-label="Ripetuta ${r.duplicateCount} volte">√ó${r.duplicateCount}</span><span class="material-icons notification__icon" aria-hidden="true">`)),(!1!==r.closable||r.actions)&&(x+='<div class="notification__actions">',r.actions&&Array.isArray(r.actions)&&r.actions.forEach((e,t)=>{x+=`\n                            <button class="notification__action-btn ${"primary"===e.style?"notification__action-btn--primary":"secondary"===e.style?"notification__action-btn--secondary":""}" \n                                    data-action-index="${t}"\n                                    aria-label="${p(e.label,{allowHTML:!1})}">\n                                ${p(e.label,{allowHTML:!1})}\n                            </button>\n                        `}),!1!==r.closable&&(x+='\n                        <button class="notification__close" \n                                aria-label="Chiudi notifica"\n                                title="Chiudi notifica">\n                            <span class="material-icons" aria-hidden="true">close</span>\n                        </button>\n                    '),x+="</div>");const n=m;n>0&&!r.persistent&&(e.debug(`üîß Creating progress bar placeholder for ${t.type} (${n}ms)`),x+=`\n                    <div class="notification__progress notification__progress--js-placeholder" \n                         aria-hidden="true" \n                         role="progressbar"\n                         aria-label="Tempo rimanente prima della chiusura automatica"\n                         data-duration="${n}"\n                         data-type="${t.type}"></div>\n                `),g.innerHTML=p(x,{allowHTML:!0})}catch(C){e.error("‚ùå Error building notification HTML:",C),g.innerHTML=p(`\n                <div class="notification__content">\n                    <span class="notification__icon">!</span>\n                    <div class="notification__body">\n                        <div class="notification__message">${t.message||"Notifica"}</div>\n                    </div>\n                    <button class="notification__close" aria-label="Chiudi">√ó</button>\n                </div>\n            `,{allowHTML:!1})}try{b(g,t,{timers:l,removeNotification:h,pauseAutoCloseTimer:_,resumeAutoCloseTimer:w,notificationContainer:T})}catch(B){e.error("‚ùå Error attaching notification events:",B);const i=g.querySelector(".notification__close");i&&i.addEventListener("click",()=>{try{h(t.id)}catch(e){g.remove()}})}try{window.innerWidth<=s.maxWidth&&v(g,t,{pauseAutoCloseTimer:_,resumeAutoCloseTimer:w,removeNotification:h})}catch(N){e.error("‚ùå Error attaching touch events:",N)}try{const i=m;if(i>0&&!r.persistent){const r=g.querySelector(".notification__progress--js-placeholder");if(e.debug("üîç Looking for progress bar placeholder:",r),u&&d)window.innerWidth>768&&(g.addEventListener("mouseenter",()=>{try{u.pause(t.id)}catch{}try{d.pause(t.id)}catch{}}),g.addEventListener("mouseleave",()=>{try{u.resume(t.id)}catch{}try{d.resume(t.id)}catch{}})),e.debug(`üïí Managers provided; start deferred until mount (${t.type})`);else if(r){const r=c(g,i,t.type);E(l,t.id,i,()=>{try{h(t.id)}catch(i){e.error("‚ùå Error in progress complete callback:",i),g.parentNode&&g.remove()}}),window.innerWidth>768&&(g.addEventListener("mouseenter",()=>{r&&r.pause()}),g.addEventListener("mouseleave",()=>{r&&r.resume()})),g._progressBarInstance=r,e.debug(`‚úÖ JavaScript progress bar initialized for ${t.type} (${i}ms)`)}else E(l,t.id,i,()=>{try{h(t.id)}catch(i){e.error("‚ùå Error in auto-close callback:",i),g.parentNode&&g.remove()}}),e.debug(`‚úÖ Fallback timer used for ${t.type} (${i}ms)`)}}catch(S){e.error("‚ùå Error setting up auto-close timer:",S)}try{y(t.type,t.message,r.title||"")}catch($){e.warn("‚ùå Error announcing notification:",$)}return g}catch(x){return e.error("‚ùå Critical error in createNotificationElement:",x),M.createSimpleFallback(t)}}function f(e){const t=String(e||"").toLowerCase();switch(t){case"errore":case"danger":case"err":case"error":return"error";case"successo":case"ok":case"success":return"success";case"avviso":case"warn":case"warning":return"warning";default:return"info"===t||"informazione"===t?"info":t||"info"}}class y{container;progressBars;constructor(t){this.container=t,this.progressBars=new Map,e.debug("NotificationProgressBarManager initialized")}start(t,i,r){if(i<=0)return null;try{this.stop(t);const n=this.queryElement(t);if(!n)return e.warn(`[ProgressBarManager] Element not found for notification ${t}`),null;const s=this.createProgressBar(n,i,r);return s&&(this.progressBars.set(t,s),n._progressBarInstance=s,e.debug(`[ProgressBarManager] Progress bar started for notification ${t}`)),s}catch(n){return e.error(`[ProgressBarManager] Failed to start progress bar for ${t}:`,n),null}}pause(t){try{const i=this.progressBars.get(t);i&&(i.pause(),e.debug(`[ProgressBarManager] Progress bar paused for notification ${t}`))}catch(i){e.error(`[ProgressBarManager] Failed to pause progress bar for ${t}:`,i)}}resume(t){try{const i=this.progressBars.get(t);i&&(i.resume(),e.debug(`[ProgressBarManager] Progress bar resumed for notification ${t}`))}catch(i){e.error(`[ProgressBarManager] Failed to resume progress bar for ${t}:`,i)}}stop(t){try{const i=this.progressBars.get(t);if(i){i.destroy(),this.progressBars.delete(t);const r=this.queryElement(t);r&&r._progressBarInstance&&(r._progressBarInstance=null),e.debug(`[ProgressBarManager] Progress bar stopped for notification ${t}`)}}catch(i){e.error(`[ProgressBarManager] Failed to stop progress bar for ${t}:`,i)}}pauseAll(){try{this.progressBars.forEach((e,t)=>this.pause(t)),e.debug(`[ProgressBarManager] All progress bars paused (${this.progressBars.size})`)}catch(t){e.error("[ProgressBarManager] Failed to pause all progress bars:",t)}}resumeAll(){try{this.progressBars.forEach((e,t)=>this.resume(t)),e.debug(`[ProgressBarManager] All progress bars resumed (${this.progressBars.size})`)}catch(t){e.error("[ProgressBarManager] Failed to resume all progress bars:",t)}}cleanup(){try{const t=this.progressBars.size;this.progressBars.forEach((e,t)=>this.stop(t)),this.progressBars.clear(),e.debug(`[ProgressBarManager] Cleanup completed (${t} progress bars destroyed)`)}catch(t){e.error("[ProgressBarManager] Failed to cleanup progress bars:",t)}}getStats(){return{active:this.progressBars.size,activeIds:Array.from(this.progressBars.keys())}}isActive(e){return this.progressBars.has(e)}destroy(){this.cleanup(),this.container=null,e.debug("[ProgressBarManager] Manager destroyed")}createProgressBar(t,i,r){try{const e=t.querySelector(".notification__progress--js-placeholder"),n=c(t,i,e?.dataset?.type||t.dataset?.type||"info");if(r){const e=()=>{try{r(t.dataset?.id??"")}catch{}t.removeEventListener("progressComplete",e)};t.addEventListener("progressComplete",e)}return{pause:()=>{try{n?.pause?.()}catch{}},resume:()=>{try{n?.resume?.()}catch{}},destroy:()=>{try{n?.destroy?.()}catch{}},get isPaused(){return Boolean(n?.isPaused)},get isDestroyed(){return Boolean(n?.isDestroyed)},get progress(){try{return n?.progress??0}catch{return 0}}}}catch(n){return e.error("[ProgressBarManager] Failed to create progress bar:",n),null}}queryElement(e){const t=this.container?.querySelector(`[data-id="${e}"]`);return t??null}}class b{containerEl;timerManager;progressBarManager;settings;onRemove;timersMap;isRendering;_lastRenderedIds;_renderCount;_lastRenderTime;_avgRenderTime;constructor({containerEl:e,timerManager:t,progressBarManager:i,settings:r,onRemove:n,timersMap:s}){this.containerEl=e||null,this.timerManager=t||null,this.progressBarManager=i||null,this.settings=r||{},this.onRemove="function"==typeof n?n:null,this.timersMap=s||new Map,this.isRendering=!1,this._lastRenderedIds=[],this._renderCount=0,this._lastRenderTime=0,this._avgRenderTime=0}setContainer(e){this.containerEl=e,this.progressBarManager&&(this.progressBarManager.container=e)}render(e=[]){if(Array.isArray(e)&&this.containerEl&&!this.isRendering){this.isRendering=!0;try{const r="undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?()=>window.performance.now():()=>Date.now(),n=r(),s=new Set(e.map(e=>e.id)),a=new Set(this._lastRenderedIds);a.forEach(e=>{if(!s.has(e))try{this.removeElement(e)}catch(t){i.handleDOMError(t,"remove",null)}}),e.forEach(e=>{if(!a.has(e.id))try{this.addElement(e)}catch(t){i.handleRenderError(t,e,e=>{const t=i.createSimpleFallback(e);return null!=t&&null!=this.containerEl&&this.containerEl.appendChild(t),t})}}),e.forEach(e=>{if(a.has(e.id))try{const t=this.getElementById(e.id);if(!t)return;const i=e?.options?.duplicateCount||1;let r=t.querySelector(".notification__count");if(i>1)if(r)r.textContent=`√ó${i}`,r.setAttribute("aria-label",`Ripetuta ${i} volte`);else{const e=t.querySelector(".notification__icon");r=document.createElement("span"),r.className="notification__count",r.setAttribute("aria-label",`Ripetuta ${i} volte`),r.textContent=`√ó${i}`,e&&e.parentNode?e.parentNode.insertBefore(r,e):t.querySelector(".notification__content")?.prepend(r)}else r&&r.remove()}catch(t){}});const o=e.length,c=Number(this.settings?.maxVisible??5),l=Math.max(0,o-c),u=l>0?e.slice(0,l):[];t=e=>{try{this.onRemove?.(e)}catch{}},void u.forEach(e=>{"success"!==e.type&&"info"!==e.type||setTimeout(()=>{t(e.id)},1e3)}),this._lastRenderedIds=e.map(e=>e.id);const d=Math.max(0,r()-n);this._lastRenderTime=d,this._renderCount+=1,this._avgRenderTime=1===this._renderCount?d:(this._avgRenderTime*(this._renderCount-1)+d)/this._renderCount}finally{this.isRendering=!1}var t}}addElement(e){const t=this.createElement(e);if(!t)throw new Error("createElement returned null");this.containerEl.appendChild(t),this.afterMount(e,t)}removeElement(e){const t=this.getElementById(e);t&&t.parentNode&&t.parentNode.removeChild(t)}getStats(){return{renderCount:this._renderCount,averageRenderTime:this._avgRenderTime,lastRenderTime:this._lastRenderTime}}updateSettings(e){this.settings=e||this.settings}createElement(t){try{return g({notification:t,settings:this.settings,timers:this.timersMap,timerManager:this.timerManager,progressBarManager:this.progressBarManager,removeNotification:e=>{try{this.onRemove?.(e)}catch{}},announceNotification:d,attachNotificationEvents:h,attachTouchEvents:m,notificationContainer:{container:this.containerEl},errorHandler:i})}catch(r){e.error("[RenderEngine] Failed to create notification element:",r);try{return i.createSimpleFallback(t)}catch(n){return null}}}afterMount(t,i){try{if(!t||!i)return;const e=t.options||{},r=a(t.type,e.duration);r>0&&!e.persistent&&this.timerManager&&this.progressBarManager&&(this.progressBarManager.start(t.id,r,()=>{try{this.onRemove?.(t.id)}catch{}}),this.timerManager.start(t.id,r),"undefined"!=typeof window&&window.innerWidth>768&&(i.addEventListener("mouseenter",()=>{try{this.timerManager.pause(t.id)}catch{}try{this.progressBarManager.pause(t.id)}catch{}}),i.addEventListener("mouseleave",()=>{try{this.timerManager.resume(t.id)}catch{}try{this.progressBarManager.resume(t.id)}catch{}})))}catch(r){e.error("[RenderEngine] afterMount failed:",r)}}getElementById(e){try{return this.containerEl?.querySelector(`[data-id="${e}"]`)||null}catch(t){return null}}pauseAll(){try{this.timerManager?.pauseAll()}catch{}try{this.progressBarManager?.pauseAll()}catch{}}resumeAll(){try{this.timerManager?.resumeAll()}catch{}try{this.progressBarManager?.resumeAll()}catch{}}cleanupAll(){try{this.timerManager?.stopAll()}catch{}try{this.progressBarManager?.cleanup()}catch{}}removeAnimated(e,t,i){try{const r=this.getElementById(e);if(r&&t)try{r.classList.remove("notification--entering"),r.classList.add("notification--exiting");const t=r.querySelector(".notification__progress");return t&&t.classList.remove("notification__progress--active","notification__progress--paused","notification__progress--resumed"),setTimeout(()=>{try{this.removeElement(e)}catch{}try{i?.()}catch{}},300),void 0}catch{}this.removeElement(e);try{i?.()}catch{}}catch(r){try{i?.()}catch{}}}}function v(e){return"object"==typeof e&&null!==e}class T{timers;onTimeout;constructor(t){this.timers=new Map,this.onTimeout=t??(t=>e.debug(`Timer expired for notification ${t}`)),e.debug("NotificationTimerManager initialized")}startAutoCloseTimer(e,t,i){if(this.timers.has(e)){const t=this.timers.get(e);t&&clearTimeout(t.timerId)}const r=Date.now(),n=setTimeout(()=>{this.timers.delete(e),i(e)},t);this.timers.set(e,{timerId:n,originalDuration:t,startTime:r,remainingTime:t,isPaused:!1,pausedAt:null,callback:i})}pauseAutoCloseTimer(t){const i=this.timers.get(t);i&&!i.isPaused&&(clearTimeout(i.timerId),i.isPaused=!0,i.pausedAt=Date.now(),i.remainingTime=i.remainingTime-(i.pausedAt-i.startTime),e.debug(`‚è∏Ô∏è Timer paused for notification: ${t}`))}resumeAutoCloseTimer(t){const i=this.timers.get(t);i&&i.isPaused&&(i.isPaused=!1,i.startTime=Date.now(),i.timerId=setTimeout(()=>{this.timers.delete(t),i.callback&&i.callback(t)},i.remainingTime),e.debug(`‚ñ∂Ô∏è Timer resumed for notification: ${t}`))}stopAutoCloseTimer(t,i){const r=this.timers.get(t);if(r){clearTimeout(r.timerId),this.timers.delete(t);try{"function"==typeof i&&i(t)}catch(n){e.warn("Timer onStop callback error:",n)}e.debug(`‚èπÔ∏è Timer stopped for notification: ${t}`)}}start(t,i,r){try{if(this.stop(t),i<=0)return e.debug(`[TimerManager] No timer set for notification ${t} (duration: ${i})`),!1;const n=r??this.onTimeout;return this.startAutoCloseTimer(t,i,t=>{e.debug(`[TimerManager] Timer ${t} expired`),n(t)}),e.debug(`[TimerManager] Timer started for notification ${t} (${i}ms)`),!0}catch(n){return e.error(`[TimerManager] Failed to start timer for ${t}:`,n),!1}}pause(t){try{return this.timers.has(t)?(this.pauseAutoCloseTimer(t),e.debug(`[TimerManager] Timer paused for notification ${t}`),!0):(e.debug(`[TimerManager] No timer to pause for notification ${t}`),!1)}catch(i){return e.error(`[TimerManager] Failed to pause timer for ${t}:`,i),!1}}resume(t){try{return this.timers.has(t)?(this.resumeAutoCloseTimer(t),e.debug(`[TimerManager] Timer resumed for notification ${t}`),!0):(e.debug(`[TimerManager] No timer to resume for notification ${t}`),!1)}catch(i){return e.error(`[TimerManager] Failed to resume timer for ${t}:`,i),!1}}stop(t,i){try{return!!this.timers.has(t)&&(this.stopAutoCloseTimer(t,i),e.debug(`[TimerManager] Timer stopped for notification ${t}`),!0)}catch(r){return e.error(`[TimerManager] Failed to stop timer for ${t}:`,r),!1}}pauseAll(){let t=0;try{this.timers.forEach((e,i)=>{this.pause(i)&&t++}),e.debug(`[TimerManager] Paused ${t}/${this.timers.size} timers`)}catch(i){e.error("[TimerManager] Failed to pause all timers:",i)}return t}resumeAll(){let t=0;try{this.timers.forEach((e,i)=>{this.resume(i)&&t++}),e.debug(`[TimerManager] Resumed ${t}/${this.timers.size} timers`)}catch(i){e.error("[TimerManager] Failed to resume all timers:",i)}return t}stopAll(t){let i=0;try{Array.from(this.timers.keys()).forEach(e=>{this.stop(e,t)&&i++}),e.debug(`[TimerManager] Stopped ${i} timers`)}catch(r){e.error("[TimerManager] Failed to stop all timers:",r)}return i}cleanupOrphanedTimers(t=[]){let i=0;try{const r=new Set(t);Array.from(this.timers.keys()).forEach(e=>{r.has(e)||this.stop(e)&&i++}),i>0&&e.debug(`[TimerManager] Cleaned up ${i} orphaned timers`)}catch(r){e.error("[TimerManager] Failed to cleanup orphaned timers:",r)}return i}getStats(){try{const e={total:this.timers.size,active:0,paused:0,activeIds:[],pausedIds:[]};return this.timers.forEach((t,i)=>{v(t)&&(t.isPaused??t.paused?(e.paused++,e.pausedIds.push(i)):(e.active++,e.activeIds.push(i)))}),e}catch(t){return e.error("[TimerManager] Failed to get stats:",t),{total:0,active:0,paused:0,activeIds:[],pausedIds:[],error:t instanceof Error?t.message:"Unknown error"}}}hasTimer(e){return this.timers.has(e)}isPaused(t){try{const e=this.timers.get(t);return!!v(e)&&Boolean(e.isPaused??e.paused)}catch(i){return e.error(`[TimerManager] Failed to check if timer ${t} is paused:`,i),!1}}getRemainingTime(t){try{const e=this.timers.get(t);if(!v(e))return-1;if((e.isPaused??e.paused)&&"number"==typeof e.remainingTime)return e.remainingTime;if("number"==typeof e.remainingTime&&"number"==typeof e.startTime){const t=Date.now()-e.startTime;return Math.max(e.remainingTime-t,0)}return-1}catch(i){return e.error(`[TimerManager] Failed to get remaining time for ${t}:`,i),-1}}cleanup(){try{const t=this.stopAll();this.timers.clear(),e.debug(`[TimerManager] Cleanup completed (${t} timers stopped)`)}catch(t){e.error("[TimerManager] Failed to cleanup:",t)}}destroy(){this.cleanup(),this.onTimeout=()=>{},e.debug("[TimerManager] Manager destroyed")}}class M{onHidden;onVisible;_handler;_attached;constructor({onHidden:e,onVisible:t}={}){this.onHidden="function"==typeof e?e:null,this.onVisible="function"==typeof t?t:null,this._handler=this._handleVisibilityChange.bind(this),this._attached=!1}attach(){this._attached||"undefined"==typeof document||(document.addEventListener("visibilitychange",this._handler,{passive:!0}),this._attached=!0)}detach(){this._attached&&"undefined"!=typeof document&&(document.removeEventListener("visibilitychange",this._handler),this._attached=!1)}_handleVisibilityChange(){try{document.hidden?this.onHidden?.():this.onVisible?.()}catch{}}}class E{timerManager;progressBarManager;constructor({timerManager:e,progressBarManager:t}={}){this.timerManager=e??new T,this.progressBarManager=t??null}start(e,t,i){return this.timerManager.start(e,t,i)}pause(e){return this.timerManager.pause(e)}resume(e){return this.timerManager.resume(e)}stop(e,t){return this.timerManager.stop(e,t??(e=>this.progressBarManager?.stop(e)))}pauseAll(){return this.timerManager.pauseAll()}resumeAll(){return this.timerManager.resumeAll()}stopAll(e){return this.timerManager.stopAll(e)}cleanupOrphans(e=[]){return this.timerManager.cleanupOrphanedTimers(e)}hasTimer(e){return this.timerManager.hasTimer(e)}}class _{static DEBUG=!1;notificationContainer;timers;initialized;isRendering;settings;_lastRenderedNotificationIds;_renderCount;_lastRenderTime;_averageRenderTime;_unsubscribe;_unsubscribeSettings;timerManager;progressBarManager;renderEngine;visibilityManager;timerAdapter;constructor(){this.notificationContainer=null,this.timers=new Map,this.initialized=!1,this.isRendering=!1,this.settings=r.getSettings(),this._lastRenderedNotificationIds=[],this._renderCount=0,this._lastRenderTime=0,this._averageRenderTime=0,this._unsubscribe=null,this._unsubscribeSettings=null,this.timerManager=null,this.progressBarManager=null,this.renderEngine=null,this.visibilityManager=null,this.timerAdapter=null}flush(){try{const e=r.getNotifications();this.renderNotifications(e)}catch{}}async init(){if(!this.initialized&&"undefined"!=typeof window)try{await this.#e(),function(){try{u=l.getInstance({id:"notification-announcer"})}catch(e){if(!document.getElementById("notification-announcer")){const e=document.createElement("div");e.id="notification-announcer",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;",document.body.appendChild(e)}}}(),this._unsubscribe=r.subscribe(this.#t),this._unsubscribeSettings=r.subscribe((e,t)=>{try{if(this.settings=t,this.notificationContainer){this.notificationContainer.updateSettings({position:this.settings.position,maxVisible:this.settings.maxVisible})}}catch{}}),this.initialized=!0,this.visibilityManager=new M({onHidden:()=>{try{this.renderEngine?.pauseAll(),this.#i()}catch{}},onVisible:()=>{try{this.renderEngine?.resumeAll(),this.#r()}catch{}}}),this.visibilityManager.attach()}catch(e){i.handleServiceError(e,"init"),this.initialized=!0}}async#e(){if(this.notificationContainer)return;const{NotificationContainer:e}=await t(async()=>{const{NotificationContainer:e}=await import("./NotificationContainer-DxM56sch.js");return{NotificationContainer:e}},__vite__mapDeps([0,1,2,3,4,5]));this.notificationContainer=new e({position:this.settings.position,maxVisible:this.settings.maxVisible});const i=this.notificationContainer?.container||null;this.timerManager=new T(e=>this.removeNotification(e)),this.progressBarManager=new y(i),this.renderEngine=new b({containerEl:i,timerManager:this.timerManager,progressBarManager:this.progressBarManager,settings:this.settings,onRemove:e=>this.removeNotification(e),timersMap:this.timers}),this.timerAdapter=new E({timerManager:this.timerManager,progressBarManager:this.progressBarManager})}show(e,t,n={}){try{const i=f(e),s=String(t||"").trim();if(!s){return this.show(i,`Notifica ${i} - Messaggio non disponibile`,n)}const a=function(e,t){const i=e||{},r=(i.customDurations||{})[t];return(i.persistentTypes||[]).includes(t)?0:"number"==typeof r?r:"number"==typeof i.defaultDuration?i.defaultDuration:5e3}(this.settings,i),o=function(e,t,i){const r=t||{};return{duration:void 0!==r.duration?r.duration:i,closable:!1!==r.closable,position:r.position||e&&e.position,priority:r.priority||0,title:r.title,actions:r.actions,persistent:r.persistent,...r}}(this.settings,"number"==typeof n?{duration:n}:n,a);return r.addNotification(i,s,o)}catch(s){i.handleServiceError(s,"show",{type:e,message:t,options:n});const r=i.recoverFromShowError({type:f(e),message:t,options:n,id:Date.now().toString()});return"string"==typeof r?r:Date.now().toString()}}success(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("success",e,t)}info(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("info",e,t)}warning(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("warning",e,t)}error(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("error",e,t)}renderNotifications(e=[]){Array.isArray(e)&&this.notificationContainer&&(this.renderEngine?.setContainer(this.notificationContainer.container),this.renderEngine?.updateSettings(this.settings),this.renderEngine?.render(e))}#n(e){const t=this.renderEngine?.createElement(e)||g({notification:e,settings:this.settings,timers:this.timers,timerManager:this.timerManager,progressBarManager:this.progressBarManager,removeNotification:e=>this.removeNotification(e),announceNotification:d,attachNotificationEvents:h,attachTouchEvents:m,notificationContainer:this.notificationContainer,errorHandler:i});if(!t)throw new Error("createNotificationElement returned null");this.notificationContainer.addNotification(t);try{this.renderEngine?.afterMount(e,t)}catch{}}#t=this.#s(e=>{Array.isArray(e)&&this.renderNotifications(e)},16);removeNotification(e){try{if(this.timerAdapter?.stop(e,()=>this.progressBarManager?.stop(e)),!this.notificationContainer)return r.removeNotification(e),void 0;const t=this.settings.enableAnimations&&!i.shouldDisableAnimations();this.renderEngine?.removeAnimated(e,t,()=>this.#a(e))}catch(t){i.handleServiceError(t,"remove",e),i.recoverFromRemoveError(e)}}#a(e){this.#o(e)}#o(e){try{r.removeNotification(e)}catch{}}clear(){try{this.timerAdapter?.stopAll(e=>this.progressBarManager?.stop(e)),this.timers.clear(),this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications(),r.clearAllNotifications()}catch(e){i.handleServiceError(e,"clear"),i.recoverFromClearError()}}clearByType(e){r.getNotifications().forEach(t=>{t.type===e&&this.timerAdapter?.stop(t.id,()=>this.progressBarManager?.stop(t.id))}),r.clearNotificationsByType(e)}startAutoCloseTimer(e,t){try{this.timerAdapter?.start(e,t,e=>this.removeNotification(e))}catch{}}pauseAutoCloseTimer(e){try{this.timerAdapter?.pause(e)}catch{}}resumeAutoCloseTimer(e){try{this.timerAdapter?.resume(e)}catch{}}stopAutoCloseTimer(e){try{this.timerAdapter?.stop(e,()=>this.progressBarManager?.stop(e))}catch{}}handleAction(e,t){try{const i=r.getNotifications().find(t=>t.id===e),n=i?.options?.actions?.[t];n&&"function"==typeof n.onClick&&n.onClick({id:e,index:t,notification:i})}catch{}}setCustomDurations(e){this.updateSettings({customDurations:{...this.settings.customDurations||{},...e}})}setPersistentTypes(e){this.updateSettings({persistentTypes:[...e]})}setAutoCleanupInterval(e){this.updateSettings({autoCleanupInterval:e})}updatePosition(e){this.updateSettings({position:e})}setMaxVisible(e){this.updateSettings({maxVisible:e});const t=r.getNotifications();this.renderNotifications(t)}enableSounds(e=!0){this.updateSettings({enableSounds:!!e})}updateSettings(e){try{const t=this._validateSettings(e);if(r.updateSettings(t),this.settings=r.getSettings(),this.notificationContainer){const e={};"position"in t&&(e.position=this.settings.position),"maxVisible"in t&&(e.maxVisible=this.settings.maxVisible),Object.keys(e).length&&this.notificationContainer.updateSettings(e)}return this.renderEngine?.updateSettings(this.settings),!0}catch{return!1}}getStats(){try{return{...r.getStats(),settings:this.settings,activeTimers:this.timerManager?this.timerManager.timers.size:this.timers.size,containerInitialized:!!this.notificationContainer,serviceInitialized:this.initialized,performance:this.renderEngine?.getStats?.()||{renderCount:this._renderCount,averageRenderTime:this._averageRenderTime,lastRenderTime:this._lastRenderTime}}}catch(e){const t=e;return{total:0,visible:0,byType:{success:0,error:0,warning:0,info:0},persistent:0,error:t?.message}}}exportSettings(){try{const e=r.exportSettings();return e.serviceMetadata={version:"2.0",exportedBy:"NotificationService"},e}catch(e){return null}}importSettings(t){try{if(!t||"object"!=typeof t||!t.settings)return!1;t.version&&"1.0"!==t.version&&e.warn(`Versione backup non supportata: ${t.version}`);const i=r.importSettings(t);return i&&(this.settings=r.getSettings()),i}catch(i){return!1}}cleanupOldNotifications(e=3e5){try{const t=r.clearOldNotifications(e),i=new Set(r.getNotifications().map(e=>e.id));return Array.from(this.timers.keys()).forEach(e=>{i.has(e)||this.timers.delete(e)}),t}catch{return 0}}_validateSettings(e){const t={},i=e=>"number"==typeof e&&!Number.isNaN(e),r=e=>"boolean"==typeof e;if(void 0!==e.maxVisible){if(!Number.isInteger(e.maxVisible)||e.maxVisible<1||e.maxVisible>20)throw new Error("maxVisible must be between 1 and 20");t.maxVisible=e.maxVisible}if(void 0!==e.defaultDuration){if(!i(e.defaultDuration)||e.defaultDuration<0)throw new Error("defaultDuration must be >= 0");t.defaultDuration=e.defaultDuration}if(void 0!==e.position){if(!["top-right","top-left","bottom-right","bottom-left","top-center","bottom-center"].includes(e.position))throw new Error("invalid position");t.position=e.position}if(void 0!==e.enableSounds){if(!r(e.enableSounds))throw new Error("enableSounds must be boolean");t.enableSounds=e.enableSounds}if(void 0!==e.enableAnimations){if(!r(e.enableAnimations))throw new Error("enableAnimations must be boolean");t.enableAnimations=e.enableAnimations}if(void 0!==e.autoCleanupInterval){if(!i(e.autoCleanupInterval)||e.autoCleanupInterval<6e4)throw new Error("autoCleanupInterval must be >= 60000");t.autoCleanupInterval=e.autoCleanupInterval}if(void 0!==e.maxStoredNotifications){if(!Number.isInteger(e.maxStoredNotifications)||e.maxStoredNotifications<10)throw new Error("maxStoredNotifications must be >= 10");t.maxStoredNotifications=e.maxStoredNotifications}if(void 0!==e.persistentTypes){if(!Array.isArray(e.persistentTypes))throw new Error("persistentTypes must be array");t.persistentTypes=[...e.persistentTypes]}if(void 0!==e.soundVolume){if(!i(e.soundVolume)||e.soundVolume<0||e.soundVolume>1)throw new Error("soundVolume must be between 0 and 1");t.soundVolume=e.soundVolume}if(void 0!==e.customDurations){const r=["success","error","warning","info"],n=e.customDurations;if(!n||"object"!=typeof n)throw new Error("customDurations must be object");for(const e of Object.keys(n))if(!r.includes(e)||!i(n[e])||n[e]<0)throw new Error("invalid customDurations entry");t.customDurations={...n}}return t}getNotificationsByType(e){try{return r.getNotificationsByType(e)}catch{return[]}}getVisibleNotifications(){try{return r.getVisibleNotifications()}catch{return[]}}hasErrors(){try{return r.hasErrorNotifications()}catch{return!1}}destroy(){try{try{this.timerAdapter?.stopAll()}catch{}try{this.progressBarManager?.cleanup()}catch{}try{this.timers.clear()}catch{}this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications();try{this.visibilityManager?.detach()}catch{}if("function"==typeof this._unsubscribe){try{this._unsubscribe()}catch{}this._unsubscribe=null}if("function"==typeof this._unsubscribeSettings){try{this._unsubscribeSettings()}catch{}this._unsubscribeSettings=null}try{this.timerManager?.destroy()}catch{}try{this.progressBarManager?.destroy()}catch{}this.renderEngine=null}finally{this.notificationContainer=null,this.initialized=!1}}#c(e){try{this.progressBarManager?.stop(e)}catch{}}#l(e){try{this.progressBarManager?.pause(e)}catch{}}#u(e){try{this.progressBarManager?.resume(e)}catch{}}#i(){try{this.timerAdapter?.pauseAll(),this.progressBarManager?.pauseAll()}catch{}}#r(){try{this.timerAdapter?.resumeAll(),this.progressBarManager?.resumeAll()}catch{}}#s(e,t){let i=!1;return(...r)=>{i||(e.apply(this,r),i=!0,setTimeout(()=>i=!1,t))}}}const w=new _;export{w as notificationService};
