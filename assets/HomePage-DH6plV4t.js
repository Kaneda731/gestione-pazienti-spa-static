import{j as e}from"./ui-vendor-S6RcKJ66.js";import{b as a,u as i}from"./react-vendor-Bp2pLdQf.js";import{u as s,a as t,s as n,b as r,l as o,c}from"./index-kK1x19NQ.js";import{p as l}from"./patientService-C7Xo1cPW.js";import"./supabase-Zkii_ZbW.js";import"./CentralizedStatisticsService-zmmQTgv5.js";const d=()=>{const{user:c,isAuthenticated:l}=s(),[d,m]=t(),[h,x]=a.useState(d),[p,u]=a.useState(!1),g=a.useRef(null),j=i();if(a.useEffect(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&u(!1)};if(p)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[p]),!l||!c)return null;const v=c.ruolo??c.role??"caricamento...",N=c.email?.split("@")[0]||"User",y=N.charAt(0).toUpperCase(),f=e=>({admin:"#6366f1",medico:"#0891b2",infermiere:"#059669",operatore:"#ea580c",lettore:"#8b5cf6"}[e.toLowerCase()]||"#64748b"),b="dark"===h?"light_mode":"dark_mode",k="dark"===h?"Tema chiaro":"Tema scuro";return e.jsxs("div",{ref:g,className:"user-avatar-menu",style:{position:"relative"},children:[e.jsx("button",{className:"user-avatar-button",onClick:()=>u(!p),"aria-label":"Menu utente",style:{width:"48px",height:"48px",borderRadius:"50%",border:"none",background:`linear-gradient(135deg, ${f(v)}, ${f(v)}dd)`,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.25)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)"},children:y}),p&&e.jsxs("div",{className:"user-avatar-dropdown",style:{position:"absolute",top:"56px",right:"0",background:"#fff",borderRadius:"8px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.12)",minWidth:"280px",zIndex:1e3,overflow:"hidden",animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:`linear-gradient(135deg, ${f(v)}, ${f(v)}dd)`,color:"#fff",padding:"16px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold"},children:y}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"14px"},children:N}),e.jsx("div",{style:{fontSize:"12px",opacity:.9},children:c.email}),e.jsx("div",{style:{display:"inline-block",marginTop:"4px",fontSize:"10px",fontWeight:"600",background:"rgba(255, 255, 255, 0.25)",padding:"2px 8px",borderRadius:"4px",textTransform:"uppercase"},children:v})]})]}),e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsxs("button",{onClick:()=>{const e="dark"===h?"light":"dark";m(e),n(e),x(e)},style:{width:"100%",border:"none",background:"none",padding:"12px 16px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",color:"#1f2937",fontSize:"14px",transition:"background-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f3f4f6"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},title:k,children:[e.jsx("span",{className:"material-icons",style:{fontSize:"20px"},children:b}),e.jsx("span",{children:k})]}),e.jsx("div",{style:{height:"1px",background:"#e5e7eb",margin:"4px 0"}}),e.jsxs("button",{onClick:async()=>{try{await r(),j("/login")}catch(e){o.error("Logout failed",e)}},style:{width:"100%",border:"none",background:"none",padding:"12px 16px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",color:"#ef4444",fontSize:"14px",fontWeight:"500",transition:"background-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#fee2e2"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("span",{className:"material-icons",style:{fontSize:"20px"},children:"logout"}),e.jsx("span",{children:"Esci"})]})]})]}),e.jsx("style",{children:"\n        @keyframes fadeIn {\n          from {\n            opacity: 0;\n            transform: translateY(-8px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n      "})]})},m=e=>`${e.cognome} ${e.nome}`.trim(),h=e=>e.codice_rad||e.id?.slice(0,6)||"N/A",x=e=>{if(!e)return"Data non disponibile";try{const a=new Date(e+"T00:00:00"),i=new Date,s=new Date(i);s.setDate(s.getDate()-1);const t=a.toDateString()===i.toDateString(),n=a.toDateString()===s.toDateString(),r=a.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),o=a.toLocaleDateString("it-IT",{month:"2-digit",day:"2-digit"});return t?`Oggi ${r}`:n?`Ieri ${r}`:o}catch{return e}},p=()=>{const e=new Date,a=e.getMinutes(),i=e.getHours();return 0===a?"Adesso":1===a?"1 min fa":a<5?`${a} min fa`:a<60?5*Math.floor(a/5)+" min fa":1===i?"1 ora fa":`${i} ore fa`},u=()=>{const{user:t}=s(),n=i(),[r,u]=a.useState([]),[g,j]=a.useState([]),[v,N]=a.useState("Caricamento..."),[y,f]=a.useState(!0),[b,k]=a.useState({patientsThisWeek:0,eventsLastDays:0,pendingDismissals:0,totalActivePatients:0}),D="admin"===a.useMemo(()=>t?t.ruolo??t.role??null:null,[t]);return a.useEffect(()=>{if(t){(async()=>{try{f(!0);const a=await l.getPatients({stato:"attivo"},{limit:3,sortColumn:"data_ricovero",sortDirection:"desc",page:0}),i=await l.getPatients({stato:"dimesso"},{limit:2,sortColumn:"data_ricovero",sortDirection:"desc",page:0});u(a.patients.map(e=>({id:e.id||"",nome:e.nome||"",cognome:e.cognome||"",codice_rad:e.codice_rad,data_ricovero:e.data_ricovero,data_dimissione:e.data_dimissione}))),j(i.patients.map(e=>({id:e.id||"",nome:e.nome||"",cognome:e.cognome||"",codice_rad:e.codice_rad,data_ricovero:e.data_ricovero,data_dimissione:e.data_dimissione})));try{const e=new Date;e.setDate(e.getDate()-7);const i=e.toISOString().split("T")[0],{data:s,error:t}=await c.from("pazienti").select("id",{count:"exact"}).gte("data_ricovero",i).is("data_dimissione",null),n=t?0:s?.length||0,{data:r,error:o}=await c.from("eventi_clinici").select("id",{count:"exact"}).gte("data_evento",i),l=o?0:r?.length||0,{data:d,error:m}=await c.from("pazienti").select("id",{count:"exact"}).not("data_dimissione","is",null).is("codice_dimissione",null);k({patientsThisWeek:n,eventsLastDays:l,pendingDismissals:m?0:d?.length||0,totalActivePatients:a.totalCount})}catch(e){o.warn("Errore caricamento statistiche:",e)}N(p())}catch(a){o.error("Errore caricamento pazienti recenti:",a),N("Errore caricamento"),u([]),j([])}finally{f(!1)}})();const e=setInterval(()=>{N(p())},6e4);return()=>clearInterval(e)}},[t]),e.jsxs("div",{className:"home-page-container",children:[e.jsxs("div",{className:"home-hero",style:{position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"20px",right:"20px",zIndex:100},children:e.jsx(d,{})}),e.jsxs("div",{className:"home-hero-content",children:[e.jsxs("h1",{className:"home-title",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1.5rem"},children:[e.jsx("img",{src:"/favicon.png",alt:"PATIENTRAK Logo",width:"144",height:"144"}),"PATIENTRAK"]}),e.jsxs("div",{className:"hero-cta-group",children:[e.jsxs("button",{className:"hero-cta hero-cta-primary",onClick:()=>n("/inserimento"),"aria-label":"Registra nuovo paziente",children:[e.jsx("span",{className:"material-icons",children:"person_add"}),"Registra Nuovo Paziente"]}),e.jsxs("button",{className:"hero-cta hero-cta-secondary",onClick:()=>n("/eventi-clinici"),"aria-label":"Registra evento clinico",children:[e.jsx("span",{className:"material-icons",children:"add_circle"}),"Evento Clinico"]})]}),e.jsx("div",{className:"hero-divider"}),e.jsxs("div",{className:"hero-recent-section",children:[e.jsx("h2",{className:"hero-section-title",children:"ðŸ“¥ Ultimi Registrati"}),e.jsx("div",{className:"hero-recent-list",children:y?e.jsx("div",{className:"hero-recent-item",style:{opacity:.6},children:e.jsx("div",{className:"hero-recent-name",children:"Caricamento..."})}):r.length>0?r.map(a=>e.jsxs("div",{className:"hero-recent-item",children:[e.jsx("div",{className:"hero-recent-name",children:m(a)}),e.jsxs("div",{className:"hero-recent-meta",children:["ID: ",h(a)," â€¢ ",x(a.data_ricovero)]})]},a.id)):e.jsx("div",{className:"hero-recent-item",style:{opacity:.5},children:e.jsx("div",{className:"hero-recent-name",children:"Nessun paziente registrato"})})})]}),e.jsx("div",{className:"hero-divider"}),e.jsxs("div",{className:"hero-recent-section",children:[e.jsx("h2",{className:"hero-section-title",children:"ðŸ“¤ Ultimi Dimessi"}),e.jsx("div",{className:"hero-recent-list",children:y?e.jsx("div",{className:"hero-recent-item",style:{opacity:.6},children:e.jsx("div",{className:"hero-recent-name",children:"Caricamento..."})}):g.length>0?g.map(a=>e.jsxs("div",{className:"hero-recent-item",children:[e.jsx("div",{className:"hero-recent-name",children:m(a)}),e.jsxs("div",{className:"hero-recent-meta",children:["ID: ",h(a)," â€¢ ",x(a.data_dimissione)]})]},a.id)):e.jsx("div",{className:"hero-recent-item",style:{opacity:.5},children:e.jsx("div",{className:"hero-recent-name",children:"Nessun paziente dimesso"})})})]}),e.jsxs("div",{className:"hero-footer",children:[e.jsx("span",{className:"material-icons",children:"schedule"}),"Ultimo aggiornamento: ",v]})]})]}),e.jsxs("section",{className:"home-section","aria-labelledby":"quick-actions-section",children:[e.jsxs("h2",{className:"section-title",id:"quick-actions-section",children:[e.jsx("span",{className:"section-icon","aria-hidden":"true",children:"âš¡"}),"Azioni Rapide"]}),e.jsxs("div",{className:"home-cards-grid",children:[e.jsx("div",{className:"home-card card-action-primary",onClick:()=>n("/inserimento"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n("/inserimento"))},"aria-label":"Vai alla pagina inserimento pazienti",children:e.jsxs("div",{className:"home-card-body",children:[e.jsx("div",{className:"home-card-icon",children:e.jsx("span",{className:"material-icons","aria-hidden":"true",children:"person_add"})}),e.jsx("h5",{className:"home-card-title",children:"Inserimento Pazienti"}),e.jsx("p",{className:"home-card-text",children:"Registra un nuovo paziente nel sistema"}),e.jsxs("p",{className:"home-card-meta",children:["Pazienti recenti: ",b.patientsThisWeek," questa settimana"]})]})}),e.jsx("div",{className:"home-card card-action-secondary",onClick:()=>n("/eventi-clinici"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n("/eventi-clinici"))},"aria-label":"Vai alla gestione eventi clinici",children:e.jsxs("div",{className:"home-card-body",children:[e.jsx("div",{className:"home-card-icon",children:e.jsx("span",{className:"material-icons","aria-hidden":"true",children:"medical_services"})}),e.jsx("h5",{className:"home-card-title",children:"Evento Clinico"}),e.jsx("p",{className:"home-card-text",children:"Registra un nuovo evento clinico"}),e.jsxs("p",{className:"home-card-meta",children:["Ultimi 7 giorni: ",b.eventsLastDays," eventi"]})]})}),e.jsx("div",{className:"home-card card-action-tertiary",onClick:()=>n("/dimissione"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n("/dimissione"))},"aria-label":"Vai alla gestione dimissioni",children:e.jsxs("div",{className:"home-card-body",children:[e.jsx("div",{className:"home-card-icon",children:e.jsx("span",{className:"material-icons","aria-hidden":"true",children:"logout"})}),e.jsx("h5",{className:"home-card-title",children:"Dimissioni"}),e.jsx("p",{className:"home-card-text",children:"Processa le dimissioni pazienti"}),e.jsxs("p",{className:"home-card-meta",children:["In sospeso: ",b.pendingDismissals]})]})})]})]}),e.jsxs("section",{className:"home-section","aria-labelledby":"support-section",children:[e.jsxs("h2",{className:"section-title",id:"support-section",children:[e.jsx("span",{className:"section-icon","aria-hidden":"true",children:"ðŸ“Š"}),"Consultazione"]}),e.jsxs("div",{className:"home-cards-grid",children:[e.jsx("div",{className:"home-card card-support-primary",onClick:()=>n("/list"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n("/list"))},"aria-label":"Vai all'elenco pazienti",children:e.jsxs("div",{className:"home-card-body",children:[e.jsx("div",{className:"home-card-icon",children:e.jsx("span",{className:"material-icons","aria-hidden":"true",children:"list"})}),e.jsx("h5",{className:"home-card-title",children:"Elenco Pazienti"}),e.jsx("p",{className:"home-card-text",children:"Visualizza e ricerca pazienti ricoverati"}),e.jsxs("p",{className:"home-card-meta",children:["Pazienti attuali: ",b.totalActivePatients]})]})}),e.jsx("div",{className:"home-card card-support-secondary",onClick:()=>n("/unified-charts"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n("/unified-charts"))},"aria-label":"Vai ai grafici e statistiche",children:e.jsxs("div",{className:"home-card-body",children:[e.jsx("div",{className:"home-card-icon",children:e.jsx("span",{className:"material-icons","aria-hidden":"true",children:"query_stats"})}),e.jsx("h5",{className:"home-card-title",children:"Grafici & Analisi"}),e.jsx("p",{className:"home-card-text",children:"Visualizza trend e statistiche cliniche"}),e.jsxs("p",{className:"home-card-meta",children:["Ultimi aggiornamenti: ",v]})]})})]})]}),D&&e.jsxs("section",{className:"home-section","aria-labelledby":"admin-section",children:[e.jsxs("h2",{className:"section-title",id:"admin-section",children:[e.jsx("span",{className:"section-icon","aria-hidden":"true",children:"âš™ï¸"}),"Amministrazione"]}),e.jsx("div",{className:"home-cards-grid",children:e.jsx("div",{className:"home-card card-admin",onClick:()=>n("/diagnosi"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n("/diagnosi"))},"aria-label":"Vai alla gestione diagnosi (solo amministratori)",children:e.jsxs("div",{className:"home-card-body",children:[e.jsx("div",{className:"home-card-icon",children:e.jsx("span",{className:"material-icons","aria-hidden":"true",children:"medical_information"})}),e.jsxs("h5",{className:"home-card-title",children:["Gestione Diagnosi",e.jsx("span",{className:"badge-admin","aria-label":"Solo amministratori",children:"Admin"})]}),e.jsx("p",{className:"home-card-text",children:"Configura le diagnosi disponibili"})]})})})]})]})};export{u as HomePage,u as default};
