import{j as e}from"./ui-vendor-S6RcKJ66.js";import{R as t,b as r}from"./react-vendor-Bp2pLdQf.js";import{D as n}from"./dropdownPositioner-CpLmXRgY.js";import{t as s,q as l}from"./index-BYALc3pe.js";const o=t.forwardRef(({id:o,placeholder:a="Seleziona...",value:c,options:i,children:u,onChange:d,disabled:p=!1,className:v="",isInvalid:f=!1},h)=>{const m=r.useRef(null),b=r.useRef(null),w=r.useRef(null),g=r.useRef(null),x=r.useRef(-1),k=r.useRef(null),y=r.useRef(null),j=r.useRef(null),[E,C]=r.useState(!1),[L,A]=r.useState(c||""),[S,N]=r.useState(-1),[R,D]=r.useState(!1);r.useEffect(()=>{if(!b.current&&u&&t.isValidElement(u)&&"select"===u.type){const e=document.querySelectorAll("select");e.length>0&&(b.current=e[e.length-1])}},[u]);const M=r.useMemo(()=>{if(i&&i.length>0)return i;if(b.current){const e=[];return b.current.querySelectorAll("option").forEach(t=>{e.push({value:t.value,label:t.textContent||"",icon:t.getAttribute("data-icon")||void 0})}),e}return[]},[i]),$=r.useMemo(()=>{const e=M.find(e=>e.value===L);return e?.label||a},[L,M,a]);r.useEffect(()=>{void 0!==c&&A(c)},[c]),r.useEffect(()=>{N(-1),L&&M.length>0&&M.some(e=>e.value===L)},[M.length,M]),r.useEffect(()=>{if(b.current){b.current.value=L;const e=new Event("change",{bubbles:!0});b.current.dispatchEvent(e)}j.current&&(j.current.value=L)},[L]),r.useEffect(()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&C(!1)};if(E)return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[E]),r.useEffect(()=>{if(E&&m.current&&g.current&&w.current){const e=n.calculateAndApply?.(m.current,g.current,w.current);e&&window.appLogger?.debug&&window.appLogger.debug("Dropdown aperto "+("up"===e.direction?"verso l'alto":"verso il basso"),{spaceBelow:e.spaceBelow,spaceAbove:e.spaceAbove,dropdownHeight:e.dropdownHeight,isInModal:e.isInModal})}},[E]),r.useEffect(()=>{if(E)return k.current=()=>{w.current&&g.current&&n.calculateAndApply(m.current,g.current,w.current)},y.current=s(()=>{w.current&&g.current&&n.calculateAndApply(m.current,g.current,w.current)},100),window.addEventListener("resize",k.current),window.addEventListener("scroll",y.current,{passive:!0}),()=>{k.current&&window.removeEventListener("resize",k.current),y.current&&window.removeEventListener("scroll",y.current)}},[E]);const I=r.useCallback(e=>{switch(e.key){case"Enter":case" ":e.preventDefault(),C(!E);break;case"Escape":e.preventDefault(),C(!1);break;case"ArrowDown":e.preventDefault(),E?N(e=>{const t=e+1>=M.length?0:e+1;return x.current=t,t}):C(!0);break;case"ArrowUp":e.preventDefault(),E&&N(e=>{const t=e-1<0?M.length-1:e-1;return x.current=t,t})}},[E,M.length]);r.useEffect(()=>{if(S>=0&&E){const e=w.current?.querySelector(`.custom-select-option[data-index="${S}"]`);e&&e.scrollIntoView({block:"nearest"})}},[S,E]);const B=r.useCallback(e=>{A(e),C(!1),d?.(e)},[d]),q=r.useCallback(e=>{e.preventDefault(),e.stopPropagation(),A(""),N(-1),d?.("")},[d]),z=r.useCallback(()=>{D(!1)},[]),T=r.useCallback(()=>{D(!0)},[]),H=r.useCallback(e=>{p||R||(e.stopPropagation(),C(!E),N(-1))},[E,p,R]),P=""!==L,V=t=>t.icon?e.jsxs(e.Fragment,{children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:l(t.icon,{allowedTags:["svg","path","circle","rect","line","polyline","polygon","i","span"],allowedAttributes:{svg:["viewBox","width","height","fill","stroke","class"],path:["d","fill","stroke","class"],circle:["cx","cy","r","fill","stroke","class"],rect:["x","y","width","height","fill","stroke","class"],i:["class"],span:["class"]},allowComments:!1})}})," "+t.label]}):t.label;return e.jsxs("div",{ref:m,id:o,className:`custom-select-wrapper ${E?"open":""} ${f?"is-invalid":""} ${p?"is-disabled":""} ${v}`,role:"combobox","aria-expanded":E,"aria-haspopup":"listbox","aria-disabled":p,onKeyDown:I,tabIndex:p?-1:0,children:[e.jsxs("div",{ref:g,className:"custom-select-trigger",onClick:H,onTouchStart:z,onTouchMove:T,children:[e.jsx("span",{className:"custom-select-label",children:V({label:$})}),e.jsx("button",{type:"button",className:"custom-select-clear-btn",onClick:q,style:{display:P?"flex":"none"},"aria-label":"Cancella selezione",disabled:p,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsx("span",{className:"custom-select-arrow","aria-hidden":"true",children:e.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:e.jsx("path",{d:"M1 1L6 6L11 1",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("div",{ref:w,className:"custom-select-dropdown",role:"listbox",children:e.jsx("div",{className:"custom-select-options",children:M.map((t,r)=>e.jsx("div",{className:`custom-select-option ${r===S?"focused":""} ${t.value===L?"selected":""}`,role:"option","aria-selected":t.value===L,"data-value":t.value,"data-index":r,onClick:()=>!p&&B(t.value),onMouseEnter:()=>E&&N(r),children:V(t)},t.value))})}),u&&e.jsx("div",{style:{display:"none"},children:u}),o&&!u&&e.jsx("select",{ref:j,id:o,style:{display:"none"},onChange:e=>{B(e.target.value)},disabled:p,children:M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})});o.displayName="CustomSelect";export{o as C};
