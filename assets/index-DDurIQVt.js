const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomePage-jTGqkUq1.js","assets/charts-feature-DjbKlvyw.js","assets/core-services-BI3G_WoH.js","assets/ui-vendor-CzXQDyZB.js","assets/react-vendor-DSd4Y30N.js","assets/supabase-D0iziRtU.js","assets/shared-BGQg7biK.js","assets/shared-DOcGBqNV.css","assets/charts-vendor-BWtMAC_w.js","assets/LoginPage-BHCWYjck.js","assets/patients-feature-C0OPiNhT.js","assets/events-feature-BaxCeh3a.js","assets/events-feature-VHXo9iQq.css","assets/patients-feature-CLkC1M1I.css","assets/DiagnosiPage-DLIgYvbe.js","assets/diagnoses-feature-CUy1qRPZ.js"])))=>i.map(i=>d[i]);
import{i as e,q as s,k as n,o as t,p as i,e as r,l as a,_ as o,d as l,u as c,r as d,t as m,v as u,w as p,x as h,y as f}from"./core-services-BI3G_WoH.js";import{j as x,r as g,R as j,Q as b,f as v}from"./charts-feature-DjbKlvyw.js";import{N as w,u as y,b as _,c as k,B as N,d as E,e as S}from"./react-vendor-DSd4Y30N.js";import{M as z,s as L,p as R,q as P,r as A}from"./shared-BGQg7biK.js";import"./ui-vendor-CzXQDyZB.js";import"./supabase-D0iziRtU.js";import"./charts-vendor-BWtMAC_w.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),s.credentials="use-credentials"===e.crossOrigin?"include":"anonymous"===e.crossOrigin?"omit":"same-origin",s}(e);fetch(e.href,s)}}();const O=({isOpen:s,onToggle:n,routes:t})=>{const{user:i}=e(),r=i?.ruolo??null,a=t.filter(e=>((e,s)=>!e.permissions||0===e.permissions.length||!!s&&e.permissions.includes(s))(e,r));return x.jsxs("aside",{className:"app-sidebar bg-dark text-white d-flex flex-column "+(s?"open":"collapsed"),"aria-hidden":s?"false":"true",children:[x.jsxs("div",{className:"d-flex align-items-center justify-content-between p-3 border-bottom border-dark",children:[x.jsx("span",{className:"fw-semibold text-uppercase small",children:"Navigazione"}),x.jsx("button",{type:"button",className:"btn btn-sm btn-outline-light d-inline-flex align-items-center",onClick:n,"aria-label":"Close sidebar",children:x.jsx("span",{className:"material-icons","aria-hidden":"true",children:"close"})})]}),x.jsx("nav",{"aria-label":"Primary navigation",className:"flex-grow-1 overflow-auto",children:x.jsx("ul",{className:"nav flex-column py-2",children:a.map(e=>x.jsx("li",{className:"nav-item",children:x.jsxs(w,{to:e.path,className:({isActive:e})=>["nav-link text-white d-flex align-items-center gap-2 px-3 py-2",e?"active fw-semibold bg-primary-subtle text-dark rounded-1":""].filter(Boolean).join(" "),onClick:n,children:[e.icon&&x.jsx("span",{className:"material-icons","aria-hidden":"true",children:e.icon}),x.jsx("span",{children:e.label})]})},e.path))})})]})},I=[{path:"/home",label:"Home",icon:"home",permissions:["admin","medico","infermiere","operatore","lettore"]},{path:"/inserimento",label:"Inserimento",icon:"note_add",permissions:["admin","medico","infermiere"]},{path:"/list",label:"Elenco pazienti",icon:"list",permissions:["admin","medico","infermiere","operatore","lettore"]},{path:"/dimissione",label:"Dimissioni",icon:"logout",permissions:["admin","medico","infermiere"]},{path:"/unified-charts",label:"Grafici",icon:"query_stats",permissions:["admin","medico","infermiere","operatore","lettore"]},{path:"/diagnosi",label:"Diagnosi",icon:"healing",permissions:["admin"]},{path:"/eventi-clinici",label:"Eventi clinici",icon:"medical_services",permissions:["admin","medico","infermiere"]}];function D(){const[e,s]=n(),[r,a]=g.useState(e);g.useEffect(()=>{const n=t();n!==e&&s(n)},[e,s]),g.useEffect(()=>{a(e)},[e]);const o=g.useCallback(()=>{const e="dark"===r?"light":"dark";s(e),i(e),a(e)},[r,s]),l="dark"===r?"Tema chiaro":"Tema scuro";return x.jsxs("button",{type:"button",className:"btn btn-outline-secondary d-flex align-items-center gap-1",onClick:o,"aria-label":l,title:l,children:[x.jsx("span",{className:"material-icons","aria-hidden":"true",children:"dark"===r?"light_mode":"dark_mode"}),x.jsx("span",{className:"visually-hidden",children:l})]})}function T(){const{isAuthenticated:s,session:n}=e(),t=y(),i=g.useCallback(async()=>{if(s&&n)try{await r(),t("/login")}catch(e){a.error("Logout failed",e)}else try{await L()}catch(e){a.error("Failed to show login modal",e)}},[s,n,t]),o=s?"Esci":"Accedi";return x.jsxs("button",{type:"button",className:"btn btn-outline-secondary d-flex align-items-center gap-1",onClick:i,children:[x.jsx("span",{className:"material-icons","aria-hidden":"true",children:s?"logout":"login"}),x.jsx("span",{children:o})]})}function C({routes:s,theme:n}){const{user:t}=e(),i=y(),r=g.useMemo(()=>t?t.ruolo??t.role??null:null,[t]),a=g.useMemo(()=>s.filter(e=>((e,s)=>!e.permissions||0===e.permissions.length||!!s&&e.permissions.includes(s))(e,r)),[s,r]),o=g.useCallback(e=>{i(e)},[i]),l="dark"===n?"text-secondary":"text-dark";return x.jsx("ul",{className:"nav nav-pills gap-1 flex-grow-1",children:a.map(e=>x.jsx("li",{className:"nav-item",children:x.jsxs(w,{to:e.path,className:({isActive:e})=>["nav-link d-flex align-items-center gap-1 px-3 py-1",e?"active fw-600":l].filter(Boolean).join(" "),onClick:s=>{s.preventDefault(),o(e.path)},children:[e.icon&&x.jsx("span",{className:"material-icons","aria-hidden":"true",children:e.icon}),x.jsx("span",{children:e.label})]})},e.path))})}function M(){const{user:s,isAuthenticated:n}=e();if(!n||!s)return null;const t=s.ruolo??s.role??"caricamento...";return x.jsxs("div",{className:"d-flex align-items-center gap-2",children:[x.jsxs("span",{className:"navbar-text text-secondary me-1",title:s.email||void 0,style:{fontSize:"0.9em"},children:[x.jsx("i",{className:"material-icons me-1",style:{fontSize:"1em",verticalAlign:"text-bottom"},children:"account_circle"}),s.email?.split("@")[0]||""]}),x.jsx("span",{className:"badge bg-info text-uppercase",style:{fontSize:"0.7em",padding:"0.3em 0.5em"},title:`Ruolo: ${t}`,children:t})]})}const V=({children:e,sidebar:t=!0,header:i=!0})=>{const[r,a]=s(),o=y(),[l]=n(),[c,d]=g.useState(()=>"undefined"!=typeof window&&window.matchMedia("(max-width: 767px)").matches);return g.useEffect(()=>{if("undefined"==typeof window)return;const e=window.matchMedia("(max-width: 767px)"),s=e=>d(e.matches);return d(e.matches),e.addEventListener("change",s),()=>{e.removeEventListener("change",s)}},[]),g.useEffect(()=>{if("undefined"!=typeof document)return document.body.classList.remove("mobile-filters-open"),document.body.style.removeProperty("overflow"),c?document.body.dataset.reactMobileNav="true":delete document.body.dataset.reactMobileNav,()=>{delete document.body.dataset.reactMobileNav,document.body.classList.remove("mobile-filters-open"),document.body.style.removeProperty("overflow")}},[c]),x.jsxs("div",{className:"app-shell d-flex min-vh-100",children:[t&&x.jsx(O,{isOpen:r,onToggle:a,routes:I}),x.jsxs("div",{className:"flex-grow-1 d-flex flex-column",style:{minHeight:0},children:[x.jsx("a",{className:"visually-hidden-focusable",href:"#main-content",children:"Salta al contenuto"}),i&&!c&&x.jsxs("header",{role:"banner",className:`navbar ${"dark"===l?"navbar-dark bg-dark":"navbar-light bg-light"} border-bottom d-flex flex-wrap align-items-center px-3 py-2 gap-3`,children:[x.jsxs("div",{className:"d-flex align-items-center gap-3 w-100",children:[t&&x.jsx("button",{type:"button",className:"btn btn-outline-primary d-inline-flex align-items-center d-lg-none",onClick:a,"aria-label":"Toggle sidebar",children:x.jsx("span",{className:"material-icons","aria-hidden":"true",children:"menu"})}),x.jsxs(w,{to:"/home",className:"navbar-brand mb-0 h5 text-decoration-none d-flex align-items-center flex-shrink-0",children:[x.jsx("img",{src:"/favicon.png",alt:"PatientTrack Logo",width:"48",height:"40",className:"d-inline-block align-text-top me-3 navbar-logo"}),x.jsx("span",{className:"d-none d-sm-inline",children:"PatientTrack"})]}),x.jsxs("div",{className:"d-flex align-items-center gap-2 ms-auto",children:[x.jsx(D,{}),x.jsx(T,{})]}),x.jsx(M,{})]}),x.jsx("nav",{className:"w-100 d-flex align-items-center gap-3",children:x.jsx(C,{routes:I,theme:l})})]}),i&&c&&x.jsx(z,{onNavigate:e=>o(e)}),x.jsx("main",{id:"main-content",role:"main",className:"flex-grow-1 p-3",style:c?{paddingTop:"5.5rem",overflowY:"auto",WebkitOverflowScrolling:"touch",minHeight:0,height:"100%"}:{minHeight:0},children:e})]})]})};const U=({children:s,allowedRoles:n=[],requireAuth:t=!0})=>{const{user:i,isAuthenticated:r}=e(),a=_(),o=function(){if("undefined"!=typeof window)return window.currentUser||null;return null}(),l=o&&(!(!(c=o.session)||"object"!=typeof c)&&"string"==typeof c.access_token&&"number"==typeof c.expires_at&&void 0!==c.user);var c;if(t&&!r&&!l)return x.jsx(k,{to:"/login",state:{from:a},replace:!0});let d=null;return i?d=i.role??null:o&&function(e){return!(!e||"object"!=typeof e)&&("string"==typeof e.id&&"string"==typeof e.email&&"string"==typeof e.role)}(o.profile)&&(d=o.profile.role??null),n.length>0&&d&&!n.includes(d)?x.jsx(k,{to:"/home",replace:!0}):x.jsx(x.Fragment,{children:s})};function H(){return x.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:x.jsx("div",{className:"spinner-border text-primary",role:"status",children:x.jsx("span",{className:"visually-hidden",children:"Caricamento in corso..."})})})}const B=g.lazy(()=>o(()=>import("./HomePage-jTGqkUq1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),q=g.lazy(()=>o(()=>import("./LoginPage-BHCWYjck.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))),F=g.lazy(()=>o(()=>import("./patients-feature-C0OPiNhT.js").then(e=>e.a),__vite__mapDeps([10,1,2,3,4,5,6,7,8,11,12,13]))),G=g.lazy(()=>o(()=>import("./patients-feature-C0OPiNhT.js").then(e=>e.b),__vite__mapDeps([10,1,2,3,4,5,6,7,8,11,12,13]))),J=g.lazy(()=>o(()=>import("./patients-feature-C0OPiNhT.js").then(e=>e.D),__vite__mapDeps([10,1,2,3,4,5,6,7,8,11,12,13]))),$=g.lazy(()=>o(()=>import("./charts-feature-DjbKlvyw.js").then(e=>e.i),__vite__mapDeps([1,2,3,4,5,6,7,8])).then(e=>({default:e.ChartsPage}))),Q=g.lazy(()=>o(()=>import("./DiagnosiPage-DLIgYvbe.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,15]))),K=g.lazy(()=>o(()=>import("./events-feature-BaxCeh3a.js").then(e=>e.E),__vite__mapDeps([11,2,3,1,6,4,7,8,5,10,13,12]))),W=g.lazy(()=>o(()=>import("./events-feature-BaxCeh3a.js").then(e=>e.b),__vite__mapDeps([11,2,3,1,6,4,7,8,5,10,13,12]))),Y=[{path:"/",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin","editor","viewer"],children:x.jsx(B,{})})})},{path:"/home",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin","editor","viewer"],children:x.jsx(B,{})})})},{path:"/login",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(q,{})})},{path:"/inserimento",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin","editor"],children:x.jsx(F,{})})})},{path:"/list",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin","editor","viewer"],children:x.jsx(G,{})})})},{path:"/dimissione",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin","editor"],children:x.jsx(J,{})})})},{path:"/unified-charts",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin","editor","viewer"],children:x.jsx($,{})})})},{path:"/diagnosi",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin"],children:x.jsx(Q,{})})})},{path:"/eventi-clinici",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin","editor"],children:x.jsx(K,{})})})},{path:"/eventi-clinici/nuovo",element:x.jsx(g.Suspense,{fallback:x.jsx(H,{}),children:x.jsx(U,{allowedRoles:["admin","editor"],children:x.jsx(W,{})})})},{path:"/grafico",element:x.jsx(k,{to:"/unified-charts",replace:!0})},{path:"/grafici-reparti",element:x.jsx(k,{to:"/unified-charts",replace:!0})},{path:"*",element:x.jsx(k,{to:"/home",replace:!0})}],Z=g.createContext(void 0);function X({children:e}){const[s,n]=g.useState({session:l.session,profile:l.profile,isLoading:l.isLoading});return g.useEffect(()=>{const e=()=>{n({session:l.session,profile:l.profile,isLoading:l.isLoading})};e();const s=setInterval(e,1e3);return()=>{clearInterval(s)}},[]),x.jsx(Z.Provider,{value:s,children:e})}function ee(){return x.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:x.jsx("div",{className:"spinner-border text-primary",role:"status",children:x.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}function se({error:e,resetError:s}){return x.jsx("div",{className:"container mt-5",children:x.jsxs("div",{className:"alert alert-danger",role:"alert",children:[x.jsx("h4",{className:"alert-heading",children:"Si √® verificato un errore"}),x.jsx("p",{children:e.message}),x.jsx("hr",{}),x.jsx("button",{className:"btn btn-primary",onClick:s,children:"Riprova"})]})})}class ne extends j.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){a.error("React Error Boundary caught error:",{error:e.message,stack:e.stack,componentStack:s.componentStack})}resetError=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError&&this.state.error?x.jsx(se,{error:this.state.error,resetError:this.resetError}):this.props.children}}function te(){const e=y();g.useEffect(()=>{d(e)},[e]);return E(Y)}function ie(){return g.useEffect(()=>(a.log("üöÄ React App mounted"),()=>{a.log("üëã React App unmounted")}),[]),g.useEffect(()=>{const e=()=>{const{setUser:e,setSession:s}=c.getState();if(l.profile&&l.session){const n={id:l.profile.id,email:l.profile.email||"",role:l.profile.role,full_name:l.profile.full_name,username:l.profile.username},t={access_token:l.session.access_token,refresh_token:l.session.refresh_token,expires_at:l.session.expires_at||0,expires_in:l.session.expires_in,token_type:l.session.token_type,user:n};e(n),s(t),a.log("‚úÖ Zustand store sincronizzato con currentUser")}else e(null),s(null)};return e(),window.addEventListener("auth:session-changed",e),window.addEventListener("auth-profile-loaded",e),()=>{window.removeEventListener("auth:session-changed",e),window.removeEventListener("auth-profile-loaded",e)}},[]),x.jsx(ne,{children:x.jsx(X,{children:x.jsx(N,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:x.jsx(g.Suspense,{fallback:x.jsx(ee,{}),children:x.jsx(V,{children:x.jsx(te,{})})})})})})}const re=new b,ae=!1;ae,window.currentUser=l,window.addEventListener("error",e=>{const s={timestamp:(new Date).toISOString(),context:"GLOBAL_ERROR",message:e.error?.message||e.message||"Unknown global error",filename:e.filename||"Unknown file",lineno:e.lineno||"Unknown line",colno:e.colno||"Unknown column",stack:e.error?.stack||"No stack trace",env:"production",url:window.location.href};try{const e=JSON.parse(localStorage.getItem("auth_errors")||"[]");e.push(s),e.length>10&&e.shift(),localStorage.setItem("auth_errors",JSON.stringify(e)),window.lastGlobalError=s,a.warn("üêõ Global error persisted:",s.message)}catch(n){a.warn("Failed to persist global error")}}),window.addEventListener("unhandledrejection",e=>{const s={timestamp:(new Date).toISOString(),context:"UNHANDLED_PROMISE",message:e.reason?.message||e.reason||"Unknown promise rejection",stack:e.reason?.stack||"No stack trace",env:"production",url:window.location.href};try{const e=JSON.parse(localStorage.getItem("auth_errors")||"[]");e.push(s),e.length>10&&e.shift(),localStorage.setItem("auth_errors",JSON.stringify(e)),window.lastPromiseError=s,a.warn("üêõ Promise rejection persisted:",s.message)}catch(n){a.warn("Failed to persist promise error")}}),window.addEventListener("load",async function(){try{a.log(`üöÄ Inizializzazione ${m.APP_NAME} v${m.APP_VERSION} (React)`),u(),p(),h(),R(),await f(e=>{a.log("‚úÖ Autenticazione inizializzata",e?"con sessione":"senza sessione")}),P(),a.log("‚úÖ Auth event listeners inizializzati");const e=document.getElementById("app");if(!e)throw new Error("Root element #app not found");const s=S.createRoot(e);j.lazy(()=>o(()=>import("./index-BXAdmnwS.js"),[]).then(e=>({default:e.ReactQueryDevtools})));s.render(x.jsx(j.StrictMode,{children:x.jsxs(v,{client:re,children:[x.jsx(ie,{}),!1]})})),a.log("‚úÖ React App montata con successo")}catch(e){a.error("‚ùå Errore durante l'inizializzazione dell'applicazione:",e),document.body.innerHTML=A('\n      <div class="container mt-5">\n        <div class="alert alert-danger" role="alert">\n          <h4 class="alert-heading">Errore di inizializzazione</h4>\n          <p>Si √® verificato un errore durante l\'avvio dell\'applicazione.</p>\n          \n          <hr>\n          <p class="mb-0">Ricarica la pagina per riprovare.</p>\n        </div>\n      </div>\n    ')}});
