const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ConfirmModal-xsmCRdjH.js","assets/index-WhCY3KaB.js","assets/supabase-AmyKTmiY.js","assets/vendor-BU6HxVpN.js","assets/index-DnXjdcoU.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-AmyKTmiY.js";import{s as t,n}from"./index-WhCY3KaB.js";import"./vendor-BU6HxVpN.js";const a={get tableBody(){return document.getElementById("diagnosi-table-body")},get form(){return document.getElementById("diagnosi-form")},get input(){return document.getElementById("diagnosi-name")},get saveButton(){return document.getElementById("save-diagnosi-btn")}};function i(e,t){switch(t){case"success":n.success(e);break;case"error":n.error(e);break;case"warning":n.warning(e);break;default:n.info(e)}}let o=null;async function s(){try{!function(e){if(a.tableBody.innerHTML="",0===e.length){const e=a.tableBody.insertRow(),t=document.createElement("td");return t.colSpan=2,t.className="text-center",t.textContent="Nessuna diagnosi trovata.",e.appendChild(t),void 0}e.forEach(e=>{const t=a.tableBody.insertRow(),n=document.createElement("td");n.setAttribute("data-label","Nome Diagnosi"),n.textContent=e.nome,t.appendChild(n);const i=document.createElement("td");i.setAttribute("data-label","Azioni"),i.className="text-end";const o=document.createElement("button");o.className="btn btn-sm btn-warning edit-btn",o.setAttribute("data-id",e.id),o.setAttribute("data-name",e.nome),o.title="Modifica diagnosi",o.innerHTML='<span class="material-icons">edit</span>',i.appendChild(o);const s=document.createElement("button");s.className="btn btn-sm btn-danger delete-btn",s.setAttribute("data-id",e.id),s.title="Elimina diagnosi",s.innerHTML='<span class="material-icons">delete</span>',i.appendChild(s),t.appendChild(i)})}(await async function(){const{data:e,error:n}=await t.from("diagnosi").select("id, nome").order("nome",{ascending:!0});if(n)throw console.error("Errore caricamento diagnosi:",n),new Error("Impossibile caricare le diagnosi.");return e||[]}())}catch(e){i(e.message,"error")}}async function r(e){e.preventDefault();const n=a.input.value.trim();if(!n)return i("Il nome della diagnosi non pu√≤ essere vuoto.","error"),void 0;try{await async function(e,n){let a;if(a=e?await t.from("diagnosi").update({nome:n}).eq("id",e).select().single():await t.from("diagnosi").insert({nome:n}).select().single(),a.error)throw console.error("Errore salvataggio diagnosi:",a.error),new Error("Impossibile salvare la diagnosi.");return a.data}(o,n);i(`Diagnosi ${o?"aggiornata":"aggiunta"} con successo!`,"success"),a.form.reset(),a.saveButton.innerHTML='<span class="material-icons">add</span> Aggiungi Diagnosi',o=null,await s()}catch(r){i(r.message,"error")}}async function c(n){const{ConfirmModal:a}=await e(async()=>{const{ConfirmModal:e}=await import("./ConfirmModal-xsmCRdjH.js");return{ConfirmModal:e}},__vite__mapDeps([0,1,2,3,4])),o=a.forDiagnosisDeletion();if(await o.show())try{await async function(e){const{error:n}=await t.from("diagnosi").delete().eq("id",e);if(n)throw console.error("Errore eliminazione diagnosi:",n),new Error("Impossibile eliminare la diagnosi.")}(n),i("Diagnosi eliminata con successo!","success"),await s()}catch(r){i(r.message,"error")}}function d(e){const t=e.target.closest("button");if(!t)return;const n=t.dataset.id;t.classList.contains("edit-btn")?(o=n,a.input.value=t.dataset.name,a.saveButton.innerHTML='<span class="material-icons">edit</span> Aggiorna',a.input.focus()):t.classList.contains("delete-btn")&&c(n)}async function l(){return a.form.addEventListener("submit",r),a.tableBody.addEventListener("click",d),await s(),()=>{}}export{l as initDiagnosiView};
