import{s as e,l as r}from"./index-B1r4MkiZ.js";const i=new class{async getAll(){try{const{data:i,error:o}=await e.from("codice_clinica").select("*").eq("attivo",!0).order("codice");if(o)throw r.error("Errore nel recupero codici clinica:",o),o;return i||[]}catch(i){throw r.error("Errore nel servizio codici clinica:",i),i}}async getById(i){try{const{data:o,error:c}=await e.from("codice_clinica").select("*").eq("id",i).single();if(c)throw r.error("Errore nel recupero codice clinica:",c),c;return o}catch(o){throw r.error("Errore nel servizio codice clinica:",o),o}}async getByCodice(i){try{const{data:o,error:c}=await e.from("codice_clinica").select("*").eq("codice",i).eq("attivo",!0).single();if(c)throw r.error("Errore nel recupero codice clinica:",c),c;return o}catch(o){throw r.error("Errore nel servizio codice clinica:",o),o}}};const o=new class{async getAll(){try{const{data:i,error:o}=await e.from("codici_dimissione").select("*").eq("attivo",!0).order("codice");if(o)throw r.error("Errore nel recupero codici dimissione:",o),o;return i||[]}catch(i){throw r.error("Errore nel servizio codici dimissione:",i),i}}async getById(i){try{const{data:o,error:c}=await e.from("codici_dimissione").select("*").eq("id",i).single();if(c)throw r.error("Errore nel recupero codice dimissione:",c),c;return o}catch(o){throw r.error("Errore nel servizio codice dimissione:",o),o}}async getByCodice(i){try{const{data:o,error:c}=await e.from("codici_dimissione").select("*").eq("codice",i).eq("attivo",!0).single();if(c)throw r.error("Errore nel recupero codice dimissione:",c),c;return o}catch(o){throw r.error("Errore nel servizio codice dimissione:",o),o}}};const c=new class{async getAll(i=null){try{let o=e.from("reparti").select("*").eq("attivo",!0).order("nome");i&&(o=o.eq("tipo",i));const{data:c,error:t}=await o;if(t)throw r.error("Errore nel recupero reparti:",t),t;return c||[]}catch(o){throw r.error("Errore nel servizio reparti:",o),o}}async getRepartiInterni(){return this.getAll("interno")}async getById(i){try{const{data:o,error:c}=await e.from("reparti").select("*").eq("id",i).single();if(c)throw r.error("Errore nel recupero reparto:",c),c;return o}catch(o){throw r.error("Errore nel servizio reparto:",o),o}}async getByNome(i){try{const{data:o,error:c}=await e.from("reparti").select("*").eq("nome",i).eq("attivo",!0).single();if(c)throw r.error("Errore nel recupero reparto:",c),c;return o}catch(o){throw r.error("Errore nel servizio reparto:",o),o}}};const t=new class{constructor(){this.cache={codiciDimissione:null,reparti:null,cliniche:null,lastUpdate:null},this.cacheTimeout=3e5}isCacheValid(){return this.cache.lastUpdate&&Date.now()-this.cache.lastUpdate<this.cacheTimeout}async loadAll(e=!1){try{if(!e&&this.isCacheValid())return{codiciDimissione:this.cache.codiciDimissione,reparti:this.cache.reparti,cliniche:this.cache.cliniche};r.info("Caricamento dati di lookup...");const[t,a,n]=await Promise.all([o.getAll(),c.getAll(),i.getAll()]);return this.cache={codiciDimissione:t,reparti:a,cliniche:n,lastUpdate:Date.now()},r.info("Dati di lookup caricati con successo"),{codiciDimissione:t,reparti:a,cliniche:n}}catch(t){throw r.error("Errore nel caricamento dati di lookup:",t),t}}async populateCodiciDimissioneSelect(e,i=null){try{const{codiciDimissione:r}=await this.loadAll(),o=e.querySelector('option[value=""]');e.innerHTML="",o&&e.appendChild(o),r.forEach(r=>{const o=document.createElement("option");o.value=r.id,o.textContent=`${r.codice} - ${r.descrizione}`,o.dataset.codice=r.codice,!i||i!=r.id&&i!=r.codice||(o.selected=!0),e.appendChild(o)}),e.dispatchEvent(new Event("change"))}catch(o){r.error("Errore nel popolare select codici dimissione:",o)}}async populateRepartiSelect(e,i=null,o="interno"){try{const r=o?await c.getAll(o):(await this.loadAll()).reparti,t=e.querySelector('option[value=""]');e.innerHTML="",t&&e.appendChild(t),r.forEach(r=>{const o=document.createElement("option");o.value=r.id,o.textContent=r.nome,o.dataset.nome=r.nome,!i||i!=r.id&&i!=r.nome||(o.selected=!0),e.appendChild(o)}),e.dispatchEvent(new Event("change"))}catch(t){r.error("Errore nel popolare select reparti:",t)}}async populateClinicheSelect(e,i=null){try{const{cliniche:r}=await this.loadAll(),o=e.querySelector('option[value=""]');e.innerHTML="",o&&e.appendChild(o),r.forEach(r=>{const o=document.createElement("option");o.value=r.id,o.textContent=`${r.codice} - ${r.nome}`,o.dataset.codice=r.codice,!i||i!=r.id&&i!=r.codice||(o.selected=!0),e.appendChild(o)}),e.dispatchEvent(new Event("change"))}catch(o){r.error("Errore nel popolare select cliniche:",o)}}invalidateCache(){this.cache={codiciDimissione:null,reparti:null,cliniche:null,lastUpdate:null}}};export{i as a,o as c,t as l,c as r};
