import{a as e}from"./index-C6xyUC8G.js";import t from"./CustomDatepicker-6By5cdaM.js";import{Modal as a}from"./vendor-BU6HxVpN.js";import"./supabase-AmyKTmiY.js";import"./utils-BtSsRyB2.js";class n{constructor(e={}){this.options={eventoId:null,title:"Risolvi Infezione",defaultDate:new Date,minDate:e.minDate?new Date(e.minDate):null,...e},this.modalId=`resolve-infection-modal-${Date.now()}`,this.datepickerInstance=null}show(){return new Promise(e=>{const n=this.render();document.body.insertAdjacentHTML("beforeend",n);const o=document.getElementById(this.modalId),s=o.querySelector("form"),i=new a(o);this.datepickerInstance=new t(`#${this.modalId} [data-datepicker]`,{defaultDate:this.options.defaultDate,minDate:this.options.minDate,maxDate:"today"});s.addEventListener("submit",t=>{t.preventDefault();const a=this.datepickerInstance.instances[0]?.selectedDates[0],n=a?a.toISOString().split("T")[0]:null;if(!n)return this.showError("La data di risoluzione è obbligatoria."),void 0;this._defocus(o),i.hide(),e(n)}),o.addEventListener("hide.bs.modal",()=>{this._defocus(o)}),o.addEventListener("hidden.bs.modal",()=>{this.datepickerInstance&&this.datepickerInstance.destroy(),o.remove(),e(null)}),i.show()})}render(){return`\n            <div class="modal fade" id="${this.modalId}" tabindex="-1" aria-labelledby="resolveModalLabel" aria-hidden="true">\n                <div class="modal-dialog modal-dialog-centered">\n                    <div class="modal-content">\n                        <form>\n                            <div class="modal-header">\n                                <h5 class="modal-title" id="resolveModalLabel">${this.options.title}</h5>\n                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                            </div>\n                            <div class="modal-body">\n                                <p>Inserisci la data in cui l'infezione è stata risolta.</p>\n                                <label for="data_fine_evento" class="form-label">Data Risoluzione</label>\n                                <div class="input-group-icon">\n                                    <input type="text" class="form-control" id="data_fine_evento" name="data_fine_evento" data-datepicker placeholder="gg/mm/aaaa" required>\n                                    <span class="material-icons input-icon">calendar_today</span>\n                                </div>\n                                <div id="resolve-modal-message-container" class="mt-2 text-danger small"></div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>\n                                <button type="submit" class="btn btn-primary">Salva Risoluzione</button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        `}_defocus(e){try{const t=document.activeElement;t&&e.contains(t)&&"function"==typeof t.blur&&t.blur()}catch{}}showError(t){const a=document.getElementById("resolve-modal-message-container");a&&(a.innerHTML=e(t))}clearError(){this.showError("")}}export{n as ResolveInfectionModal};
