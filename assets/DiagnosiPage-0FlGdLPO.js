import{j as e}from"./ui-vendor-S6RcKJ66.js";import{u as a,b as s}from"./react-vendor-Bp2pLdQf.js";import{n as i,a as n}from"./notificationErrorHandler-Mip4TmJ6.js";import{b as t,l as r}from"./index-Bw9wUZ85.js";import"./supabase-Zkii_ZbW.js";const o=()=>{const o=a(),[l,c]=s.useState([]),[d,m]=s.useState(!0),[g,u]=s.useState({nome:""}),[h,b]=s.useState(null),[x,p]=s.useState(!1);s.useEffect(()=>{j()},[]);const j=async()=>{try{m(!0);const e=await async function(){const{data:e,error:a}=await t.from("diagnosi").select("id, nome").order("nome",{ascending:!0});if(a)throw r.error("Errore caricamento diagnosi:",a),new Error("Impossibile caricare le diagnosi.");return e||[]}();c(e)}catch(e){const a=e instanceof Error?e.message:"Impossibile caricare le diagnosi.";i(a)}finally{m(!1)}},f=async e=>{if(window.confirm(`Sei sicuro di voler eliminare la diagnosi "${e.nome}"?`))try{await async function(e){const a="string"==typeof e?parseInt(e,10):e,{error:s}=await t.from("diagnosi").delete().eq("id",a);if(s)throw r.error("Errore eliminazione diagnosi:",s),new Error("Impossibile eliminare la diagnosi.")}(e.id),n("Diagnosi eliminata con successo!"),await j()}catch(a){const e=a instanceof Error?a.message:"Impossibile eliminare la diagnosi.";i(e)}};return e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsxs("h3",{className:"mb-0",children:[e.jsx("span",{className:"material-icons me-2",style:{verticalAlign:"text-bottom"},children:"medical_information"}),"Gestione Diagnosi"]}),e.jsxs("button",{className:"btn btn-back-menu btn-sm",onClick:()=>o("/#/home"),children:[e.jsx("span",{className:"material-icons me-1",style:{verticalAlign:"text-bottom"},children:"arrow_back"}),"Torna al Menu"]})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("form",{onSubmit:async e=>{e.preventDefault();const a=g.nome.trim();if(!a)return i("Il nome della diagnosi non puÃ² essere vuoto."),void 0;p(!0);try{await async function(e,a){let s;if(e){const i="string"==typeof e?parseInt(e,10):e;s=await t.from("diagnosi").update({nome:a}).eq("id",i).select().single()}else s=await t.from("diagnosi").insert({nome:a}).select().single();if(s.error)throw r.error("Errore salvataggio diagnosi:",s.error),new Error("Impossibile salvare la diagnosi.");return s.data}(h,a);n(`Diagnosi ${h?"aggiornata":"aggiunta"} con successo!`),u({nome:""}),b(null),await j()}catch(s){const e=s instanceof Error?s.message:"Impossibile salvare la diagnosi.";i(e)}finally{p(!1)}},className:"mb-4 modern-form",children:e.jsxs("div",{className:"diagnosi-form-container d-flex gap-2",children:[e.jsx("input",{type:"text",id:"diagnosi-name-input",className:"form-control",placeholder:"Nome nuova diagnosi",value:g.nome,onChange:e=>u({nome:e.target.value}),required:!0,disabled:x}),e.jsxs("div",{className:"d-flex gap-2",children:[h&&e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>{u({nome:""}),b(null)},disabled:x,children:[e.jsx("span",{className:"material-icons",children:"cancel"}),"Annulla"]}),e.jsxs("button",{type:"submit",className:"btn btn-primary",disabled:x||!g.nome.trim(),children:[e.jsx("span",{className:"material-icons",children:h?"edit":"add"}),e.jsx("span",{children:h?"Aggiorna":"Aggiungi Diagnosi"})]})]})]})}),e.jsx("div",{className:"table-responsive",children:d?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Caricamento..."})})}):0===l.length?e.jsx("div",{className:"text-center py-5",children:e.jsx("p",{className:"text-muted mb-0",children:"Nessuna diagnosi trovata."})}):e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome Diagnosi"}),e.jsx("th",{className:"text-end",children:"Azioni"})]})}),e.jsx("tbody",{children:l.map(a=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Nome Diagnosi",children:a.nome}),e.jsxs("td",{"data-label":"Azioni",className:"text-end",children:[e.jsx("button",{className:"btn btn-sm btn-warning me-2",onClick:()=>(e=>{u({nome:e.nome}),b(e.id),setTimeout(()=>{const e=document.getElementById("diagnosi-name-input");e&&e.focus()},100)})(a),title:"Modifica diagnosi",children:e.jsx("span",{className:"material-icons",children:"edit"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>f(a),title:"Elimina diagnosi",children:e.jsx("span",{className:"material-icons",children:"delete"})})]})]},a.id))})]})})]})]})})};export{o as DiagnosiPage,o as default};
