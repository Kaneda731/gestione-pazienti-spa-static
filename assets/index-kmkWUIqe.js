const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/form-DBj6nFds.js","assets/supabase-AmyKTmiY.js","assets/infectionDataManager-ROCKD2qw.js","assets/ResolveInfectionModal-XlAp_Oxk.js","assets/CustomDatepicker-6By5cdaM.js","assets/utils-BtSsRyB2.js","assets/vendor-BU6HxVpN.js","assets/post-operative-calculator-C3z7C_vm.js","assets/CustomSelect-CrgYxVDy.js","assets/surgeryDataManager-CbtGeuzn.js","assets/lookupService-OKfLbxYh.js","assets/dimissione-BRocebjT.js","assets/patientService-DL4qIFol.js","assets/PatientAutocomplete-CioXZbxx.js","assets/formatting-C7G90sDQ.js","assets/grafico-35dZt1W1.js","assets/helpers-x6jexb_e.js","assets/chartjsService-eCPZngdw.js","assets/list-CEoPZFWf.js","assets/diagnosi-_ZueX3-a.js","assets/eventi-clinici-BGyAJeQK.js"])))=>i.map(i=>d[i]);
import{Dropdown as e,Collapse as t,Modal as i}from"./vendor-BU6HxVpN.js";import{_ as n,c as r}from"./supabase-AmyKTmiY.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),t.credentials="use-credentials"===e.crossOrigin?"include":"anonymous"===e.crossOrigin?"omit":"same-origin",t}(e);fetch(e.href,t)}}(),"undefined"!=typeof window&&(window.bootstrap={Modal:i,Collapse:t,Dropdown:e}),"undefined"!=typeof window&&(window.EMERGENCY_STOP=function(){console.log("üö® EMERGENCY STOP ACTIVATED");try{window.notificationService&&(window.notificationService.timers?.forEach(e=>clearTimeout(e)),window.notificationService.timers?.clear(),window.notificationService.emergencyReset&&window.notificationService.emergencyReset()),window.stateService&&window.stateService.subscribers?.clear()}catch(e){console.error("‚ùå Emergency stop failed:",e)}},window.EMERGENCY_RELOAD=function(){console.log("üîÑ Emergency reload..."),location.reload()});const{entries:o,setPrototypeOf:a,isFrozen:s,getPrototypeOf:c,getOwnPropertyDescriptor:l}=Object;let{freeze:d,seal:u,create:h}=Object,{apply:p,construct:g}="undefined"!=typeof Reflect&&Reflect;d||(d=function(e){return e}),u||(u=function(e){return e}),p||(p=function(e,t,i){return e.apply(t,i)}),g||(g=function(e,t){return new e(...t)});const m=x(Array.prototype.forEach),f=x(Array.prototype.lastIndexOf),y=x(Array.prototype.pop),b=x(Array.prototype.push),v=x(Array.prototype.splice),w=x(String.prototype.toLowerCase),E=x(String.prototype.toString),S=x(String.prototype.match),_=x(String.prototype.replace),C=x(String.prototype.indexOf),T=x(String.prototype.trim),A=x(Object.prototype.hasOwnProperty),L=x(RegExp.prototype.test),z=(k=TypeError,function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return g(k,t)});var k;function x(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return p(e,t,n)}}function N(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w;a&&a(e,null);let n=t.length;for(;n--;){let r=t[n];if("string"==typeof r){const e=i(r);e!==r&&(s(t)||(t[n]=e),r=e)}e[r]=!0}return e}function D(e){for(let t=0;t<e.length;t++){A(e,t)||(e[t]=null)}return e}function O(e){const t=h(null);for(const[i,n]of o(e)){A(e,i)&&(t[i]=Array.isArray(n)?D(n):n&&"object"==typeof n&&n.constructor===Object?O(n):n)}return t}function I(e,t){for(;null!==e;){const i=l(e,t);if(i){if(i.get)return x(i.get);if("function"==typeof i.value)return x(i.value)}e=c(e)}return function(){return null}}const M=d(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),R=d(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),P=d(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),$=d(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),F=d(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),j=d(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),B=d(["#text"]),U=d(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),V=d(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),H=d(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),q=d(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),G=u(/\{\{[\w\W]*|[\w\W]*\}\}/gm),W=u(/<%[\w\W]*|[\w\W]*%>/gm),Q=u(/\$\{[\w\W]*/gm),J=u(/^data-[\-\w.\u00B7-\uFFFF]+$/),Y=u(/^aria-[\-\w]+$/),X=u(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),K=u(/^(?:\w+script|data):/i),Z=u(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ee=u(/^html$/i),te=u(/^[a-z][.\w]*(-[.\w]+)+$/i);var ie=Object.freeze({__proto__:null,ARIA_ATTR:Y,ATTR_WHITESPACE:Z,CUSTOM_ELEMENT:te,DATA_ATTR:J,DOCTYPE_NAME:ee,ERB_EXPR:W,IS_ALLOWED_URI:X,IS_SCRIPT_OR_DATA:K,MUSTACHE_EXPR:G,TMPLIT_EXPR:Q});const ne=1,re=3,oe=7,ae=8,se=9;var ce=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const i=t=>e(t);if(i.version="3.2.6",i.removed=[],!t||!t.document||t.document.nodeType!==se||!t.Element)return i.isSupported=!1,i;let{document:n}=t;const r=n,a=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:c,Node:l,Element:u,NodeFilter:p,NamedNodeMap:g=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:k,DOMParser:x,trustedTypes:D}=t,G=u.prototype,W=I(G,"cloneNode"),Q=I(G,"remove"),J=I(G,"nextSibling"),Y=I(G,"childNodes"),K=I(G,"parentNode");if("function"==typeof c){const e=n.createElement("template");e.content&&e.content.ownerDocument&&(n=e.content.ownerDocument)}let Z,te="";const{implementation:ce,createNodeIterator:le,createDocumentFragment:de,getElementsByTagName:ue}=n,{importNode:he}=r;let pe={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};i.isSupported="function"==typeof o&&"function"==typeof K&&ce&&void 0!==ce.createHTMLDocument;const{MUSTACHE_EXPR:ge,ERB_EXPR:me,TMPLIT_EXPR:fe,DATA_ATTR:ye,ARIA_ATTR:be,IS_SCRIPT_OR_DATA:ve,ATTR_WHITESPACE:we,CUSTOM_ELEMENT:Ee}=ie;let{IS_ALLOWED_URI:Se}=ie,_e=null;const Ce=N({},[...M,...R,...P,...F,...B]);let Te=null;const Ae=N({},[...U,...V,...H,...q]);let Le=Object.seal(h(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ze=null,ke=null,xe=!0,Ne=!0,De=!1,Oe=!0,Ie=!1,Me=!0,Re=!1,Pe=!1,$e=!1,Fe=!1,je=!1,Be=!1,Ue=!0,Ve=!1,He=!0,qe=!1,Ge={},We=null;const Qe=N({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Je=null;const Ye=N({},["audio","video","img","source","image","track"]);let Xe=null;const Ke=N({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ze="http://www.w3.org/1998/Math/MathML",et="http://www.w3.org/2000/svg",tt="http://www.w3.org/1999/xhtml";let it=tt,nt=!1,rt=null;const ot=N({},[Ze,et,tt],E);let at=N({},["mi","mo","mn","ms","mtext"]),st=N({},["annotation-xml"]);const ct=N({},["title","style","font","a","script"]);let lt=null;const dt=["application/xhtml+xml","text/html"];let ut=null,ht=null;const pt=n.createElement("form"),gt=function(e){return e instanceof RegExp||e instanceof Function},mt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ht||ht!==e){if(e&&"object"==typeof e||(e={}),e=O(e),lt=-1===dt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,ut="application/xhtml+xml"===lt?E:w,_e=A(e,"ALLOWED_TAGS")?N({},e.ALLOWED_TAGS,ut):Ce,Te=A(e,"ALLOWED_ATTR")?N({},e.ALLOWED_ATTR,ut):Ae,rt=A(e,"ALLOWED_NAMESPACES")?N({},e.ALLOWED_NAMESPACES,E):ot,Xe=A(e,"ADD_URI_SAFE_ATTR")?N(O(Ke),e.ADD_URI_SAFE_ATTR,ut):Ke,Je=A(e,"ADD_DATA_URI_TAGS")?N(O(Ye),e.ADD_DATA_URI_TAGS,ut):Ye,We=A(e,"FORBID_CONTENTS")?N({},e.FORBID_CONTENTS,ut):Qe,ze=A(e,"FORBID_TAGS")?N({},e.FORBID_TAGS,ut):O({}),ke=A(e,"FORBID_ATTR")?N({},e.FORBID_ATTR,ut):O({}),Ge=!!A(e,"USE_PROFILES")&&e.USE_PROFILES,xe=!1!==e.ALLOW_ARIA_ATTR,Ne=!1!==e.ALLOW_DATA_ATTR,De=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Oe=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Ie=e.SAFE_FOR_TEMPLATES||!1,Me=!1!==e.SAFE_FOR_XML,Re=e.WHOLE_DOCUMENT||!1,Fe=e.RETURN_DOM||!1,je=e.RETURN_DOM_FRAGMENT||!1,Be=e.RETURN_TRUSTED_TYPE||!1,$e=e.FORCE_BODY||!1,Ue=!1!==e.SANITIZE_DOM,Ve=e.SANITIZE_NAMED_PROPS||!1,He=!1!==e.KEEP_CONTENT,qe=e.IN_PLACE||!1,Se=e.ALLOWED_URI_REGEXP||X,it=e.NAMESPACE||tt,at=e.MATHML_TEXT_INTEGRATION_POINTS||at,st=e.HTML_INTEGRATION_POINTS||st,Le=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&gt(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Le.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&gt(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Le.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Le.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ie&&(Ne=!1),je&&(Fe=!0),Ge&&(_e=N({},B),Te=[],!0===Ge.html&&(N(_e,M),N(Te,U)),!0===Ge.svg&&(N(_e,R),N(Te,V),N(Te,q)),!0===Ge.svgFilters&&(N(_e,P),N(Te,V),N(Te,q)),!0===Ge.mathMl&&(N(_e,F),N(Te,H),N(Te,q))),e.ADD_TAGS&&(_e===Ce&&(_e=O(_e)),N(_e,e.ADD_TAGS,ut)),e.ADD_ATTR&&(Te===Ae&&(Te=O(Te)),N(Te,e.ADD_ATTR,ut)),e.ADD_URI_SAFE_ATTR&&N(Xe,e.ADD_URI_SAFE_ATTR,ut),e.FORBID_CONTENTS&&(We===Qe&&(We=O(We)),N(We,e.FORBID_CONTENTS,ut)),He&&(_e["#text"]=!0),Re&&N(_e,["html","head","body"]),_e.table&&(N(_e,["tbody"]),delete ze.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw z('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw z('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');Z=e.TRUSTED_TYPES_POLICY,te=Z.createHTML("")}else void 0===Z&&(Z=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let i=null;const n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(i=t.getAttribute(n));const r="dompurify"+(i?"#"+i:"");try{return e.createPolicy(r,{createHTML:e=>e,createScriptURL:e=>e})}catch(o){return console.warn("TrustedTypes policy "+r+" could not be created."),null}}(D,a)),null!==Z&&"string"==typeof te&&(te=Z.createHTML(""));d&&d(e),ht=e}},ft=N({},[...R,...P,...$]),yt=N({},[...F,...j]),bt=function(e){b(i.removed,{element:e});try{K(e).removeChild(e)}catch(t){Q(e)}},vt=function(e,t){try{b(i.removed,{attribute:t.getAttributeNode(e),from:t})}catch(n){b(i.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(Fe||je)try{bt(t)}catch(n){}else try{t.setAttribute(e,"")}catch(n){}},wt=function(e){let t=null,i=null;if($e)e="<remove></remove>"+e;else{const t=S(e,/^[\r\n\t ]+/);i=t&&t[0]}"application/xhtml+xml"===lt&&it===tt&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const r=Z?Z.createHTML(e):e;if(it===tt)try{t=(new x).parseFromString(r,lt)}catch(a){}if(!t||!t.documentElement){t=ce.createDocument(it,"template",null);try{t.documentElement.innerHTML=nt?te:r}catch(a){}}const o=t.body||t.documentElement;return e&&i&&o.insertBefore(n.createTextNode(i),o.childNodes[0]||null),it===tt?ue.call(t,Re?"html":"body")[0]:Re?t.documentElement:o},Et=function(e){return le.call(e.ownerDocument||e,e,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},St=function(e){return e instanceof k&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof g)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},_t=function(e){return"function"==typeof l&&e instanceof l};function Ct(e,t,n){m(e,e=>{e.call(i,t,n,ht)})}const Tt=function(e){let t=null;if(Ct(pe.beforeSanitizeElements,e,null),St(e))return bt(e),!0;const n=ut(e.nodeName);if(Ct(pe.uponSanitizeElement,e,{tagName:n,allowedTags:_e}),Me&&e.hasChildNodes()&&!_t(e.firstElementChild)&&L(/<[/\w!]/g,e.innerHTML)&&L(/<[/\w!]/g,e.textContent))return bt(e),!0;if(e.nodeType===oe)return bt(e),!0;if(Me&&e.nodeType===ae&&L(/<[/\w]/g,e.data))return bt(e),!0;if(!_e[n]||ze[n]){if(!ze[n]&&Lt(n)){if(Le.tagNameCheck instanceof RegExp&&L(Le.tagNameCheck,n))return!1;if(Le.tagNameCheck instanceof Function&&Le.tagNameCheck(n))return!1}if(He&&!We[n]){const t=K(e)||e.parentNode,i=Y(e)||e.childNodes;if(i&&t){for(let n=i.length-1;n>=0;--n){const r=W(i[n],!0);r.__removalCount=(e.__removalCount||0)+1,t.insertBefore(r,J(e))}}}return bt(e),!0}return e instanceof u&&!function(e){let t=K(e);t&&t.tagName||(t={namespaceURI:it,tagName:"template"});const i=w(e.tagName),n=w(t.tagName);return!!rt[e.namespaceURI]&&(e.namespaceURI===et?t.namespaceURI===tt?"svg"===i:t.namespaceURI===Ze?"svg"===i&&("annotation-xml"===n||at[n]):Boolean(ft[i]):e.namespaceURI===Ze?t.namespaceURI===tt?"math"===i:t.namespaceURI===et?"math"===i&&st[n]:Boolean(yt[i]):e.namespaceURI===tt?!(t.namespaceURI===et&&!st[n])&&!(t.namespaceURI===Ze&&!at[n])&&!yt[i]&&(ct[i]||!ft[i]):!("application/xhtml+xml"!==lt||!rt[e.namespaceURI]))}(e)?(bt(e),!0):"noscript"!==n&&"noembed"!==n&&"noframes"!==n||!L(/<\/no(script|embed|frames)/i,e.innerHTML)?(Ie&&e.nodeType===re&&(t=e.textContent,m([ge,me,fe],e=>{t=_(t,e," ")}),e.textContent!==t&&(b(i.removed,{element:e.cloneNode()}),e.textContent=t)),Ct(pe.afterSanitizeElements,e,null),!1):(bt(e),!0)},At=function(e,t,i){if(Ue&&("id"===t||"name"===t)&&(i in n||i in pt))return!1;if(Ne&&!ke[t]&&L(ye,t));else if(xe&&L(be,t));else if(!Te[t]||ke[t]){if(!(Lt(e)&&(Le.tagNameCheck instanceof RegExp&&L(Le.tagNameCheck,e)||Le.tagNameCheck instanceof Function&&Le.tagNameCheck(e))&&(Le.attributeNameCheck instanceof RegExp&&L(Le.attributeNameCheck,t)||Le.attributeNameCheck instanceof Function&&Le.attributeNameCheck(t))||"is"===t&&Le.allowCustomizedBuiltInElements&&(Le.tagNameCheck instanceof RegExp&&L(Le.tagNameCheck,i)||Le.tagNameCheck instanceof Function&&Le.tagNameCheck(i))))return!1}else if(Xe[t]);else if(L(Se,_(i,we,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==C(i,"data:")||!Je[e]){if(De&&!L(ve,_(i,we,"")));else if(i)return!1}else;return!0},Lt=function(e){return"annotation-xml"!==e&&S(e,Ee)},zt=function(e){Ct(pe.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||St(e))return;const n={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Te,forceKeepAttr:void 0};let r=t.length;for(;r--;){const a=t[r],{name:s,namespaceURI:c,value:l}=a,d=ut(s),u=l;let h="value"===s?u:T(u);if(n.attrName=d,n.attrValue=h,n.keepAttr=!0,n.forceKeepAttr=void 0,Ct(pe.uponSanitizeAttribute,e,n),h=n.attrValue,!Ve||"id"!==d&&"name"!==d||(vt(s,e),h="user-content-"+h),Me&&L(/((--!?|])>)|<\/(style|title)/i,h)){vt(s,e);continue}if(n.forceKeepAttr)continue;if(!n.keepAttr){vt(s,e);continue}if(!Oe&&L(/\/>/i,h)){vt(s,e);continue}Ie&&m([ge,me,fe],e=>{h=_(h,e," ")});const p=ut(e.nodeName);if(At(p,d,h)){if(Z&&"object"==typeof D&&"function"==typeof D.getAttributeType)if(c);else switch(D.getAttributeType(p,d)){case"TrustedHTML":h=Z.createHTML(h);break;case"TrustedScriptURL":h=Z.createScriptURL(h)}if(h!==u)try{c?e.setAttributeNS(c,s,h):e.setAttribute(s,h),St(e)?bt(e):y(i.removed)}catch(o){vt(s,e)}}else vt(s,e)}Ct(pe.afterSanitizeAttributes,e,null)},kt=function e(t){let i=null;const n=Et(t);for(Ct(pe.beforeSanitizeShadowDOM,t,null);i=n.nextNode();)Ct(pe.uponSanitizeShadowNode,i,null),Tt(i),zt(i),i.content instanceof s&&e(i.content);Ct(pe.afterSanitizeShadowDOM,t,null)};return i.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,o=null,a=null,c=null;if(nt=!e,nt&&(e="\x3c!--\x3e"),"string"!=typeof e&&!_t(e)){if("function"!=typeof e.toString)throw z("toString is not a function");if("string"!=typeof(e=e.toString()))throw z("dirty is not a string, aborting")}if(!i.isSupported)return e;if(Pe||mt(t),i.removed=[],"string"==typeof e&&(qe=!1),qe){if(e.nodeName){const t=ut(e.nodeName);if(!_e[t]||ze[t])throw z("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)n=wt("\x3c!----\x3e"),o=n.ownerDocument.importNode(e,!0),o.nodeType===ne&&"BODY"===o.nodeName||"HTML"===o.nodeName?n=o:n.appendChild(o);else{if(!Fe&&!Ie&&!Re&&-1===e.indexOf("<"))return Z&&Be?Z.createHTML(e):e;if(n=wt(e),!n)return Fe?null:Be?te:""}n&&$e&&bt(n.firstChild);const d=Et(qe?e:n);for(;a=d.nextNode();)Tt(a),zt(a),a.content instanceof s&&kt(a.content);if(qe)return e;if(Fe){if(je)for(c=de.call(n.ownerDocument);n.firstChild;)c.appendChild(n.firstChild);else c=n;return(Te.shadowroot||Te.shadowrootmode)&&(c=he.call(r,c,!0)),c}let u=Re?n.outerHTML:n.innerHTML;return Re&&_e["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&L(ee,n.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+u),Ie&&m([ge,me,fe],e=>{u=_(u,e," ")}),Z&&Be?Z.createHTML(u):u},i.setConfig=function(){mt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Pe=!0},i.clearConfig=function(){ht=null,Pe=!1},i.isValidAttribute=function(e,t,i){ht||mt({});const n=ut(e),r=ut(t);return At(n,r,i)},i.addHook=function(e,t){"function"==typeof t&&b(pe[e],t)},i.removeHook=function(e,t){if(void 0!==t){const i=f(pe[e],t);return-1===i?void 0:v(pe[e],i,1)[0]}return y(pe[e])},i.removeHooks=function(e){pe[e]=[]},i.removeAllHooks=function(){pe={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},i}();function le(e){if(!e)return"";try{return ce.sanitize(e)}catch(t){return console.warn("Error sanitizing HTML:",t),String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;")}}const de=new class{constructor(){this.loadingInstances=new Map}showLoading(e,t="Caricamento..."){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const i=this.generateId(),n=this.createLoadingElement(t);return this.loadingInstances.set(i,{container:e,originalContent:e.innerHTML}),e.innerHTML=le(""),e.appendChild(n),i}hideLoading(e){const t=this.loadingInstances.get(e);t&&(t.container.innerHTML=le(t.originalContent),this.loadingInstances.delete(e))}showEmpty(e,t="Nessun dato disponibile",i="inbox"){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const n=this.createEmptyElement(t,i);e.innerHTML=le(""),e.appendChild(n)}showError(e,t="Si √® verificato un errore",i=!1,n=null){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const r=this.createErrorElement(t,i,n);e.innerHTML=le(""),e.appendChild(r)}createLoadingElement(e){const t=document.createElement("div");return t.className="ui-state loading-state",t.innerHTML=le(`\n            <div class="loading-content">\n                <div class="spinner">\n                    <div class="spinner-border text-primary" role="status">\n                        <span class="visually-hidden">Loading...</span>\n                    </div>\n                </div>\n                <div class="loading-message">${e}</div>\n            </div>\n            <style>\n                .ui-state {\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    min-height: 200px;\n                    text-align: center;\n                    padding: 2rem;\n                }\n                \n                .loading-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                }\n                \n                .loading-message {\n                    color: #6c757d;\n                    font-size: 0.9rem;\n                }\n                \n                .empty-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                    color: #6c757d;\n                }\n                \n                .empty-icon {\n                    font-size: 3rem;\n                    opacity: 0.5;\n                }\n                \n                .empty-message {\n                    font-size: 1.1rem;\n                    font-weight: 500;\n                }\n                \n                .error-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                    color: #dc3545;\n                }\n                \n                .error-icon {\n                    font-size: 3rem;\n                    opacity: 0.7;\n                }\n                \n                .error-message {\n                    font-size: 1.1rem;\n                    font-weight: 500;\n                    text-align: center;\n                }\n                \n                .retry-button {\n                    margin-top: 0.5rem;\n                }\n            </style>\n        `),t}createEmptyElement(e,t){const i=document.createElement("div");return i.className="ui-state empty-state",i.innerHTML=le(`\n            <div class="empty-content">\n                <span class="material-icons empty-icon">${t}</span>\n                <div class="empty-message">${e}</div>\n            </div>\n        `),i}createErrorElement(e,t,i){const n=document.createElement("div");n.className="ui-state error-state";if(n.innerHTML=le(`\n            <div class="error-content">\n                <span class="material-icons error-icon">error_outline</span>\n                <div class="error-message">${e}</div>\n                ${t&&i?'\n            <button class="btn btn-outline-danger btn-sm retry-button">\n                <span class="material-icons me-1">refresh</span>\n                Riprova\n            </button>\n        ':""}\n            </div>\n        `),t&&i){n.querySelector(".retry-button").addEventListener("click",i)}return n}showPageLoading(e="Caricamento..."){const t=document.createElement("div");t.id="page-loading-overlay",t.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(255, 255, 255, 0.9);\n            z-index: 9998;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        ";const i=this.createLoadingElement(e);return t.appendChild(i),document.body.appendChild(t),()=>{const e=document.getElementById("page-loading-overlay");e&&e.remove()}}hidePageLoading(){const e=document.getElementById("page-loading-overlay");e&&e.remove()}generateId(){return"loading_"+Math.random().toString(36).substr(2,9)}async withLoading(e,t,i="Caricamento..."){const n=this.showLoading(e,i);try{const e=await t();return this.hideLoading(n),e}catch(r){throw this.hideLoading(n),this.showError(e,`Errore: ${r.message}`,!0,()=>{this.withLoading(e,t,i)}),r}}renderConditional(e,t,i,n="Nessun dato disponibile"){if(!t||Array.isArray(t)&&0===t.length)return this.showEmpty(e,n),void 0;"string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),e&&(e.innerHTML=le(""),i(e,t))}};"undefined"!=typeof window&&(window.uiStateService=de);const ue=new class{constructor(){this.errorPatterns=["message channel closed before a response was received","A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received","Extension context invalidated","Could not establish connection","The message port closed before a response was received","Receiving end does not exist","chrome-extension://","moz-extension://","safari-extension://","edge-extension://"],this.suppressedErrors=new Set,this.errorCount=0,this.maxErrorsToLog=5,this.init()}init(){window.addEventListener("error",this.handleError.bind(this)),window.addEventListener("unhandledrejection",this.handleRejection.bind(this)),this.interceptExtensionListeners()}isExtensionError(e,t=""){if(!e)return!1;const i=e.toString().toLowerCase(),n=t.toString().toLowerCase();return this.errorPatterns.some(e=>i.includes(e.toLowerCase())||n.includes(e.toLowerCase()))}handleError(e){const{message:t,filename:i}=e;return!this.isExtensionError(t,i)||(this.suppressExtensionError(e,"JavaScript Error"),void 0)}handleRejection(e){const t=e.reason;let i="";return t instanceof Error?i=t.message:"string"==typeof t?i=t:t&&t.toString&&(i=t.toString()),!this.isExtensionError(i)||(this.suppressExtensionError(e,"Promise Rejection"),void 0)}suppressExtensionError(e,t){e.preventDefault(),e.stopPropagation();const i=`${t}:${e.message||e.reason}`;return!this.suppressedErrors.has(i)&&this.errorCount<this.maxErrorsToLog&&(console.warn("[ExtensionErrorHandler] Errore di estensione soppresso:",t,{message:e.message||e.reason,filename:e.filename,type:t}),this.suppressedErrors.add(i),this.errorCount++),!1}interceptExtensionListeners(){"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage&&this.wrapChromeListeners(),"undefined"!=typeof browser&&browser.runtime&&browser.runtime.onMessage&&this.wrapFirefoxListeners(),this.wrapPostMessage()}wrapChromeListeners(){const e=chrome.runtime.onMessage.addListener;chrome.runtime.onMessage.addListener=function(t){return e.call(this,function(e,i,n){try{const r=t(e,i,n);if(!0===r){const e=setTimeout(()=>{try{n({_extensionErrorHandlerResponse:!0})}catch(e){}},100),t=n;n=function(...i){clearTimeout(e);try{return t(...i)}catch(n){}}}return r}catch(r){return console.warn("[ExtensionErrorHandler] Errore nel message listener:",r),!1}})}}wrapFirefoxListeners(){const e=browser.runtime.onMessage.addListener;browser.runtime.onMessage.addListener=function(t){return e.call(this,function(e,i,n){try{return t(e,i,n)}catch(r){return console.warn("[ExtensionErrorHandler] Errore nel message listener Firefox:",r),Promise.resolve()}})}}wrapPostMessage(){const e=window.postMessage;window.postMessage=function(t,i,n){try{return e.call(this,t,i,n)}catch(r){if(this.isExtensionError(r.message))return console.warn("[ExtensionErrorHandler] Errore postMessage di estensione soppresso:",r),void 0;throw r}}.bind(this)}getStats(){return{suppressedErrorTypes:this.suppressedErrors.size,totalErrorCount:this.errorCount,maxErrorsToLog:this.maxErrorsToLog}}resetStats(){this.suppressedErrors.clear(),this.errorCount=0}};"undefined"!=typeof window&&(window.extensionErrorHandler=ue);const he="Gestione Pazienti SPA",pe="1.0.0",ge="development"==="production";const me=new class{sanitizeArgs(e){const t=new Set(["password","token","auth","secret","nome","cognome","codice_fiscale","codice_rad","telefono","email","indirizzo","indirizzo_residenza","citta","cap","note","descrizione"]),i=e=>{if(null==e)return e;if("string"==typeof e)return e.length>200?e.slice(0,200)+"‚Ä¶":e;if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(i);if("object"==typeof e){const n={};for(const[r,o]of Object.entries(e))n[r]=t.has(r)?"[REDACTED]":i(o);return n}return e};return e.map(i)}log(...e){}warn(...e){}error(...e){const t=this.sanitizeArgs(e);console.error(...t)}info(...e){}debug(...e){}group(e){}groupEnd(){}table(e){}time(e){}timeEnd(e){}};class fe{constructor(){this.logger=me}getLegendOptions(e={}){return{position:e.position||"right",align:e.align||"start",labels:{boxWidth:e.boxWidth||20,font:{size:e.fontSize||14},padding:e.padding||20,usePointStyle:!0,generateLabels:this._generateLabels.bind(this)},onClick:this._handleLegendClick.bind(this)}}_generateLabels(e){try{const t=e.data;return t.labels?.length&&t.datasets?.length?t.labels.map((i,n)=>{const r=this._getDatasetColor(t.datasets[0],n),o=e.getDatasetMeta(0);return{text:i,fillStyle:r,strokeStyle:r,lineWidth:0,pointStyle:"circle",hidden:!!o.data[n]&&o.data[n].hidden,index:n}}):[]}catch(t){return this.logger.error("Errore nella generazione delle etichette della legenda:",t),[]}}_handleLegendClick(e,t,i){try{const e=t.index,n=i.chart,r=n.getDatasetMeta(0);r.data[e]&&(r.data[e].hidden=!r.data[e].hidden,n.update(),this._updateContainerState(n,e,r.data[e].hidden),this.logger.debug(`Toggle visibilit√† elemento ${e}: ${r.data[e].hidden?"nascosto":"visibile"}`))}catch(n){this.logger.error("Errore nella gestione del click sulla legenda:",n)}}_updateContainerState(e,t,i){try{const n=e.canvas.parentNode;if(n){const e=n.querySelector(`.chart-legend-item-${t}`);e&&e.classList.toggle("filtered",i)}}catch(n){this.logger.warn("Impossibile aggiornare lo stato del container:",n)}}_getDatasetColor(e,t){return e.backgroundColor&&Array.isArray(e.backgroundColor)?e.backgroundColor[t]||"#666":e.backgroundColor&&"function"==typeof e.backgroundColor?e.backgroundColor(t)||"#666":e.backgroundColor||"#666"}}class ye extends fe{getLegendOptions(e={}){const t=super.getLegendOptions(e);return{...t,position:"right",align:"start",labels:{...t.labels,boxWidth:20,font:{size:14},padding:20}}}}class be extends fe{getLegendOptions(e={}){const t=super.getLegendOptions(e);return{...t,position:"bottom",align:"center",labels:{...t.labels,boxWidth:15,font:{size:12},padding:15}}}_handleLegendClick(e,t,i){super._handleLegendClick(e,t,i),this._showMobileFeedback(t,i)}_showMobileFeedback(e,t){try{const i=t.chart,n=e.index,r=i.getDatasetMeta(0),o=r.data[n]?.hidden;this._showToast(`${o?"Nascosto":"Mostrato"}: ${i.data.labels[n]}`,"mobile")}catch(i){this.logger.warn("Impossibile mostrare feedback mobile:",i)}}_showToast(e,t,i=2e3){console.log(`[${t.toUpperCase()}] ${e}`)}}class ve extends fe{getLegendOptions(e={}){const t=super.getLegendOptions(e);return{...t,position:"bottom",align:"center",labels:{...t.labels,boxWidth:18,font:{size:14},padding:18}}}_handleLegendClick(e,t,i){super._handleLegendClick(e,t,i),this._showTabletFeedback(t,i)}_showTabletFeedback(e,t){try{const i=t.chart,n=e.index,r=i.getDatasetMeta(0),o=r.data[n]?.hidden;this._showToast(`${o?"Nascosto":"Mostrato"}: ${i.data.labels[n]}`,"tablet")}catch(i){this.logger.warn("Impossibile mostrare feedback tablet:",i)}}_showToast(e,t,i=2e3){console.log(`[${t.toUpperCase()}] ${e}`)}}class we{static createAdapter(e="desktop"){switch(e.toLowerCase()){case"mobile":return new be;case"tablet":return new ve;default:return new ye}}}const Ee=new class{constructor(){this.logger=me,this.adapters=new Map}getAdapter(e="desktop"){return this.adapters.has(e)||this.adapters.set(e,we.createAdapter(e)),this.adapters.get(e)}preserveLegendOptions(e={},t="desktop",i={}){try{const n=this.getAdapter(t).getLegendOptions(i),r=this._deepMerge(e,{plugins:{legend:n}});return this.logger.debug("Opzioni legenda preservate e combinate:",{deviceType:t,existingOptions:!!e.plugins?.legend,customOptions:Object.keys(i)}),r}catch(n){return this.logger.error("Errore nella preservazione delle opzioni della legenda:",n),e}}_deepMerge(e,t){try{if(this._hasCircularReferences(t))return this.logger.warn("Riferimenti circolari rilevati nel deep merge, uso merge superficiale"),{...e,...t};const i={...e},n=10,r=(e,t,i=0)=>{if(i>n)return this.logger.warn("Profondit√† massima raggiunta nel deep merge, uso merge superficiale"),{...e,...t};for(const n in t)if(t.hasOwnProperty(n)){const o=t[n];this._isSafeOptionValue(o)?e[n]=o&&"object"==typeof o&&!Array.isArray(o)?r(e[n]||{},o,i+1):o:this.logger.warn(`Valore non sicuro saltato nel deep merge: ${n}`)}return e};return r(i,t)}catch(i){return this.logger.error("Errore nel deep merge, uso merge superficiale:",i),{...e,...t}}}detectDevice(){try{const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}catch(e){return this.logger.warn("Impossibile rilevare il dispositivo, uso desktop come fallback:",e),"desktop"}}applyToExistingChart(e,t="desktop",i={}){try{if(!e||!e.options)return this.logger.warn("Grafico non valido per l'applicazione delle opzioni"),void 0;if(this._isChartCorrupted(e))return this.logger.warn("Grafico in stato corrotto, applicazione opzioni saltata"),void 0;const n=this.preserveLegendOptions(e.options,t,i);if(this._hasCircularReferences(n)){this.logger.warn("Opzioni con riferimenti circolari rilevate, uso opzioni di fallback");const i=this._getFallbackLegendOptions(t);return this._applySafeOptions(e,i),void 0}this._applySafeOptions(e,n),this.logger.debug("Opzioni preservate applicate al grafico esistente")}catch(n){this.logger.error("Errore nell'applicazione delle opzioni al grafico:",n);try{this.logger.warn("Applicazione fallback delle opzioni...");const i=this._getFallbackLegendOptions(t);this._applySafeOptions(e,i)}catch(r){this.logger.error("Errore anche nel fallback delle opzioni:",r)}}}_isChartCorrupted(e){try{if(!e.options||!e.data||!e.canvas)return!0;const t=Object.keys(e.options);if(t.length>1e3)return!0;for(const i of t)if("function"==typeof e.options[i])return!0;return!1}catch(t){return!0}}_hasCircularReferences(e){try{const t=new WeakSet,i=e=>{if(e&&"object"==typeof e){if(t.has(e))return!0;t.add(e);for(const t in e)if(e.hasOwnProperty(t)&&i(e[t]))return!0}return!1};return i(e)}catch(t){return!0}}_applySafeOptions(e,t){try{const i=this._createSafeOptionsCopy(t);Object.assign(e.options,i),"function"==typeof e.update&&e.update()}catch(i){this.logger.error("Errore nell'applicazione sicura delle opzioni:",i)}}_createSafeOptionsCopy(e){try{const t={};for(const[i,n]of Object.entries(e))this._isSafeOptionValue(n)&&(t[i]=n);return t}catch(t){return this.logger.warn("Errore nella creazione della copia sicura, uso oggetto vuoto:",t),{}}}_isSafeOptionValue(e){if(null==e)return!0;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;if(Array.isArray(e))return e.every(e=>this._isSafeOptionValue(e));if("object"==typeof e)try{const t=Object.keys(e);if(t.length>100)return!1;const i=["plugins","legend","labels","position","display","font","size","color","padding","boxWidth","usePointStyle"];for(const n of t)if(!i.includes(n)){if("function"==typeof e[n])return!1;if(!this._isSafeOptionValue(e[n]))return!1}return!0}catch(t){return!1}return!1}_getFallbackLegendOptions(e){return{plugins:{legend:{display:!0,position:"mobile"===e?"bottom":"right",labels:{font:{size:"mobile"===e?12:14}}}}}}};const Se=new class{constructor(){this.logger=me}getLegendOptionsForChartType(e,t="desktop",i={}){try{const n=this._getBaseOptionsForChartType(e),r=this._getDeviceSpecificOptions(t),o=this._mergeOptions(n,r,i);return Ee.preserveLegendOptions({},t,o)}catch(n){return this.logger.error(`Errore nell'ottenimento delle opzioni per ${e}:`,n),this._getFallbackOptions(t)}}_getBaseOptionsForChartType(e){const t={pie:this._getPieChartLegendOptions(),doughnut:this._getDoughnutChartLegendOptions(),bar:this._getBarChartLegendOptions(),line:this._getLineChartLegendOptions(),radar:this._getRadarChartLegendOptions(),polarArea:this._getPolarAreaChartLegendOptions()};return t[e]||t.bar}_getPieChartLegendOptions(){return{position:"right",align:"start",labels:{generateLabels:e=>{const t=e.data;return t.labels?.length&&t.datasets?.length?t.labels.map((e,i)=>{const n=t.datasets[0],r=n.data[i],o=n.percentages?.[i]||this._calculatePercentage(r,t.datasets[0].data),a=this._getDatasetColor(n,i);return{text:`${e} (${o}%)`,fillStyle:a,strokeStyle:a,lineWidth:0,pointStyle:"circle",hidden:!1,index:i}}):[]}}}}_getDoughnutChartLegendOptions(){return{...this._getPieChartLegendOptions(),labels:{...this._getPieChartLegendOptions().labels,generateLabels:e=>{const t=e.data;return t.labels?.length&&t.datasets?.length?t.labels.map((e,i)=>{const n=t.datasets[0],r=n.data[i],o=n.percentages?.[i]||this._calculatePercentage(r,t.datasets[0].data),a=this._getDatasetColor(n,i);return{text:`${e} (${o}%)`,fillStyle:a,strokeStyle:a,lineWidth:0,pointStyle:"rect",hidden:!1,index:i}}):[]}}}}_getBarChartLegendOptions(){return{position:"top",align:"center",labels:{generateLabels:e=>{const t=e.data;return t.datasets?.length?t.datasets.map((e,t)=>{const i=this._getDatasetColor(e,t);return{text:e.label||`Dataset ${t+1}`,fillStyle:i,strokeStyle:i,lineWidth:0,pointStyle:"rect",hidden:e.hidden||!1,index:t}}):[]}}}}_getLineChartLegendOptions(){return{position:"top",align:"center",labels:{generateLabels:e=>{const t=e.data;return t.datasets?.length?t.datasets.map((e,t)=>{const i=this._getDatasetColor(e,t);return{text:e.label||`Dataset ${t+1}`,fillStyle:i,strokeStyle:e.borderColor||i,lineWidth:2,pointStyle:"circle",hidden:e.hidden||!1,index:t}}):[]}}}}_getRadarChartLegendOptions(){return{position:"top",align:"center",labels:{generateLabels:e=>{const t=e.data;return t.datasets?.length?t.datasets.map((e,t)=>{const i=this._getDatasetColor(e,t);return{text:e.label||`Dataset ${t+1}`,fillStyle:i,strokeStyle:e.borderColor||i,lineWidth:2,pointStyle:"circle",hidden:e.hidden||!1,index:t}}):[]}}}}_getPolarAreaChartLegendOptions(){return{position:"right",align:"start",labels:{generateLabels:e=>{const t=e.data;return t.labels?.length&&t.datasets?.length?t.labels.map((e,i)=>{const n=t.datasets[0],r=n.data[i],o=n.percentages?.[i]||this._calculatePercentage(r,t.datasets[0].data),a=this._getDatasetColor(n,i);return{text:`${e} (${o}%)`,fillStyle:a,strokeStyle:a,lineWidth:0,pointStyle:"circle",hidden:!1,index:i}}):[]}}}}_getDeviceSpecificOptions(e){const t={mobile:{position:"bottom",align:"center",labels:{boxWidth:15,font:{size:12},padding:15}},tablet:{position:"bottom",align:"center",labels:{boxWidth:18,font:{size:14},padding:18}},desktop:{position:"right",align:"start",labels:{boxWidth:20,font:{size:14},padding:20}}};return t[e]||t.desktop}_mergeOptions(...e){return e.reduce((e,t)=>{if(!t)return e;for(const i in t)e[i]=t[i]&&"object"==typeof t[i]&&!Array.isArray(t[i])?this._mergeOptions(e[i]||{},t[i]):t[i];return e},{})}_calculatePercentage(e,t){try{const i=t.reduce((e,t)=>e+(t||0),0);return(i>0?e/i*100:0).toFixed(1)}catch(i){return this.logger.warn("Errore nel calcolo della percentuale:",i),"0.0"}}_getDatasetColor(e,t){return e.backgroundColor&&Array.isArray(e.backgroundColor)?e.backgroundColor[t]||"#666":e.backgroundColor&&"function"==typeof e.backgroundColor?e.backgroundColor(t)||"#666":e.backgroundColor||"#666"}_getFallbackOptions(e){return this.logger.warn(`Utilizzo opzioni di fallback per ${e}`),{plugins:{legend:{position:"mobile"===e?"bottom":"right",align:"mobile"===e?"center":"start",labels:{boxWidth:"mobile"===e?15:20,font:{size:"mobile"===e?12:14},padding:"mobile"===e?15:20,usePointStyle:!0}}}}}applyLegendToChart(e,t,i="desktop",n={}){try{if(!e||!e.options)return this.logger.warn("Grafico non valido per l'applicazione della legenda"),void 0;const r=this.getLegendOptionsForChartType(t,i,n);if(r.plugins?.legend){e.options.plugins=e.options.plugins||{};const n=this._createSafeLegendCopy(e.options.plugins.legend||{});e.options.plugins.legend={...n,...r.plugins.legend},e.update(),this.logger.debug(`Legenda applicata al grafico ${t} per ${i}`)}}catch(r){this.logger.error("Errore nell'applicazione della legenda al grafico:",r);try{this.logger.warn("Applicazione fallback della legenda..."),this._applyFallbackLegend(e,i)}catch(o){this.logger.error("Errore anche nel fallback della legenda:",o)}}}_createSafeLegendCopy(e){try{const t={};for(const[i,n]of Object.entries(e))this._isSafeValue(n)&&(t[i]=n);return t}catch(t){return this.logger.warn("Errore nella creazione della copia sicura, uso oggetto vuoto:",t),{}}}_isSafeValue(e){if(null==e)return!0;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;if(Array.isArray(e))return e.every(e=>this._isSafeValue(e));if("object"==typeof e)try{const t=Object.keys(e);if(t.length>100)return!1;for(const i of t){if("function"==typeof e[i])return!1;if(!this._isSafeValue(e[i]))return!1}return!0}catch(t){return!1}return!1}_applyFallbackLegend(e,t){try{const i=this._getFallbackOptions(t);i.plugins?.legend&&(e.options.plugins=e.options.plugins||{},e.options.plugins.legend=i.plugins.legend,e.update(),this.logger.info("Legenda di fallback applicata con successo"))}catch(i){this.logger.error("Errore nell'applicazione della legenda di fallback:",i)}}};const _e=new class{constructor(){this.logger=me,this.activeCharts=new Map}createChartConfiguration(e,t,i={},n="desktop",r=null){try{n||(n=Ee.detectDevice());const o=this._getBaseChartOptions(e,i),a=Se.getLegendOptionsForChartType(e,n,i.legend||{}),s=this._mergeChartOptions(o,a,i);return r&&(s.chartId=r,s.deviceType=n),this.logger.debug(`Configurazione grafico creata per ${e} su ${n}`,{chartId:r,hasLegend:!!s.plugins?.legend,hasOnClick:!!s.plugins?.legend?.onClick}),{type:e,data:t,options:s,deviceType:n,chartId:r}}catch(o){return this.logger.error("Errore nella creazione della configurazione del grafico:",o),this._getFallbackConfiguration(e,t,n)}}applyPreservedOptions(e,t,i="desktop",n={}){try{if(!e||!e.options)return this.logger.warn("Grafico non valido per l'applicazione delle opzioni preservate"),void 0;if(this._isChartCorrupted(e))return this.logger.warn("Grafico in stato corrotto, applicazione opzioni saltata"),void 0;i||(i=Ee.detectDevice());try{Ee.applyToExistingChart(e,i,n),this.logger.debug("Opzioni preservate applicate con successo")}catch(r){this.logger.error("Errore nell'applicazione delle opzioni preservate:",r)}try{Se.applyLegendToChart(e,t,i,n),this.logger.debug("Opzioni legenda applicate con successo")}catch(o){this.logger.error("Errore nell'applicazione delle opzioni legenda:",o)}this.logger.debug(`Opzioni preservate applicate al grafico ${t} per ${i}`)}catch(a){this.logger.error("Errore generale nell'applicazione delle opzioni preservate:",a);try{this.logger.warn("Tentativo di ripristino del grafico..."),this._restoreChartToSafeState(e)}catch(s){this.logger.error("Errore nel ripristino del grafico:",s)}}}_isChartCorrupted(e){try{if(!e||"object"!=typeof e)return!0;if(!e.options||!e.data||!e.canvas)return!e.ctx||!e.chartArea||"function"!=typeof e.update;const t=Object.keys(e.options);if(t.length>1e3)return!0;for(const i of t)if("function"==typeof e.options[i])return!0;return!1}catch(t){return!0}}_restoreChartToSafeState(e){try{e.options&&e.options.plugins&&(e.options.plugins.legend={display:!0,position:"top"}),"function"==typeof e.update&&(e.update(),this.logger.info("Grafico ripristinato a stato sicuro"))}catch(t){this.logger.error("Errore nel ripristino del grafico:",t)}}registerActiveChart(e,t,i,n="desktop"){try{this.activeCharts.set(e,{chart:t,chartType:i,deviceType:n,createdAt:new Date,lastUpdated:new Date}),this.logger.debug(`Grafico registrato: ${e} (${i} su ${n})`)}catch(r){this.logger.error("Errore nella registrazione del grafico attivo:",r)}}updateRegisteredChart(e,t={}){try{const i=this.activeCharts.get(e);i&&(Object.assign(i,t,{lastUpdated:new Date}),this.logger.debug(`Grafico aggiornato: ${e}`))}catch(i){this.logger.error("Errore nell'aggiornamento del grafico registrato:",i)}}unregisterChart(e){try{this.activeCharts.has(e)&&(this.activeCharts.delete(e),this.logger.debug(`Grafico rimosso dalla registrazione: ${e}`))}catch(t){this.logger.error("Errore nella rimozione del grafico dalla registrazione:",t)}}getActiveChartsInfo(){try{return Array.from(this.activeCharts.entries()).map(([e,t])=>({id:e,chartType:t.chartType,deviceType:t.deviceType,createdAt:t.createdAt,lastUpdated:t.lastUpdated,isActive:!!t.chart&&!t.chart.destroyed}))}catch(e){return this.logger.error("Errore nel recupero delle informazioni sui grafici attivi:",e),[]}}_getBaseChartOptions(e,t={}){const i={responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!1},tooltip:{enabled:!0,mode:"index",intersect:!1}}};switch(e){case"pie":case"doughnut":i.plugins.datalabels=!1,"doughnut"===e&&(i.cutout="60%");break;case"bar":i.scales={x:{display:!0},y:{display:!0}};break;case"line":i.scales={x:{display:!0},y:{display:!0}},i.elements={line:{tension:.4}};break;case"radar":i.scales={r:{display:!0}};break;case"polarArea":i.scales={r:{display:!1}}}return i}_mergeChartOptions(...e){return e.reduce((e,t)=>{if(!t)return e;for(const i in t)e[i]=t[i]&&"object"==typeof t[i]&&!Array.isArray(t[i])?this._mergeChartOptions(e[i]||{},t[i]):t[i];return e},{})}_getFallbackConfiguration(e,t,i){return this.logger.warn(`Utilizzo configurazione di fallback per ${e} su ${i}`),{type:e,data:t,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"mobile"===i?"bottom":"right",align:"mobile"===i?"center":"start",labels:{boxWidth:"mobile"===i?15:20,font:{size:"mobile"===i?12:14},padding:"mobile"===i?15:20,usePointStyle:!0}}}},deviceType:i}}migrateExistingChart(e,t,i="desktop"){try{if(!e||!e.options)return this.logger.warn("Grafico esistente non valido per la migrazione"),null;const n=Ee.preserveLegendOptions(e.options,i,{}),r=this._mergeChartOptions(e.options,n,{chartType:t,deviceType:i});return this.logger.info(`Grafico migrato con successo: ${t} su ${i}`),{type:t,data:e.data,options:r,deviceType:i,migrated:!0}}catch(n){return this.logger.error("Errore nella migrazione del grafico esistente:",n),null}}validateChartConfiguration(e){try{const t=[],i=[];if(e.type||t.push("Tipo di grafico mancante"),e.data||t.push("Dati del grafico mancanti"),e.options||t.push("Opzioni del grafico mancanti"),e.options?.plugins?.legend){const t=e.options.plugins.legend;t.onClick||i.push("Funzionalit√† onClick della legenda non configurata"),t.labels?.generateLabels||i.push("Generazione etichette personalizzata non configurata")}else i.push("Configurazione legenda non trovata");if(e.deviceType){["desktop","mobile","tablet"].includes(e.deviceType)||i.push(`Tipo di dispositivo non riconosciuto: ${e.deviceType}`)}const n=0===t.length,r=i.length>0;return this.logger.debug("Validazione configurazione grafico completata",{isValid:n,errors:t.length,warnings:i.length}),{isValid:n,hasWarnings:r,errors:t,warnings:i}}catch(t){return this.logger.error("Errore nella validazione della configurazione:",t),{isValid:!1,hasWarnings:!1,errors:["Errore durante la validazione"],warnings:[]}}}};const Ce=new class{constructor(){this.logger=me,this.migratedCharts=new Map,this.migrationStatus={started:!1,completed:!1,totalCharts:0,migratedCharts:0,failedCharts:0,errors:[]}}async startMigration(e={}){try{this.logger.info("üöÄ Avvio migrazione al nuovo sistema di grafici"),this.migrationStatus.started=!0,this.migrationStatus.startedAt=new Date;const t=this._findExistingCharts();if(0===t.length)return this.logger.info("‚úÖ Nessun grafico esistente trovato da migrare"),this.migrationStatus.completed=!0,this.migrationStatus.completedAt=new Date,this.migrationStatus;this.migrationStatus.totalCharts=t.length,this.logger.info(`üìä Trovati ${t.length} grafici da migrare`);for(const i of t)await this._migrateSingleChart(i,e);return this.migrationStatus.completed=!0,this.migrationStatus.completedAt=new Date,this.migrationStatus.duration=this.migrationStatus.completedAt-this.migrationStatus.startedAt,this.logger.info("üéâ Migrazione completata con successo!",{total:this.migrationStatus.totalCharts,migrated:this.migrationStatus.migratedCharts,failed:this.migrationStatus.failedCharts,duration:`${this.migrationStatus.duration}ms`}),this.migrationStatus}catch(t){throw this.logger.error("‚ùå Errore durante la migrazione:",t),this.migrationStatus.errors.push({type:"migration_error",message:t.message,timestamp:new Date}),t}}_findExistingCharts(){try{const e=[];return document.querySelectorAll("canvas").forEach((t,i)=>{try{if(window.Chart&&"function"==typeof window.Chart.getChart){const n=window.Chart.getChart(t);n&&e.push({canvas:t,chart:n,index:i,id:t.id||`chart-${i}`,type:this._detectChartType(n),hasLegend:!!n.options?.plugins?.legend,hasOnClick:!!n.options?.plugins?.legend?.onClick})}}catch(n){this.logger.warn(`Impossibile analizzare canvas ${i}:`,n)}}),e}catch(e){return this.logger.error("Errore nella ricerca dei grafici esistenti:",e),[]}}async _migrateSingleChart(e,t={}){try{const{canvas:i,chart:n,id:r,type:o}=e;if(i.hasAttribute("data-migrated-chart"))return this.logger.debug(`‚è≠Ô∏è Grafico ${r} gi√† migrato, skip`),void 0;if(!this._isChartReadyForMigration(n))return this.logger.debug(`‚è≥ Grafico ${r} non ancora pronto per la migrazione, skip`),void 0;this.logger.info(`üîÑ Migrazione grafico ${r} (${o})`);const a=Ee.detectDevice(),s=`migrated-${r}-${o}-${Date.now()}`,c=_e.migrateExistingChart(n,o,a);c?(_e.registerActiveChart(s,n,o,a),this.migratedCharts.set(s,{originalId:r,canvas:i,chart:n,chartType:o,deviceType:a,migratedConfig:c,migratedAt:new Date,originalConfig:{hasLegend:e.hasLegend,hasOnClick:e.hasOnClick}}),i.setAttribute("data-migrated-chart",s),i.setAttribute("data-chart-type",o),i.setAttribute("data-device-type",a),i.setAttribute("data-migration-date",(new Date).toISOString()),_e.applyPreservedOptions(n,o,a,t.chartOptions||{}),this.migrationStatus.migratedCharts++,this.logger.info(`‚úÖ Grafico ${r} migrato con successo`,{newId:s,type:o,device:a,hasLegend:!!c.plugins?.legend,hasOnClick:!!c.plugins?.legend?.onClick})):(this.migrationStatus.failedCharts++,this.logger.warn(`‚ö†Ô∏è Fallita migrazione grafico ${r}`))}catch(i){this.migrationStatus.failedCharts++,this.migrationStatus.errors.push({type:"chart_migration_error",chartId:e.id,message:i.message,timestamp:new Date}),this.logger.error(`‚ùå Errore nella migrazione del grafico ${e.id}:`,i)}}_isChartReadyForMigration(e){try{if(!e||"object"!=typeof e)return!1;if(!e.options||!e.data||!e.canvas)return e.ctx&&e.chartArea&&"function"==typeof e.update,!1;const t=Object.keys(e.options);if(t.length>1e3)return!1;for(const i of t)if("function"==typeof e.options[i])return!1;return!0}catch(t){return!1}}_detectChartType(e){try{return e.config&&e.config.type?e.config.type:e.options&&e.options.type?e.options.type:this._inferChartTypeFromData(e.data)}catch(t){return this.logger.warn("Errore nel rilevamento del tipo di grafico:",t),"bar"}}_inferChartTypeFromData(e){try{if(!e||!e.datasets)return"bar";const t=e.datasets[0];return t.percentages||t.data&&t.data.length===e.labels?.length?"pie":t.borderColor?"line":"bar"}catch(t){return this.logger.warn("Errore nell'inferenza del tipo di grafico:",t),"bar"}}getMigrationStatus(){return{...this.migrationStatus}}getMigratedChartsInfo(){try{return Array.from(this.migratedCharts.entries()).map(([e,t])=>({id:e,originalId:t.originalId,chartType:t.chartType,deviceType:t.deviceType,migratedAt:t.migratedAt,originalConfig:t.originalConfig,hasLegend:!!t.chart.options?.plugins?.legend,hasOnClick:!!t.chart.options?.plugins?.legend?.onClick}))}catch(e){return this.logger.error("Errore nel recupero delle informazioni sui grafici migrati:",e),[]}}verifyMigration(){try{const e={total:this.migratedCharts.size,verified:0,issues:[],timestamp:new Date};return this.migratedCharts.forEach((t,i)=>{try{const n=t.chart;if(!n||n.destroyed)return e.issues.push({chartId:i,issue:"chart_destroyed",message:"Grafico distrutto o non valido"}),void 0;if(!n.options?.plugins?.legend)return e.issues.push({chartId:i,issue:"missing_legend",message:"Configurazione legenda mancante"}),void 0;if(!n.options.plugins.legend.onClick)return e.issues.push({chartId:i,issue:"missing_onclick",message:"Funzionalit√† onClick mancante"}),void 0;e.verified++}catch(n){e.issues.push({chartId:i,issue:"verification_error",message:n.message})}}),this.logger.info("Verifica migrazione completata",e),e}catch(e){return this.logger.error("Errore durante la verifica della migrazione:",e),{error:e.message}}}rollbackChart(e){try{const t=this.migratedCharts.get(e);if(!t)return this.logger.warn(`Grafico migrato ${e} non trovato per il rollback`),!1;const{canvas:i,originalId:n}=t;return i.removeAttribute("data-migrated-chart"),i.removeAttribute("data-chart-type"),i.removeAttribute("data-device-type"),i.removeAttribute("data-migration-date"),_e.unregisterChart(e),this.migratedCharts.delete(e),this.logger.info(`Rollback completato per il grafico ${n}`,{chartId:e,originalId:n}),!0}catch(t){return this.logger.error(`Errore durante il rollback del grafico ${e}:`,t),!1}}cleanup(){try{const e=Array.from(this.migratedCharts.keys());e.forEach(e=>{this.rollbackChart(e)}),this.logger.info("Pulizia migrazioni completata",{removedCharts:e.length})}catch(e){this.logger.error("Errore durante la pulizia delle migrazioni:",e)}}},Te={enabled:!0,waitForDOM:!0,waitForChartJS:!0,chartJSTimeout:15e3,chartOptions:{preserveExisting:!0,enableResponsive:!0,enhanceInteractions:!0},verbose:!0};const Ae=new class{constructor(e={}){this.config={...Te,...e},this.logger=me,this.initialized=!1,this.migrationStarted=!1}async initialize(){try{if(this.initialized)return this.logger.warn("Migrazione automatica gi√† inizializzata"),void 0;this.logger.info("üöÄ Inizializzazione migrazione automatica"),this.config.waitForDOM&&await this._waitForDOM(),this.config.waitForChartJS&&await this._waitForChartJS(),this._setupEventListeners(),await this._startAutoMigration(),this.initialized=!0,this.logger.info("‚úÖ Migrazione automatica inizializzata con successo")}catch(e){throw this.logger.error("‚ùå Errore durante l'inizializzazione della migrazione automatica:",e),e}}_waitForDOM(){return new Promise(e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})}async _waitForChartJS(){return new Promise(async(e,t)=>{try{if(window.Chart&&"function"==typeof window.Chart.getChart)return this.logger.info("‚úÖ Chart.js rilevato globalmente"),e(),void 0;try{const i=await n(()=>import("./chartjsService-eCPZngdw.js").then(e=>e.e),[]);if(i&&i.chartLoader&&"function"==typeof i.chartLoader.isLoaded){const n=i.chartLoader;if(n.isLoaded())return this.logger.info("‚úÖ Chart.js rilevato tramite chartjsService"),e(),void 0;this.logger.info("‚è≥ Chart.js non ancora caricato tramite chartjsService, attendo...");const r=this.config.chartJSTimeout,o=100;let a=0;const s=()=>{try{if(n&&n.isLoaded&&n.isLoaded())return this.logger.info("‚úÖ Chart.js caricato tramite chartjsService"),e(),void 0;if(a+=o,a>=r)return this.logger.warn("Timeout nell'attesa di Chart.js tramite chartjsService, uso fallback globale"),this._startGlobalChartJSCheck(e,t),void 0;setTimeout(s,o)}catch(i){this.logger.warn("Errore nel controllo chartjsService, uso fallback globale:",i),this._startGlobalChartJSCheck(e,t)}};s()}else this.logger.warn("chartjsService importato ma chartLoader non valido, uso fallback globale"),this._startGlobalChartJSCheck(e,t)}catch(i){this.logger.warn("Impossibile importare chartjsService, uso fallback globale:",i),this._startGlobalChartJSCheck(e,t)}}catch(r){t(new Error(`Errore nell'attesa di Chart.js: ${r.message}`))}})}_startGlobalChartJSCheck(e,t){try{this.logger.info("üîÑ Avvio controllo globale di Chart.js come fallback...");const i=this.config.chartJSTimeout,n=100;let r=0;const o=()=>{try{if(window.Chart&&"function"==typeof window.Chart.getChart)return this.logger.info("‚úÖ Chart.js rilevato globalmente dopo attesa"),e(),void 0;if(r+=n,r>=i)return t(new Error("Timeout nell'attesa di Chart.js (fallback globale)")),void 0;setTimeout(o,n)}catch(a){this.logger.error("Errore nel controllo globale di Chart.js:",a),t(new Error(`Errore nel controllo globale: ${a.message}`))}};o()}catch(i){this.logger.error("Errore nell'avvio del controllo globale:",i),t(new Error(`Errore nell'avvio controllo globale: ${i.message}`))}}_setupEventListeners(){try{window.addEventListener("load",()=>{this._startAutoMigration()}),this._setupMutationObserver(),window.addEventListener("resize",this._debounce(()=>{this._handleResize()},250)),this.logger.info("üì° Event listener configurati per la migrazione automatica")}catch(e){this.logger.error("Errore nella configurazione degli event listener:",e)}}_setupMutationObserver(){try{if("undefined"!=typeof MutationObserver){new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){"CANVAS"===e.tagName&&this._handleNewCanvas(e);const t=e.querySelectorAll&&e.querySelectorAll("canvas");t&&t.forEach(e=>this._handleNewCanvas(e))}})})}).observe(document.body,{childList:!0,subtree:!0}),this.logger.info("üëÅÔ∏è MutationObserver configurato per nuovi canvas")}}catch(e){this.logger.warn("MutationObserver non disponibile:",e)}}_handleNewCanvas(e){try{if(e.hasAttribute("data-migration-processed"))return;e.setAttribute("data-migration-processed","true"),setTimeout(()=>{try{if(window.Chart&&"function"==typeof window.Chart.getChart){const t=window.Chart.getChart(e);t&&this._isChartReadyForMigration(t)?(this.logger.info("üé® Nuovo canvas rilevato, avvio migrazione..."),this._migrateSingleChart(e,t)):t&&(this.logger.debug("‚è≥ Grafico non ancora pronto, riprovo pi√π tardi..."),setTimeout(()=>this._handleNewCanvas(e),500))}}catch(t){this.logger.warn("Errore nella gestione del nuovo canvas:",t)}},200)}catch(t){this.logger.error("Errore nella gestione del nuovo canvas:",t)}}_handleResize(){try{const e=this._detectDeviceType();this._updateDeviceTypeForMigratedCharts(e)}catch(e){this.logger.warn("Errore nella gestione del ridimensionamento:",e)}}_isChartReadyForMigration(e){try{if(!e||"object"!=typeof e)return!1;if(!e.options||!e.data||!e.canvas)return e.ctx&&e.chartArea&&"function"==typeof e.update,!1;const t=Object.keys(e.options);if(t.length>1e3)return!1;for(const i of t)if("function"==typeof e.options[i])return!1;return!0}catch(t){return!1}}_detectDeviceType(){try{const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}catch(e){return"desktop"}}_updateDeviceTypeForMigratedCharts(e){try{Ce.getMigratedChartsInfo().forEach(t=>{t.deviceType!==e&&(this.logger.info(`üîÑ Aggiornamento tipo dispositivo per ${t.id}: ${t.deviceType} ‚Üí ${e}`),Ce.updateChartDeviceType(t.id,e))})}catch(t){this.logger.warn("Errore nell'aggiornamento del tipo dispositivo:",t)}}async _startAutoMigration(){try{if(this.migrationStarted)return this.logger.info("üîÑ Migrazione automatica gi√† in corso"),void 0;this.migrationStarted=!0,this.logger.info("üöÄ Avvio migrazione automatica dei grafici esistenti");const e=await Ce.startMigration(this.config.chartOptions);this.logger.info("‚úÖ Migrazione automatica completata",{total:e.totalCharts,migrated:e.migratedCharts,failed:e.failedCharts,duration:e.duration});const t=Ce.verifyMigration();return this.logger.info("üîç Verifica migrazione completata",t),e}catch(e){throw this.logger.error("‚ùå Errore durante la migrazione automatica:",e),e}finally{this.migrationStarted=!1}}_migrateSingleChart(e,t){try{const i={canvas:e,chart:t,index:0,id:e.id||`auto-chart-${Date.now()}`,type:this._detectChartType(t),hasLegend:!!t.options?.plugins?.legend,hasOnClick:!!t.options?.plugins?.legend?.onClick};Ce._migrateSingleChart(i,this.config.chartOptions)}catch(i){this.logger.error("Errore nella migrazione del singolo grafico:",i)}}_detectChartType(e){try{return e.config&&e.config.type?e.config.type:e.options&&e.options.type?e.options.type:"bar"}catch(t){return"bar"}}_debounce(e,t){let i;return function(...n){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...n)},t)}}getStatus(){return{initialized:this.initialized,migrationStarted:this.migrationStarted,config:this.config,migrationStatus:Ce.getMigrationStatus()}}disable(){this.config.enabled=!1,this.logger.info("‚è∏Ô∏è Migrazione automatica disabilitata")}enable(){this.config.enabled=!0,this.logger.info("‚ñ∂Ô∏è Migrazione automatica riabilitata")}cleanup(){try{Ce.cleanup(),this.initialized=!1,this.migrationStarted=!1,this.logger.info("üßπ Pulizia migrazione automatica completata")}catch(e){this.logger.error("Errore durante la pulizia:",e)}}},Le={enabled:!0,waitForDOM:!0,waitForChartJS:!0,chartJSTimeout:15e3,chartOptions:{preserveExisting:!0,enableResponsive:!0,enhanceInteractions:!0},verbose:!0};async function ze(){try{me.info("üöÄ Inizializzazione automatica del sistema di migrazione grafici"),await Ae.initialize(Le),me.info("‚úÖ Sistema di migrazione automatica inizializzato con successo");const e=Ae.getStatus();me.info("üìä Stato migrazione automatica:",e)}catch(e){if(me.error("‚ùå Errore durante l'inizializzazione automatica:",e),e.message.includes("Chart.js")||e.message.includes("Timeout")){me.info("‚è≥ Chart.js non ancora disponibile, riprovo con retry intelligente...");let e=0;const t=3,i=3e3,n=async()=>{try{e++;const n=i*Math.pow(2,e-1);me.info(`üîÑ Tentativo di reinizializzazione ${e}/${t} (delay: ${n}ms)...`),await new Promise(e=>setTimeout(e,n)),await Ae.initialize(Le),me.info("‚úÖ Reinizializzazione riuscita")}catch(r){e<t?(me.warn(`‚ö†Ô∏è Tentativo ${e} fallito, riprovo...`),n()):(me.error("‚ùå Tutti i tentativi di reinizializzazione falliti:",r),me.info("üí° Il sistema continuer√† a funzionare normalmente, ma la migrazione dei grafici potrebbe non essere attiva"))}};n()}else me.info("üîÑ Tentativo di reinizializzazione per errore generico..."),setTimeout(async()=>{try{await Ae.initialize(Le),me.info("‚úÖ Reinizializzazione riuscita")}catch(e){me.error("‚ùå Reinizializzazione fallita:",e)}},2e3)}}"undefined"!=typeof window?"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ze):ze():me.info("üñ•Ô∏è Ambiente Node.js rilevato, migrazione automatica non disponibile");const ke=r("https://aiguzywadjzyrwandgba.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpZ3V6eXdhZGp6eXJ3YW5kZ2JhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyMDM1MzQsImV4cCI6MjA2Njc3OTUzNH0.pezVt3-xxkHBYK2V6ryHUtj_givF_TA9xwEzuK2essw",{auth:{flowType:"pkce",detectSessionInUrl:!0,persistSession:!0,autoRefreshToken:!0,storage:window.localStorage,storageKey:"supabase.auth.token",debug:!1},global:{headers:{"X-Client-Info":"supabase-js-vite"}}}),xe=Object.freeze(Object.defineProperty({__proto__:null,supabase:ke},Symbol.toStringTag,{value:"Module"}));const Ne=new class{constructor(){this.readyPromise=new Promise(e=>{this.resolveReady=e}),this.init()}async init(){await this.waitForViteReady(),await this.waitForSupabaseReady(),this.notifyReady()}async waitForViteReady(){return new Promise(e=>{"complete"===document.readyState?(me.log("Vite √® pronto"),e()):window.addEventListener("load",()=>{setTimeout(()=>{me.log("Vite √® pronto (dopo load)"),e()},100)},{once:!0})})}async waitForSupabaseReady(){return new Promise(async e=>{try{await ke.auth.getSession(),me.log("Supabase √® pronto"),e()}catch(t){console.error("Errore nell'inizializzazione Supabase:",t),this.clearCorruptedState(),setTimeout(async()=>{try{await ke.auth.getSession(),me.log("Supabase √® pronto (dopo retry)"),e()}catch(t){console.error("Errore nel retry Supabase:",t),e()}},500)}})}clearCorruptedState(){me.log("Pulisco stato corrotto..."),["supabase.auth.token","sb-aiguzywadjzyrwandgba-auth-token"].forEach(e=>{localStorage.removeItem(e),sessionStorage.removeItem(e)}),document.cookie.split(";").forEach(e=>{const t=e.indexOf("="),i=t>-1?e.substr(0,t):e;(i.trim().includes("supabase")||i.trim().includes("sb-"))&&(document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/")})}onReady(){return this.readyPromise}notifyReady(){me.log("Middleware Vite-Supabase pronto"),this.resolveReady()}};const De=new class{constructor(){this.isInitialized=!1,this.authState="idle",this.errorState=null,this.init()}async init(){if(!this.isInitialized){await new Promise(e=>{Ne.onReady(e)});try{const e=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.substring(1));t.has("access_token")||t.has("refresh_token")||e.has("code")||t.has("error")?(me.log("Rilevato redirect OAuth con parametri reali, gestisco la sessione..."),this.authState="authenticating",await this.handleOAuthCallback()):me.log("Nessun parametro OAuth rilevato, inizializzazione normale"),this.isInitialized=!0}catch(e){console.error("Errore nell'inizializzazione OAuth:",e),this.errorState=e,this.authState="error"}}}async handleOAuthCallback(){try{me.log("Gestisco callback OAuth...");if(new URLSearchParams(window.location.search).has("code")){me.log("Rilevato parametro code, eseguo exchangeCodeForSession...");const{data:e,error:t}=await ke.auth.exchangeCodeForSession(window.location.href);if(t)throw console.error("Errore in exchangeCodeForSession:",t),this.clearCorruptedState(),t;me.log("exchangeCodeForSession completato:",!!e?.session)}const{data:e,error:t}=await ke.auth.getSession();if(t)throw console.error("Errore nel callback OAuth:",t),this.clearCorruptedState(),t;if(e.session){me.log("Sessione OAuth recuperata con successo"),this.authState="authenticated",this.cleanupOAuthUrl();const e=sessionStorage.getItem("redirectUrl");e?(sessionStorage.removeItem("redirectUrl"),window.location.hash=e):window.location.hash="#home"}return e.session}catch(e){throw console.error("Errore nella gestione del callback OAuth:",e),this.clearCorruptedState(),e}}clearCorruptedState(){me.log("Pulisco stato corrotto OAuth..."),Ne.clearCorruptedState(),this.cleanupOAuthUrl(),this.authState="idle",this.errorState=null}cleanupOAuthUrl(){if(window.location.hash.includes("access_token")||window.location.search.includes("code")){const e=window.location.hash.split("&")[0],t=window.location.pathname+(e&&"#"!==e?e:"");window.history.replaceState({},document.title,t),me.log("URL pulito da parametri OAuth, nuovo URL:",t)}}async signInWithGoogle(){try{await Ne.onReady(),"error"===this.authState&&(me.log("Stato di errore rilevato, pulisco..."),this.clearCorruptedState(),await new Promise(e=>setTimeout(e,100))),this.authState="authenticating";const e=window.location.origin+window.location.pathname+window.location.hash;me.log("Iniziando login OAuth con redirect:",e);const{data:t,error:i}=await ke.auth.signInWithOAuth({provider:"google",options:{redirectTo:e,queryParams:{}}});if(i)throw console.error("Errore nella chiamata OAuth:",i),this.authState="error",this.errorState=i,i;return me.log("Login OAuth iniziato con successo:",t),{success:!0,data:t}}catch(e){return console.error("Errore completo nel login OAuth:",e),401===e.status&&(me.log("Errore 401 rilevato, pulisco stato corrotto..."),this.clearCorruptedState()),this.authState="error",this.errorState=e,{success:!1,error:e.message}}}getAuthState(){return{state:this.authState,error:this.errorState,isInitialized:this.isInitialized}}};let Oe={session:void 0,profile:null};async function Ie(e){try{if("undefined"!=typeof window&&window.__PW_E2E_AUTH_MOCK){e?.user?(Oe.session=e,Oe.profile={id:e.user.id,username:e.user.email?.split("@")[0]||"e2e-user",full_name:e.user.user_metadata?.full_name||e.user.user_metadata?.name||e.user.email||"E2E User",role:"editor",email:e.user.email,fallback:!0}):(Oe.session=null,Oe.profile=null);try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:e}}))}catch{}return window.dispatchEvent(new CustomEvent("auth-profile-loaded")),void 0}}catch{}if(e?.user){const t=await async function(e){if(!e)return null;try{const{data:t,error:i,status:n}=await ke.from("profiles").select("username, full_name, role").eq("id",e.id).single();if(i&&406!==n)throw i;return t}catch(t){console.error("Errore nel recuperare il profilo utente:",t);try{const{data:t}=await ke.rpc("get_user_role_safe",{user_uuid:e.id}),i=t||"editor";return console.info("‚úÖ Ruolo recuperato con funzione sicura:",i),{id:e.id,username:e.email?.split("@")[0]||"utente",full_name:e.user_metadata?.full_name||e.user_metadata?.name||e.email||"Utente",role:i,email:e.email,fallback:!0}}catch(i){return console.error("‚ùå Errore nel recupero ruolo sicuro, uso fallback minimo:",i),null}}}(e.user);Oe.session=e,t?Oe.profile=t:(console.warn("‚ö†Ô∏è Profilo non disponibile, uso fallback per:",e.user.email),Oe.profile={id:e.user.id,username:e.user.email?.split("@")[0]||"utente",full_name:e.user.user_metadata?.full_name||e.user.user_metadata?.name||e.user.email||"Utente",role:"editor",email:e.user.email,fallback:!0})}else Oe.session=null,Oe.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:e}}))}catch{}window.dispatchEvent(new CustomEvent("auth-profile-loaded"))}async function Me(){try{const{error:e}=await ke.auth.signOut();if(e)throw e;return{success:!0}}catch(e){return console.error("Errore durante il signOut:",e),{success:!1,error:e.message}}}let Re=!1;void(window.innerWidth>767||document.addEventListener("DOMContentLoaded",()=>{!function(){if(Re)return;const e=()=>{Re=!0,document.removeEventListener("touchstart",e),document.removeEventListener("click",e)};document.addEventListener("touchstart",e,{once:!0,passive:!0}),document.addEventListener("click",e,{once:!0,passive:!0})}(),document.querySelectorAll(".card").forEach(e=>{e.addEventListener("touchstart",e=>{if(!e.target.closest("button, a, input, select, .custom-select-wrapper"))try{"vibrate"in navigator&&Re&&navigator.vibrate(10)}catch(t){console.debug("Vibrazione non disponibile o bloccata.",t.message)}},{passive:!0})}),window.addEventListener("resize",()=>{window.innerWidth<=480?document.querySelectorAll(".cards-grid-mobile").forEach(e=>{e.style.gridTemplateColumns="1fr"}):document.querySelectorAll(".cards-grid-mobile").forEach(e=>{e.style.gridTemplateColumns=""})},{passive:!0})}));const Pe="redirectUrl";let $e=window.innerWidth<=767;function Fe(){const e=document.querySelector(".navbar"),t=document.querySelector(".mobile-navbar");if(!e||!t)return;const i=window.innerWidth<=767;if(i===$e)return e.classList.toggle("d-none",i),t.classList.toggle("d-none",!i),void 0;$e=i,me.log("Mode changed to: "+(i?"mobile":"desktop"));const n=new CustomEvent("mode:change",{detail:{isMobile:i}});window.dispatchEvent(n),e.classList.toggle("d-none",i),t.classList.toggle("d-none",!i),i&&je()}function je(){const e=document.getElementById("mobile-auth-container"),t=document.getElementById("mobile-home-link");if(!e||!t)return;if(Oe.session){const i=document.createElement("span");i.className="material-icons",i.title="Logout",i.textContent="logout",e.replaceChildren(i),e.onclick=async e=>{e.preventDefault(),await Me()},t.classList.add("navbar-home-logged")}else{const i=document.createElement("span");i.className="material-icons",i.title="Login",i.textContent="login",e.replaceChildren(i),e.onclick=e=>{e.preventDefault();const t=document.getElementById("login-modal-trigger");t&&t.click()},t.classList.remove("navbar-home-logged")}}let Be=null,Ue=!1;const Ve={inserimento:()=>n(()=>import("./form-DBj6nFds.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),dimissione:()=>n(()=>import("./dimissione-BRocebjT.js"),__vite__mapDeps([11,12,1,2,6,10,4,5,8,13,14])),grafico:()=>n(()=>import("./grafico-35dZt1W1.js"),__vite__mapDeps([15,16,1,17,4,5,8,6])),list:()=>n(()=>import("./list-CEoPZFWf.js"),__vite__mapDeps([18,1,12,2,6,7,14,8,16])),diagnosi:()=>n(()=>import("./diagnosi-_ZueX3-a.js"),__vite__mapDeps([19,1,6])),"eventi-clinici":()=>n(()=>import("./eventi-clinici-BGyAJeQK.js"),__vite__mapDeps([20,1,14,2,13,12,6,4,5,8]))},He=new Map,qe=Object.assign({"/src/views/access-denied.html":()=>n(()=>import("./access-denied-qNA2WfrE.js"),[]).then(e=>e.default),"/src/views/auth-modal.html":()=>n(()=>import("./auth-modal-VMurGtIz.js"),[]).then(e=>e.default),"/src/views/diagnosi.html":()=>n(()=>import("./diagnosi-Cwkqnh9y.js"),[]).then(e=>e.default),"/src/views/dimissione.html":()=>n(()=>import("./dimissione-Btfp9upn.js"),[]).then(e=>e.default),"/src/views/eventi-clinici.html":()=>n(()=>import("./eventi-clinici-D-JWmn83.js"),[]).then(e=>e.default),"/src/views/grafico.html":()=>n(()=>import("./grafico-DyPZBtMB.js"),[]).then(e=>e.default),"/src/views/home.html":()=>n(()=>import("./home-fApaPaO7.js"),[]).then(e=>e.default),"/src/views/inserimento.html":()=>n(()=>import("./inserimento-B2V9ZJKD.js"),[]).then(e=>e.default),"/src/views/list.html":()=>n(()=>import("./list-oHAJ5ahF.js"),[]).then(e=>e.default),"/src/views/login-required.html":()=>n(()=>import("./login-required-DkOrvptO.js"),[]).then(e=>e.default)});function Ge(){const e=Oe.profile?.role;me.log("Updating UI visibility based on role:",e);const t={inserimento:["admin","editor"],list:["admin","editor","viewer"],grafico:["admin","editor","viewer"],diagnosi:["admin"],dimissione:["admin","editor"],"eventi-clinici":["admin","editor"]};document.querySelectorAll(".menu-card").forEach(i=>{const n=i.dataset.view;t[n]&&(i.style.display=e&&t[n].includes(e)?"block":"none")})}async function We(e){if(He.has(e))return He.get(e);const t=`/src/views/${e}.html`;if(!qe[t])return console.error(`Vista non trovata: ${e} (path cercato: ${t})`),me.error(`Vista HTML non trovata: ${e}`),"home"!==e?await We("home"):'\n                <div class="container mt-4">\n                    <div class="alert alert-danger" role="alert">\n                        <h4 class="alert-heading">Errore critico</h4>\n                        <p>Impossibile caricare le viste dell\'applicazione.</p>\n                        <button class="btn btn-primary" onclick="location.reload()">Ricarica pagina</button>\n                    </div>\n                </div>\n            ';try{const i=await qe[t]();if(!i||"string"!=typeof i)throw new Error(`Contenuto vista ${e} non valido`);return He.set(e,i),i}catch(i){return console.error("Errore nel caricamento della vista:",e,i),me.error(`Fallimento caricamento vista HTML ${e}:`,i),"home"!==e?await We("home"):'\n                <div class="container mt-4">\n                    <div class="alert alert-danger" role="alert">\n                        <h4 class="alert-heading">Errore di caricamento</h4>\n                        <p>Si √® verificato un errore nel caricamento della vista.</p>\n                        <button class="btn btn-primary" onclick="location.reload()">Ricarica pagina</button>\n                        \n                    </div>\n                </div>\n            '}}function Qe(e){window.location.hash=e}async function Je(){if(Ue)return me.warn("Navigazione gi√† in corso, interrotta."),void 0;Ue=!0;const e=document.getElementById("view-container");try{if("function"==typeof Be&&(Be(),Be=null),window.location.hash.includes("access_token="))return;if(void 0===Oe.session)return;const i=window.location.hash.replace(/^#\/?/,"");if(!Oe.session&&(""===i||"home"===i||"list"===i))return window.location.hash="login-required",void 0;if(!e)return console.error("Fatal: #view-container non trovato."),void 0;e.innerHTML=le('<div class="d-flex justify-content-center align-items-center" style="height: 80vh;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>');const n=window.location.hash.replace(/^#\/?/,"")||"home",[r,o]=n.split("?"),a=new URLSearchParams(o),s={inserimento:["admin","editor"],list:["admin","editor","viewer"],grafico:["admin","editor","viewer"],diagnosi:["admin"],dimissione:["admin","editor"],"eventi-clinici":["admin","editor"]};let c=r;Object.keys(s).includes(r)&&!Oe.session?(sessionStorage.setItem("redirectUrl",n),c="login-required"):s[r]&&!s[r].includes(Oe.profile?.role)&&Oe.profile&&(c="access-denied");const l=await We(c);e.innerHTML=le(l);const d=e.querySelector(".view");d.offsetHeight,d&&d.classList.add("active");const u=Ve[c];if(u)try{const e=await async function(e,t=3,i=1e3){let n;for(let o=1;o<=t;o++)try{return await e()}catch(r){if(n=r,me.warn(`Tentativo ${o}/${t} fallito per import dinamico:`,r.message),o===t)throw n;const e=i*Math.pow(2,o-1);await new Promise(t=>setTimeout(t,e))}}(u);if(!e)throw new Error(`Modulo ${c} caricato ma vuoto`);if("list"===c){const t=await e.fetchListData();Be=await e.initListView(t)}else if("diagnosi"===c)Be=await e.initDiagnosiView(a);else if("grafico"===c)Be=await e.initGraficoView(a);else if("inserimento"===c)Be=await e.initInserimentoView(a);else if("dimissione"===c)Be=await e.initDimissioneView(a);else if("eventi-clinici"===c)Be=await e.initEventiCliniciView(a);else{const t=Object.values(e).find(e=>"function"==typeof e&&e.name.startsWith("init"));t&&(Be=await t(a))}}catch(t){return console.error("Errore nel caricamento del modulo:",c,t),me.error(`Fallimento caricamento modulo ${c}:`,t),e.innerHTML=le(`\n                    <div class="container mt-4">\n                        <div class="alert alert-warning" role="alert">\n                            <h4 class="alert-heading">\n                                <span class="material-icons me-2" style="vertical-align: middle;">warning</span>\n                                Problema di caricamento\n                            </h4>\n                            <p>Si √® verificato un problema nel caricamento di questa sezione dell'applicazione.</p>\n                            <hr>\n                            <div class="d-flex gap-2">\n                                <button class="btn btn-primary" onclick="location.reload()">\n                                    <span class="material-icons me-1" style="vertical-align: middle;">refresh</span>\n                                    Ricarica pagina\n                                </button>\n                                <button class="btn btn-outline-secondary" onclick="window.location.hash = 'home'">\n                                    <span class="material-icons me-1" style="vertical-align: middle;">home</span>\n                                    Torna alla home\n                                </button>\n                            </div>\n                            ${ge?`<details class="mt-3"><summary>Dettagli tecnici (solo sviluppo)</summary><pre class="small mt-2">${t.stack||t.message}</pre></details>`:""}\n                        </div>\n                    </div>\n                `),void 0}else if("home"===c)Ge(),document.querySelectorAll(".menu-card").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.view;"inserimento"===t&&sessionStorage.removeItem("editPazienteId"),Qe(t)})});else if("login-required"===c){const e=document.getElementById("login-prompt-button");e&&e.addEventListener("click",()=>{ke.auth.signInWithOAuth({provider:"google"})})}const h=new CustomEvent("viewChanged",{detail:{view:c,params:a}});document.dispatchEvent(h)}catch(i){console.error("Errore durante il rendering della vista:",i),e&&(e.innerHTML=le('<div class="alert alert-danger m-3">Si √® verificato un errore critico. Si prega di ricaricare la pagina.</div>'))}finally{Ue=!1}}function Ye(){void window.addEventListener("error",e=>{if(["A listener indicated an asynchronous response by returning true","Extension context invalidated","Could not establish connection","chrome-extension://","moz-extension://"].some(t=>e.message&&e.message.includes(t)))return console.debug("Browser extension error ignored:",e.message),e.preventDefault(),!1;console.error("Application error:",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{const t=e.reason?.message||e.reason?.toString()||"";if(["A listener indicated an asynchronous response by returning true","message channel closed before a response was received","Extension context invalidated","Could not establish connection"].some(e=>t.includes(e)))return console.debug("Browser extension promise rejection ignored:",t),e.preventDefault(),void 0;console.error("Unhandled promise rejection:",e.reason)}),window.appLogger={info:(e,t=null)=>{me.log(`[APP] ${e}`,t||"")},warn:(e,t=null)=>{me.warn(`[APP WARNING] ${e}`,t||"")},error:(e,t=null)=>{console.error("[APP ERROR]",e,t||"")},debug:(e,t=null)=>{"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||me.log(`[APP DEBUG] ${e}`,t||"")}},window.appLogger.info("Error service and logger initialized.",{timestamp:(new Date).toISOString()})}function Xe(){document.addEventListener("click",e=>{const t=e.target.closest(".btn-back-menu");if(t){e.preventDefault(),t.style.transform="scale(0.95)",t.style.transition="transform 0.1s ease",setTimeout(()=>{t.style.transform="",t.style.transition=""},150);const i=t.getAttribute("data-view")||"home";"home"===i&&(sessionStorage.removeItem("editPazienteId"),sessionStorage.removeItem("formData"),sessionStorage.removeItem("currentFilters")),setTimeout(()=>Qe(i),100)}})}window.addEventListener("auth-profile-loaded",Ge);class Ke{constructor(e={}){this.options={id:e.id||"notification-announcer",className:e.className||"notification__sr-only",defaultLive:e.defaultLive||"polite",enableQueue:!1!==e.enableQueue,queueDelay:e.queueDelay||150,maxQueueSize:e.maxQueueSize||10,...e},this.element=null,this.queue=[],this.isProcessing=!1,this.currentTimeout=null,this.init()}init(){this.createElement(),this.setupAccessibility()}createElement(){const e=document.getElementById(this.options.id);e&&e.remove(),this.element=document.createElement("div"),this.element.id=this.options.id,this.element.className=this.options.className,document.body.appendChild(this.element)}setupAccessibility(){this.element.setAttribute("aria-live",this.options.defaultLive),this.element.setAttribute("aria-atomic","true"),this.element.setAttribute("role","status"),this.element.style.cssText="\n            position: absolute !important;\n            width: 1px !important;\n            height: 1px !important;\n            padding: 0 !important;\n            margin: -1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n        "}announce(e,t={}){if(!e||"string"!=typeof e)return console.warn("NotificationLiveRegion: messaggio non valido",e),void 0;const i={message:e.trim(),live:t.live||this.options.defaultLive,priority:t.priority||0,timestamp:Date.now(),id:this.generateAnnouncementId()};this.options.enableQueue?this.addToQueue(i):this.processAnnouncement(i)}announceSuccess(e,t=""){this.announce(t?`Successo: ${t}. ${e}`:`Successo: ${e}`,{live:"polite",priority:1})}announceError(e,t=""){this.announce(t?`Errore: ${t}. ${e}`:`Errore: ${e}`,{live:"assertive",priority:3})}announceWarning(e,t=""){this.announce(t?`Attenzione: ${t}. ${e}`:`Attenzione: ${e}`,{live:"assertive",priority:2})}announceInfo(e,t=""){this.announce(t?`Informazione: ${t}. ${e}`:`Informazione: ${e}`,{live:"polite",priority:1})}announceNotification(e,t,i="",n={}){const r={success:"Successo",error:"Errore",warning:"Attenzione",info:"Informazione"}[e]||"Notifica";this.announce(i?`${r}: ${i}. ${t}`:`${r}: ${t}`,{live:{success:"polite",error:"assertive",warning:"assertive",info:"polite"}[e]||"polite",priority:{success:1,error:3,warning:2,info:1}[e]||1,...n})}addToQueue(e){const t=Date.now()-3e3;this.queue=this.queue.filter(i=>i.timestamp<t||i.message!==e.message),this.queue.length>=this.options.maxQueueSize&&this.queue.shift();const i=this.queue.findIndex(t=>t.priority<e.priority);-1===i?this.queue.push(e):this.queue.splice(i,0,e),this.processQueue()}processQueue(){if(this.isProcessing||0===this.queue.length)return;this.isProcessing=!0;const e=this.queue.shift();this.processAnnouncement(e),this.currentTimeout=setTimeout(()=>{this.isProcessing=!1,this.processQueue()},this.options.queueDelay)}processAnnouncement(e){this.element.getAttribute("aria-live")!==e.live&&this.element.setAttribute("aria-live",e.live),this.element.textContent="",setTimeout(()=>{this.element.textContent=e.message,this.dispatchEvent("announced",{announcement:e})},50)}clearQueue(){this.queue=[],this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.isProcessing=!1,this.dispatchEvent("queueCleared")}clear(){this.element.textContent="",this.dispatchEvent("cleared")}updateSettings(e){this.options={...this.options,...e},e.defaultLive&&this.element.setAttribute("aria-live",e.defaultLive),this.dispatchEvent("settingsUpdated",{options:this.options})}getState(){return{id:this.options.id,queueLength:this.queue.length,isProcessing:this.isProcessing,currentContent:this.element.textContent,currentLive:this.element.getAttribute("aria-live"),options:{...this.options}}}generateAnnouncementId(){return`announcement-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}dispatchEvent(e,t={}){const i=new CustomEvent(`notificationLiveRegion:${e}`,{detail:{liveRegion:this,...t}});document.dispatchEvent(i)}destroy(){this.clearQueue(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchEvent("destroyed"),this.element=null,this.queue=[]}static getInstance(e={}){return Ke._instance||(Ke._instance=new Ke(e)),Ke._instance}static destroyInstance(){Ke._instance&&(Ke._instance.destroy(),Ke._instance=null)}static exists(){return!!Ke._instance}}Ke._instance=null;let Ze=null;function et(e,t,i=""){try{Ze||(Ze=Ke.getInstance({id:"notification-announcer"})),Ze.announceNotification?.(e,t,i)}catch(n){const i=document.getElementById("notification-announcer");i&&(i.textContent=`${e}: ${t}`)}}function tt(e,t,{removeNotification:i}){const n=e.querySelector(".notification__close");n&&n.addEventListener("click",e=>{e.stopPropagation(),i(t.id)}),e.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),i(t.id))})}function it(e,t,{pauseAutoCloseTimer:i}){let n=0;e.addEventListener("touchstart",()=>{n=Date.now()}),e.addEventListener("touchend",()=>{Date.now()-n>500&&i?.(t.id)})}class nt{static DEBUG=!1;static notificationQueue=[];static isDOMReady=!1;static domReadyCallbacks=[];static animationSupport=null;static reducedMotionPreference=null;static errorCounts={render:0,animation:0,dom:0,service:0,total:0};static init(){this.checkDOMReady(),this.checkAnimationSupport(),this.checkReducedMotionPreference(),this.setupErrorRecovery()}static handleRenderError(e,t,i=null){this.errorCounts.render++,this.errorCounts.total++,me.error("‚ùå Notification render error:",e,t),"undefined"!=typeof window&&window.appLogger&&window.appLogger.error("Notification render failed",{error:e.message,notificationId:t?.id,notificationType:t?.type,stack:e.stack});try{return i&&"function"==typeof i?i(t):this.createSimpleFallback(t)}catch(n){return me.error("‚ùå Fallback renderer also failed:",n),this.showConsoleFallback(t),null}}static handleAnimationError(e,t,i="unknown"){if(this.errorCounts.animation++,this.errorCounts.total++,me.warn("‚ö†Ô∏è Animation error:",e,i),t)try{t.style.animation="none",t.style.transition="none","entrance"===i?(t.style.opacity="1",t.style.transform="translateX(0)",t.classList.add("notification--visible"),t.classList.remove("notification--entering")):"exit"===i&&(t.style.opacity="0",t.classList.add("notification--hidden"),t.classList.remove("notification--exiting")),this.DEBUG&&me.debug("‚úÖ Animation fallback applied to element")}catch(n){me.error("‚ùå Animation fallback failed:",n)}}static handleServiceError(e,t,i=null){this.errorCounts.service++,this.errorCounts.total++,this.errorCounts.service%10==1&&me.error(`‚ùå NotificationService error in ${t} (${this.errorCounts.service} total):`,e),"undefined"!=typeof window&&window.appLogger&&window.appLogger.error(`NotificationService ${t} failed`,{error:e.message,operation:t,data:i,stack:e.stack});try{switch(t){case"show":this.recoverFromShowError(i);break;case"remove":this.recoverFromRemoveError(i);break;case"clear":this.recoverFromClearError();break;case"init":this.recoverFromInitError();break;default:me.warn(`‚ö†Ô∏è No recovery strategy for operation: ${t}`)}}catch(n){me.error("‚ùå Error recovery failed:",n)}}static handleDOMError(e,t,i=null){return this.errorCounts.dom++,this.errorCounts.total++,me.error(`‚ùå DOM error in ${t}:`,e),!(!this.isDOMReady&&"render"===t)||(me.debug("üìã DOM not ready, queueing notification"),!1)}static queueNotification(e,t){if(this.isDOMReady)try{return e(t)}catch(i){return this.handleRenderError(i,t)}return this.notificationQueue.push({renderFunction:e,notification:t,timestamp:Date.now()}),this.DEBUG&&me.debug(`üìã Queued notification ${t?.id}, queue size: ${this.notificationQueue.length}`),null}static processNotificationQueue(){if(!this.isDOMReady||0===this.notificationQueue.length)return;me.debug(`üöÄ Processing ${this.notificationQueue.length} queued notifications`);const e=[...this.notificationQueue];this.notificationQueue=[],e.forEach(({renderFunction:e,notification:t,timestamp:i})=>{try{if(Date.now()-i>3e4)return me.warn("‚ö†Ô∏è Skipping old queued notification:",t?.id),void 0;e(t)}catch(n){this.handleRenderError(n,t)}})}static createSimpleFallback(e){const t=document.createElement("div");t.className=`notification notification--${e.type} notification--fallback`,t.setAttribute("data-id",e.id),t.setAttribute("role","error"===e.type?"alert":"status"),t.setAttribute("aria-live","error"===e.type?"assertive":"polite"),t.style.cssText="\n            position: relative;\n            padding: 12px 16px;\n            margin: 8px 0;\n            border-radius: 4px;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 14px;\n            line-height: 1.4;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n            max-width: 400px;\n            word-wrap: break-word;\n        ";const i={success:{bg:"#d4edda",text:"#155724",border:"#c3e6cb"},error:{bg:"#f8d7da",text:"#721c24",border:"#f5c6cb"},warning:{bg:"#fff3cd",text:"#856404",border:"#ffeaa7"},info:{bg:"#d1ecf1",text:"#0c5460",border:"#bee5eb"}},n=i[e.type]||i.info;t.style.backgroundColor=n.bg,t.style.color=n.text,t.style.border=`1px solid ${n.border}`;const r=document.createElement("div");r.style.cssText="display: flex; align-items: flex-start; gap: 8px;";const o=document.createElement("span");o.style.cssText="flex-shrink: 0; font-weight: bold; font-size: 16px;";const a={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"};o.textContent=a[e.type]||a.info;const s=document.createElement("div");if(s.style.cssText="flex: 1; min-width: 0;",e.title){const t=document.createElement("div");t.style.cssText="font-weight: bold; margin-bottom: 4px;",t.textContent=e.title,s.appendChild(t)}const c=document.createElement("div");c.textContent=e.message||`Notifica ${e.type||"info"} - Messaggio non disponibile`,s.appendChild(c);const l=document.createElement("button");return l.style.cssText=`\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            padding: 0;\n            margin-left: 8px;\n            color: ${n.text};\n            opacity: 0.7;\n            flex-shrink: 0;\n        `,l.textContent="√ó",l.setAttribute("aria-label","Chiudi notifica"),l.onclick=()=>{t.remove();try{window.stateService&&"function"==typeof window.stateService.removeNotification&&window.stateService.removeNotification(e.id)}catch(i){console.debug("Could not remove from state:",i)}},r.appendChild(o),r.appendChild(s),r.appendChild(l),t.appendChild(r),t}static showConsoleFallback(e){const t={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},i=`${t[e.type]||t.info} NOTIFICATION: ${e.message||`Notifica ${e.type||"info"} - Messaggio non disponibile`}`;"error"===e.type?console.error(i):"warning"===e.type?console.warn(i):console.log(i)}static checkDOMReady(){if("undefined"==typeof document)return this.isDOMReady=!1,void 0;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.isDOMReady=!0,this.processNotificationQueue(),this.domReadyCallbacks.forEach(e=>{try{e()}catch(t){console.error("‚ùå DOM ready callback error:",t)}}),this.domReadyCallbacks=[]}):this.isDOMReady=!0}static checkAnimationSupport(){if("undefined"==typeof window||"undefined"==typeof document)return this.animationSupport=!1,void 0;try{const e=document.createElement("div");e.style.animation="test 1s",this.animationSupport=""!==e.style.animation}catch(e){this.animationSupport=!1}this.DEBUG&&console.log("üé¨ Animation support:",this.animationSupport)}static checkReducedMotionPreference(){if("undefined"==typeof window||!window.matchMedia)return this.reducedMotionPreference=!1,void 0;try{const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.reducedMotionPreference=e.matches,e.addEventListener("change",e=>{this.reducedMotionPreference=e.matches})}catch(e){this.reducedMotionPreference=!1}this.DEBUG&&console.log("üé¨ Reduced motion preference:",this.reducedMotionPreference)}static setupErrorRecovery(){setInterval(()=>{this.cleanupOldQueuedNotifications()},6e4),"undefined"!=typeof window&&window.addEventListener("error",e=>{e.message&&e.message.includes("notification")&&console.warn("‚ö†Ô∏è Possible notification-related error detected")})}static cleanupOldQueuedNotifications(){const e=Date.now(),t=this.notificationQueue.length;this.notificationQueue=this.notificationQueue.filter(t=>e-t.timestamp<6e4);const i=t-this.notificationQueue.length;i>0&&this.DEBUG&&console.log(`üßπ Cleaned up ${i} old queued notifications`)}static recoverFromShowError(e){console.log("üîÑ Attempting recovery from show error");try{const t=this.createSimpleFallback(e);if(t){const e=document.querySelector(".notification-container")||document.querySelector("#notification-container")||document.body;if(e)return e.appendChild(t),!0}}catch(t){console.error("‚ùå Show recovery failed:",t)}return this.showConsoleFallback(e),!1}static recoverFromRemoveError(e){console.log("üîÑ Attempting recovery from remove error");try{const t=document.querySelector(`[data-id="${e}"]`);if(t)return t.remove(),me.debug("‚úÖ Notification removed via DOM recovery"),!0}catch(t){console.error("‚ùå Remove recovery failed:",t)}return!1}static recoverFromClearError(){me.debug("üîÑ Attempting recovery from clear error");try{const e=document.querySelectorAll('.notification, [class*="notification"]');return e.forEach(e=>{try{e.remove()}catch(t){me.debug("Could not remove notification element:",t)}}),me.debug(`‚úÖ Cleared ${e.length} notifications via DOM recovery`),!0}catch(e){me.error("‚ùå Clear recovery failed:",e)}return!1}static recoverFromInitError(){me.debug("üîÑ Attempting recovery from init error");try{let e=document.querySelector(".notification-container");if(!e)return e=document.createElement("div"),e.className="notification-container notification-container--fallback",e.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    z-index: 9999;\n                    pointer-events: none;\n                ",document.body.appendChild(e),me.debug("‚úÖ Fallback notification container created"),!0}catch(e){me.error("‚ùå Init recovery failed:",e)}return!1}static getErrorStats(){return{...this.errorCounts,queueSize:this.notificationQueue.length,isDOMReady:this.isDOMReady,animationSupport:this.animationSupport,reducedMotionPreference:this.reducedMotionPreference}}static resetErrorStats(){this.errorCounts={render:0,animation:0,dom:0,service:0,total:0}}static shouldDisableAnimations(){return!this.animationSupport||this.reducedMotionPreference}static onDOMReady(e){if(this.isDOMReady)try{e()}catch(t){me.error("‚ùå DOM ready callback error:",t)}else this.domReadyCallbacks.push(e)}}"undefined"!=typeof window&&nt.init();const rt={SUCCESS:{icon:"check_circle",ariaRole:"status",ariaLive:"polite",defaultDuration:4e3},ERROR:{icon:"error",ariaRole:"alert",ariaLive:"assertive",defaultDuration:0},WARNING:{icon:"warning",ariaRole:"alert",ariaLive:"assertive",defaultDuration:6e3},INFO:{icon:"info",ariaRole:"status",ariaLive:"polite",defaultDuration:5e3}},ot={maxWidth:768};class at{constructor(e,t=4e3,i="success"){this.element=e,this.duration=t,this.type=i,this.startTime=null,this.animationId=null,this.isPaused=!1,this.pausedTime=0,this.isDestroyed=!1,this.timing=this.createEasingFunction("linear"),this.init()}createEasingFunction(e="linear"){const t={linear:e=>e,easeOut:e=>1-Math.pow(1-e,3),easeIn:e=>Math.pow(e,3),easeInOut:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2};return t[e]||t.linear}init(){if(this.isDestroyed)return;const e=this.element.querySelector(".notification__progress--js-placeholder");e?this.replaceProgressBarPlaceholder(e):this.element.querySelector(".notification__progress")||this.createProgressBar(),this.progressBar=this.element.querySelector(".notification__progress"),this.progressFill=this.element.querySelector(".notification__progress-fill"),this.progressBar&&this.progressFill&&this.start()}replaceProgressBarPlaceholder(e){e.classList.remove("notification__progress--js-placeholder"),e.classList.add("notification__progress--js-controlled"),e.setAttribute("aria-valuenow","100");const t={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"};e.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${t[this.type]||t.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const i=document.createElement("div");i.className="notification__progress-fill";const n={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"};i.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${n[this.type]||n.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,e.innerHTML="",e.appendChild(i)}createProgressBar(){const e={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"},t={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"},i=document.createElement("div");i.className="notification__progress notification__progress--js-controlled",i.setAttribute("role","progressbar"),i.setAttribute("aria-label","Tempo rimanente prima della chiusura automatica"),i.setAttribute("aria-valuemin","0"),i.setAttribute("aria-valuemax","100"),i.setAttribute("aria-valuenow","100"),i.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${e[this.type]||e.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const n=document.createElement("div");n.className="notification__progress-fill",n.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${t[this.type]||t.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,i.appendChild(n),this.element.appendChild(i)}start(){this.isDestroyed||(this.startTime=performance.now(),this.lastLoggedProgress=-1,this.animate({timing:this.timing,draw:e=>this.draw(e),duration:this.duration}))}animate({timing:e,draw:t,duration:i}){if(this.isDestroyed)return;const n=this.startTime,r=o=>{if(this.isDestroyed)return;if(this.isPaused)return this.animationId=requestAnimationFrame(r),void 0;let a=(o-n-this.pausedTime)/i;a>1&&(a=1),a<0&&(a=0);let s=e(a);t(s),this.updateAccessibility(a),a<1?this.animationId=requestAnimationFrame(r):this.onComplete()};this.animationId=requestAnimationFrame(r)}draw(e){if(this.isDestroyed||!this.progressFill)return;this.progressFill.style.transform=`scaleX(${1-e})`}updateAccessibility(e){if(this.progressBar){const t=Math.round(100*(1-e));this.progressBar.setAttribute("aria-valuenow",t.toString())}}pause(){this.isPaused||this.isDestroyed||(this.isPaused=!0,this.pauseStartTime=performance.now())}resume(){this.isPaused&&!this.isDestroyed&&(this.isPaused=!1,this.pauseStartTime&&(this.pausedTime+=performance.now()-this.pauseStartTime,this.pauseStartTime=null))}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.progressFill&&!this.isDestroyed&&(this.progressFill.style.transform="scaleX(0)")}onComplete(){if(this.isDestroyed)return;const e=new CustomEvent("progressComplete",{detail:{element:this.element,type:this.type,duration:this.duration}});this.element.dispatchEvent(e)}destroy(){this.isDestroyed=!0,this.stop(),this.progressBar&&this.progressBar.parentNode&&this.progressBar.parentNode.removeChild(this.progressBar),this.element=null,this.progressBar=null,this.progressFill=null}}function st(e,{allowHTML:t=!1}={}){if(!t){const t=document.createElement("div");return t.textContent=String(e??""),t.innerHTML}const i=document.createElement("div");i.innerHTML=String(e??"");const n=new Set(["b","strong","i","em","u","br","code","pre","span","p","ul","ol","li","a"]),r=e=>{if(e.nodeType===Node.COMMENT_NODE)return e.remove(),void 0;if(e.nodeType===Node.ELEMENT_NODE){const t=e;if(!n.has(t.tagName.toLowerCase())){const e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);return e.removeChild(t),void 0}[...t.attributes].forEach(e=>{const i=e.name.toLowerCase(),n=String(e.value||"");if(i.startsWith("on")||"style"===i)t.removeAttribute(e.name);else if("a"===t.tagName.toLowerCase()&&"href"===i){/^(https?:|mailto:)/i.test(n)||t.removeAttribute("href")}else"href"!==i&&"title"!==i&&t.removeAttribute(e.name)})}let t=e.firstChild;for(;t;){const e=t.nextSibling;r(t),t=e}};return r(i),i.innerHTML}function ct({notification:e,_index:t=0,settings:i,timers:n,removeNotification:r,startAutoCloseTimer:o,pauseAutoCloseTimer:a,resumeAutoCloseTimer:s,announceNotification:c,attachNotificationEvents:l,attachTouchEvents:d,notificationContainer:u,errorHandler:h=nt}){try{const t=rt[e.type.toUpperCase()]||rt.INFO,v=e.options||{},w=function(e,t){if(void 0!==t)return t;const i=rt[e.toUpperCase()];return i?i.defaultDuration:5e3}(e.type,v.duration),E=document.createElement("div");let S=`notification notification--${e.type}`;if(w>0&&!v.persistent&&(S+=" notification--autoclose"),E.className=S,E.dataset.id=e.id,E.setAttribute("role",t.ariaRole),E.setAttribute("aria-live",t.ariaLive),E.setAttribute("aria-atomic","true"),E.setAttribute("tabindex","0"),i.enableAnimations&&!h.shouldDisableAnimations())try{E.classList.add("notification--entering"),E.addEventListener("animationend",e=>{(e.animationName.includes("slideIn")||e.animationName.includes("fadeIn"))&&(E.classList.remove("notification--entering"),E.classList.add("notification--visible"))}),E.addEventListener("animationerror",e=>{h.handleAnimationError(new Error("Animation failed"),E,"entrance")})}catch(p){h.handleAnimationError(p,E,"entrance")}else E.classList.add("notification--visible","notification--no-animations");let _="";try{_=`\n                <div class="notification__content">\n                    <span class="material-icons notification__icon" aria-hidden="true">${t.icon}</span>\n                    <div class="notification__body">\n                        ${v.title?`<div class="notification__title">${st(v.title,{allowHTML:!1})}</div>`:""}\n                        <div class="notification__message">${st(e.message,{allowHTML:!!v.allowHTML})}</div>\n                    </div>\n                </div>\n            `,v.duplicateCount&&v.duplicateCount>1&&(_=_.replace('<span class="material-icons notification__icon" aria-hidden="true">',`<span class="notification__count" aria-label="Ripetuta ${v.duplicateCount} volte">√ó${v.duplicateCount}</span><span class="material-icons notification__icon" aria-hidden="true">`)),(!1!==v.closable||v.actions)&&(_+='<div class="notification__actions">',v.actions&&Array.isArray(v.actions)&&v.actions.forEach((e,t)=>{_+=`\n                            <button class="notification__action-btn ${"primary"===e.style?"notification__action-btn--primary":"secondary"===e.style?"notification__action-btn--secondary":""}" \n                                    data-action-index="${t}"\n                                    aria-label="${st(e.label,{allowHTML:!1})}">\n                                ${st(e.label,{allowHTML:!1})}\n                            </button>\n                        `}),!1!==v.closable&&(_+='\n                        <button class="notification__close" \n                                aria-label="Chiudi notifica"\n                                title="Chiudi notifica">\n                            <span class="material-icons" aria-hidden="true">close</span>\n                        </button>\n                    '),_+="</div>");const i=w;i>0&&!v.persistent&&(me.debug(`üîß Creating progress bar placeholder for ${e.type} (${i}ms)`),_+=`\n                    <div class="notification__progress notification__progress--js-placeholder" \n                         aria-hidden="true" \n                         role="progressbar"\n                         aria-label="Tempo rimanente prima della chiusura automatica"\n                         data-duration="${i}"\n                         data-type="${e.type}"></div>\n                `),E.innerHTML=_}catch(g){me.error("‚ùå Error building notification HTML:",g),E.innerHTML=`\n                <div class="notification__content">\n                    <span class="notification__icon">!</span>\n                    <div class="notification__body">\n                        <div class="notification__message">${e.message||"Notifica"}</div>\n                    </div>\n                    <button class="notification__close" aria-label="Chiudi">√ó</button>\n                </div>\n            `}try{l(E,e,{timers:n,removeNotification:r,pauseAutoCloseTimer:a,resumeAutoCloseTimer:s,notificationContainer:u})}catch(m){me.error("‚ùå Error attaching notification events:",m);const t=E.querySelector(".notification__close");t&&t.addEventListener("click",()=>{try{r(e.id)}catch(t){E.remove()}})}try{window.innerWidth<=ot.maxWidth&&d(E,e,{pauseAutoCloseTimer:a,resumeAutoCloseTimer:s,removeNotification:r})}catch(f){me.error("‚ùå Error attaching touch events:",f)}try{const t=w;if(t>0&&!v.persistent){const i=E.querySelector(".notification__progress--js-placeholder");if(me.debug("üîç Looking for progress bar placeholder:",i),i){const i=new at(E,t,e.type);o(n,e.id,t,()=>{try{r(e.id)}catch(t){me.error("‚ùå Error in progress complete callback:",t),E.parentNode&&E.remove()}}),window.innerWidth>768&&(E.addEventListener("mouseenter",()=>{i&&i.pause()}),E.addEventListener("mouseleave",()=>{i&&i.resume()})),E.addEventListener("progressComplete",()=>{try{r(e.id)}catch(t){me.error("‚ùå Error in progress complete callback:",t),E.parentNode&&E.remove()}}),E._progressBarInstance=i,me.debug(`‚úÖ JavaScript progress bar initialized for ${e.type} (${t}ms)`)}else o(n,e.id,t,()=>{try{r(e.id)}catch(t){console.error("‚ùå Error in auto-close callback:",t),E.parentNode&&E.remove()}}),me.debug(`‚úÖ Fallback timer used for ${e.type} (${t}ms)`)}}catch(y){me.error("‚ùå Error setting up auto-close timer:",y)}try{c(e.type,e.message,v.title||"")}catch(b){me.warn("‚ùå Error announcing notification:",b)}return E}catch(v){return me.error("‚ùå Critical error in createNotificationElement:",v),h.createSimpleFallback(e)}}function lt(e,t,i,n){if(e.has(t)){const i=e.get(t);clearTimeout(i.timerId)}const r=Date.now(),o=setTimeout(()=>{e.delete(t),n(t)},i);e.set(t,{timerId:o,originalDuration:i,startTime:r,remainingTime:i,isPaused:!1,pausedAt:null,callback:n})}function dt(e,t){const i=e.get(t);i&&!i.isPaused&&(clearTimeout(i.timerId),i.isPaused=!0,i.pausedAt=Date.now(),i.remainingTime=i.remainingTime-(i.pausedAt-i.startTime),me.debug(`‚è∏Ô∏è Timer paused for notification: ${t}`))}function ut(e,t){const i=e.get(t);i&&i.isPaused&&(i.isPaused=!1,i.startTime=Date.now(),i.timerId=setTimeout(()=>{e.delete(t),i.callback&&i.callback(t)},i.remainingTime),me.debug(`‚ñ∂Ô∏è Timer resumed for notification: ${t}`))}function ht(e,t,i){const n=e.get(t);if(n){clearTimeout(n.timerId),e.delete(t);try{"function"==typeof i&&i(t)}catch(r){me.warn("Timer onStop callback error:",r)}me.debug(`‚èπÔ∏è Timer stopped for notification: ${t}`)}}const pt=new class{getDefaultAnimationSetting(){try{return"undefined"==typeof window||!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches}catch(e){return!0}}constructor(){this.state={currentView:"home",previousView:null,editPazienteId:null,selectedPazienteId:null,listFilters:{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"},eventiCliniciFilters:{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"},formData:{},isLoading:!1,loadingMessage:"",errors:[],notifications:[],notificationSettings:{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:this.getDefaultAnimationSetting(),autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}},user:null,isAuthenticated:!1},this.subscribers=new Map,this.persistentKeys=["listFilters","editPazienteId","formData","eventiCliniciFilters","notificationSettings"],this.cleanupTimer=null,this.loadPersistedState(),this.startAutoCleanup()}loadPersistedState(){try{this.persistentKeys.forEach(e=>{const t=localStorage.getItem(`app_state_${e}`);t&&(this.state[e]=JSON.parse(t))});const e=this.state.notificationSettings||{};Array.isArray(e.persistentTypes)?e.persistentTypes.includes("error")||e.persistentTypes.unshift("error"):e.persistentTypes=["error"],e.customDurations=e.customDurations||{},(void 0===e.customDurations.error||e.customDurations.error>0)&&(e.customDurations.error=0),this.state.notificationSettings=e}catch(e){me.warn("Errore durante il caricamento dello stato persistente:",e)}}persistState(){try{this.persistentKeys.forEach(e=>{null!=this.state[e]&&localStorage.setItem(`app_state_${e}`,JSON.stringify(this.state[e]))})}catch(e){me.warn("Errore durante il salvataggio dello stato persistente:",e)}}getState(e){return e?this.state[e]:{...this.state}}setState(e,t){const i="string"==typeof e?{[e]:t}:e,n={...this.state};void 0===i.notifications||Array.isArray(i.notifications)||(console.warn("‚ö†Ô∏è StateService: notifications must be an array, got:",typeof i.notifications),i.notifications=[]),Object.assign(this.state,i);const r=Object.keys(i);r.some(e=>this.persistentKeys.includes(e))&&this.persistState(),this.notifySubscribers(r,n)}subscribe(e,t){const i=Array.isArray(e)?e:[e],n=Symbol("subscriber");return this.subscribers.set(n,{keys:i,callback:t}),()=>{this.subscribers.delete(n)}}notifySubscribers(e,t){this.subscribers.forEach(({keys:i,callback:n},r)=>{if(i.some(t=>e.includes(t)))try{const o=n(this.state,t,e);o&&"function"==typeof o.then&&o.catch(o=>{console.error(`Errore async in subscriber callback [${n.name||"(anonymous)"}] (subscriberId: ${String(r)}):`,o,"\nchangedKeys:",e,"\nsubscriber keys:",i,"\ncurrent state:",this.state,"\nold state:",t,"\ncallback:",n.toString())})}catch(o){console.error(`Errore in subscriber callback [${n.name||"(anonymous)"}] (subscriberId: ${String(r)}):`,o,"\nchangedKeys:",e,"\nsubscriber keys:",i,"\ncurrent state:",this.state,"\nold state:",t,"\ncallback:",n.toString())}})}clearState(e=["user","isAuthenticated"]){this.stopAutoCleanup();const t={};e.forEach(e=>{void 0!==this.state[e]&&(t[e]=this.state[e])});const i={currentView:"home",previousView:null,editPazienteId:null,selectedPazienteId:null,listFilters:{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"},eventiCliniciFilters:{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"},formData:{},isLoading:!1,loadingMessage:"",errors:[],notifications:[],notificationSettings:{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:this.getDefaultAnimationSetting(),autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}},user:null,isAuthenticated:!1};this.state={...i,...t},this.persistentKeys.forEach(t=>{e.includes(t)||localStorage.removeItem(`app_state_${t}`)}),e.includes("notificationSettings")&&this.startAutoCleanup()}setEditPatient(e){this.setState("editPazienteId",e)}getEditPatientId(){return this.getState("editPazienteId")}clearEditPatient(){this.setState("editPazienteId",null)}updateFilters(e){this.setState("listFilters",{...this.getState("listFilters"),...e})}getFilters(){return this.getState("listFilters")}resetFilters(){this.setState("listFilters",{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"})}setFormData(e){this.setState("formData",e)}getFormData(){return this.getState("formData")}clearFormData(){this.setState("formData",{})}setLoading(e,t=""){this.setState({isLoading:e,loadingMessage:t})}addNotification(e,t,i={}){"number"==typeof i&&(i={duration:i});const n=this.normalizeNotificationType(e),r={maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:!0,autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0},...this.getState("notificationSettings")},o=r.customDurations&&void 0!==r.customDurations[n]?r.customDurations[n]:r.defaultDuration,a={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:n,message:t,timestamp:new Date,isVisible:!0,isRemoving:!1,options:{duration:o,persistent:r.persistentTypes.includes(n),closable:!0,position:r.position,priority:0,duplicateCount:1,...i}};a.options.persistent&&(a.options.duration=0);const s=this.getState("notifications");me.debug(`[StateService] Current notifications before adding: ${s.length}`,s);try{const e=Date.now(),r=1500;if(("success"===n||"info"===n)&&!1!==i.dedupe){const i=[...s].reverse().findIndex(i=>{const o=new Date(i.timestamp).getTime();return i.type===n&&i.message===t&&e-o<=r});if(-1!==i){const e=s.length-1-i,t=s[e],n={...t,timestamp:new Date,options:{...t.options,duplicateCount:(t.options?.duplicateCount||1)+1}},r=s.slice();return r[e]=n,this.setState("notifications",r),void 0}}}catch(l){}let c=[...s,a];if(c.length>r.maxStoredNotifications){me.warn(`[StateService] Max stored notifications (${r.maxStoredNotifications}) exceeded. Trimming old notifications.`);const e=c.sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)).slice(0,c.length-r.maxStoredNotifications);c=c.filter(t=>!e.includes(t)||t.options.persistent&&"error"===t.type),me.debug(`[StateService] Notifications after trimming: ${c.length}`,c)}return this.setState("notifications",c),me.debug(`[StateService] Notification added. New notifications array length: ${this.getState("notifications").length}`,this.getState("notifications")),a.id}normalizeNotificationType(e){const t=String(e||"").toLowerCase().trim();return t?["error","errore","err","danger","fatal"].includes(t)?"error":["success","ok","successo"].includes(t)?"success":["warning","warn","avviso","alert"].includes(t)?"warning":(["info","informazione","notice"].includes(t),"info"):"info"}removeNotification(e){const t=this.getState("notifications");me.debug("[StateService] Notifiche prima della rimozione:",t);const i=t.filter(t=>t.id!==e);this.setState("notifications",i);const n=this.getState("notifications");me.debug("[StateService] Notifiche dopo la rimozione:",n)}updateNotificationSettings(e){const t={...this.getState("notificationSettings"),...e};this.setState("notificationSettings",t),void 0!==e.autoCleanupInterval&&this.startAutoCleanup()}getNotificationSettings(){return this.getState("notificationSettings")}clearAllNotifications(){this.setState("notifications",[])}clearNotificationsByType(e){const t=this.getState("notifications").filter(t=>t.type!==e);this.setState("notifications",t)}clearOldNotifications(e=3e5){const t=new Date,i=this.getState("notifications"),n=i.filter(i=>{const n=t-new Date(i.timestamp);return!(!i.options.persistent||"error"!==i.type)||n<e});return this.setState("notifications",n),i.length-n.length}markNotificationRemoving(e){const t=this.getState("notifications").map(t=>t.id===e?{...t,isRemoving:!0}:t);this.setState("notifications",t)}getNotificationsByType(e){return this.getState("notifications").filter(t=>t.type===e)}getVisibleNotifications(){return this.getState("notifications").filter(e=>e.isVisible&&!e.isRemoving)}countNotificationsByType(e){return this.getNotificationsByType(e).length}hasErrorNotifications(){return this.countNotificationsByType("error")>0}startAutoCleanup(){this.cleanupTimer&&clearInterval(this.cleanupTimer);const e=this.getState("notificationSettings");this.cleanupTimer=setInterval(()=>{const t=this.clearOldNotifications(e.autoCleanupInterval);t>0&&me.debug(`Cleanup automatico: rimosse ${t} notifiche vecchie`)},e.autoCleanupInterval)}stopAutoCleanup(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}getNotificationStats(){const e=this.getState("notifications");return{total:e.length,visible:e.filter(e=>e.isVisible&&!e.isRemoving).length,byType:{success:e.filter(e=>"success"===e.type).length,error:e.filter(e=>"error"===e.type).length,warning:e.filter(e=>"warning"===e.type).length,info:e.filter(e=>"info"===e.type).length},persistent:e.filter(e=>e.options.persistent).length,oldest:e.length>0?Math.min(...e.map(e=>new Date(e.timestamp).getTime())):null,newest:e.length>0?Math.max(...e.map(e=>new Date(e.timestamp).getTime())):null}}exportNotificationSettings(){return{settings:this.getState("notificationSettings"),timestamp:(new Date).toISOString(),version:"1.0"}}importNotificationSettings(e){try{return!("1.0"!==e.version||!e.settings)&&(this.updateNotificationSettings(e.settings),!0)}catch(t){return me.error("Errore durante importazione impostazioni notifiche:",t),!1}}setCurrentView(e,t=null){this.setState({currentView:e,previousView:t||this.getState("currentView")})}getCurrentView(){return this.getState("currentView")}setUser(e){this.setState({user:e,isAuthenticated:!!e})}getUser(){return this.getState("user")}isAuthenticated(){return this.getState("isAuthenticated")}updateEventiCliniciFilters(e){this.setState("eventiCliniciFilters",{...this.getState("eventiCliniciFilters"),...e})}getEventiCliniciFilters(){return this.getState("eventiCliniciFilters")}resetEventiCliniciFilters(){this.setState("eventiCliniciFilters",{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"})}destroy(){this.stopAutoCleanup(),this.subscribers.clear(),this.persistentKeys.forEach(e=>{localStorage.removeItem(`app_state_${e}`)})}},gt=Object.freeze(Object.defineProperty({__proto__:null,stateService:pt},Symbol.toStringTag,{value:"Module"}));class mt{static DEBUG=!1;constructor(){this.notificationContainer=null,this.timers=new Map,this.initialized=!1,this.isRendering=!1,this.settings=pt.getNotificationSettings(),this._lastRenderedNotificationIds=[],this._renderCount=0,this._lastRenderTime=0,this._averageRenderTime=0,this._unsubscribe=null,this._unsubscribeSettings=null}flush(){try{const e=pt.getState("notifications")||[];this.renderNotifications(e)}catch{}}async init(){if(!this.initialized&&"undefined"!=typeof window)try{await this.#e(),function(){try{Ze=Ke.getInstance({id:"notification-announcer"})}catch(e){if(!document.getElementById("notification-announcer")){const e=document.createElement("div");e.id="notification-announcer",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;",document.body.appendChild(e)}}}(),this._unsubscribe=pt.subscribe("notifications",this.#t),this._unsubscribeSettings=pt.subscribe("notificationSettings",e=>{try{if(this.settings=pt.getNotificationSettings(),this.notificationContainer){this.notificationContainer.updateSettings({position:this.settings.position,maxVisible:this.settings.maxVisible})}}catch{}}),this.initialized=!0,"undefined"!=typeof document&&(this._visibilityHandler=()=>{try{document.hidden?this.#i():this.#n()}catch{}},document.addEventListener("visibilitychange",this._visibilityHandler,{passive:!0}))}catch(e){nt.handleServiceError(e,"init"),this.initialized=!0}}async#e(){if(this.notificationContainer)return;const{NotificationContainer:e}=await n(async()=>{const{NotificationContainer:e}=await import("./NotificationContainer-CzhXFxPx.js");return{NotificationContainer:e}},[]);this.notificationContainer=new e({position:this.settings.position,maxVisible:this.settings.maxVisible})}show(e,t,i={}){try{const n=this.#r(e),r=String(t||"").trim();if(!r){return this.show(n,`Notifica ${n} - Messaggio non disponibile`,i)}const o=this.#o(n),a=this.#a(i,o);return pt.addNotification(n,r,a)}catch(n){return nt.handleServiceError(n,"show",{type:e,message:t,options:i}),nt.recoverFromShowError({type:this.#r(e),message:t,options:i,id:Date.now().toString()})}}success(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("success",e,t)}info(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("info",e,t)}warning(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("warning",e,t)}error(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("error",e,t)}renderNotifications(e=[]){if(Array.isArray(e)&&this.notificationContainer&&!this.isRendering){this.isRendering=!0;try{const i="undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?()=>window.performance.now():()=>Date.now(),n=i(),r=new Set(e.map(e=>e.id)),o=new Set(this._lastRenderedNotificationIds);o.forEach(e=>{if(!r.has(e))try{this.notificationContainer.removeNotification(e)}catch(t){nt.handleDOMError(t,"remove",null)}}),e.forEach(e=>{if(!o.has(e.id))try{this.#s(e)}catch(t){nt.handleRenderError(t,e,e=>{const t=nt.createSimpleFallback(e);return t&&this.notificationContainer.addNotification(t),t})}}),e.forEach(e=>{if(o.has(e.id))try{const t=this.notificationContainer.container?.querySelector(`[data-id="${e.id}"]`);if(!t)return;const i=e?.options?.duplicateCount||1;let n=t.querySelector(".notification__count");if(i>1)if(n)n.textContent=`√ó${i}`,n.setAttribute("aria-label",`Ripetuta ${i} volte`);else{const e=t.querySelector(".notification__icon");n=document.createElement("span"),n.className="notification__count",n.setAttribute("aria-label",`Ripetuta ${i} volte`),n.textContent=`√ó${i}`,e&&e.parentNode?e.parentNode.insertBefore(n,e):t.querySelector(".notification__content")?.prepend(n)}else n&&n.remove()}catch(t){}});const a=Math.max(0,e.length-this.settings.maxVisible),s=a>0?e.slice(0,a):[];t=e=>this.removeNotification(e),void s.forEach(e=>{"success"!==e.type&&"info"!==e.type||setTimeout(()=>{t(e.id)},1e3)}),this._lastRenderedNotificationIds=e.map(e=>e.id);const c=i(),l=Math.max(0,c-n);this._lastRenderTime=l,this._renderCount+=1,this._averageRenderTime=1===this._renderCount?l:(this._averageRenderTime*(this._renderCount-1)+l)/this._renderCount}finally{this.isRendering=!1}var t}}#s(e){const t=ct({notification:e,settings:this.settings,timers:this.timers,removeNotification:e=>this.removeNotification(e),handleAction:(e,t)=>this.handleAction(e,t),startAutoCloseTimer:lt,pauseAutoCloseTimer:dt,resumeAutoCloseTimer:ut,announceNotification:et,attachNotificationEvents:tt,attachTouchEvents:it,notificationContainer:this.notificationContainer,errorHandler:nt});if(!t)throw new Error("createNotificationElement returned null");this.notificationContainer.addNotification(t)}#t=this.#c(e=>{let t=[];Array.isArray(e)?t=e:e&&"object"==typeof e&&(t=e.notifications||[]),this.renderNotifications(t)},16);removeNotification(e){try{if(ht(this.timers,e,()=>this.#l(e)),!this.notificationContainer)return pt.removeNotification(e),void 0;const t=this.notificationContainer.container?.querySelector(`[data-id="${e}"]`),i=this.settings.enableAnimations&&!nt.shouldDisableAnimations();if(t&&i)try{t.classList.remove("notification--entering"),t.classList.add("notification--exiting");const i=t.querySelector(".notification__progress");return i&&i.classList.remove("notification__progress--active","notification__progress--paused","notification__progress--resumed"),setTimeout(()=>this.#d(e),300),void 0}catch{}this.#d(e)}catch(t){nt.handleServiceError(t,"remove",e),nt.recoverFromRemoveError(e)}}#d(e){try{this.notificationContainer&&this.notificationContainer.removeNotification(e)}catch{}pt.removeNotification(e)}clear(){try{this.timers.forEach((e,t)=>ht(this.timers,t,()=>this.#l(t))),this.timers.clear(),this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications(),pt.clearAllNotifications()}catch(e){nt.handleServiceError(e,"clear"),nt.recoverFromClearError()}}clearByType(e){(pt.getState("notifications")||[]).forEach(t=>{t.type===e&&this.timers.has(t.id)&&ht(this.timers,t.id,()=>this.#l(t.id))}),pt.clearNotificationsByType(e)}startAutoCloseTimer(e,t){try{lt(this.timers,e,t,e=>this.removeNotification(e))}catch{}}pauseAutoCloseTimer(e){try{dt(this.timers,e)}catch{}}resumeAutoCloseTimer(e){try{ut(this.timers,e)}catch{}}stopAutoCloseTimer(e){try{ht(this.timers,e,()=>this.#l(e))}catch{}}handleAction(e,t){try{const i=(pt.getState("notifications")||[]).find(t=>t.id===e),n=i?.options?.actions?.[t];n&&"function"==typeof n.onClick&&n.onClick({id:e,index:t,notification:i})}catch{}}setCustomDurations(e){this.updateSettings({customDurations:{...this.settings.customDurations||{},...e}})}setPersistentTypes(e){this.updateSettings({persistentTypes:[...e]})}setAutoCleanupInterval(e){this.updateSettings({autoCleanupInterval:e})}updatePosition(e){this.updateSettings({position:e})}setMaxVisible(e){this.updateSettings({maxVisible:e});const t=pt.getState("notifications")||[];this.renderNotifications(t)}enableSounds(e=!0){this.updateSettings({enableSounds:!!e})}updateSettings(e){try{const t=this._validateSettings(e);if(pt.updateNotificationSettings(t),this.settings=pt.getNotificationSettings(),this.notificationContainer){const e={};"position"in t&&(e.position=this.settings.position),"maxVisible"in t&&(e.maxVisible=this.settings.maxVisible),Object.keys(e).length&&this.notificationContainer.updateSettings(e)}return!0}catch{return!1}}getStats(){try{return{..."function"==typeof pt.getNotificationStats?pt.getNotificationStats():{total:0,visible:0,byType:{success:0,error:0,warning:0,info:0},persistent:0},settings:this.settings,activeTimers:this.timers.size,containerInitialized:!!this.notificationContainer,serviceInitialized:this.initialized,performance:{renderCount:this._renderCount,averageRenderTime:this._averageRenderTime,lastRenderTime:this._lastRenderTime}}}catch(e){return{total:0,visible:0,byType:{success:0,error:0,warning:0,info:0},persistent:0,error:e?.message}}}exportSettings(){try{const e=pt.exportNotificationSettings();return e.serviceMetadata={version:"2.0",exportedBy:"NotificationService"},e}catch(e){return null}}importSettings(e){try{if(!e||"object"!=typeof e||!e.settings)return!1;e.version&&"1.0"!==e.version&&me.warn(`Versione backup non supportata: ${e.version}`);const t=pt.importNotificationSettings(e);return t&&(this.settings=pt.getNotificationSettings()),t}catch(t){return!1}}cleanupOldNotifications(e=3e5){try{if("function"==typeof pt.clearOldNotifications){const t=pt.clearOldNotifications(e)??0,i=new Set((pt.getState("notifications")||[]).map(e=>e.id));return Array.from(this.timers.keys()).forEach(e=>{i.has(e)||this.timers.delete(e)}),t}const t=Date.now(),i=pt.getState("notifications")||[];let n=0;i.forEach(i=>{const r=new Date(i.timestamp).getTime();if(Number.isFinite(r)&&t-r>e)try{pt.removeNotification(i.id),n+=1}catch{}});const r=new Set((pt.getState("notifications")||[]).map(e=>e.id));return Array.from(this.timers.keys()).forEach(e=>{r.has(e)||this.timers.delete(e)}),n}catch{return 0}}_validateSettings(e){const t={},i=e=>"number"==typeof e&&!Number.isNaN(e),n=e=>"boolean"==typeof e;if(void 0!==e.maxVisible){if(!Number.isInteger(e.maxVisible)||e.maxVisible<1||e.maxVisible>20)throw new Error("maxVisible must be between 1 and 20");t.maxVisible=e.maxVisible}if(void 0!==e.defaultDuration){if(!i(e.defaultDuration)||e.defaultDuration<0)throw new Error("defaultDuration must be >= 0");t.defaultDuration=e.defaultDuration}if(void 0!==e.position){if(!["top-right","top-left","bottom-right","bottom-left","top-center","bottom-center"].includes(e.position))throw new Error("invalid position");t.position=e.position}if(void 0!==e.enableSounds){if(!n(e.enableSounds))throw new Error("enableSounds must be boolean");t.enableSounds=e.enableSounds}if(void 0!==e.enableAnimations){if(!n(e.enableAnimations))throw new Error("enableAnimations must be boolean");t.enableAnimations=e.enableAnimations}if(void 0!==e.autoCleanupInterval){if(!i(e.autoCleanupInterval)||e.autoCleanupInterval<6e4)throw new Error("autoCleanupInterval must be >= 60000");t.autoCleanupInterval=e.autoCleanupInterval}if(void 0!==e.maxStoredNotifications){if(!Number.isInteger(e.maxStoredNotifications)||e.maxStoredNotifications<10)throw new Error("maxStoredNotifications must be >= 10");t.maxStoredNotifications=e.maxStoredNotifications}if(void 0!==e.persistentTypes){if(!Array.isArray(e.persistentTypes))throw new Error("persistentTypes must be array");t.persistentTypes=[...e.persistentTypes]}if(void 0!==e.soundVolume){if(!i(e.soundVolume)||e.soundVolume<0||e.soundVolume>1)throw new Error("soundVolume must be between 0 and 1");t.soundVolume=e.soundVolume}if(void 0!==e.customDurations){const n=["success","error","warning","info"],r=e.customDurations;if(!r||"object"!=typeof r)throw new Error("customDurations must be object");for(const e of Object.keys(r))if(!n.includes(e)||!i(r[e])||r[e]<0)throw new Error("invalid customDurations entry");t.customDurations={...r}}return t}getNotificationsByType(e){try{return pt.getNotificationsByType(e)}catch{return[]}}getVisibleNotifications(){try{return pt.getVisibleNotifications()}catch{return[]}}hasErrors(){try{return pt.hasErrorNotifications()}catch{return!1}}destroy(){try{if(this.timers.forEach((e,t)=>ht(this.timers,t)),this.timers.clear(),this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications(),this._visibilityHandler&&"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this._visibilityHandler),"function"==typeof this._unsubscribe){try{this._unsubscribe()}catch{}this._unsubscribe=null}if("function"==typeof this._unsubscribeSettings){try{this._unsubscribeSettings()}catch{}this._unsubscribeSettings=null}}finally{this.notificationContainer=null,this.initialized=!1}}#o(e){const t=this.settings||{},i=(t.customDurations||{})[e];return(t.persistentTypes||[]).includes(e)?0:"number"==typeof i?i:"number"==typeof t.defaultDuration?t.defaultDuration:5e3}#a(e,t){return{duration:void 0!==e.duration?e.duration:t,closable:!1!==e.closable,position:e.position||this.settings.position,priority:e.priority||0,title:e.title,actions:e.actions,persistent:e.persistent,...e}}#l(e){try{const t=this.notificationContainer?.container?.querySelector(`[data-id="${e}"]`);t&&t._progressBarInstance&&(t._progressBarInstance.destroy(),t._progressBarInstance=null)}catch{}}#u(e){try{const t=this.notificationContainer?.container?.querySelector(`[data-id="${e}"]`);t&&t._progressBarInstance&&"function"==typeof t._progressBarInstance.pause&&t._progressBarInstance.pause()}catch{}}#h(e){try{const t=this.notificationContainer?.container?.querySelector(`[data-id="${e}"]`);t&&t._progressBarInstance&&"function"==typeof t._progressBarInstance.resume&&t._progressBarInstance.resume()}catch{}}#i(){try{this.timers.forEach((e,t)=>{try{dt(this.timers,t)}catch{}this.#u(t)})}catch{}}#n(){try{this.timers.forEach((e,t)=>{try{ut(this.timers,t)}catch{}this.#h(t)})}catch{}}#c(e,t){let i=!1;return(...n)=>{i||(e.apply(this,n),i=!0,setTimeout(()=>i=!1,t))}}#r(e){const t=String(e||"").toLowerCase();switch(t){case"errore":case"danger":case"err":case"error":return"error";case"successo":case"ok":case"success":return"success";case"avviso":case"warn":case"warning":return"warning";default:return"info"===t||"informazione"===t?"info":t||"info"}}}const ft=new mt;function yt(){!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("theme-icon");if(!e||!t)return;bt(localStorage.getItem("theme")||"light"),e.addEventListener("click",()=>{bt("dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?"light":"dark")})}(),function(){const e=document.getElementById("mobile-theme-toggle"),t=document.getElementById("mobile-theme-icon");if(!e||!t)return;function i(){"dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?(t.textContent="light_mode",e.setAttribute("title","Modalit√† chiara")):(t.textContent="dark_mode",e.setAttribute("title","Modalit√† scura"))}e.addEventListener("click",e=>{e.preventDefault();bt("dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?"light":"dark")});new MutationObserver(i).observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),i()}()}function bt(e){document.documentElement.setAttribute("data-bs-theme",e),localStorage.setItem("theme",e);const t=document.getElementById("theme-icon"),i=document.getElementById("theme-toggle");t&&i&&("dark"===e?(t.textContent="light_mode",i.setAttribute("title","Modalit√† chiara")):(t.textContent="dark_mode",i.setAttribute("title","Modalit√† scura")))}function vt(e){const t=document.getElementById("auth-container");if(t){if(e){const i=Oe.profile?.role||"caricamento...",n=e.user.email;t.innerHTML=le(`\n            <div class="d-flex align-items-center text-light">\n                <span class="navbar-text me-3" title="${n}">\n                    <i class="material-icons me-1" style="font-size: 1.1em; vertical-align: text-bottom;">account_circle</i>\n                    ${n.split("@")[0]}\n                </span>\n                <span class="badge bg-info me-3 text-uppercase" style="font-size: 0.75em; padding: 0.4em 0.6em;">\n                    ${i}\n                </span>\n                <button id="logout-button" class="btn btn-outline-light btn-sm">\n                    <i class="material-icons" style="font-size: 1em; vertical-align: middle;">logout</i>\n                </button>\n            </div>\n        `)}else t.innerHTML=le('\n            <button id="login-modal-trigger" class="btn btn-outline-light">\n                <i class="material-icons me-1" style="font-size: 1em;">login</i>\n                Accedi\n            </button>\n        ');je()}}function wt(){window.addEventListener("auth:session-changed",e=>{vt(e.detail?.session||null)}),void 0!==Oe&&vt(Oe.session||null),document.body.addEventListener("click",async e=>{if(e.target.closest("#logout-button")&&(e.preventDefault(),await Me()),e.target.closest("#login-modal-trigger")&&(e.preventDefault(),async function(){let e=document.getElementById("auth-modal");if(!e){const{default:t}=await n(async()=>{const{default:e}=await import("./auth-modal-VMurGtIz.js");return{default:e}},[]),i=document.createElement("div");i.innerHTML=le(t),document.body.appendChild(i.firstElementChild),e=document.getElementById("auth-modal")}const t=document.getElementById("auth-error-message");t&&(t.style.display="none");new i(e).show()}()),e.target.closest("#google-login-btn")){e.preventDefault(),me.log("Pulsante Google cliccato");const n=e.target.closest("#google-login-btn"),r=n.querySelector(".spinner-border"),o=n.querySelector(".material-icons");n.disabled=!0,r&&(r.style.display="inline-block"),o&&(o.style.display="none");try{await async function(){return await De.signInWithGoogle()}();!function(){const e=document.getElementById("auth-modal");if(e){const t=i.getInstance(e);t&&t.hide()}}()}catch(t){console.error("Errore durante l'accesso:",t);const e=document.getElementById("auth-error");e&&(e.textContent="Errore durante l'accesso. Riprova.",e.style.display="block")}finally{n.disabled=!1,r&&(r.style.display="none"),o&&(o.style.display="inline-block")}}})}window.addEventListener("load",async function(){try{me.log(`üöÄ Inizializzazione ${he} v${pe}`),Ye(),yt(),Xe(),function(){Fe(),window.addEventListener("resize",Fe);const e=document.getElementById("auth-container");e&&new MutationObserver(je).observe(e,{childList:!0,subtree:!0});setTimeout(je,150),window.addEventListener("auth:session-changed",()=>{je()})}(),window.authUIListenersInitialized||(wt(),window.authUIListenersInitialized=!0),ft.init(),window.addEventListener("hashchange",Je),await async function(e){De.init();try{if("undefined"!=typeof window&&window.__PW_E2E_AUTH_MOCK){const t={user:{id:"e2e-user-123",email:"e2e@example.com",user_metadata:{name:"E2E User"}},access_token:"e2e-token"};return await Ie(t),e&&e(t),me.log("E2E auth mock attivo: sessione e profilo impostati"),void 0}}catch{}const{data:{session:t}}=await ke.auth.getSession();me.log("Sessione iniziale recuperata:",t),await Ie(t),e&&e(t),ke.auth.onAuthStateChange(async(t,i)=>{me.log("Auth event:",t,"Session:",i),"SIGNED_OUT"===t&&"error"===De.getAuthState().state&&De.clearCorruptedState(),i?.access_token!==Oe.session?.access_token&&(await Ie(i),e&&e(i))}),me.log("Sistema di autenticazione inizializzato")}(e=>{const t=sessionStorage.getItem(Pe);sessionStorage.removeItem(Pe),e&&t?window.location.hash=t:Je()}),me.log("‚úÖ Applicazione inizializzata con successo")}catch(e){console.error("‚ùå Errore durante l'inizializzazione dell'applicazione:",e),document.body.innerHTML=le('\n      <div class="container mt-5">\n        <div class="alert alert-danger" role="alert">\n          <h4 class="alert-heading">Errore di inizializzazione</h4>\n          <p>Si √® verificato un errore durante l\'avvio dell\'applicazione.</p>\n          \n          <hr>\n          <p class="mb-0">Ricarica la pagina per riprovare.</p>\n        </div>\n      </div>\n    ')}});export{le as a,pt as b,Qe as c,Oe as d,xe as e,gt as f,Xe as i,me as l,ft as n,ce as p,ke as s};
