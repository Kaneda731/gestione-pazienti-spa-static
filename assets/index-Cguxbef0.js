const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/form-Waf-8Glj.js","assets/supabase-B8WzuNbi.js","assets/infectionDataManager-Bb7OdohR.js","assets/CustomDatepicker-6By5cdaM.js","assets/utils-BtSsRyB2.js","assets/CustomSelect-DUfE6qP_.js","assets/post-operative-calculator-C3z7C_vm.js","assets/ResolveInfectionModal-eLOSV2oN.js","assets/vendor-CQCqr9ER.js","assets/surgeryDataManager-CbtGeuzn.js","assets/date-CcL_Wp-e.js","assets/lookupService-4jtKkPOh.js","assets/dimissione-BuDGNTiK.js","assets/patientService-DJFQakDm.js","assets/PatientAutocomplete-DbZG8NS3.js","assets/searchUtils-C0FWAVpe.js","assets/grafico-Bij_m6uF.js","assets/helpers-D-YmcGcE.js","assets/list-Djb4U6Z7.js","assets/diagnosi-CyDzl5j_.js","assets/eventi-clinici-DMcdJoK_.js"])))=>i.map(i=>d[i]);
import{Dropdown as e,Collapse as t,Modal as i}from"./vendor-CQCqr9ER.js";import{c as n,_ as r}from"./supabase-B8WzuNbi.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),t.credentials="use-credentials"===e.crossOrigin?"include":"anonymous"===e.crossOrigin?"omit":"same-origin",t}(e);fetch(e.href,t)}}(),"undefined"!=typeof window&&(window.bootstrap={Modal:i,Collapse:t,Dropdown:e}),"undefined"!=typeof window&&(window.EMERGENCY_STOP=function(){console.log("üö® EMERGENCY STOP ACTIVATED");try{window.notificationService&&(window.notificationService.timers?.forEach(e=>clearTimeout(e)),window.notificationService.timers?.clear(),window.notificationService.emergencyReset&&window.notificationService.emergencyReset()),window.stateService&&window.stateService.subscribers?.clear()}catch(e){console.error("‚ùå Emergency stop failed:",e)}},window.EMERGENCY_RELOAD=function(){console.log("üîÑ Emergency reload..."),location.reload()});const{entries:o,setPrototypeOf:s,isFrozen:a,getPrototypeOf:c,getOwnPropertyDescriptor:l}=Object;let{freeze:d,seal:u,create:m}=Object,{apply:h,construct:p}="undefined"!=typeof Reflect&&Reflect;d||(d=function(e){return e}),u||(u=function(e){return e}),h||(h=function(e,t,i){return e.apply(t,i)}),p||(p=function(e,t){return new e(...t)});const g=x(Array.prototype.forEach),f=x(Array.prototype.lastIndexOf),y=x(Array.prototype.pop),w=x(Array.prototype.push),b=x(Array.prototype.splice),v=x(String.prototype.toLowerCase),E=x(String.prototype.toString),S=x(String.prototype.match),T=x(String.prototype.replace),_=x(String.prototype.indexOf),A=x(String.prototype.trim),M=x(Object.prototype.hasOwnProperty),C=x(RegExp.prototype.test),N=(I=TypeError,function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return p(I,t)});var I;function x(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return h(e,t,n)}}function L(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;s&&s(e,null);let n=t.length;for(;n--;){let r=t[n];if("string"==typeof r){const e=i(r);e!==r&&(a(t)||(t[n]=e),r=e)}e[r]=!0}return e}function k(e){for(let t=0;t<e.length;t++){M(e,t)||(e[t]=null)}return e}function D(e){const t=m(null);for(const[i,n]of o(e)){M(e,i)&&(t[i]=Array.isArray(n)?k(n):n&&"object"==typeof n&&n.constructor===Object?D(n):n)}return t}function R(e,t){for(;null!==e;){const i=l(e,t);if(i){if(i.get)return x(i.get);if("function"==typeof i.value)return x(i.value)}e=c(e)}return function(){return null}}const O=d(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),P=d(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),z=d(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),B=d(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),$=d(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),F=d(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),U=d(["#text"]),V=d(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),H=d(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),q=d(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),j=d(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),G=u(/\{\{[\w\W]*|[\w\W]*\}\}/gm),W=u(/<%[\w\W]*|[\w\W]*%>/gm),Q=u(/\$\{[\w\W]*/gm),Y=u(/^data-[\-\w.\u00B7-\uFFFF]+$/),J=u(/^aria-[\-\w]+$/),X=u(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),K=u(/^(?:\w+script|data):/i),Z=u(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ee=u(/^html$/i),te=u(/^[a-z][.\w]*(-[.\w]+)+$/i);var ie=Object.freeze({__proto__:null,ARIA_ATTR:J,ATTR_WHITESPACE:Z,CUSTOM_ELEMENT:te,DATA_ATTR:Y,DOCTYPE_NAME:ee,ERB_EXPR:W,IS_ALLOWED_URI:X,IS_SCRIPT_OR_DATA:K,MUSTACHE_EXPR:G,TMPLIT_EXPR:Q});const ne=1,re=3,oe=7,se=8,ae=9;var ce=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const i=t=>e(t);if(i.version="3.2.6",i.removed=[],!t||!t.document||t.document.nodeType!==ae||!t.Element)return i.isSupported=!1,i;let{document:n}=t;const r=n,s=r.currentScript,{DocumentFragment:a,HTMLTemplateElement:c,Node:l,Element:u,NodeFilter:h,NamedNodeMap:p=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:I,DOMParser:x,trustedTypes:k}=t,G=u.prototype,W=R(G,"cloneNode"),Q=R(G,"remove"),Y=R(G,"nextSibling"),J=R(G,"childNodes"),K=R(G,"parentNode");if("function"==typeof c){const e=n.createElement("template");e.content&&e.content.ownerDocument&&(n=e.content.ownerDocument)}let Z,te="";const{implementation:ce,createNodeIterator:le,createDocumentFragment:de,getElementsByTagName:ue}=n,{importNode:me}=r;let he={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};i.isSupported="function"==typeof o&&"function"==typeof K&&ce&&void 0!==ce.createHTMLDocument;const{MUSTACHE_EXPR:pe,ERB_EXPR:ge,TMPLIT_EXPR:fe,DATA_ATTR:ye,ARIA_ATTR:we,IS_SCRIPT_OR_DATA:be,ATTR_WHITESPACE:ve,CUSTOM_ELEMENT:Ee}=ie;let{IS_ALLOWED_URI:Se}=ie,Te=null;const _e=L({},[...O,...P,...z,...$,...U]);let Ae=null;const Me=L({},[...V,...H,...q,...j]);let Ce=Object.seal(m(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ne=null,Ie=null,xe=!0,Le=!0,ke=!1,De=!0,Re=!1,Oe=!0,Pe=!1,ze=!1,Be=!1,$e=!1,Fe=!1,Ue=!1,Ve=!0,He=!1,qe=!0,je=!1,Ge={},We=null;const Qe=L({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ye=null;const Je=L({},["audio","video","img","source","image","track"]);let Xe=null;const Ke=L({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ze="http://www.w3.org/1998/Math/MathML",et="http://www.w3.org/2000/svg",tt="http://www.w3.org/1999/xhtml";let it=tt,nt=!1,rt=null;const ot=L({},[Ze,et,tt],E);let st=L({},["mi","mo","mn","ms","mtext"]),at=L({},["annotation-xml"]);const ct=L({},["title","style","font","a","script"]);let lt=null;const dt=["application/xhtml+xml","text/html"];let ut=null,mt=null;const ht=n.createElement("form"),pt=function(e){return e instanceof RegExp||e instanceof Function},gt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!mt||mt!==e){if(e&&"object"==typeof e||(e={}),e=D(e),lt=-1===dt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,ut="application/xhtml+xml"===lt?E:v,Te=M(e,"ALLOWED_TAGS")?L({},e.ALLOWED_TAGS,ut):_e,Ae=M(e,"ALLOWED_ATTR")?L({},e.ALLOWED_ATTR,ut):Me,rt=M(e,"ALLOWED_NAMESPACES")?L({},e.ALLOWED_NAMESPACES,E):ot,Xe=M(e,"ADD_URI_SAFE_ATTR")?L(D(Ke),e.ADD_URI_SAFE_ATTR,ut):Ke,Ye=M(e,"ADD_DATA_URI_TAGS")?L(D(Je),e.ADD_DATA_URI_TAGS,ut):Je,We=M(e,"FORBID_CONTENTS")?L({},e.FORBID_CONTENTS,ut):Qe,Ne=M(e,"FORBID_TAGS")?L({},e.FORBID_TAGS,ut):D({}),Ie=M(e,"FORBID_ATTR")?L({},e.FORBID_ATTR,ut):D({}),Ge=!!M(e,"USE_PROFILES")&&e.USE_PROFILES,xe=!1!==e.ALLOW_ARIA_ATTR,Le=!1!==e.ALLOW_DATA_ATTR,ke=e.ALLOW_UNKNOWN_PROTOCOLS||!1,De=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Re=e.SAFE_FOR_TEMPLATES||!1,Oe=!1!==e.SAFE_FOR_XML,Pe=e.WHOLE_DOCUMENT||!1,$e=e.RETURN_DOM||!1,Fe=e.RETURN_DOM_FRAGMENT||!1,Ue=e.RETURN_TRUSTED_TYPE||!1,Be=e.FORCE_BODY||!1,Ve=!1!==e.SANITIZE_DOM,He=e.SANITIZE_NAMED_PROPS||!1,qe=!1!==e.KEEP_CONTENT,je=e.IN_PLACE||!1,Se=e.ALLOWED_URI_REGEXP||X,it=e.NAMESPACE||tt,st=e.MATHML_TEXT_INTEGRATION_POINTS||st,at=e.HTML_INTEGRATION_POINTS||at,Ce=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&pt(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Ce.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&pt(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Ce.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Ce.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Re&&(Le=!1),Fe&&($e=!0),Ge&&(Te=L({},U),Ae=[],!0===Ge.html&&(L(Te,O),L(Ae,V)),!0===Ge.svg&&(L(Te,P),L(Ae,H),L(Ae,j)),!0===Ge.svgFilters&&(L(Te,z),L(Ae,H),L(Ae,j)),!0===Ge.mathMl&&(L(Te,$),L(Ae,q),L(Ae,j))),e.ADD_TAGS&&(Te===_e&&(Te=D(Te)),L(Te,e.ADD_TAGS,ut)),e.ADD_ATTR&&(Ae===Me&&(Ae=D(Ae)),L(Ae,e.ADD_ATTR,ut)),e.ADD_URI_SAFE_ATTR&&L(Xe,e.ADD_URI_SAFE_ATTR,ut),e.FORBID_CONTENTS&&(We===Qe&&(We=D(We)),L(We,e.FORBID_CONTENTS,ut)),qe&&(Te["#text"]=!0),Pe&&L(Te,["html","head","body"]),Te.table&&(L(Te,["tbody"]),delete Ne.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw N('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw N('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');Z=e.TRUSTED_TYPES_POLICY,te=Z.createHTML("")}else void 0===Z&&(Z=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let i=null;const n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(i=t.getAttribute(n));const r="dompurify"+(i?"#"+i:"");try{return e.createPolicy(r,{createHTML:e=>e,createScriptURL:e=>e})}catch(o){return console.warn("TrustedTypes policy "+r+" could not be created."),null}}(k,s)),null!==Z&&"string"==typeof te&&(te=Z.createHTML(""));d&&d(e),mt=e}},ft=L({},[...P,...z,...B]),yt=L({},[...$,...F]),wt=function(e){w(i.removed,{element:e});try{K(e).removeChild(e)}catch(t){Q(e)}},bt=function(e,t){try{w(i.removed,{attribute:t.getAttributeNode(e),from:t})}catch(n){w(i.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if($e||Fe)try{wt(t)}catch(n){}else try{t.setAttribute(e,"")}catch(n){}},vt=function(e){let t=null,i=null;if(Be)e="<remove></remove>"+e;else{const t=S(e,/^[\r\n\t ]+/);i=t&&t[0]}"application/xhtml+xml"===lt&&it===tt&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const r=Z?Z.createHTML(e):e;if(it===tt)try{t=(new x).parseFromString(r,lt)}catch(s){}if(!t||!t.documentElement){t=ce.createDocument(it,"template",null);try{t.documentElement.innerHTML=nt?te:r}catch(s){}}const o=t.body||t.documentElement;return e&&i&&o.insertBefore(n.createTextNode(i),o.childNodes[0]||null),it===tt?ue.call(t,Pe?"html":"body")[0]:Pe?t.documentElement:o},Et=function(e){return le.call(e.ownerDocument||e,e,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},St=function(e){return e instanceof I&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof p)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Tt=function(e){return"function"==typeof l&&e instanceof l};function _t(e,t,n){g(e,e=>{e.call(i,t,n,mt)})}const At=function(e){let t=null;if(_t(he.beforeSanitizeElements,e,null),St(e))return wt(e),!0;const n=ut(e.nodeName);if(_t(he.uponSanitizeElement,e,{tagName:n,allowedTags:Te}),Oe&&e.hasChildNodes()&&!Tt(e.firstElementChild)&&C(/<[/\w!]/g,e.innerHTML)&&C(/<[/\w!]/g,e.textContent))return wt(e),!0;if(e.nodeType===oe)return wt(e),!0;if(Oe&&e.nodeType===se&&C(/<[/\w]/g,e.data))return wt(e),!0;if(!Te[n]||Ne[n]){if(!Ne[n]&&Ct(n)){if(Ce.tagNameCheck instanceof RegExp&&C(Ce.tagNameCheck,n))return!1;if(Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(n))return!1}if(qe&&!We[n]){const t=K(e)||e.parentNode,i=J(e)||e.childNodes;if(i&&t){for(let n=i.length-1;n>=0;--n){const r=W(i[n],!0);r.__removalCount=(e.__removalCount||0)+1,t.insertBefore(r,Y(e))}}}return wt(e),!0}return e instanceof u&&!function(e){let t=K(e);t&&t.tagName||(t={namespaceURI:it,tagName:"template"});const i=v(e.tagName),n=v(t.tagName);return!!rt[e.namespaceURI]&&(e.namespaceURI===et?t.namespaceURI===tt?"svg"===i:t.namespaceURI===Ze?"svg"===i&&("annotation-xml"===n||st[n]):Boolean(ft[i]):e.namespaceURI===Ze?t.namespaceURI===tt?"math"===i:t.namespaceURI===et?"math"===i&&at[n]:Boolean(yt[i]):e.namespaceURI===tt?!(t.namespaceURI===et&&!at[n])&&!(t.namespaceURI===Ze&&!st[n])&&!yt[i]&&(ct[i]||!ft[i]):!("application/xhtml+xml"!==lt||!rt[e.namespaceURI]))}(e)?(wt(e),!0):"noscript"!==n&&"noembed"!==n&&"noframes"!==n||!C(/<\/no(script|embed|frames)/i,e.innerHTML)?(Re&&e.nodeType===re&&(t=e.textContent,g([pe,ge,fe],e=>{t=T(t,e," ")}),e.textContent!==t&&(w(i.removed,{element:e.cloneNode()}),e.textContent=t)),_t(he.afterSanitizeElements,e,null),!1):(wt(e),!0)},Mt=function(e,t,i){if(Ve&&("id"===t||"name"===t)&&(i in n||i in ht))return!1;if(Le&&!Ie[t]&&C(ye,t));else if(xe&&C(we,t));else if(!Ae[t]||Ie[t]){if(!(Ct(e)&&(Ce.tagNameCheck instanceof RegExp&&C(Ce.tagNameCheck,e)||Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(e))&&(Ce.attributeNameCheck instanceof RegExp&&C(Ce.attributeNameCheck,t)||Ce.attributeNameCheck instanceof Function&&Ce.attributeNameCheck(t))||"is"===t&&Ce.allowCustomizedBuiltInElements&&(Ce.tagNameCheck instanceof RegExp&&C(Ce.tagNameCheck,i)||Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(i))))return!1}else if(Xe[t]);else if(C(Se,T(i,ve,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==_(i,"data:")||!Ye[e]){if(ke&&!C(be,T(i,ve,"")));else if(i)return!1}else;return!0},Ct=function(e){return"annotation-xml"!==e&&S(e,Ee)},Nt=function(e){_t(he.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||St(e))return;const n={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ae,forceKeepAttr:void 0};let r=t.length;for(;r--;){const s=t[r],{name:a,namespaceURI:c,value:l}=s,d=ut(a),u=l;let m="value"===a?u:A(u);if(n.attrName=d,n.attrValue=m,n.keepAttr=!0,n.forceKeepAttr=void 0,_t(he.uponSanitizeAttribute,e,n),m=n.attrValue,!He||"id"!==d&&"name"!==d||(bt(a,e),m="user-content-"+m),Oe&&C(/((--!?|])>)|<\/(style|title)/i,m)){bt(a,e);continue}if(n.forceKeepAttr)continue;if(!n.keepAttr){bt(a,e);continue}if(!De&&C(/\/>/i,m)){bt(a,e);continue}Re&&g([pe,ge,fe],e=>{m=T(m,e," ")});const h=ut(e.nodeName);if(Mt(h,d,m)){if(Z&&"object"==typeof k&&"function"==typeof k.getAttributeType)if(c);else switch(k.getAttributeType(h,d)){case"TrustedHTML":m=Z.createHTML(m);break;case"TrustedScriptURL":m=Z.createScriptURL(m)}if(m!==u)try{c?e.setAttributeNS(c,a,m):e.setAttribute(a,m),St(e)?wt(e):y(i.removed)}catch(o){bt(a,e)}}else bt(a,e)}_t(he.afterSanitizeAttributes,e,null)},It=function e(t){let i=null;const n=Et(t);for(_t(he.beforeSanitizeShadowDOM,t,null);i=n.nextNode();)_t(he.uponSanitizeShadowNode,i,null),At(i),Nt(i),i.content instanceof a&&e(i.content);_t(he.afterSanitizeShadowDOM,t,null)};return i.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,o=null,s=null,c=null;if(nt=!e,nt&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Tt(e)){if("function"!=typeof e.toString)throw N("toString is not a function");if("string"!=typeof(e=e.toString()))throw N("dirty is not a string, aborting")}if(!i.isSupported)return e;if(ze||gt(t),i.removed=[],"string"==typeof e&&(je=!1),je){if(e.nodeName){const t=ut(e.nodeName);if(!Te[t]||Ne[t])throw N("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)n=vt("\x3c!----\x3e"),o=n.ownerDocument.importNode(e,!0),o.nodeType===ne&&"BODY"===o.nodeName||"HTML"===o.nodeName?n=o:n.appendChild(o);else{if(!$e&&!Re&&!Pe&&-1===e.indexOf("<"))return Z&&Ue?Z.createHTML(e):e;if(n=vt(e),!n)return $e?null:Ue?te:""}n&&Be&&wt(n.firstChild);const d=Et(je?e:n);for(;s=d.nextNode();)At(s),Nt(s),s.content instanceof a&&It(s.content);if(je)return e;if($e){if(Fe)for(c=de.call(n.ownerDocument);n.firstChild;)c.appendChild(n.firstChild);else c=n;return(Ae.shadowroot||Ae.shadowrootmode)&&(c=me.call(r,c,!0)),c}let u=Pe?n.outerHTML:n.innerHTML;return Pe&&Te["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&C(ee,n.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+u),Re&&g([pe,ge,fe],e=>{u=T(u,e," ")}),Z&&Ue?Z.createHTML(u):u},i.setConfig=function(){gt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),ze=!0},i.clearConfig=function(){mt=null,ze=!1},i.isValidAttribute=function(e,t,i){mt||gt({});const n=ut(e),r=ut(t);return Mt(n,r,i)},i.addHook=function(e,t){"function"==typeof t&&w(he[e],t)},i.removeHook=function(e,t){if(void 0!==t){const i=f(he[e],t);return-1===i?void 0:b(he[e],i,1)[0]}return y(he[e])},i.removeHooks=function(e){he[e]=[]},i.removeAllHooks=function(){he={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},i}();function le(e){if(!e)return"";try{return ce.sanitize(e)}catch(t){return console.warn("Error sanitizing HTML:",t),String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;")}}const de=new class{constructor(){this.loadingInstances=new Map}showLoading(e,t="Caricamento..."){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const i=this.generateId(),n=this.createLoadingElement(t);return this.loadingInstances.set(i,{container:e,originalContent:e.innerHTML}),e.innerHTML=le(""),e.appendChild(n),i}hideLoading(e){const t=this.loadingInstances.get(e);t&&(t.container.innerHTML=le(t.originalContent),this.loadingInstances.delete(e))}showEmpty(e,t="Nessun dato disponibile",i="inbox"){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const n=this.createEmptyElement(t,i);e.innerHTML=le(""),e.appendChild(n)}showError(e,t="Si √® verificato un errore",i=!1,n=null){if("string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),!e)return;const r=this.createErrorElement(t,i,n);e.innerHTML=le(""),e.appendChild(r)}createLoadingElement(e){const t=document.createElement("div");return t.className="ui-state loading-state",t.innerHTML=le(`\n            <div class="loading-content">\n                <div class="spinner">\n                    <div class="spinner-border text-primary" role="status">\n                        <span class="visually-hidden">Loading...</span>\n                    </div>\n                </div>\n                <div class="loading-message">${e}</div>\n            </div>\n            <style>\n                .ui-state {\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    min-height: 200px;\n                    text-align: center;\n                    padding: 2rem;\n                }\n                \n                .loading-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                }\n                \n                .loading-message {\n                    color: #6c757d;\n                    font-size: 0.9rem;\n                }\n                \n                .empty-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                    color: #6c757d;\n                }\n                \n                .empty-icon {\n                    font-size: 3rem;\n                    opacity: 0.5;\n                }\n                \n                .empty-message {\n                    font-size: 1.1rem;\n                    font-weight: 500;\n                }\n                \n                .error-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1rem;\n                    color: #dc3545;\n                }\n                \n                .error-icon {\n                    font-size: 3rem;\n                    opacity: 0.7;\n                }\n                \n                .error-message {\n                    font-size: 1.1rem;\n                    font-weight: 500;\n                    text-align: center;\n                }\n                \n                .retry-button {\n                    margin-top: 0.5rem;\n                }\n            </style>\n        `),t}createEmptyElement(e,t){const i=document.createElement("div");return i.className="ui-state empty-state",i.innerHTML=le(`\n            <div class="empty-content">\n                <span class="material-icons empty-icon">${t}</span>\n                <div class="empty-message">${e}</div>\n            </div>\n        `),i}createErrorElement(e,t,i){const n=document.createElement("div");n.className="ui-state error-state";if(n.innerHTML=le(`\n            <div class="error-content">\n                <span class="material-icons error-icon">error_outline</span>\n                <div class="error-message">${e}</div>\n                ${t&&i?'\n            <button class="btn btn-outline-danger btn-sm retry-button">\n                <span class="material-icons me-1">refresh</span>\n                Riprova\n            </button>\n        ':""}\n            </div>\n        `),t&&i){n.querySelector(".retry-button").addEventListener("click",i)}return n}showPageLoading(e="Caricamento..."){const t=document.createElement("div");t.id="page-loading-overlay",t.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(255, 255, 255, 0.9);\n            z-index: 9998;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        ";const i=this.createLoadingElement(e);return t.appendChild(i),document.body.appendChild(t),()=>{const e=document.getElementById("page-loading-overlay");e&&e.remove()}}hidePageLoading(){const e=document.getElementById("page-loading-overlay");e&&e.remove()}generateId(){return"loading_"+Math.random().toString(36).substr(2,9)}async withLoading(e,t,i="Caricamento..."){const n=this.showLoading(e,i);try{const e=await t();return this.hideLoading(n),e}catch(r){throw this.hideLoading(n),this.showError(e,`Errore: ${r.message}`,!0,()=>{this.withLoading(e,t,i)}),r}}renderConditional(e,t,i,n="Nessun dato disponibile"){if(!t||Array.isArray(t)&&0===t.length)return this.showEmpty(e,n),void 0;"string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e)),e&&(e.innerHTML=le(""),i(e,t))}};"undefined"!=typeof window&&(window.uiStateService=de);const ue=new class{constructor(){this.errorPatterns=["message channel closed before a response was received","A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received","Extension context invalidated","Could not establish connection","The message port closed before a response was received","Receiving end does not exist","chrome-extension://","moz-extension://","safari-extension://","edge-extension://"],this.suppressedErrors=new Set,this.errorCount=0,this.maxErrorsToLog=5,this.init()}init(){window.addEventListener("error",this.handleError.bind(this)),window.addEventListener("unhandledrejection",this.handleRejection.bind(this)),this.interceptExtensionListeners()}isExtensionError(e,t=""){if(!e)return!1;const i=e.toString().toLowerCase(),n=t.toString().toLowerCase();return this.errorPatterns.some(e=>i.includes(e.toLowerCase())||n.includes(e.toLowerCase()))}handleError(e){const{message:t,filename:i}=e;return!this.isExtensionError(t,i)||(this.suppressExtensionError(e,"JavaScript Error"),void 0)}handleRejection(e){const t=e.reason;let i="";return t instanceof Error?i=t.message:"string"==typeof t?i=t:t&&t.toString&&(i=t.toString()),!this.isExtensionError(i)||(this.suppressExtensionError(e,"Promise Rejection"),void 0)}suppressExtensionError(e,t){e.preventDefault(),e.stopPropagation();const i=`${t}:${e.message||e.reason}`;return!this.suppressedErrors.has(i)&&this.errorCount<this.maxErrorsToLog&&(console.warn("[ExtensionErrorHandler] Errore di estensione soppresso:",t,{message:e.message||e.reason,filename:e.filename,type:t}),this.suppressedErrors.add(i),this.errorCount++),!1}interceptExtensionListeners(){"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage&&this.wrapChromeListeners(),"undefined"!=typeof browser&&browser.runtime&&browser.runtime.onMessage&&this.wrapFirefoxListeners(),this.wrapPostMessage()}wrapChromeListeners(){const e=chrome.runtime.onMessage.addListener;chrome.runtime.onMessage.addListener=function(t){return e.call(this,function(e,i,n){try{const r=t(e,i,n);if(!0===r){const e=setTimeout(()=>{try{n({_extensionErrorHandlerResponse:!0})}catch(e){}},100),t=n;n=function(...i){clearTimeout(e);try{return t(...i)}catch(n){}}}return r}catch(r){return console.warn("[ExtensionErrorHandler] Errore nel message listener:",r),!1}})}}wrapFirefoxListeners(){const e=browser.runtime.onMessage.addListener;browser.runtime.onMessage.addListener=function(t){return e.call(this,function(e,i,n){try{return t(e,i,n)}catch(r){return console.warn("[ExtensionErrorHandler] Errore nel message listener Firefox:",r),Promise.resolve()}})}}wrapPostMessage(){const e=window.postMessage;window.postMessage=function(t,i,n){try{return e.call(this,t,i,n)}catch(r){if(this.isExtensionError(r.message))return console.warn("[ExtensionErrorHandler] Errore postMessage di estensione soppresso:",r),void 0;throw r}}.bind(this)}getStats(){return{suppressedErrorTypes:this.suppressedErrors.size,totalErrorCount:this.errorCount,maxErrorsToLog:this.maxErrorsToLog}}resetStats(){this.suppressedErrors.clear(),this.errorCount=0}};"undefined"!=typeof window&&(window.extensionErrorHandler=ue);const me="PatientTrack",he="1.0.0",pe="development"==="production",ge="warn";const fe=new class{constructor(){const e={error:0,warn:1,info:2,debug:3};this.level=e[ge.toLowerCase()]??1,this.levels=e}sanitizeArgs(e){const t=new Set(["password","token","auth","secret","nome","cognome","codice_fiscale","codice_rad","telefono","email","indirizzo","indirizzo_residenza","citta","cap","note","descrizione"]),i=e=>{if(null==e)return e;if("string"==typeof e)return e.length>200?e.slice(0,200)+"‚Ä¶":e;if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(i);if("object"==typeof e){const n={};for(const[r,o]of Object.entries(e))n[r]=t.has(r)?"[REDACTED]":i(o);return n}return e};return e.map(i)}log(...e){}warn(...e){}error(...e){const t=this.sanitizeArgs(e);console.error(...t)}info(...e){}debug(...e){}group(e){}groupEnd(){}table(e){}time(e){}timeEnd(e){}},ye=n("https://aiguzywadjzyrwandgba.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpZ3V6eXdhZGp6eXJ3YW5kZ2JhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyMDM1MzQsImV4cCI6MjA2Njc3OTUzNH0.pezVt3-xxkHBYK2V6ryHUtj_givF_TA9xwEzuK2essw",{auth:{flowType:"pkce",detectSessionInUrl:!0,persistSession:!0,autoRefreshToken:!0,storage:window.localStorage,storageKey:"supabase.auth.token",debug:!1},global:{headers:{"X-Client-Info":"supabase-js-vite"}}});const we=new class{constructor(){this.readyPromise=new Promise(e=>{this.resolveReady=e}),this.init()}async init(){await this.waitForViteReady(),await this.waitForSupabaseReady(),this.notifyReady()}async waitForViteReady(){return new Promise(e=>{"complete"===document.readyState?(fe.log("Vite √® pronto"),e()):window.addEventListener("load",()=>{setTimeout(()=>{fe.log("Vite √® pronto (dopo load)"),e()},100)},{once:!0})})}async waitForSupabaseReady(){return new Promise(async e=>{try{await ye.auth.getSession(),fe.log("Supabase √® pronto"),e()}catch(t){console.error("Errore nell'inizializzazione Supabase:",t),this.clearCorruptedState(),setTimeout(async()=>{try{await ye.auth.getSession(),fe.log("Supabase √® pronto (dopo retry)"),e()}catch(t){console.error("Errore nel retry Supabase:",t),e()}},500)}})}clearCorruptedState(){fe.log("Pulisco stato corrotto..."),["supabase.auth.token","sb-aiguzywadjzyrwandgba-auth-token"].forEach(e=>{localStorage.removeItem(e),sessionStorage.removeItem(e)}),document.cookie.split(";").forEach(e=>{const t=e.indexOf("="),i=t>-1?e.substr(0,t):e;(i.trim().includes("supabase")||i.trim().includes("sb-"))&&(document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/")})}onReady(){return this.readyPromise}notifyReady(){fe.log("Middleware Vite-Supabase pronto"),this.resolveReady()}};const be=new class{constructor(){this.isInitialized=!1,this.authState="idle",this.errorState=null,this.init()}async init(){if(!this.isInitialized){await new Promise(e=>{we.onReady(e)});try{const e=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.substring(1));t.has("access_token")||t.has("refresh_token")||e.has("code")||t.has("error")?(fe.log("Rilevato redirect OAuth con parametri reali, gestisco la sessione..."),this.authState="authenticating",await this.handleOAuthCallback()):fe.log("Nessun parametro OAuth rilevato, inizializzazione normale"),this.isInitialized=!0}catch(e){console.error("Errore nell'inizializzazione OAuth:",e),this.errorState=e,this.authState="error"}}}async handleOAuthCallback(){try{fe.log("Gestisco callback OAuth...");if(new URLSearchParams(window.location.search).has("code")){fe.log("Rilevato parametro code, eseguo exchangeCodeForSession...");const{data:e,error:t}=await ye.auth.exchangeCodeForSession(window.location.href);if(t)throw console.error("Errore in exchangeCodeForSession:",t),this.clearCorruptedState(),t;fe.log("exchangeCodeForSession completato:",!!e?.session)}const{data:e,error:t}=await ye.auth.getSession();if(t)throw console.error("Errore nel callback OAuth:",t),this.clearCorruptedState(),t;if(e.session){fe.log("Sessione OAuth recuperata con successo"),this.authState="authenticated",this.cleanupOAuthUrl();const e=sessionStorage.getItem("redirectUrl");e?(sessionStorage.removeItem("redirectUrl"),window.location.hash=e):window.location.hash="#home"}return e.session}catch(e){throw console.error("Errore nella gestione del callback OAuth:",e),this.clearCorruptedState(),e}}clearCorruptedState(){fe.log("Pulisco stato corrotto OAuth..."),we.clearCorruptedState(),this.cleanupOAuthUrl(),this.authState="idle",this.errorState=null}cleanupOAuthUrl(){if(window.location.hash.includes("access_token")||window.location.search.includes("code")){const e=window.location.hash.split("&")[0],t=window.location.pathname+(e&&"#"!==e?e:"");window.history.replaceState({},document.title,t),fe.log("URL pulito da parametri OAuth, nuovo URL:",t)}}async signInWithGoogle(){try{await we.onReady(),"error"===this.authState&&(fe.log("Stato di errore rilevato, pulisco..."),this.clearCorruptedState(),await new Promise(e=>setTimeout(e,100))),this.authState="authenticating";const e=window.location.origin+window.location.pathname+window.location.hash;fe.log("Iniziando login OAuth con redirect:",e);const{data:t,error:i}=await ye.auth.signInWithOAuth({provider:"google",options:{redirectTo:e,queryParams:{}}});if(i)throw console.error("Errore nella chiamata OAuth:",i),this.authState="error",this.errorState=i,i;return fe.log("Login OAuth iniziato con successo:",t),{success:!0,data:t}}catch(e){return console.error("Errore completo nel login OAuth:",e),401===e.status&&(fe.log("Errore 401 rilevato, pulisco stato corrotto..."),this.clearCorruptedState()),this.authState="error",this.errorState=e,{success:!1,error:e.message}}}getAuthState(){return{state:this.authState,error:this.errorState,isInitialized:this.isInitialized}}};let ve={session:void 0,profile:null,isLoading:!0};async function Ee(e){try{if("undefined"!=typeof window&&window.__PW_E2E_AUTH_MOCK){e?.user?(ve.session=e,ve.profile={id:e.user.id,username:e.user.email?.split("@")[0]||"e2e-user",full_name:e.user.user_metadata?.full_name||e.user.user_metadata?.name||e.user.email||"E2E User",role:"editor",email:e.user.email,fallback:!0}):(ve.session=null,ve.profile=null);try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:e}}))}catch{}return window.dispatchEvent(new CustomEvent("auth-profile-loaded")),void 0}}catch{}if(e?.user){const t=await async function(e){if(!e)return null;try{const{data:t,error:i,status:n}=await ye.from("profiles").select("username, full_name, role").eq("id",e.id).single();if(i&&406!==n)throw i;return t}catch(t){fe.error("Errore nel recuperare il profilo utente:",t),fe.warn("üîÑ Uso profilo di fallback per utente:",e.email?.substring(0,3)+"***");try{const{data:t}=await ye.rpc("get_user_role_safe",{user_uuid:e.id}),i=t||"editor";return fe.info("‚úÖ Ruolo recuperato con funzione sicura:",i),{id:e.id,username:e.email?.split("@")[0]||"utente",full_name:e.user_metadata?.full_name||e.user_metadata?.name||e.email||"Utente",role:i,email:e.email,fallback:!0}}catch(i){return fe.error("‚ùå Errore nel recupero ruolo sicuro, uso fallback minimo:",i),null}}}(e.user);ve.session=e,t?ve.profile=t:(fe.warn("‚ö†Ô∏è Profilo non disponibile, uso fallback per utente:",e.user.email?.substring(0,3)+"***"),ve.profile={id:e.user.id,username:e.user.email?.split("@")[0]||"utente",full_name:e.user.user_metadata?.full_name||e.user.user_metadata?.name||e.user.email||"Utente",role:"editor",email:e.user.email,fallback:!0}),ve.profile?.fallback?fe.info("‚úÖ Utente autenticato con profilo di fallback:",ve.profile.username):fe.info("‚úÖ Utente autenticato:",ve.profile?.username||"sconosciuto")}else ve.session=null,ve.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:e}}))}catch{}window.dispatchEvent(new CustomEvent("auth-profile-loaded"))}async function Se(){try{ve.session=null,ve.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:null}}))}catch{}window.dispatchEvent(new CustomEvent("auth-profile-loaded"));try{const{error:e}=await ye.auth.signOut();if(e&&"Auth session missing!"!==e.message)throw e}catch(e){if("Auth session missing!"!==e.message&&"AuthSessionMissingError"!==e.name)throw e;fe.warn("Sessione gi√† mancante durante logout, continuando...")}return setTimeout(()=>{window.location.hash="login-required"},100),{success:!0}}catch(t){console.error("Errore durante il signOut:",t),ve.session=null,ve.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:null}}))}catch{}return window.dispatchEvent(new CustomEvent("auth-profile-loaded")),{success:!1,error:t.message}}}async function Te(e,t){try{const i=t||function(e=32){const t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}(32),{data:n,error:r}=await ye.auth.signInWithIdToken({provider:"google",token:e,nonce:i});if(r)throw r;return fe.log("Login BYO Google (GIS) via ID token completato"),{success:!0,data:n}}catch(i){return console.error("Errore login via ID token:",i),{success:!1,error:i.message}}}let _e=!1;void(window.innerWidth>767||document.addEventListener("DOMContentLoaded",()=>{!function(){if(_e)return;const e=()=>{_e=!0,document.removeEventListener("touchstart",e),document.removeEventListener("click",e)};document.addEventListener("touchstart",e,{once:!0,passive:!0}),document.addEventListener("click",e,{once:!0,passive:!0})}(),document.querySelectorAll(".card").forEach(e=>{e.addEventListener("touchstart",e=>{if(!e.target.closest("button, a, input, select, .custom-select-wrapper"))try{"vibrate"in navigator&&_e&&navigator.vibrate(10)}catch(t){console.debug("Vibrazione non disponibile o bloccata.",t.message)}},{passive:!0})}),window.addEventListener("resize",()=>{window.innerWidth<=480?document.querySelectorAll(".cards-grid-mobile").forEach(e=>{e.style.gridTemplateColumns="1fr"}):document.querySelectorAll(".cards-grid-mobile").forEach(e=>{e.style.gridTemplateColumns=""})},{passive:!0})}));const Ae="redirectUrl";let Me=window.innerWidth<=767;function Ce(){const e=document.querySelector(".navbar"),t=document.querySelector(".mobile-navbar");if(!e||!t)return;const i=window.innerWidth<=767;if(i===Me)return e.classList.toggle("d-none",i),t.classList.toggle("d-none",!i),void 0;Me=i,fe.log("Mode changed to: "+(i?"mobile":"desktop"));const n=new CustomEvent("mode:change",{detail:{isMobile:i}});window.dispatchEvent(n),e.classList.toggle("d-none",i),t.classList.toggle("d-none",!i),i&&Ne()}function Ne(){const e=document.getElementById("mobile-auth-container"),t=document.getElementById("mobile-home-link");if(!e||!t)return;if(ve.session){const i=document.createElement("span");i.className="material-icons",i.title="Logout",i.textContent="logout",e.replaceChildren(i),e.onclick=async e=>{e.preventDefault(),await Se()},t.classList.add("navbar-home-logged")}else{const i=document.createElement("span");i.className="material-icons",i.title="Login",i.textContent="login",e.replaceChildren(i),e.onclick=e=>{e.preventDefault();const t=document.getElementById("login-modal-trigger");t&&t.click()},t.classList.remove("navbar-home-logged")}}let Ie=null;async function xe({clientId:e}){var t;await(t="https://accounts.google.com/gsi/client",Ie||(Ie=new Promise((e,i)=>{if("undefined"!=typeof window&&window.google&&window.google.accounts&&window.google.accounts.id)return e(),void 0;const n=document.createElement("script");n.src=t,n.async=!0,n.defer=!0,n.onload=()=>e(),n.onerror=()=>i(new Error("Failed to load Google Identity Services script")),document.head.appendChild(n)}),Ie));const i=function(e=32){const t=new Uint8Array(e);return window.crypto.getRandomValues(t),btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}(32);return new Promise((t,n)=>{const r=setTimeout(()=>n(new Error("GIS prompt not available")),4e3),o=setTimeout(()=>n(new Error("Google One Tap timed out")),2e4);try{window.google.accounts.id.initialize({client_id:e,ux_mode:"popup",itp_support:!0,use_fedcm_for_prompt:!1,callback:e=>{try{e&&e.credential?(clearTimeout(r),clearTimeout(o),t({idToken:e.credential,nonce:i})):e&&e.error&&(clearTimeout(r),clearTimeout(o),n(new Error(e.error)))}catch(s){clearTimeout(r),clearTimeout(o),n(s)}},nonce:i}),window.google.accounts.id.prompt(e=>{try{if(e?.isNotDisplayed?.()){const t=e.getNotDisplayedReason?.();clearTimeout(r),n(new Error(`GIS not displayed: ${t||"unknown"}`))}else if(e?.isSkippedMoment?.()){const t=e.getSkippedReason?.();clearTimeout(r),n(new Error(`GIS skipped: ${t||"unknown"}`))}else if(e?.isDismissedMoment?.()){const t=e.getDismissedReason?.();clearTimeout(r),n(new Error(`GIS dismissed: ${t||"unknown"}`))}}catch(t){}})}catch(s){clearTimeout(r),clearTimeout(o),n(s)}})}function Le(e){const t=document.getElementById("auth-container");if(t){if(e){const i=ve.profile?.role||"caricamento...",n=e.user.email;t.innerHTML=le(`\n            <div class="d-flex align-items-center text-light">\n                <span class="navbar-text me-3" title="${n}">\n                    <i class="material-icons me-1" style="font-size: 1.1em; vertical-align: text-bottom;">account_circle</i>\n                    ${n.split("@")[0]}\n                </span>\n                <span class="badge bg-info me-3 text-uppercase" style="font-size: 0.75em; padding: 0.4em 0.6em;">\n                    ${i}\n                </span>\n                <button id="logout-button" class="btn btn-outline-light btn-sm">\n                    <i class="material-icons" style="font-size: 1em; vertical-align: middle;">logout</i>\n                </button>\n            </div>\n        `)}else t.innerHTML=le('\n            <button id="login-modal-trigger" class="btn btn-outline-light">\n                <i class="material-icons me-1" style="font-size: 1em;">login</i>\n                Accedi\n            </button>\n        ');Ne()}}function ke(){window.addEventListener("auth:session-changed",e=>{Le(e.detail?.session||null)}),void 0!==ve&&Le(ve.session||null),document.body.addEventListener("click",async e=>{if(e.target.closest("#logout-button")&&(e.preventDefault(),await Se()),e.target.closest("#login-modal-trigger")&&(e.preventDefault(),De()),e.target.closest("#google-login-btn")){e.preventDefault(),fe.log("Pulsante Google cliccato");const r=e.target.closest("#google-login-btn"),o=r.querySelector(".spinner-border"),s=r.querySelector(".material-icons");r.disabled=!0,o&&(o.style.display="inline-block"),s&&(s.style.display="none");try{const e=!0,i="1096813530815-bk23h9jv77okogb6pb2k0mtqbb5fo1n0.apps.googleusercontent.com";console.log("üîß Config GIS:",{useGIS:"true",clientId:"1096813530815-bk23h9jv77okogb6pb2k0mtqbb5fo1n0.apps.googleusercontent.com",strict:void 0,renderOfficial:void 0,currentDomain:window.location.origin,hostname:window.location.hostname,protocol:window.location.protocol});const n=await(async()=>{try{const e=window.RequestFileSystem||window.webkitRequestFileSystem;if(e){if(await new Promise(t=>{e(window.TEMPORARY,100,()=>t(!1),()=>t(!0))}))return!0}if("storage"in navigator&&"estimate"in navigator.storage){return(await navigator.storage.estimate()).quota<12e7}return new Promise(e=>{const t=indexedDB.open("test");t.onerror=()=>e(!0),t.onsuccess=()=>{e(!1),t.result.close(),indexedDB.deleteDatabase("test")}})}catch{return!1}})();if(e&&i&&!n){console.log("üöÄ Tentativo login GIS..."),window,window,window;try{console.log("üîÑ Chiamando getGoogleIdToken...");const{idToken:e,nonce:t}=await xe({clientId:i});console.log("‚úÖ Token GIS ottenuto:",{tokenLength:e?.length,nonceLength:t?.length,tokenPreview:e?.substring(0,20)+"..."});const{error:n}=await ye.auth.signInWithIdToken({provider:"google",token:e,nonce:t});if(n)throw console.log("‚ùå Errore Supabase signInWithIdToken:",n),n;return console.log("‚úÖ Login GIS completato con successo"),Re(),void 0}catch(t){console.log("‚ùå Errore GIS dettagliato:",{message:t.message,stack:t.stack,name:t.name,cause:t.cause})}}else n?console.log("üïµÔ∏è Modalit√† incognito rilevata, uso OAuth redirect direttamente"):console.log("‚ö†Ô∏è GIS non abilitato o Client ID mancante:",{useGis:e,hasClientId:!!i});await async function(){return await be.signInWithGoogle()}(),Re()}catch(i){console.error("Errore durante l'accesso:",i);const e={timestamp:(new Date).toISOString(),message:i?.message||"Unknown error",stack:i?.stack||"No stack trace",name:i?.name||"Unknown",cause:i?.cause||null,useGis:!0,hasClientId:!0,userAgent:navigator.userAgent,url:window.location.href,env:"production"};try{const t=JSON.parse(localStorage.getItem("auth_errors")||"[]");t.push(e),t.length>10&&t.shift(),localStorage.setItem("auth_errors",JSON.stringify(t)),window.lastAuthError=e}catch(n){console.warn("Failed to persist error details:",n)}const t=document.getElementById("auth-error");if(t){const e=i&&(i.message||i.error||i.toString())||"Errore durante l'accesso. Riprova.";t.textContent=e,t.style.display="block"}}finally{r.disabled=!1,o&&(o.style.display="none"),s&&(s.style.display="inline-block")}}})}async function De(){let e=document.getElementById("auth-modal");if(!e){const{default:t}=await r(async()=>{const{default:e}=await import("./auth-modal-Dgd2BaX-.js");return{default:e}},[]),i=document.createElement("div");i.innerHTML=le(t),document.body.appendChild(i.firstElementChild),e=document.getElementById("auth-modal")}const t=document.getElementById("auth-error-message");t&&(t.style.display="none");const n=new i(e);try{const t=!0,i="1096813530815-bk23h9jv77okogb6pb2k0mtqbb5fo1n0.apps.googleusercontent.com";t&&!i;const n=await(async()=>{try{const e=window.RequestFileSystem||window.webkitRequestFileSystem;if(e){if(await new Promise(t=>{e(window.TEMPORARY,100,()=>t(!1),()=>t(!0))}))return!0}if("storage"in navigator&&"estimate"in navigator.storage){return(await navigator.storage.estimate()).quota<12e7}return new Promise(e=>{const t=indexedDB.open("test");t.onerror=()=>e(!0),t.onsuccess=()=>{e(!1),t.result.close(),indexedDB.deleteDatabase("test")}})}catch{return!1}})();if(n){const t=document.createElement("div");t.className="alert alert-info mt-2",t.innerHTML='\n                <i class="material-icons me-2" style="vertical-align: middle;">info</i>\n                <strong>Modalit√† incognito rilevata:</strong> Il login popup potrebbe non funzionare. \n                Usa il login con redirect se hai problemi.\n            ';const i=e.querySelector(".modal-body");i&&i.insertBefore(t,i.firstChild)}t&&i&&!0&&!n&&(await new Promise((e,t)=>{if(window.google?.accounts?.id)return e();const i=document.createElement("script");i.src="https://accounts.google.com/gsi/client",i.async=!0,i.defer=!0,i.onload=()=>e(),i.onerror=()=>t(new Error("Impossibile caricare Google Identity Services")),document.head.appendChild(i)}),window.google.accounts.id.initialize({client_id:i,ux_mode:"popup",itp_support:!0,use_fedcm_for_prompt:!1,callback:async e=>{try{if(e?.credential){const t=new Uint8Array(32);window.crypto.getRandomValues(t);const i=btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""),n=await Te(e.credential,i);if(n?.success){try{document.activeElement&&document.activeElement.blur()}catch{}Re()}}}catch(t){console.error("Errore GIS callback:",t);const r={timestamp:(new Date).toISOString(),context:"GIS_CALLBACK",message:t?.message||"Unknown GIS error",stack:t?.stack||"No stack trace",name:t?.name||"Unknown",response:e,clientId:i?.substring(0,10)+"...",env:"production"};try{const e=JSON.parse(localStorage.getItem("auth_errors")||"[]");e.push(r),e.length>10&&e.shift(),localStorage.setItem("auth_errors",JSON.stringify(e)),window.lastGisError=r}catch(n){console.warn("Failed to persist GIS error:",n)}}}}))}catch(o){}n.show()}function Re(){const e=document.getElementById("auth-modal");if(e){const t=i.getInstance(e);t&&t.hide()}}let Oe=null,Pe=!1;const ze={inserimento:()=>r(()=>import("./form-Waf-8Glj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])),dimissione:()=>r(()=>import("./dimissione-BuDGNTiK.js"),__vite__mapDeps([12,13,2,1,11,3,4,5,14,15,8])),grafico:()=>r(()=>import("./grafico-Bij_m6uF.js"),__vite__mapDeps([16,17,1,3,4,5,8])),list:()=>r(()=>import("./list-Djb4U6Z7.js"),__vite__mapDeps([18,1,13,2,6,15,5,17,8])),diagnosi:()=>r(()=>import("./diagnosi-CyDzl5j_.js"),__vite__mapDeps([19,1,8])),"eventi-clinici":()=>r(()=>import("./eventi-clinici-DMcdJoK_.js"),__vite__mapDeps([20,1,15,2,13,14,17,10,3,4,5,8]))},Be=new Map,$e=Object.assign({"/src/views/access-denied.html":()=>r(()=>import("./access-denied-qNA2WfrE.js"),[]).then(e=>e.default),"/src/views/auth-modal.html":()=>r(()=>import("./auth-modal-Dgd2BaX-.js"),[]).then(e=>e.default),"/src/views/diagnosi.html":()=>r(()=>import("./diagnosi-Cwkqnh9y.js"),[]).then(e=>e.default),"/src/views/dimissione.html":()=>r(()=>import("./dimissione-CVLz7l64.js"),[]).then(e=>e.default),"/src/views/eventi-clinici.html":()=>r(()=>import("./eventi-clinici-B0W0dyB6.js"),[]).then(e=>e.default),"/src/views/grafico.html":()=>r(()=>import("./grafico-DyPZBtMB.js"),[]).then(e=>e.default),"/src/views/home.html":()=>r(()=>import("./home-fApaPaO7.js"),[]).then(e=>e.default),"/src/views/inserimento.html":()=>r(()=>import("./inserimento-Cf4Qb7GO.js"),[]).then(e=>e.default),"/src/views/list.html":()=>r(()=>import("./list-Dq1y52KA.js"),[]).then(e=>e.default),"/src/views/login-required.html":()=>r(()=>import("./login-required-DkOrvptO.js"),[]).then(e=>e.default)});function Fe(){const e=ve.profile?.role;fe.log("Updating UI visibility based on role:",e);const t={inserimento:["admin","editor"],list:["admin","editor","viewer"],grafico:["admin","editor","viewer"],diagnosi:["admin"],dimissione:["admin","editor"],"eventi-clinici":["admin","editor"]};document.querySelectorAll(".menu-card").forEach(i=>{const n=i.dataset.view;t[n]&&(i.style.display=e&&t[n].includes(e)?"block":"none")})}async function Ue(e){if(Be.has(e))return Be.get(e);const t=`/src/views/${e}.html`;if(!$e[t])return console.error(`Vista non trovata: ${e} (path cercato: ${t})`),fe.error(`Vista HTML non trovata: ${e}`),"home"!==e?await Ue("home"):'\n                <div class="container mt-4">\n                    <div class="alert alert-danger" role="alert">\n                        <h4 class="alert-heading">Errore critico</h4>\n                        <p>Impossibile caricare le viste dell\'applicazione.</p>\n                        <button class="btn btn-primary" onclick="location.reload()">Ricarica pagina</button>\n                    </div>\n                </div>\n            ';try{const i=await $e[t]();if(!i||"string"!=typeof i)throw new Error(`Contenuto vista ${e} non valido`);return Be.set(e,i),i}catch(i){return console.error("Errore nel caricamento della vista:",e,i),fe.error(`Fallimento caricamento vista HTML ${e}:`,i),"home"!==e?await Ue("home"):'\n                <div class="container mt-4">\n                    <div class="alert alert-danger" role="alert">\n                        <h4 class="alert-heading">Errore di caricamento</h4>\n                        <p>Si √® verificato un errore nel caricamento della vista.</p>\n                        <button class="btn btn-primary" onclick="location.reload()">Ricarica pagina</button>\n                        \n                    </div>\n                </div>\n            '}}function Ve(e){window.location.hash=e}async function He(){if(Pe)return fe.warn("Navigazione gi√† in corso, interrotta."),void 0;Pe=!0;const e=document.getElementById("view-container");try{if("function"==typeof Oe&&(Oe(),Oe=null),window.location.hash.includes("access_token="))return;if(ve.isLoading)return fe.log("Sessione in caricamento, aspetto..."),e&&(e.innerHTML=le('<div class="d-flex justify-content-center align-items-center" style="height: 80vh;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Caricamento sessione...</span></div></div>')),void 0;if(void 0===ve.session)return;const i=window.location.hash.replace(/^#\/?/,"");if((""===i||"home"===i||"list"===i)&&!ve.session)return window.location.hash="login-required",void 0;if(!e)return console.error("Fatal: #view-container non trovato."),void 0;e.innerHTML=le('<div class="d-flex justify-content-center align-items-center" style="height: 80vh;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>');const n=window.location.hash.replace(/^#\/?/,"")||"home",[r,o]=n.split("?"),s=new URLSearchParams(o),a={inserimento:["admin","editor"],list:["admin","editor","viewer"],grafico:["admin","editor","viewer"],diagnosi:["admin"],dimissione:["admin","editor"],"eventi-clinici":["admin","editor"]};let c=r;Object.keys(a).includes(r)&&!ve.session?(sessionStorage.setItem("redirectUrl",n),c="login-required"):a[r]&&!a[r].includes(ve.profile?.role)&&ve.profile&&(c="access-denied");const l=await Ue(c);e.innerHTML=le(l);const d=e.querySelector(".view");d.offsetHeight,d&&d.classList.add("active");const u=ze[c];if(u)try{const e=await async function(e,t=3,i=1e3){let n;for(let o=1;o<=t;o++)try{return await e()}catch(r){if(n=r,fe.warn(`Tentativo ${o}/${t} fallito per import dinamico:`,r.message),o===t)throw n;const e=i*Math.pow(2,o-1);await new Promise(t=>setTimeout(t,e))}}(u);if(!e)throw new Error(`Modulo ${c} caricato ma vuoto`);if("list"===c){const t=await e.fetchListData();Oe=await e.initListView(t)}else if("diagnosi"===c)Oe=await e.initDiagnosiView(s);else if("grafico"===c)Oe=await e.initGraficoView(s);else if("inserimento"===c)Oe=await e.initInserimentoView(s);else if("dimissione"===c)Oe=await e.initDimissioneView(s);else if("eventi-clinici"===c)Oe=await e.initEventiCliniciView(s);else{const t=Object.values(e).find(e=>"function"==typeof e&&e.name.startsWith("init"));t&&(Oe=await t(s))}}catch(t){return console.error("Errore nel caricamento del modulo:",c,t),fe.error(`Fallimento caricamento modulo ${c}:`,t),e.innerHTML=le(`\n                    <div class="container mt-4">\n                        <div class="alert alert-warning" role="alert">\n                            <h4 class="alert-heading">\n                                <span class="material-icons me-2" style="vertical-align: middle;">warning</span>\n                                Problema di caricamento\n                            </h4>\n                            <p>Si √® verificato un problema nel caricamento di questa sezione dell'applicazione.</p>\n                            <hr>\n                            <div class="d-flex gap-2">\n                                <button class="btn btn-primary" onclick="location.reload()">\n                                    <span class="material-icons me-1" style="vertical-align: middle;">refresh</span>\n                                    Ricarica pagina\n                                </button>\n                                <button class="btn btn-outline-secondary" onclick="window.location.hash = 'home'">\n                                    <span class="material-icons me-1" style="vertical-align: middle;">home</span>\n                                    Torna alla home\n                                </button>\n                            </div>\n                            ${pe?`<details class="mt-3"><summary>Dettagli tecnici (solo sviluppo)</summary><pre class="small mt-2">${t.stack||t.message}</pre></details>`:""}\n                        </div>\n                    </div>\n                `),void 0}else if("home"===c)Fe(),document.querySelectorAll(".menu-card").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.view;"inserimento"===t&&sessionStorage.removeItem("editPazienteId"),Ve(t)})});else if("login-required"===c){const e=document.getElementById("login-prompt-button");e&&e.addEventListener("click",async()=>{await De()})}const m=new CustomEvent("viewChanged",{detail:{view:c,params:s}});document.dispatchEvent(m)}catch(i){console.error("Errore durante il rendering della vista:",i),e&&(e.innerHTML=le('<div class="alert alert-danger m-3">Si √® verificato un errore critico. Si prega di ricaricare la pagina.</div>'))}finally{Pe=!1}}function qe(){void window.addEventListener("error",e=>{if(["A listener indicated an asynchronous response by returning true","Extension context invalidated","Could not establish connection","chrome-extension://","moz-extension://"].some(t=>e.message&&e.message.includes(t)))return console.debug("Browser extension error ignored:",e.message),e.preventDefault(),!1;console.error("Application error:",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{const t=e.reason?.message||e.reason?.toString()||"";if(["A listener indicated an asynchronous response by returning true","message channel closed before a response was received","Extension context invalidated","Could not establish connection"].some(e=>t.includes(e)))return console.debug("Browser extension promise rejection ignored:",t),e.preventDefault(),void 0;console.error("Unhandled promise rejection:",e.reason)}),window.appLogger={info:(e,t=null)=>{fe.log(`[APP] ${e}`,t||"")},warn:(e,t=null)=>{fe.warn(`[APP WARNING] ${e}`,t||"")},error:(e,t=null)=>{console.error("[APP ERROR]",e,t||"")},debug:(e,t=null)=>{"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||fe.log(`[APP DEBUG] ${e}`,t||"")}},window.appLogger.info("Error service and logger initialized.",{timestamp:(new Date).toISOString()})}function je(){document.addEventListener("click",e=>{const t=e.target.closest(".btn-back-menu");if(t){e.preventDefault(),t.style.transform="scale(0.95)",t.style.transition="transform 0.1s ease",setTimeout(()=>{t.style.transform="",t.style.transition=""},150);const i=t.getAttribute("data-view")||"home";"home"===i&&(sessionStorage.removeItem("editPazienteId"),sessionStorage.removeItem("formData"),sessionStorage.removeItem("currentFilters")),setTimeout(()=>Ve(i),100)}})}function Ge(e,t,i,n){if(e.has(t)){const i=e.get(t);clearTimeout(i.timerId)}const r=Date.now(),o=setTimeout(()=>{e.delete(t),n(t)},i);e.set(t,{timerId:o,originalDuration:i,startTime:r,remainingTime:i,isPaused:!1,pausedAt:null,callback:n})}function We(e,t){const i=e.get(t);i&&!i.isPaused&&(clearTimeout(i.timerId),i.isPaused=!0,i.pausedAt=Date.now(),i.remainingTime=i.remainingTime-(i.pausedAt-i.startTime),fe.debug(`‚è∏Ô∏è Timer paused for notification: ${t}`))}function Qe(e,t){const i=e.get(t);i&&i.isPaused&&(i.isPaused=!1,i.startTime=Date.now(),i.timerId=setTimeout(()=>{e.delete(t),i.callback&&i.callback(t)},i.remainingTime),fe.debug(`‚ñ∂Ô∏è Timer resumed for notification: ${t}`))}function Ye(e,t,i){const n=e.get(t);if(n){clearTimeout(n.timerId),e.delete(t);try{"function"==typeof i&&i(t)}catch(r){fe.warn("Timer onStop callback error:",r)}fe.debug(`‚èπÔ∏è Timer stopped for notification: ${t}`)}}window.addEventListener("auth-profile-loaded",Fe),window.renderView=He;class Je{constructor({timerManager:e,progressBarManager:t,legacyTimersMap:i}){this.timerManager=e||null,this.progressBarManager=t||null,this.legacyTimersMap=i||new Map}start(e,t,i){return this.timerManager?this.timerManager.start(e,t,i):Ge(this.legacyTimersMap,e,t,i)}pause(e){return this.timerManager?this.timerManager.pause(e):We(this.legacyTimersMap,e)}resume(e){return this.timerManager?this.timerManager.resume(e):Qe(this.legacyTimersMap,e)}stop(e,t){return this.timerManager?this.timerManager.stop(e,t||(()=>this.progressBarManager?.stop(e))):Ye(this.legacyTimersMap,e,t||(()=>this.progressBarManager?.stop(e)))}pauseAll(){if(this.timerManager)return this.timerManager.pauseAll();let e=0;return this.legacyTimersMap.forEach((t,i)=>{We(this.legacyTimersMap,i)&&e++}),e}resumeAll(){if(this.timerManager)return this.timerManager.resumeAll();let e=0;return this.legacyTimersMap.forEach((t,i)=>{Qe(this.legacyTimersMap,i)&&e++}),e}stopAll(e){if(this.timerManager)return this.timerManager.stopAll(e);let t=0;return Array.from(this.legacyTimersMap.keys()).forEach(i=>{Ye(this.legacyTimersMap,i,e||(()=>this.progressBarManager?.stop(i)))&&t++}),t}cleanupOrphans(e=[]){if(this.timerManager)return this.timerManager.cleanupOrphanedTimers(e);const t=new Set(e);let i=0;return Array.from(this.legacyTimersMap.keys()).forEach(e=>{t.has(e)||Ye(this.legacyTimersMap,e,()=>this.progressBarManager?.stop(e))&&i++}),i}hasTimer(e){return this.timerManager?this.timerManager.hasTimer(e):this.legacyTimersMap.has(e)}}class Xe{constructor(e,t=4e3,i="success"){this.element=e,this.duration=t,this.type=i,this.startTime=null,this.animationId=null,this.isPaused=!1,this.pausedTime=0,this.isDestroyed=!1,this.timing=this.createEasingFunction("linear"),this.init()}createEasingFunction(e="linear"){const t={linear:e=>e,easeOut:e=>1-Math.pow(1-e,3),easeIn:e=>Math.pow(e,3),easeInOut:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2};return t[e]||t.linear}init(){if(this.isDestroyed)return;const e=this.element.querySelector(".notification__progress--js-placeholder");e?this.replaceProgressBarPlaceholder(e):this.element.querySelector(".notification__progress")||this.createProgressBar(),this.progressBar=this.element.querySelector(".notification__progress"),this.progressFill=this.element.querySelector(".notification__progress-fill"),this.progressBar&&this.progressFill&&this.start()}replaceProgressBarPlaceholder(e){e.classList.remove("notification__progress--js-placeholder"),e.classList.add("notification__progress--js-controlled"),e.setAttribute("aria-valuenow","100");const t={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"};e.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${t[this.type]||t.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const i=document.createElement("div");i.className="notification__progress-fill";const n={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"};i.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${n[this.type]||n.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,e.innerHTML="",e.appendChild(i)}createProgressBar(){const e={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"},t={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"},i=document.createElement("div");i.className="notification__progress notification__progress--js-controlled",i.setAttribute("role","progressbar"),i.setAttribute("aria-label","Tempo rimanente prima della chiusura automatica"),i.setAttribute("aria-valuemin","0"),i.setAttribute("aria-valuemax","100"),i.setAttribute("aria-valuenow","100"),i.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${e[this.type]||e.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const n=document.createElement("div");n.className="notification__progress-fill",n.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${t[this.type]||t.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,i.appendChild(n),this.element.appendChild(i)}start(){this.isDestroyed||(this.startTime=performance.now(),this.lastLoggedProgress=-1,this.animate({timing:this.timing,draw:e=>this.draw(e),duration:this.duration}))}animate({timing:e,draw:t,duration:i}){if(this.isDestroyed)return;const n=this.startTime,r=o=>{if(this.isDestroyed)return;if(this.isPaused)return this.animationId=requestAnimationFrame(r),void 0;let s=(o-n-this.pausedTime)/i;s>1&&(s=1),s<0&&(s=0);let a=e(s);t(a),this.updateAccessibility(s),s<1?this.animationId=requestAnimationFrame(r):this.onComplete()};this.animationId=requestAnimationFrame(r)}draw(e){if(this.isDestroyed||!this.progressFill)return;this.progressFill.style.transform=`scaleX(${1-e})`}updateAccessibility(e){if(this.progressBar){const t=Math.round(100*(1-e));this.progressBar.setAttribute("aria-valuenow",t.toString())}}pause(){this.isPaused||this.isDestroyed||(this.isPaused=!0,this.pauseStartTime=performance.now())}resume(){this.isPaused&&!this.isDestroyed&&(this.isPaused=!1,this.pauseStartTime&&(this.pausedTime+=performance.now()-this.pauseStartTime,this.pauseStartTime=null))}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.progressFill&&!this.isDestroyed&&(this.progressFill.style.transform="scaleX(0)")}onComplete(){if(this.isDestroyed)return;const e=new CustomEvent("progressComplete",{detail:{element:this.element,type:this.type,duration:this.duration}});this.element.dispatchEvent(e)}destroy(){this.isDestroyed=!0,this.stop(),this.progressBar&&this.progressBar.parentNode&&this.progressBar.parentNode.removeChild(this.progressBar),this.element=null,this.progressBar=null,this.progressFill=null}}function Ke(e,t,i){return new Xe(e,t,i)}class Ze{constructor(e){this.container=e,this.progressBars=new Map,fe.debug("NotificationProgressBarManager initialized")}start(e,t,i){if(t<=0)return null;try{this.stop(e);const n=this.container?.querySelector(`[data-id="${e}"]`);if(!n)return fe.warn(`[ProgressBarManager] Element not found for notification ${e}`),null;const r=this.createProgressBar(n,t,()=>{this.stop(e),"function"==typeof i&&i(e)});return r&&(this.progressBars.set(e,r),n._progressBarInstance=r,fe.debug(`[ProgressBarManager] Progress bar started for notification ${e}`)),r}catch(n){return fe.error(`[ProgressBarManager] Failed to start progress bar for ${e}:`,n),null}}pause(e){try{const t=this.progressBars.get(e);t&&"function"==typeof t.pause&&(t.pause(),fe.debug(`[ProgressBarManager] Progress bar paused for notification ${e}`))}catch(t){fe.error(`[ProgressBarManager] Failed to pause progress bar for ${e}:`,t)}}resume(e){try{const t=this.progressBars.get(e);t&&"function"==typeof t.resume&&(t.resume(),fe.debug(`[ProgressBarManager] Progress bar resumed for notification ${e}`))}catch(t){fe.error(`[ProgressBarManager] Failed to resume progress bar for ${e}:`,t)}}stop(e){try{const t=this.progressBars.get(e);if(t){"function"==typeof t.destroy&&t.destroy(),this.progressBars.delete(e);const i=this.container?.querySelector(`[data-id="${e}"]`);i&&i._progressBarInstance&&(i._progressBarInstance=null),fe.debug(`[ProgressBarManager] Progress bar stopped for notification ${e}`)}}catch(t){fe.error(`[ProgressBarManager] Failed to stop progress bar for ${e}:`,t)}}pauseAll(){try{this.progressBars.forEach((e,t)=>{this.pause(t)}),fe.debug(`[ProgressBarManager] All progress bars paused (${this.progressBars.size})`)}catch(e){fe.error("[ProgressBarManager] Failed to pause all progress bars:",e)}}resumeAll(){try{this.progressBars.forEach((e,t)=>{this.resume(t)}),fe.debug(`[ProgressBarManager] All progress bars resumed (${this.progressBars.size})`)}catch(e){fe.error("[ProgressBarManager] Failed to resume all progress bars:",e)}}cleanup(){try{const e=this.progressBars.size;this.progressBars.forEach((e,t)=>{this.stop(t)}),this.progressBars.clear(),fe.debug(`[ProgressBarManager] Cleanup completed (${e} progress bars destroyed)`)}catch(e){fe.error("[ProgressBarManager] Failed to cleanup progress bars:",e)}}getStats(){return{active:this.progressBars.size,activeIds:Array.from(this.progressBars.keys())}}isActive(e){return this.progressBars.has(e)}createProgressBar(e,t,i){try{const n=e.querySelector(".notification__progress--js-placeholder"),r=Ke(e,t,n?.dataset?.type||e?.dataset?.type||"info");if("function"==typeof i){const t=()=>{try{i()}catch{}e.removeEventListener("progressComplete",t)};e.addEventListener("progressComplete",t)}return{pause:()=>{try{r?.pause?.()}catch{}},resume:()=>{try{r?.resume?.()}catch{}},destroy:()=>{try{r?.destroy?.()}catch{}},get isPaused(){return!!r?.isPaused},get isDestroyed(){return!!r?.isDestroyed},get progress(){try{return r?.progress??0}catch{return 0}}}}catch(n){return fe.error("[ProgressBarManager] Failed to create progress bar:",n),null}}destroy(){this.cleanup(),this.container=null,fe.debug("[ProgressBarManager] Manager destroyed")}}const et={SUCCESS:{icon:"check_circle",ariaRole:"status",ariaLive:"polite",defaultDuration:4e3},ERROR:{icon:"error",ariaRole:"alert",ariaLive:"assertive",defaultDuration:0},WARNING:{icon:"warning",ariaRole:"alert",ariaLive:"assertive",defaultDuration:6e3},INFO:{icon:"info",ariaRole:"status",ariaLive:"polite",defaultDuration:5e3}},tt={maxWidth:768};function it(e,t){if(void 0!==t)return t;const i=et[e.toUpperCase()];return i?i.defaultDuration:5e3}class nt{constructor(e={}){this.options={id:e.id||"notification-announcer",className:e.className||"notification__sr-only",defaultLive:e.defaultLive||"polite",enableQueue:!1!==e.enableQueue,queueDelay:e.queueDelay||150,maxQueueSize:e.maxQueueSize||10,...e},this.element=null,this.queue=[],this.isProcessing=!1,this.currentTimeout=null,this.init()}init(){this.createElement(),this.setupAccessibility()}createElement(){const e=document.getElementById(this.options.id);e&&e.remove(),this.element=document.createElement("div"),this.element.id=this.options.id,this.element.className=this.options.className,document.body.appendChild(this.element)}setupAccessibility(){this.element.setAttribute("aria-live",this.options.defaultLive),this.element.setAttribute("aria-atomic","true"),this.element.setAttribute("role","status"),this.element.style.cssText="\n            position: absolute !important;\n            width: 1px !important;\n            height: 1px !important;\n            padding: 0 !important;\n            margin: -1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n        "}announce(e,t={}){if(!e||"string"!=typeof e)return console.warn("NotificationLiveRegion: messaggio non valido",e),void 0;const i={message:e.trim(),live:t.live||this.options.defaultLive,priority:t.priority||0,timestamp:Date.now(),id:this.generateAnnouncementId()};this.options.enableQueue?this.addToQueue(i):this.processAnnouncement(i)}announceSuccess(e,t=""){this.announce(t?`Successo: ${t}. ${e}`:`Successo: ${e}`,{live:"polite",priority:1})}announceError(e,t=""){this.announce(t?`Errore: ${t}. ${e}`:`Errore: ${e}`,{live:"assertive",priority:3})}announceWarning(e,t=""){this.announce(t?`Attenzione: ${t}. ${e}`:`Attenzione: ${e}`,{live:"assertive",priority:2})}announceInfo(e,t=""){this.announce(t?`Informazione: ${t}. ${e}`:`Informazione: ${e}`,{live:"polite",priority:1})}announceNotification(e,t,i="",n={}){const r={success:"Successo",error:"Errore",warning:"Attenzione",info:"Informazione"}[e]||"Notifica";this.announce(i?`${r}: ${i}. ${t}`:`${r}: ${t}`,{live:{success:"polite",error:"assertive",warning:"assertive",info:"polite"}[e]||"polite",priority:{success:1,error:3,warning:2,info:1}[e]||1,...n})}addToQueue(e){const t=Date.now()-3e3;this.queue=this.queue.filter(i=>i.timestamp<t||i.message!==e.message),this.queue.length>=this.options.maxQueueSize&&this.queue.shift();const i=this.queue.findIndex(t=>t.priority<e.priority);-1===i?this.queue.push(e):this.queue.splice(i,0,e),this.processQueue()}processQueue(){if(this.isProcessing||0===this.queue.length)return;this.isProcessing=!0;const e=this.queue.shift();this.processAnnouncement(e),this.currentTimeout=setTimeout(()=>{this.isProcessing=!1,this.processQueue()},this.options.queueDelay)}processAnnouncement(e){this.element.getAttribute("aria-live")!==e.live&&this.element.setAttribute("aria-live",e.live),this.element.textContent="",setTimeout(()=>{this.element.textContent=e.message,this.dispatchEvent("announced",{announcement:e})},50)}clearQueue(){this.queue=[],this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.isProcessing=!1,this.dispatchEvent("queueCleared")}clear(){this.element.textContent="",this.dispatchEvent("cleared")}updateSettings(e){this.options={...this.options,...e},e.defaultLive&&this.element.setAttribute("aria-live",e.defaultLive),this.dispatchEvent("settingsUpdated",{options:this.options})}getState(){return{id:this.options.id,queueLength:this.queue.length,isProcessing:this.isProcessing,currentContent:this.element.textContent,currentLive:this.element.getAttribute("aria-live"),options:{...this.options}}}generateAnnouncementId(){return`announcement-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}dispatchEvent(e,t={}){const i=new CustomEvent(`notificationLiveRegion:${e}`,{detail:{liveRegion:this,...t}});document.dispatchEvent(i)}destroy(){this.clearQueue(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchEvent("destroyed"),this.element=null,this.queue=[]}static getInstance(e={}){return nt._instance||(nt._instance=new nt(e)),nt._instance}static destroyInstance(){nt._instance&&(nt._instance.destroy(),nt._instance=null)}static exists(){return!!nt._instance}}nt._instance=null;let rt=null;function ot(e,t,i=""){try{rt||(rt=nt.getInstance({id:"notification-announcer"})),rt.announceNotification?.(e,t,i)}catch(n){const i=document.getElementById("notification-announcer");i&&(i.textContent=`${e}: ${t}`)}}function st(e,t,{removeNotification:i}){const n=e.querySelector(".notification__close");n&&n.addEventListener("click",e=>{e.stopPropagation(),i(t.id)}),e.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),i(t.id))})}function at(e,t,{pauseAutoCloseTimer:i}){let n=0;e.addEventListener("touchstart",()=>{n=Date.now()}),e.addEventListener("touchend",()=>{Date.now()-n>500&&i?.(t.id)})}const ct=new class{constructor(){this.notifications=[],this.settings=this.getDefaultSettings(),this.subscribers=new Map,this.cleanupTimer=null,this.loadPersistedSettings(),this.startAutoCleanup(),fe.debug("NotificationStateManager initialized")}getDefaultSettings(){return{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:!0,autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}}}loadPersistedSettings(){try{const e=localStorage.getItem("notificationSettings");if(e){const t=JSON.parse(e);this.settings={...this.settings,...t}}}catch(e){fe.warn("Failed to load persisted notification settings:",e)}}persistSettings(){try{localStorage.setItem("notificationSettings",JSON.stringify(this.settings))}catch(e){fe.warn("Failed to persist notification settings:",e)}}subscribe(e){const t=Symbol("notificationSubscriber");return this.subscribers.set(t,e),()=>{this.subscribers.delete(t)}}notifySubscribers(){this.subscribers.forEach((e,t)=>{try{e(this.notifications,this.settings)}catch(i){fe.error(`Error in notification subscriber ${String(t)}:`,i)}})}addNotification(e,t,i={}){"number"==typeof i&&(i={duration:i});const n=this.normalizeNotificationType(e),r=void 0!==this.settings.customDurations?.[n]?this.settings.customDurations[n]:this.settings.defaultDuration,o={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:n,message:t,timestamp:new Date,isVisible:!0,isRemoving:!1,options:{duration:r,persistent:this.settings.persistentTypes.includes(n),closable:!0,position:this.settings.position,priority:0,duplicateCount:1,...i}};if(o.options.persistent&&(o.options.duration=0),fe.debug(`[NotificationStateManager] Current notifications before adding: ${this.notifications.length}`,this.notifications),!this.handleDeduplication(n,t))return this.notifications=[...this.notifications,o],this.enforceMaxNotifications(),this.notifySubscribers(),fe.debug(`[NotificationStateManager] Notification added. New notifications array length: ${this.notifications.length}`,this.notifications),o.id}handleDeduplication(e,t){try{const i=Date.now(),n=1500;if("success"===e||"info"===e){const r=[...this.notifications].reverse().findIndex(r=>{const o=new Date(r.timestamp).getTime();return r.type===e&&r.message===t&&i-o<=n});if(-1!==r){const e=this.notifications.length-1-r,t=this.notifications[e],i={...t,timestamp:new Date,options:{...t.options,duplicateCount:(t.options?.duplicateCount||1)+1}};return this.notifications=[...this.notifications],this.notifications[e]=i,this.notifySubscribers(),!0}}}catch(i){fe.warn("Deduplication failed:",i)}return!1}enforceMaxNotifications(){if(this.notifications.length>this.settings.maxStoredNotifications){fe.warn(`[NotificationStateManager] Max stored notifications (${this.settings.maxStoredNotifications}) exceeded. Trimming old notifications.`);const e=[...this.notifications].sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)).slice(0,this.notifications.length-this.settings.maxStoredNotifications);this.notifications=this.notifications.filter(t=>!e.includes(t)||t.options.persistent&&"error"===t.type),fe.debug(`[NotificationStateManager] Notifications after trimming: ${this.notifications.length}`,this.notifications)}}normalizeNotificationType(e){const t=String(e||"").toLowerCase().trim();return t?["error","errore","err","danger","fatal"].includes(t)?"error":["success","ok","successo"].includes(t)?"success":["warning","warn","avviso","alert"].includes(t)?"warning":(["info","informazione","notice"].includes(t),"info"):"info"}removeNotification(e){const t=this.notifications.length;this.notifications=this.notifications.filter(t=>t.id!==e),this.notifications.length!==t&&(fe.debug(`[NotificationStateManager] Notification ${e} removed`),this.notifySubscribers())}clearAllNotifications(){this.notifications.length>0&&(this.notifications=[],this.notifySubscribers(),fe.debug("[NotificationStateManager] All notifications cleared"))}clearNotificationsByType(e){const t=this.notifications.length;this.notifications=this.notifications.filter(t=>t.type!==e),this.notifications.length!==t&&(fe.debug(`[NotificationStateManager] Notifications of type '${e}' cleared`),this.notifySubscribers())}updateSettings(e){const t={...this.settings,...e};this.settings=t,this.persistSettings(),void 0!==e.autoCleanupInterval&&this.startAutoCleanup(),this.notifySubscribers(),fe.debug("[NotificationStateManager] Settings updated:",t)}getSettings(){return{...this.settings}}getNotifications(){return[...this.notifications]}getNotificationsByType(e){return this.notifications.filter(t=>t.type===e)}getVisibleNotifications(){return this.notifications.filter(e=>e.isVisible&&!e.isRemoving).slice(-this.settings.maxVisible)}hasErrorNotifications(){return this.notifications.some(e=>"error"===e.type)}getStats(){const e={success:0,error:0,warning:0,info:0};let t=0;return this.notifications.forEach(i=>{e[i.type]=(e[i.type]||0)+1,i.options.persistent&&t++}),{total:this.notifications.length,visible:this.getVisibleNotifications().length,byType:e,persistent:t}}clearOldNotifications(e=3e5){const t=Date.now(),i=this.notifications.length;this.notifications=this.notifications.filter(i=>{const n=new Date(i.timestamp).getTime();if(!Number.isFinite(n))return!0;return!(t-n>e&&!i.options.persistent)});const n=i-this.notifications.length;return n>0&&(fe.debug(`[NotificationStateManager] Cleaned up ${n} old notifications`),this.notifySubscribers()),n}startAutoCleanup(){this.cleanupTimer&&clearInterval(this.cleanupTimer);const e=this.settings.autoCleanupInterval;e>0&&(this.cleanupTimer=setInterval(()=>{this.clearOldNotifications()},e),fe.debug(`[NotificationStateManager] Auto cleanup started with interval: ${e}ms`))}exportSettings(){return{version:"2.0",timestamp:(new Date).toISOString(),settings:{...this.settings},exportedBy:"NotificationStateManager"}}importSettings(e){try{return!(!e||"object"!=typeof e||!e.settings)&&(e.version&&"2.0"!==e.version&&"1.0"!==e.version&&fe.warn(`Unsupported backup version: ${e.version}`),this.settings={...this.getDefaultSettings(),...e.settings},this.persistSettings(),this.startAutoCleanup(),this.notifySubscribers(),fe.debug("[NotificationStateManager] Settings imported successfully"),!0)}catch(t){return fe.error("Failed to import notification settings:",t),!1}}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.subscribers.clear(),this.notifications=[],fe.debug("[NotificationStateManager] Destroyed")}};class lt{static DEBUG=!1;static notificationQueue=[];static isDOMReady=!1;static domReadyCallbacks=[];static animationSupport=null;static reducedMotionPreference=null;static errorCounts={render:0,animation:0,dom:0,service:0,total:0};static init(){this.checkDOMReady(),this.checkAnimationSupport(),this.checkReducedMotionPreference(),this.setupErrorRecovery()}static handleRenderError(e,t,i=null){this.errorCounts.render++,this.errorCounts.total++,fe.error("‚ùå Notification render error:",e,t),"undefined"!=typeof window&&window.appLogger&&window.appLogger.error("Notification render failed",{error:e.message,notificationId:t?.id,notificationType:t?.type,stack:e.stack});try{return i&&"function"==typeof i?i(t):this.createSimpleFallback(t)}catch(n){return fe.error("‚ùå Fallback renderer also failed:",n),this.showConsoleFallback(t),null}}static handleAnimationError(e,t,i="unknown"){if(this.errorCounts.animation++,this.errorCounts.total++,fe.warn("‚ö†Ô∏è Animation error:",e,i),t)try{t.style.animation="none",t.style.transition="none","entrance"===i?(t.style.opacity="1",t.style.transform="translateX(0)",t.classList.add("notification--visible"),t.classList.remove("notification--entering")):"exit"===i&&(t.style.opacity="0",t.classList.add("notification--hidden"),t.classList.remove("notification--exiting")),this.DEBUG&&fe.debug("‚úÖ Animation fallback applied to element")}catch(n){fe.error("‚ùå Animation fallback failed:",n)}}static handleServiceError(e,t,i=null){this.errorCounts.service++,this.errorCounts.total++,this.errorCounts.service%10==1&&fe.error(`‚ùå NotificationService error in ${t} (${this.errorCounts.service} total):`,e),"undefined"!=typeof window&&window.appLogger&&window.appLogger.error(`NotificationService ${t} failed`,{error:e.message,operation:t,data:i,stack:e.stack});try{switch(t){case"show":this.recoverFromShowError(i);break;case"remove":this.recoverFromRemoveError(i);break;case"clear":this.recoverFromClearError();break;case"init":this.recoverFromInitError();break;default:fe.warn(`‚ö†Ô∏è No recovery strategy for operation: ${t}`)}}catch(n){fe.error("‚ùå Error recovery failed:",n)}}static handleDOMError(e,t,i=null){return this.errorCounts.dom++,this.errorCounts.total++,fe.error(`‚ùå DOM error in ${t}:`,e),!(!this.isDOMReady&&"render"===t)||(fe.debug("üìã DOM not ready, queueing notification"),!1)}static queueNotification(e,t){if(this.isDOMReady)try{return e(t)}catch(i){return this.handleRenderError(i,t)}return this.notificationQueue.push({renderFunction:e,notification:t,timestamp:Date.now()}),this.DEBUG&&fe.debug(`üìã Queued notification ${t?.id}, queue size: ${this.notificationQueue.length}`),null}static processNotificationQueue(){if(!this.isDOMReady||0===this.notificationQueue.length)return;fe.debug(`üöÄ Processing ${this.notificationQueue.length} queued notifications`);const e=[...this.notificationQueue];this.notificationQueue=[],e.forEach(({renderFunction:e,notification:t,timestamp:i})=>{try{if(Date.now()-i>3e4)return fe.warn("‚ö†Ô∏è Skipping old queued notification:",t?.id),void 0;e(t)}catch(n){this.handleRenderError(n,t)}})}static createSimpleFallback(e){const t=document.createElement("div");t.className=`notification notification--${e.type} notification--fallback`,t.setAttribute("data-id",e.id),t.setAttribute("role","error"===e.type?"alert":"status"),t.setAttribute("aria-live","error"===e.type?"assertive":"polite"),t.style.cssText="\n            position: relative;\n            padding: 12px 16px;\n            margin: 8px 0;\n            border-radius: 4px;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 14px;\n            line-height: 1.4;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n            max-width: 400px;\n            word-wrap: break-word;\n        ";const i={success:{bg:"#d4edda",text:"#155724",border:"#c3e6cb"},error:{bg:"#f8d7da",text:"#721c24",border:"#f5c6cb"},warning:{bg:"#fff3cd",text:"#856404",border:"#ffeaa7"},info:{bg:"#d1ecf1",text:"#0c5460",border:"#bee5eb"}},n=i[e.type]||i.info;t.style.backgroundColor=n.bg,t.style.color=n.text,t.style.border=`1px solid ${n.border}`;const r=document.createElement("div");r.style.cssText="display: flex; align-items: flex-start; gap: 8px;";const o=document.createElement("span");o.style.cssText="flex-shrink: 0; font-weight: bold; font-size: 16px;";const s={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"};o.textContent=s[e.type]||s.info;const a=document.createElement("div");if(a.style.cssText="flex: 1; min-width: 0;",e.title){const t=document.createElement("div");t.style.cssText="font-weight: bold; margin-bottom: 4px;",t.textContent=e.title,a.appendChild(t)}const c=document.createElement("div");c.textContent=e.message||`Notifica ${e.type||"info"} - Messaggio non disponibile`,a.appendChild(c);const l=document.createElement("button");return l.style.cssText=`\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            padding: 0;\n            margin-left: 8px;\n            color: ${n.text};\n            opacity: 0.7;\n            flex-shrink: 0;\n        `,l.textContent="√ó",l.setAttribute("aria-label","Chiudi notifica"),l.onclick=()=>{t.remove();try{ct&&"function"==typeof ct.removeNotification&&ct.removeNotification(e.id)}catch(i){console.debug("Could not remove from state:",i)}},r.appendChild(o),r.appendChild(a),r.appendChild(l),t.appendChild(r),t}static showConsoleFallback(e){const t={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},i=`${t[e.type]||t.info} NOTIFICATION: ${e.message||`Notifica ${e.type||"info"} - Messaggio non disponibile`}`;"error"===e.type?console.error(i):"warning"===e.type?console.warn(i):console.log(i)}static checkDOMReady(){if("undefined"==typeof document)return this.isDOMReady=!1,void 0;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.isDOMReady=!0,this.processNotificationQueue(),this.domReadyCallbacks.forEach(e=>{try{e()}catch(t){console.error("‚ùå DOM ready callback error:",t)}}),this.domReadyCallbacks=[]}):this.isDOMReady=!0}static checkAnimationSupport(){if("undefined"==typeof window||"undefined"==typeof document)return this.animationSupport=!1,void 0;try{const e=document.createElement("div");e.style.animation="test 1s",this.animationSupport=""!==e.style.animation}catch(e){this.animationSupport=!1}this.DEBUG&&console.log("üé¨ Animation support:",this.animationSupport)}static checkReducedMotionPreference(){if("undefined"==typeof window||!window.matchMedia)return this.reducedMotionPreference=!1,void 0;try{const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.reducedMotionPreference=e.matches,e.addEventListener("change",e=>{this.reducedMotionPreference=e.matches})}catch(e){this.reducedMotionPreference=!1}this.DEBUG&&console.log("üé¨ Reduced motion preference:",this.reducedMotionPreference)}static setupErrorRecovery(){setInterval(()=>{this.cleanupOldQueuedNotifications()},6e4),"undefined"!=typeof window&&window.addEventListener("error",e=>{e.message&&e.message.includes("notification")&&console.warn("‚ö†Ô∏è Possible notification-related error detected")})}static cleanupOldQueuedNotifications(){const e=Date.now(),t=this.notificationQueue.length;this.notificationQueue=this.notificationQueue.filter(t=>e-t.timestamp<6e4);const i=t-this.notificationQueue.length;i>0&&this.DEBUG&&console.log(`üßπ Cleaned up ${i} old queued notifications`)}static recoverFromShowError(e){console.log("üîÑ Attempting recovery from show error");try{const t=this.createSimpleFallback(e);if(t){const e=document.querySelector(".notification-container")||document.querySelector("#notification-container")||document.body;if(e)return e.appendChild(t),!0}}catch(t){console.error("‚ùå Show recovery failed:",t)}return this.showConsoleFallback(e),!1}static recoverFromRemoveError(e){console.log("üîÑ Attempting recovery from remove error");try{const t=document.querySelector(`[data-id="${e}"]`);if(t)return t.remove(),fe.debug("‚úÖ Notification removed via DOM recovery"),!0}catch(t){console.error("‚ùå Remove recovery failed:",t)}return!1}static recoverFromClearError(){fe.debug("üîÑ Attempting recovery from clear error");try{const e=document.querySelectorAll('.notification, [class*="notification"]');return e.forEach(e=>{try{e.remove()}catch(t){fe.debug("Could not remove notification element:",t)}}),fe.debug(`‚úÖ Cleared ${e.length} notifications via DOM recovery`),!0}catch(e){fe.error("‚ùå Clear recovery failed:",e)}return!1}static recoverFromInitError(){fe.debug("üîÑ Attempting recovery from init error");try{let e=document.querySelector(".notification-container");if(!e)return e=document.createElement("div"),e.className="notification-container notification-container--fallback",e.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    z-index: 9999;\n                    pointer-events: none;\n                ",document.body.appendChild(e),fe.debug("‚úÖ Fallback notification container created"),!0}catch(e){fe.error("‚ùå Init recovery failed:",e)}return!1}static getErrorStats(){return{...this.errorCounts,queueSize:this.notificationQueue.length,isDOMReady:this.isDOMReady,animationSupport:this.animationSupport,reducedMotionPreference:this.reducedMotionPreference}}static resetErrorStats(){this.errorCounts={render:0,animation:0,dom:0,service:0,total:0}}static shouldDisableAnimations(){return!this.animationSupport||this.reducedMotionPreference}static onDOMReady(e){if(this.isDOMReady)try{e()}catch(t){fe.error("‚ùå DOM ready callback error:",t)}else this.domReadyCallbacks.push(e)}}function dt(e,{allowHTML:t=!1}={}){if(!t){const t=document.createElement("div");return t.textContent=String(e??""),t.innerHTML}const i=document.createElement("div");i.innerHTML=String(e??"");const n=new Set(["b","strong","i","em","u","br","code","pre","span","p","ul","ol","li","a"]),r=e=>{if(e.nodeType===Node.COMMENT_NODE)return e.remove(),void 0;if(e.nodeType===Node.ELEMENT_NODE){const t=e;if(!n.has(t.tagName.toLowerCase())){const e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);return e.removeChild(t),void 0}[...t.attributes].forEach(e=>{const i=e.name.toLowerCase(),n=String(e.value||"");if(i.startsWith("on")||"style"===i)t.removeAttribute(e.name);else if("a"===t.tagName.toLowerCase()&&"href"===i){/^(https?:|mailto:)/i.test(n)||t.removeAttribute("href")}else"href"!==i&&"title"!==i&&t.removeAttribute(e.name)})}let t=e.firstChild;for(;t;){const e=t.nextSibling;r(t),t=e}};return r(i),i.innerHTML}function ut({notification:e,_index:t=0,settings:i,timers:n,timerManager:r,progressBarManager:o,removeNotification:s,startAutoCloseTimer:a,pauseAutoCloseTimer:c,resumeAutoCloseTimer:l,announceNotification:d,attachNotificationEvents:u,attachTouchEvents:m,notificationContainer:h,errorHandler:p=lt}){try{const t=et[e.type.toUpperCase()]||et.INFO,E=e.options||{},S=it(e.type,E.duration),T=document.createElement("div");let _=`notification notification--${e.type}`;if(S>0&&!E.persistent&&(_+=" notification--autoclose"),T.className=_,T.dataset.id=e.id,T.setAttribute("role",t.ariaRole),T.setAttribute("aria-live",t.ariaLive),T.setAttribute("aria-atomic","true"),T.setAttribute("tabindex","0"),i.enableAnimations&&!p.shouldDisableAnimations())try{T.classList.add("notification--entering"),T.addEventListener("animationend",e=>{(e.animationName.includes("slideIn")||e.animationName.includes("fadeIn"))&&(T.classList.remove("notification--entering"),T.classList.add("notification--visible"))}),T.addEventListener("animationerror",e=>{p.handleAnimationError(new Error("Animation failed"),T,"entrance")})}catch(g){p.handleAnimationError(g,T,"entrance")}else T.classList.add("notification--visible","notification--no-animations");let A="";try{A=`\n                <div class="notification__content">\n                    <span class="material-icons notification__icon" aria-hidden="true">${t.icon}</span>\n                    <div class="notification__body">\n                        ${E.title?`<div class="notification__title">${dt(E.title,{allowHTML:!1})}</div>`:""}\n                        <div class="notification__message">${dt(e.message,{allowHTML:!!E.allowHTML})}</div>\n                    </div>\n                </div>\n            `,E.duplicateCount&&E.duplicateCount>1&&(A=A.replace('<span class="material-icons notification__icon" aria-hidden="true">',`<span class="notification__count" aria-label="Ripetuta ${E.duplicateCount} volte">√ó${E.duplicateCount}</span><span class="material-icons notification__icon" aria-hidden="true">`)),(!1!==E.closable||E.actions)&&(A+='<div class="notification__actions">',E.actions&&Array.isArray(E.actions)&&E.actions.forEach((e,t)=>{A+=`\n                            <button class="notification__action-btn ${"primary"===e.style?"notification__action-btn--primary":"secondary"===e.style?"notification__action-btn--secondary":""}" \n                                    data-action-index="${t}"\n                                    aria-label="${dt(e.label,{allowHTML:!1})}">\n                                ${dt(e.label,{allowHTML:!1})}\n                            </button>\n                        `}),!1!==E.closable&&(A+='\n                        <button class="notification__close" \n                                aria-label="Chiudi notifica"\n                                title="Chiudi notifica">\n                            <span class="material-icons" aria-hidden="true">close</span>\n                        </button>\n                    '),A+="</div>");const i=S;i>0&&!E.persistent&&(fe.debug(`üîß Creating progress bar placeholder for ${e.type} (${i}ms)`),A+=`\n                    <div class="notification__progress notification__progress--js-placeholder" \n                         aria-hidden="true" \n                         role="progressbar"\n                         aria-label="Tempo rimanente prima della chiusura automatica"\n                         data-duration="${i}"\n                         data-type="${e.type}"></div>\n                `),T.innerHTML=A}catch(f){fe.error("‚ùå Error building notification HTML:",f),T.innerHTML=`\n                <div class="notification__content">\n                    <span class="notification__icon">!</span>\n                    <div class="notification__body">\n                        <div class="notification__message">${e.message||"Notifica"}</div>\n                    </div>\n                    <button class="notification__close" aria-label="Chiudi">√ó</button>\n                </div>\n            `}try{u(T,e,{timers:n,removeNotification:s,pauseAutoCloseTimer:c,resumeAutoCloseTimer:l,notificationContainer:h})}catch(y){fe.error("‚ùå Error attaching notification events:",y);const t=T.querySelector(".notification__close");t&&t.addEventListener("click",()=>{try{s(e.id)}catch(t){T.remove()}})}try{window.innerWidth<=tt.maxWidth&&m(T,e,{pauseAutoCloseTimer:c,resumeAutoCloseTimer:l,removeNotification:s})}catch(w){fe.error("‚ùå Error attaching touch events:",w)}try{const t=S;if(t>0&&!E.persistent){const i=T.querySelector(".notification__progress--js-placeholder");if(fe.debug("üîç Looking for progress bar placeholder:",i),r&&o)window.innerWidth>768&&(T.addEventListener("mouseenter",()=>{try{r.pause(e.id)}catch{}try{o.pause(e.id)}catch{}}),T.addEventListener("mouseleave",()=>{try{r.resume(e.id)}catch{}try{o.resume(e.id)}catch{}})),fe.debug(`üïí Managers provided; start deferred until mount (${e.type})`);else if(i){const i=Ke(T,t,e.type);a(n,e.id,t,()=>{try{s(e.id)}catch(t){fe.error("‚ùå Error in progress complete callback:",t),T.parentNode&&T.remove()}}),window.innerWidth>768&&(T.addEventListener("mouseenter",()=>{i&&i.pause()}),T.addEventListener("mouseleave",()=>{i&&i.resume()})),T._progressBarInstance=i,fe.debug(`‚úÖ JavaScript progress bar initialized for ${e.type} (${t}ms)`)}else a(n,e.id,t,()=>{try{s(e.id)}catch(t){console.error("‚ùå Error in auto-close callback:",t),T.parentNode&&T.remove()}}),fe.debug(`‚úÖ Fallback timer used for ${e.type} (${t}ms)`)}}catch(b){fe.error("‚ùå Error setting up auto-close timer:",b)}try{d(e.type,e.message,E.title||"")}catch(v){fe.warn("‚ùå Error announcing notification:",v)}return T}catch(E){return fe.error("‚ùå Critical error in createNotificationElement:",E),p.createSimpleFallback(e)}}"undefined"!=typeof window&&lt.init();class mt{constructor({containerEl:e,timerManager:t,progressBarManager:i,settings:n,onRemove:r,timersMap:o}){this.containerEl=e||null,this.timerManager=t||null,this.progressBarManager=i||null,this.settings=n||{},this.onRemove="function"==typeof r?r:null,this.timersMap=o||new Map,this.isRendering=!1,this._lastRenderedIds=[],this._renderCount=0,this._lastRenderTime=0,this._avgRenderTime=0}setContainer(e){this.containerEl=e,this.progressBarManager&&(this.progressBarManager.container=e)}render(e=[]){if(Array.isArray(e)&&this.containerEl&&!this.isRendering){this.isRendering=!0;try{const i="undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?()=>window.performance.now():()=>Date.now(),n=i(),r=new Set(e.map(e=>e.id)),o=new Set(this._lastRenderedIds);o.forEach(e=>{if(!r.has(e))try{this.removeElement(e)}catch(t){lt.handleDOMError(t,"remove",null)}}),e.forEach(e=>{if(!o.has(e.id))try{this.addElement(e)}catch(t){lt.handleRenderError(t,e,e=>{const t=lt.createSimpleFallback(e);return t&&this.containerEl.appendChild(t),t})}}),e.forEach(e=>{if(o.has(e.id))try{const t=this.getElementById(e.id);if(!t)return;const i=e?.options?.duplicateCount||1;let n=t.querySelector(".notification__count");if(i>1)if(n)n.textContent=`√ó${i}`,n.setAttribute("aria-label",`Ripetuta ${i} volte`);else{const e=t.querySelector(".notification__icon");n=document.createElement("span"),n.className="notification__count",n.setAttribute("aria-label",`Ripetuta ${i} volte`),n.textContent=`√ó${i}`,e&&e.parentNode?e.parentNode.insertBefore(n,e):t.querySelector(".notification__content")?.prepend(n)}else n&&n.remove()}catch(t){}});const s=Math.max(0,e.length-(this.settings?.maxVisible??5)),a=s>0?e.slice(0,s):[];t=e=>{try{this.onRemove?.(e)}catch{}},void a.forEach(e=>{"success"!==e.type&&"info"!==e.type||setTimeout(()=>{t(e.id)},1e3)}),this._lastRenderedIds=e.map(e=>e.id);const c=Math.max(0,i()-n);this._lastRenderTime=c,this._renderCount+=1,this._avgRenderTime=1===this._renderCount?c:(this._avgRenderTime*(this._renderCount-1)+c)/this._renderCount}finally{this.isRendering=!1}var t}}addElement(e){const t=this.createElement(e);if(!t)throw new Error("createElement returned null");this.containerEl.appendChild(t),this.afterMount(e,t)}removeElement(e){const t=this.getElementById(e);t&&t.parentNode&&t.parentNode.removeChild(t)}getStats(){return{renderCount:this._renderCount,averageRenderTime:this._avgRenderTime,lastRenderTime:this._lastRenderTime}}updateSettings(e){this.settings=e||this.settings}createElement(e){try{return ut({notification:e,settings:this.settings,timers:this.timersMap,timerManager:this.timerManager,progressBarManager:this.progressBarManager,removeNotification:e=>{try{this.onRemove?.(e)}catch{}},announceNotification:ot,attachNotificationEvents:st,attachTouchEvents:at,notificationContainer:{container:this.containerEl},errorHandler:lt})}catch(t){fe.error("[RenderEngine] Failed to create notification element:",t);try{return lt.createSimpleFallback(e)}catch(i){return null}}}afterMount(e,t){try{if(!e||!t)return;const i=e.options||{},n=it(e.type,i.duration);n>0&&!i.persistent&&this.timerManager&&this.progressBarManager&&(this.progressBarManager.start(e.id,n,()=>{try{this.onRemove?.(e.id)}catch{}}),this.timerManager.start(e.id,n),"undefined"!=typeof window&&window.innerWidth>768&&(t.addEventListener("mouseenter",()=>{try{this.timerManager.pause(e.id)}catch{}try{this.progressBarManager.pause(e.id)}catch{}}),t.addEventListener("mouseleave",()=>{try{this.timerManager.resume(e.id)}catch{}try{this.progressBarManager.resume(e.id)}catch{}})))}catch(i){fe.error("[RenderEngine] afterMount failed:",i)}}getElementById(e){try{return this.containerEl?.querySelector(`[data-id="${e}"]`)||null}catch(t){return null}}pauseAll(){try{this.timerManager?.pauseAll()}catch{}try{this.progressBarManager?.pauseAll()}catch{}}resumeAll(){try{this.timerManager?.resumeAll()}catch{}try{this.progressBarManager?.resumeAll()}catch{}}cleanupAll(){try{this.timerManager?.stopAll()}catch{}try{this.progressBarManager?.cleanup()}catch{}}removeAnimated(e,t,i){try{const n=this.getElementById(e);if(n&&t)try{n.classList.remove("notification--entering"),n.classList.add("notification--exiting");const t=n.querySelector(".notification__progress");return t&&t.classList.remove("notification__progress--active","notification__progress--paused","notification__progress--resumed"),setTimeout(()=>{try{this.removeElement(e)}catch{}try{i?.()}catch{}},300),void 0}catch{}this.removeElement(e);try{i?.()}catch{}}catch(n){try{i?.()}catch{}}}}class ht{constructor(e){this.timers=new Map,this.onTimeout=e||(e=>fe.debug(`Timer expired for notification ${e}`)),fe.debug("NotificationTimerManager initialized")}start(e,t){try{if(this.stop(e),t<=0)return fe.debug(`[TimerManager] No timer set for notification ${e} (duration: ${t})`),!1;const i=Ge(this.timers,e,t,e=>{fe.debug(`[TimerManager] Timer ${e} expired`),this.onTimeout(e)});return i&&fe.debug(`[TimerManager] Timer started for notification ${e} (${t}ms)`),i}catch(i){return fe.error(`[TimerManager] Failed to start timer for ${e}:`,i),!1}}pause(e){try{if(!this.timers.has(e))return fe.debug(`[TimerManager] No timer to pause for notification ${e}`),!1;const t=We(this.timers,e);return t&&fe.debug(`[TimerManager] Timer paused for notification ${e}`),t}catch(t){return fe.error(`[TimerManager] Failed to pause timer for ${e}:`,t),!1}}resume(e){try{if(!this.timers.has(e))return fe.debug(`[TimerManager] No timer to resume for notification ${e}`),!1;const t=Qe(this.timers,e);return t&&fe.debug(`[TimerManager] Timer resumed for notification ${e}`),t}catch(t){return fe.error(`[TimerManager] Failed to resume timer for ${e}:`,t),!1}}stop(e,t){try{if(!this.timers.has(e))return!1;const i=Ye(this.timers,e,t);return i&&fe.debug(`[TimerManager] Timer stopped for notification ${e}`),i}catch(i){return fe.error(`[TimerManager] Failed to stop timer for ${e}:`,i),!1}}pauseAll(){let e=0;try{this.timers.forEach((t,i)=>{this.pause(i)&&e++}),fe.debug(`[TimerManager] Paused ${e}/${this.timers.size} timers`)}catch(t){fe.error("[TimerManager] Failed to pause all timers:",t)}return e}resumeAll(){let e=0;try{this.timers.forEach((t,i)=>{this.resume(i)&&e++}),fe.debug(`[TimerManager] Resumed ${e}/${this.timers.size} timers`)}catch(t){fe.error("[TimerManager] Failed to resume all timers:",t)}return e}stopAll(e){let t=0;try{Array.from(this.timers.keys()).forEach(i=>{this.stop(i,e)&&t++}),fe.debug(`[TimerManager] Stopped ${t} timers`)}catch(i){fe.error("[TimerManager] Failed to stop all timers:",i)}return t}cleanupOrphanedTimers(e=[]){let t=0;try{const i=new Set(e);Array.from(this.timers.keys()).forEach(e=>{i.has(e)||this.stop(e)&&t++}),t>0&&fe.debug(`[TimerManager] Cleaned up ${t} orphaned timers`)}catch(i){fe.error("[TimerManager] Failed to cleanup orphaned timers:",i)}return t}getStats(){try{const e={total:this.timers.size,active:0,paused:0,activeIds:[],pausedIds:[]};return this.timers.forEach((t,i)=>{t&&"object"==typeof t&&(t.paused?(e.paused++,e.pausedIds.push(i)):(e.active++,e.activeIds.push(i)))}),e}catch(e){return fe.error("[TimerManager] Failed to get stats:",e),{total:0,active:0,paused:0,activeIds:[],pausedIds:[],error:e.message}}}hasTimer(e){return this.timers.has(e)}isPaused(e){try{const t=this.timers.get(e);return t&&!0===t.paused}catch(t){return fe.error(`[TimerManager] Failed to check if timer ${e} is paused:`,t),!1}}getRemainingTime(e){try{const t=this.timers.get(e);return t&&"function"==typeof t.getRemainingTime?t.getRemainingTime():-1}catch(t){return fe.error(`[TimerManager] Failed to get remaining time for ${e}:`,t),-1}}cleanup(){try{const e=this.stopAll();this.timers.clear(),fe.debug(`[TimerManager] Cleanup completed (${e} timers stopped)`)}catch(e){fe.error("[TimerManager] Failed to cleanup:",e)}}destroy(){this.cleanup(),this.onTimeout=null,fe.debug("[TimerManager] Manager destroyed")}}class pt{constructor({onHidden:e,onVisible:t}={}){this.onHidden="function"==typeof e?e:null,this.onVisible="function"==typeof t?t:null,this._handler=this._handleVisibilityChange.bind(this),this._attached=!1}attach(){this._attached||"undefined"==typeof document||(document.addEventListener("visibilitychange",this._handler,{passive:!0}),this._attached=!0)}detach(){this._attached&&"undefined"!=typeof document&&(document.removeEventListener("visibilitychange",this._handler),this._attached=!1)}_handleVisibilityChange(){try{document.hidden?this.onHidden?.():this.onVisible?.()}catch{}}}function gt(e){const t=String(e||"").toLowerCase();switch(t){case"errore":case"danger":case"err":case"error":return"error";case"successo":case"ok":case"success":return"success";case"avviso":case"warn":case"warning":return"warning";default:return"info"===t||"informazione"===t?"info":t||"info"}}class ft{static DEBUG=!1;constructor(){this.notificationContainer=null,this.timers=new Map,this.initialized=!1,this.isRendering=!1,this.settings=ct.getSettings(),this._lastRenderedNotificationIds=[],this._renderCount=0,this._lastRenderTime=0,this._averageRenderTime=0,this._unsubscribe=null,this._unsubscribeSettings=null,this.timerManager=null,this.progressBarManager=null,this.renderEngine=null,this.visibilityManager=null,this.timerAdapter=null}flush(){try{const e=ct.getNotifications();this.renderNotifications(e)}catch{}}async init(){if(!this.initialized&&"undefined"!=typeof window)try{await this.#e(),function(){try{rt=nt.getInstance({id:"notification-announcer"})}catch(e){if(!document.getElementById("notification-announcer")){const e=document.createElement("div");e.id="notification-announcer",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;",document.body.appendChild(e)}}}(),this._unsubscribe=ct.subscribe(this.#t),this._unsubscribeSettings=ct.subscribe((e,t)=>{try{if(this.settings=t,this.notificationContainer){this.notificationContainer.updateSettings({position:this.settings.position,maxVisible:this.settings.maxVisible})}}catch{}}),this.initialized=!0,this.visibilityManager=new pt({onHidden:()=>{try{this.renderEngine?.pauseAll(),this.#i()}catch{}},onVisible:()=>{try{this.renderEngine?.resumeAll(),this.#n()}catch{}}}),this.visibilityManager.attach()}catch(e){lt.handleServiceError(e,"init"),this.initialized=!0}}async#e(){if(this.notificationContainer)return;const{NotificationContainer:e}=await r(async()=>{const{NotificationContainer:e}=await import("./NotificationContainer-CzhXFxPx.js");return{NotificationContainer:e}},[]);this.notificationContainer=new e({position:this.settings.position,maxVisible:this.settings.maxVisible});const t=this.notificationContainer?.container||null;this.timerManager=new ht(e=>this.removeNotification(e)),this.progressBarManager=new Ze(t),this.renderEngine=new mt({containerEl:t,timerManager:this.timerManager,progressBarManager:this.progressBarManager,settings:this.settings,onRemove:e=>this.removeNotification(e),timersMap:this.timers}),this.timerAdapter=new Je({timerManager:this.timerManager,progressBarManager:this.progressBarManager,legacyTimersMap:this.timers})}show(e,t,i={}){try{const n=gt(e),r=String(t||"").trim();if(!r){return this.show(n,`Notifica ${n} - Messaggio non disponibile`,i)}const o=function(e,t){const i=e||{},n=(i.customDurations||{})[t];return(i.persistentTypes||[]).includes(t)?0:"number"==typeof n?n:"number"==typeof i.defaultDuration?i.defaultDuration:5e3}(this.settings,n),s=function(e,t,i){return{duration:void 0!==t?.duration?t.duration:i,closable:!1!==t?.closable,position:t&&t.position||e&&e.position,priority:t&&t.priority||0,title:t?.title,actions:t?.actions,persistent:t?.persistent,...t}}(this.settings,i,o);return ct.addNotification(n,r,s)}catch(n){return lt.handleServiceError(n,"show",{type:e,message:t,options:i}),lt.recoverFromShowError({type:gt(e),message:t,options:i,id:Date.now().toString()})}}success(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("success",e,t)}info(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("info",e,t)}warning(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("warning",e,t)}error(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("error",e,t)}renderNotifications(e=[]){Array.isArray(e)&&this.notificationContainer&&(this.renderEngine?.setContainer(this.notificationContainer.container),this.renderEngine?.updateSettings(this.settings),this.renderEngine?.render(e))}#r(e){const t=this.renderEngine?.createElement(e)||ut({notification:e,settings:this.settings,timers:this.timers,removeNotification:e=>this.removeNotification(e),startAutoCloseTimer:Ge,pauseAutoCloseTimer:We,resumeAutoCloseTimer:Qe,announceNotification:ot,attachNotificationEvents:st,attachTouchEvents:at,notificationContainer:this.notificationContainer,errorHandler:lt});if(!t)throw new Error("createNotificationElement returned null");this.notificationContainer.addNotification(t);try{this.renderEngine?.afterMount(e,t)}catch{}}#t=this.#o(e=>{Array.isArray(e)&&this.renderNotifications(e)},16);removeNotification(e){try{if(this.timerAdapter?.stop(e,()=>this.progressBarManager?.stop(e)),!this.notificationContainer)return ct.removeNotification(e),void 0;const t=this.settings.enableAnimations&&!lt.shouldDisableAnimations();this.renderEngine?.removeAnimated(e,t,()=>this.#s(e))}catch(t){lt.handleServiceError(t,"remove",e),lt.recoverFromRemoveError(e)}}#s(e){this.#a(e)}#a(e){try{ct.removeNotification(e)}catch{}}clear(){try{this.timerAdapter?.stopAll(e=>this.progressBarManager?.stop(e)),this.timers.clear(),this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications(),ct.clearAllNotifications()}catch(e){lt.handleServiceError(e,"clear"),lt.recoverFromClearError()}}clearByType(e){ct.getNotifications().forEach(t=>{t.type===e&&this.timerAdapter?.stop(t.id,()=>this.progressBarManager?.stop(t.id))}),ct.clearNotificationsByType(e)}startAutoCloseTimer(e,t){try{this.timerAdapter?.start(e,t,e=>this.removeNotification(e))}catch{}}pauseAutoCloseTimer(e){try{this.timerAdapter?.pause(e)}catch{}}resumeAutoCloseTimer(e){try{this.timerAdapter?.resume(e)}catch{}}stopAutoCloseTimer(e){try{this.timerAdapter?.stop(e,()=>this.progressBarManager?.stop(e))}catch{}}handleAction(e,t){try{const i=ct.getNotifications().find(t=>t.id===e),n=i?.options?.actions?.[t];n&&"function"==typeof n.onClick&&n.onClick({id:e,index:t,notification:i})}catch{}}setCustomDurations(e){this.updateSettings({customDurations:{...this.settings.customDurations||{},...e}})}setPersistentTypes(e){this.updateSettings({persistentTypes:[...e]})}setAutoCleanupInterval(e){this.updateSettings({autoCleanupInterval:e})}updatePosition(e){this.updateSettings({position:e})}setMaxVisible(e){this.updateSettings({maxVisible:e});const t=ct.getNotifications();this.renderNotifications(t)}enableSounds(e=!0){this.updateSettings({enableSounds:!!e})}updateSettings(e){try{const t=this._validateSettings(e);if(ct.updateSettings(t),this.settings=ct.getSettings(),this.notificationContainer){const e={};"position"in t&&(e.position=this.settings.position),"maxVisible"in t&&(e.maxVisible=this.settings.maxVisible),Object.keys(e).length&&this.notificationContainer.updateSettings(e)}return this.renderEngine?.updateSettings(this.settings),!0}catch{return!1}}getStats(){try{return{...ct.getStats(),settings:this.settings,activeTimers:this.timerManager?this.timerManager.timers.size:this.timers.size,containerInitialized:!!this.notificationContainer,serviceInitialized:this.initialized,performance:this.renderEngine?.getStats?.()||{renderCount:this._renderCount,averageRenderTime:this._averageRenderTime,lastRenderTime:this._lastRenderTime}}}catch(e){return{total:0,visible:0,byType:{success:0,error:0,warning:0,info:0},persistent:0,error:e?.message}}}exportSettings(){try{const e=ct.exportSettings();return e.serviceMetadata={version:"2.0",exportedBy:"NotificationService"},e}catch(e){return null}}importSettings(e){try{if(!e||"object"!=typeof e||!e.settings)return!1;e.version&&"1.0"!==e.version&&fe.warn(`Versione backup non supportata: ${e.version}`);const t=ct.importSettings(e);return t&&(this.settings=ct.getSettings()),t}catch(t){return!1}}cleanupOldNotifications(e=3e5){try{const t=ct.clearOldNotifications(e),i=new Set(ct.getNotifications().map(e=>e.id));return Array.from(this.timers.keys()).forEach(e=>{i.has(e)||this.timers.delete(e)}),t}catch{return 0}}_validateSettings(e){const t={},i=e=>"number"==typeof e&&!Number.isNaN(e),n=e=>"boolean"==typeof e;if(void 0!==e.maxVisible){if(!Number.isInteger(e.maxVisible)||e.maxVisible<1||e.maxVisible>20)throw new Error("maxVisible must be between 1 and 20");t.maxVisible=e.maxVisible}if(void 0!==e.defaultDuration){if(!i(e.defaultDuration)||e.defaultDuration<0)throw new Error("defaultDuration must be >= 0");t.defaultDuration=e.defaultDuration}if(void 0!==e.position){if(!["top-right","top-left","bottom-right","bottom-left","top-center","bottom-center"].includes(e.position))throw new Error("invalid position");t.position=e.position}if(void 0!==e.enableSounds){if(!n(e.enableSounds))throw new Error("enableSounds must be boolean");t.enableSounds=e.enableSounds}if(void 0!==e.enableAnimations){if(!n(e.enableAnimations))throw new Error("enableAnimations must be boolean");t.enableAnimations=e.enableAnimations}if(void 0!==e.autoCleanupInterval){if(!i(e.autoCleanupInterval)||e.autoCleanupInterval<6e4)throw new Error("autoCleanupInterval must be >= 60000");t.autoCleanupInterval=e.autoCleanupInterval}if(void 0!==e.maxStoredNotifications){if(!Number.isInteger(e.maxStoredNotifications)||e.maxStoredNotifications<10)throw new Error("maxStoredNotifications must be >= 10");t.maxStoredNotifications=e.maxStoredNotifications}if(void 0!==e.persistentTypes){if(!Array.isArray(e.persistentTypes))throw new Error("persistentTypes must be array");t.persistentTypes=[...e.persistentTypes]}if(void 0!==e.soundVolume){if(!i(e.soundVolume)||e.soundVolume<0||e.soundVolume>1)throw new Error("soundVolume must be between 0 and 1");t.soundVolume=e.soundVolume}if(void 0!==e.customDurations){const n=["success","error","warning","info"],r=e.customDurations;if(!r||"object"!=typeof r)throw new Error("customDurations must be object");for(const e of Object.keys(r))if(!n.includes(e)||!i(r[e])||r[e]<0)throw new Error("invalid customDurations entry");t.customDurations={...r}}return t}getNotificationsByType(e){try{return ct.getNotificationsByType(e)}catch{return[]}}getVisibleNotifications(){try{return ct.getVisibleNotifications()}catch{return[]}}hasErrors(){try{return ct.hasErrorNotifications()}catch{return!1}}destroy(){try{try{this.timerAdapter?.stopAll()}catch{}try{this.progressBarManager?.cleanup()}catch{}try{this.timers.forEach((e,t)=>Ye(this.timers,t))}catch{}try{this.timers.clear()}catch{}this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications();try{this.visibilityManager?.detach()}catch{}if("function"==typeof this._unsubscribe){try{this._unsubscribe()}catch{}this._unsubscribe=null}if("function"==typeof this._unsubscribeSettings){try{this._unsubscribeSettings()}catch{}this._unsubscribeSettings=null}try{this.timerManager?.destroy()}catch{}try{this.progressBarManager?.destroy()}catch{}this.renderEngine=null}finally{this.notificationContainer=null,this.initialized=!1}}#c(e){try{this.progressBarManager?.stop(e)}catch{}}#l(e){try{this.progressBarManager?.pause(e)}catch{}}#d(e){try{this.progressBarManager?.resume(e)}catch{}}#i(){try{this.timerAdapter?.pauseAll(),this.progressBarManager?.pauseAll()}catch{}}#n(){try{this.timerAdapter?.resumeAll(),this.progressBarManager?.resumeAll()}catch{}}#o(e,t){let i=!1;return(...n)=>{i||(e.apply(this,n),i=!0,setTimeout(()=>i=!1,t))}}}const yt=new ft;const wt=new class{getDefaultAnimationSetting(){try{return"undefined"==typeof window||!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches}catch(e){return!0}}constructor(){this.state={currentView:"home",previousView:null,editPazienteId:null,selectedPazienteId:null,listFilters:{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"},eventiCliniciFilters:{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"},formData:{},isLoading:!1,loadingMessage:"",errors:[],notifications:[],notificationSettings:{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:this.getDefaultAnimationSetting(),autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}},user:null,isAuthenticated:!1},this.subscribers=new Map,this.persistentKeys=["listFilters","editPazienteId","formData","eventiCliniciFilters","notificationSettings"],this.loadPersistedState()}loadPersistedState(){try{this.persistentKeys.forEach(e=>{const t=localStorage.getItem(`app_state_${e}`);t&&(this.state[e]=JSON.parse(t))});const e=this.state.notificationSettings||{};Array.isArray(e.persistentTypes)?e.persistentTypes.includes("error")||e.persistentTypes.unshift("error"):e.persistentTypes=["error"],e.customDurations=e.customDurations||{},(void 0===e.customDurations.error||e.customDurations.error>0)&&(e.customDurations.error=0),this.state.notificationSettings=e}catch(e){fe.warn("Errore durante il caricamento dello stato persistente:",e)}}persistState(){try{this.persistentKeys.forEach(e=>{null!=this.state[e]&&localStorage.setItem(`app_state_${e}`,JSON.stringify(this.state[e]))})}catch(e){fe.warn("Errore durante il salvataggio dello stato persistente:",e)}}getState(e){return e?this.state[e]:{...this.state}}setState(e,t){const i="string"==typeof e?{[e]:t}:e,n={...this.state};void 0===i.notifications||Array.isArray(i.notifications)||(console.warn("‚ö†Ô∏è StateService: notifications must be an array, got:",typeof i.notifications),i.notifications=[]),Object.assign(this.state,i);const r=Object.keys(i);r.some(e=>this.persistentKeys.includes(e))&&this.persistState(),this.notifySubscribers(r,n)}subscribe(e,t){const i=Array.isArray(e)?e:[e],n=Symbol("subscriber");return this.subscribers.set(n,{keys:i,callback:t}),()=>{this.subscribers.delete(n)}}notifySubscribers(e,t){this.subscribers.forEach(({keys:i,callback:n},r)=>{if(i.some(t=>e.includes(t)))try{const o=n(this.state,t,e);o&&"function"==typeof o.then&&o.catch(o=>{console.error(`Errore async in subscriber callback [${n.name||"(anonymous)"}] (subscriberId: ${String(r)}):`,o,"\nchangedKeys:",e,"\nsubscriber keys:",i,"\ncurrent state:",this.state,"\nold state:",t,"\ncallback:",n.toString())})}catch(o){console.error(`Errore in subscriber callback [${n.name||"(anonymous)"}] (subscriberId: ${String(r)}):`,o,"\nchangedKeys:",e,"\nsubscriber keys:",i,"\ncurrent state:",this.state,"\nold state:",t,"\ncallback:",n.toString())}})}clearState(e=["user","isAuthenticated"]){this.stopAutoCleanup();const t={};e.forEach(e=>{void 0!==this.state[e]&&(t[e]=this.state[e])});const i={currentView:"home",previousView:null,editPazienteId:null,selectedPazienteId:null,listFilters:{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"},eventiCliniciFilters:{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"},formData:{},isLoading:!1,loadingMessage:"",errors:[],notifications:[],notificationSettings:{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:this.getDefaultAnimationSetting(),autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}},user:null,isAuthenticated:!1};this.state={...i,...t},this.persistentKeys.forEach(t=>{e.includes(t)||localStorage.removeItem(`app_state_${t}`)})}setEditPatient(e){this.setState("editPazienteId",e)}getEditPatientId(){return this.getState("editPazienteId")}clearEditPatient(){this.setState("editPazienteId",null)}updateFilters(e){this.setState("listFilters",{...this.getState("listFilters"),...e})}getFilters(){return this.getState("listFilters")}resetFilters(){this.setState("listFilters",{reparto:"",diagnosi:"",stato:"",infetto:"",search:"",page:0,sortColumn:"data_ricovero",sortDirection:"desc"})}setFormData(e){this.setState("formData",e)}getFormData(){return this.getState("formData")}clearFormData(){this.setState("formData",{})}setLoading(e,t=""){this.setState({isLoading:e,loadingMessage:t})}startAutoCleanup(){this.cleanupTimer&&clearInterval(this.cleanupTimer);const e=this.getState("notificationSettings");this.cleanupTimer=setInterval(()=>{const t=this.clearOldNotifications(e.autoCleanupInterval);t>0&&fe.debug(`Cleanup automatico: rimosse ${t} notifiche vecchie`)},e.autoCleanupInterval)}stopAutoCleanup(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}_removedNotificationStats(){const e=this.getState("notifications");return{total:e.length,visible:e.filter(e=>e.isVisible&&!e.isRemoving).length,byType:{success:e.filter(e=>"success"===e.type).length,error:e.filter(e=>"error"===e.type).length,warning:e.filter(e=>"warning"===e.type).length,info:e.filter(e=>"info"===e.type).length},persistent:e.filter(e=>e.options.persistent).length,oldest:e.length>0?Math.min(...e.map(e=>new Date(e.timestamp).getTime())):null,newest:e.length>0?Math.max(...e.map(e=>new Date(e.timestamp).getTime())):null}}_removedExportSettings(){return{settings:this.getState("notificationSettings"),timestamp:(new Date).toISOString(),version:"1.0"}}_removedImportSettings(e){try{return!("1.0"!==e.version||!e.settings)&&(this.updateNotificationSettings(e.settings),!0)}catch(t){return fe.error("Errore durante importazione impostazioni notifiche:",t),!1}}setCurrentView(e,t=null){this.setState({currentView:e,previousView:t||this.getState("currentView")})}getCurrentView(){return this.getState("currentView")}setUser(e){this.setState({user:e,isAuthenticated:!!e})}getUser(){return this.getState("user")}isAuthenticated(){return this.getState("isAuthenticated")}updateEventiCliniciFilters(e){this.setState("eventiCliniciFilters",{...this.getState("eventiCliniciFilters"),...e})}getEventiCliniciFilters(){return this.getState("eventiCliniciFilters")}resetEventiCliniciFilters(){this.setState("eventiCliniciFilters",{paziente_search:"",tipo_evento:"",data_da:"",data_a:"",reparto:"",agente_patogeno:"",tipo_intervento:"",sortColumn:"data_evento",sortDirection:"desc"})}destroy(){this.stopAutoCleanup(),this.subscribers.clear(),this.persistentKeys.forEach(e=>{localStorage.removeItem(`app_state_${e}`)})}};function bt(){!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("theme-icon");if(!e||!t)return;vt(localStorage.getItem("theme")||"light"),e.addEventListener("click",()=>{vt("dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?"light":"dark")})}(),function(){const e=document.getElementById("mobile-theme-toggle"),t=document.getElementById("mobile-theme-icon");if(!e||!t)return;function i(){"dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?(t.textContent="light_mode",e.setAttribute("title","Modalit√† chiara")):(t.textContent="dark_mode",e.setAttribute("title","Modalit√† scura"))}e.addEventListener("click",e=>{e.preventDefault();vt("dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?"light":"dark")});new MutationObserver(i).observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),i()}()}function vt(e){document.documentElement.setAttribute("data-bs-theme",e),localStorage.setItem("theme",e);const t=document.getElementById("theme-icon"),i=document.getElementById("theme-toggle");t&&i&&("dark"===e?(t.textContent="light_mode",i.setAttribute("title","Modalit√† chiara")):(t.textContent="dark_mode",i.setAttribute("title","Modalit√† scura")))}function Et(e){const t=sessionStorage.getItem(Ae);e&&t?(console.log("üîÑ Redirect a pagina salvata:",t),sessionStorage.removeItem(Ae),window.location.hash=t):e?(console.log("üîÑ Redirect a home dopo login"),window.location.hash="home"):He()}window.addEventListener("error",e=>{const t={timestamp:(new Date).toISOString(),context:"GLOBAL_ERROR",message:e.error?.message||e.message||"Unknown global error",filename:e.filename||"Unknown file",lineno:e.lineno||"Unknown line",colno:e.colno||"Unknown column",stack:e.error?.stack||"No stack trace",env:"production",url:window.location.href};try{const e=JSON.parse(localStorage.getItem("auth_errors")||"[]");e.push(t),e.length>10&&e.shift(),localStorage.setItem("auth_errors",JSON.stringify(e)),window.lastGlobalError=t}catch(i){console.warn("Failed to persist global error")}}),window.addEventListener("unhandledrejection",e=>{const t={timestamp:(new Date).toISOString(),context:"UNHANDLED_PROMISE",message:e.reason?.message||e.reason||"Unknown promise rejection",stack:e.reason?.stack||"No stack trace",env:"production",url:window.location.href};try{const e=JSON.parse(localStorage.getItem("auth_errors")||"[]");e.push(t),e.length>10&&e.shift(),localStorage.setItem("auth_errors",JSON.stringify(e)),window.lastPromiseError=t}catch(i){console.warn("Failed to persist promise error")}}),window.addEventListener("load",async function(){try{fe.log(`üöÄ Inizializzazione ${me} v${he}`),qe(),bt(),je(),function(){Ce(),window.addEventListener("resize",Ce);const e=document.getElementById("auth-container");e&&new MutationObserver(Ne).observe(e,{childList:!0,subtree:!0});setTimeout(Ne,150),window.addEventListener("auth:session-changed",()=>{Ne()})}(),window.authUIListenersInitialized||(ke(),window.authUIListenersInitialized=!0),yt.init(),window.addEventListener("hashchange",He),await async function(e){be.init(),ve.isLoading=!0;try{if("undefined"!=typeof window&&window.__PW_E2E_AUTH_MOCK){const t={user:{id:"e2e-user-123",email:"e2e@example.com",user_metadata:{name:"E2E User"}},access_token:"e2e-token"};return await Ee(t),ve.isLoading=!1,e&&e(t),fe.log("E2E auth mock attivo: sessione e profilo impostati"),void 0}}catch{}let t=null,i=null;for(let r=1;r<=3;r++)try{const{data:{session:e},error:n}=await ye.auth.getSession();if(!n){t=e;break}if(i=n,fe.warn(`Tentativo ${r}/3 - Errore nel recupero sessione:`,n),r<3){await new Promise(e=>setTimeout(e,1e3*r));continue}}catch(n){if(i=n,fe.warn(`Tentativo ${r}/3 - Errore critico:`,n),r<3){await new Promise(e=>setTimeout(e,1e3*r));continue}}i&&!t&&fe.error("Fallimento definitivo nel recupero sessione dopo",3,"tentativi:",i),fe.log("Sessione iniziale recuperata:",t),await Ee(t),ve.isLoading=!1,e&&e(t),ye.auth.onAuthStateChange(async(t,i)=>{fe.log("Auth event:",t,"Session:",i),"SIGNED_OUT"===t&&"error"===be.getAuthState().state&&be.clearCorruptedState(),i?.access_token!==ve.session?.access_token&&(await Ee(i),e&&e(i))}),fe.log("Sistema di autenticazione inizializzato")}(e=>{Et(e),sessionStorage.getItem(Ae)||setTimeout(()=>He(),50)}),window.addEventListener("auth:session-changed",e=>{const t=e.detail?.session;t?setTimeout(()=>Et(t),100):setTimeout(()=>He(),50)}),fe.log("‚úÖ Applicazione inizializzata con successo")}catch(e){console.error("‚ùå Errore durante l'inizializzazione dell'applicazione:",e),document.body.innerHTML=le('\n      <div class="container mt-5">\n        <div class="alert alert-danger" role="alert">\n          <h4 class="alert-heading">Errore di inizializzazione</h4>\n          <p>Si √® verificato un errore durante l\'avvio dell\'applicazione.</p>\n          \n          <hr>\n          <p class="mb-0">Ricarica la pagina per riprovare.</p>\n        </div>\n      </div>\n    ')}});export{le as a,wt as b,ve as c,Ve as d,je as i,fe as l,yt as n,ce as p,ye as s};
