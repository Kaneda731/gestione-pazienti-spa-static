import{j as e}from"./ui-vendor-CgDpQ-gO.js";import{R as i,u as a,b as t}from"./react-vendor-bU8fvvPN.js";import{u as s,s as n,l as c,a as o,b as r,c as l}from"./index-Co0ngb9X.js";import{p as d}from"./patientService-DSsJrdX8.js";import"./supabase-DpMRTrmd.js";import"./CentralizedStatisticsService-Cnr3KuoH.js";const m=i.memo(({icon:i,title:a,description:t,meta:s,variant:n,onClick:c,showAdminBadge:o=!1})=>e.jsx("div",{className:`home-card card-${n}`,onClick:c,role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),c())},"aria-label":`Vai a ${a}`,children:e.jsxs("div",{className:"home-card-body",children:[e.jsx("div",{className:"home-card-icon",children:e.jsx("span",{className:"material-icons","aria-hidden":"true",children:i})}),e.jsxs("h5",{className:"home-card-title",children:[a,o&&e.jsx("span",{className:"badge-admin","aria-label":"Solo amministratori",children:"Admin"})]}),e.jsx("p",{className:"home-card-text",children:t}),e.jsx("p",{className:"home-card-meta",children:s})]})}));m.displayName="HomeCard";const p=({stats:i,isAdmin:t})=>{const s=a();return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"home-section","aria-labelledby":"quick-actions-section",children:[e.jsxs("h2",{className:"section-title",id:"quick-actions-section",children:[e.jsx("span",{className:"section-icon material-icons","aria-hidden":"true",children:"bolt"}),"Azioni Rapide"]}),e.jsxs("div",{className:"home-cards-grid",children:[e.jsx(m,{icon:"person_add",title:"Inserimento Pazienti",description:"Registra un nuovo paziente nel sistema",meta:`Pazienti recenti: ${i.patientsThisWeek} questa settimana`,variant:"action-primary",onClick:()=>s("/inserimento")}),e.jsx(m,{icon:"medical_services",title:"Evento Clinico",description:"Registra un nuovo evento clinico",meta:`Ultimi 7 giorni: ${i.eventsLastDays} eventi`,variant:"action-secondary",onClick:()=>s("/eventi-clinici")}),e.jsx(m,{icon:"logout",title:"Dimissioni",description:"Processa le dimissioni pazienti",meta:`In sospeso: ${i.pendingDismissals}`,variant:"action-tertiary",onClick:()=>s("/dimissione")})]})]}),e.jsxs("section",{className:"home-section","aria-labelledby":"support-section",children:[e.jsxs("h2",{className:"section-title",id:"support-section",children:[e.jsx("span",{className:"section-icon material-icons","aria-hidden":"true",children:"bar_chart"}),"Consultazione"]}),e.jsxs("div",{className:"home-cards-grid",children:[e.jsx(m,{icon:"list",title:"Elenco Pazienti",description:"Visualizza e ricerca pazienti ricoverati",meta:`Pazienti attuali: ${i.totalActivePatients}`,variant:"support-primary",onClick:()=>s("/list")}),e.jsx(m,{icon:"query_stats",title:"Grafici & Analisi",description:"Visualizza trend e statistiche cliniche",meta:"Analisi dati e trend",variant:"support-secondary",onClick:()=>s("/unified-charts")})]})]}),t&&e.jsxs("section",{className:"home-section","aria-labelledby":"admin-section",children:[e.jsxs("h2",{className:"section-title",id:"admin-section",children:[e.jsx("span",{className:"section-icon material-icons","aria-hidden":"true",children:"settings"}),"Amministrazione"]}),e.jsx("div",{className:"home-cards-grid",children:e.jsx(m,{icon:"medical_information",title:"Gestione Diagnosi",description:"Configura le diagnosi disponibili",meta:"Configurazione sistema",variant:"admin",onClick:()=>s("/diagnosi"),showAdminBadge:!0})})]})]})};function h(e){return`${e.cognome} ${e.nome}`.trim()}function u(e){return e.codice_rad||e.id?.slice(0,6)||"N/A"}function g(e){if(!e)return"Data non disponibile";try{const i=new Date(e+"T00:00:00");if(isNaN(i.getTime()))return e;const a=new Date,t=new Date(a);t.setDate(t.getDate()-1);const s=i.toDateString()===a.toDateString(),n=i.toDateString()===t.toDateString(),c=i.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),o=i.toLocaleDateString("it-IT",{month:"2-digit",day:"2-digit"});return s?`Oggi ${c}`:n?`Ieri ${c}`:o}catch{return e}}function x(){const e=new Date,i=e.getMinutes(),a=e.getHours();return 0===i?"Adesso":1===i?"1 min fa":i<5?`${i} min fa`:i<60?5*Math.floor(i/5)+" min fa":1===a?"1 ora fa":`${a} ore fa`}const j={patientsThisWeek:0,eventsLastDays:0,pendingDismissals:0,totalActivePatients:0};async function v(){return(await d.getPatients({stato:"attivo"},{limit:3,sortColumn:"data_ricovero",sortDirection:"desc",page:0})).patients.map(e=>({id:e.id||"",nome:e.nome||"",cognome:e.cognome||"",codice_rad:e.codice_rad,data_ricovero:e.data_ricovero,data_dimissione:e.data_dimissione}))}async function N(){return(await d.getPatients({stato:"dimesso"},{limit:2,sortColumn:"data_ricovero",sortDirection:"desc",page:0})).patients.map(e=>({id:e.id||"",nome:e.nome||"",cognome:e.cognome||"",codice_rad:e.codice_rad,data_ricovero:e.data_ricovero,data_dimissione:e.data_dimissione}))}function b(){const{user:e}=s(),[i,a]=t.useState([]),[o,r]=t.useState([]),[l,m]=t.useState(j),[p,h]=t.useState("Caricamento..."),[u,g]=t.useState(!0);return t.useEffect(()=>{if(!e)return;(async()=>{try{g(!0);const e=new Date;e.setDate(e.getDate()-7);const i=e.toISOString().split("T")[0],[t,s,o,l,p,u]=await Promise.all([v().catch(e=>(c.warn("Errore caricamento pazienti recenti:",e),[])),N().catch(e=>(c.warn("Errore caricamento dimissioni recenti:",e),[])),d.getPatients({stato:"attivo"},{limit:1,page:0}).catch(e=>(c.warn("Errore caricamento conteggio pazienti:",e),{patients:[],totalCount:0})),n.from("pazienti").select("id",{count:"exact"}).gte("data_ricovero",i).is("data_dimissione",null),n.from("eventi_clinici").select("id",{count:"exact"}).gte("data_evento",i),n.from("pazienti").select("id",{count:"exact"}).not("data_dimissione","is",null).is("codice_dimissione",null)]);a(t),r(s),m({patientsThisWeek:l.error?0:l.data?.length||0,eventsLastDays:p.error?0:p.data?.length||0,pendingDismissals:u.error?0:u.data?.length||0,totalActivePatients:o.totalCount??0}),h(x())}catch(e){c.error("Errore caricamento dati home:",e),h("Errore caricamento"),a([]),r([])}finally{g(!1)}})();const i=setInterval(()=>{h(x())},6e4);return()=>clearInterval(i)},[e]),{recentPatients:i,recentDismissals:o,stats:l,lastUpdate:p,isLoading:u}}const f=()=>{const{user:i,isAuthenticated:t}=s(),[n,d]=o(),m=a();if(!t||!i)return null;const p=i.ruolo??i.role??"utente",h=i.email?.split("@")[0]||"User",u=h.charAt(0).toUpperCase()+h.slice(1),g=u.charAt(0).toUpperCase(),x=e=>({admin:"#6366f1",medico:"#0891b2",infermiere:"#059669",operatore:"#ea580c",lettore:"#8b5cf6"}[e.toLowerCase()]||"#64748b"),j="dark"===n?"light_mode":"dark_mode";return e.jsxs("div",{className:"sidebar-user-section",children:[e.jsx("div",{className:"sidebar-avatar",style:{background:`linear-gradient(135deg, ${x(p)}, ${x(p)}cc)`},children:g}),e.jsxs("div",{className:"sidebar-user-info",children:[e.jsx("span",{className:"sidebar-user-name",children:u}),e.jsx("span",{className:"sidebar-user-role",style:{color:x(p)},children:p})]}),e.jsx("button",{className:"sidebar-icon-btn",onClick:()=>{const e="dark"===n?"light":"dark";d(e),r(e)},title:"dark"===n?"Tema chiaro":"Tema scuro",children:e.jsx("span",{className:"material-icons",children:j})}),e.jsx("button",{className:"sidebar-icon-btn sidebar-icon-btn--danger",onClick:async()=>{try{await l(),m("/login")}catch(e){c.error("Logout failed",e)}},title:"Esci",children:e.jsx("span",{className:"material-icons",children:"logout"})})]})},_=({title:i,icon:t,patients:s,isLoading:n,dateField:c,variant:o="registrati"})=>{const r=a();return e.jsxs("div",n?{className:`compact-patient-card compact-patient-card--${o}`,children:[e.jsxs("h3",{className:"compact-patient-title",children:[e.jsx("span",{className:"material-icons compact-patient-title-icon","aria-hidden":"true",children:t})," ",i]}),e.jsx("div",{className:"compact-patient-list",children:e.jsx("div",{className:"compact-patient-item compact-patient-item--loading",children:"Caricamento..."})})]}:0===s.length?{className:`compact-patient-card compact-patient-card--${o}`,children:[e.jsxs("h3",{className:"compact-patient-title",children:[e.jsx("span",{className:"material-icons compact-patient-title-icon","aria-hidden":"true",children:t})," ",i]}),e.jsx("div",{className:"compact-patient-list",children:e.jsx("div",{className:"compact-patient-item compact-patient-item--empty",children:"Nessun paziente"})})]}:{className:`compact-patient-card compact-patient-card--${o}`,children:[e.jsxs("h3",{className:"compact-patient-title",children:[e.jsx("span",{className:"material-icons compact-patient-title-icon","aria-hidden":"true",children:t})," ",i]}),e.jsx("div",{className:"compact-patient-list",children:s.slice(0,5).map(i=>e.jsxs("div",{className:"compact-patient-item",children:[e.jsx("button",{type:"button",className:"compact-patient-name",onClick:()=>r(`/patient/${i.id}`),"aria-label":`Visualizza dettagli paziente ${h(i)}`,children:h(i)}),e.jsxs("span",{className:"compact-patient-meta",children:["ID: ",u(i)," â€¢ ",g(i[c])]})]},i.id))})]})},y=()=>{const i=a(),{user:n}=s(),{recentPatients:c,recentDismissals:o,stats:r,lastUpdate:l,isLoading:d}=b(),m="admin"===t.useMemo(()=>n?n.ruolo??n.role??null:null,[n]);return e.jsxs("div",{className:"home-split-layout",children:[e.jsx("aside",{className:"home-left-panel",children:e.jsxs("div",{className:"home-left-content",children:[e.jsxs("div",{className:"home-logo-section",children:[e.jsx("img",{src:"/favicon.png",alt:"PATIENTRAK Logo",className:"home-logo-img"}),e.jsx("p",{className:"home-logo-subtitle",children:"Gestione pazienti"})]}),e.jsxs("div",{className:"home-cta-section",children:[e.jsxs("button",{className:"home-cta home-cta--primary",onClick:()=>i("/inserimento"),"aria-label":"Registra nuovo paziente",children:[e.jsx("span",{className:"material-icons",children:"person_add"}),"Nuovo Paziente"]}),e.jsxs("button",{className:"home-cta home-cta--secondary",onClick:()=>i("/eventi-clinici"),"aria-label":"Registra evento clinico",children:[e.jsx("span",{className:"material-icons",children:"add_circle"}),"Evento Clinico"]})]}),e.jsx("div",{className:"home-illustration",children:e.jsx("img",{src:"/assets/healthcare-illustration-DYdVxBMC.webp",alt:"Personale sanitario",loading:"lazy"})}),e.jsx("div",{className:"home-user-section",children:e.jsx(f,{})}),e.jsxs("div",{className:"home-left-footer",children:[e.jsx("span",{className:"material-icons",children:"schedule"}),"Aggiornato: ",l]})]})}),e.jsxs("main",{className:"home-right-panel",children:[e.jsxs("section",{className:"home-recent-section",children:[e.jsx(_,{title:"Ultimi Registrati",icon:"person_add",patients:c,isLoading:d,dateField:"data_ricovero",variant:"registrati"}),e.jsx(_,{title:"Ultimi Dimessi",icon:"exit_to_app",patients:o,isLoading:d,dateField:"data_dimissione",variant:"dimessi"})]}),e.jsx(p,{stats:r,isAdmin:m})]})]})};export{m as HomeCard,p as HomeCardsGrid,y as HomePage,y as default,g as formatDateTime,x as formatLastUpdate,u as formatPatientId,h as formatPatientName,b as useHomeData};
