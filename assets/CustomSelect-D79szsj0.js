import{j as e}from"./ui-vendor-S6RcKJ66.js";import{R as t,b as n}from"./react-vendor-Bp2pLdQf.js";import{y as r}from"./index-D_g3uL3k.js";class s{static calculatePosition(e,t,n=!1){const r=e.getBoundingClientRect(),s=e.closest(".modal"),o=n||!!s;let l;if(o&&s){const e=s.querySelector(".modal-body");l=(e?e.getBoundingClientRect():s.getBoundingClientRect()).bottom}else l=window.innerHeight;const c=Math.min(o?150:200,t.scrollHeight||200),a=l-r.bottom-20,i=o&&s?s.getBoundingClientRect().top:0,u=r.top-i-20;return{direction:a<c&&u>=c?"up":"down",spaceBelow:a,spaceAbove:u,dropdownHeight:c,isInModal:o,elementId:e.id}}static applyPosition(e,t){e.classList.remove("dropdown-up","dropdown-down");e.classList.add("up"===t.direction?"dropdown-up":"dropdown-down")}static calculateAndApply(e,t,n,r=!1){const s=this.calculatePosition(t,n,r);return this.applyPosition(e,s),s}}const o=t.forwardRef(({id:o,placeholder:l="Seleziona...",value:c,options:a,children:i,onChange:u,disabled:d=!1,className:p="",isInvalid:v=!1},f)=>{const h=n.useRef(null),m=n.useRef(null),b=n.useRef(null),g=n.useRef(null),w=n.useRef(-1),x=n.useRef(null),y=n.useRef(null),j=n.useRef(null),[k,C]=n.useState(!1),[E,L]=n.useState(c||""),[A,R]=n.useState(-1),[S,M]=n.useState(!1);n.useEffect(()=>{if(!m.current&&i&&t.isValidElement(i)&&"select"===i.type){const e=document.querySelectorAll("select");e.length>0&&(m.current=e[e.length-1])}},[i]);const N=n.useMemo(()=>{if(a&&a.length>0)return a;if(m.current){const e=[];return m.current.querySelectorAll("option").forEach(t=>{e.push({value:t.value,label:t.textContent||"",icon:t.getAttribute("data-icon")||void 0})}),e}return[]},[a]),B=n.useMemo(()=>{const e=N.find(e=>e.value===E);return e?.label||l},[E,N,l]);n.useEffect(()=>{void 0!==c&&L(c)},[c]),n.useEffect(()=>{R(-1),E&&N.length>0&&N.some(e=>e.value===E)},[N.length,N]),n.useEffect(()=>{if(m.current){m.current.value=E;const e=new Event("change",{bubbles:!0});m.current.dispatchEvent(e)}j.current&&(j.current.value=E)},[E]),n.useEffect(()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&C(!1)};if(k)return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[k]),n.useEffect(()=>{if(k&&h.current&&g.current&&b.current){const e=s.calculateAndApply?.(h.current,g.current,b.current);e&&window.appLogger?.debug&&window.appLogger.debug("Dropdown aperto "+("up"===e.direction?"verso l'alto":"verso il basso"),{spaceBelow:e.spaceBelow,spaceAbove:e.spaceAbove,dropdownHeight:e.dropdownHeight,isInModal:e.isInModal})}},[k]),n.useEffect(()=>{if(k)return x.current=()=>{b.current&&g.current&&s.calculateAndApply(h.current,g.current,b.current)},y.current=r(()=>{b.current&&g.current&&s.calculateAndApply(h.current,g.current,b.current)},100),window.addEventListener("resize",x.current),window.addEventListener("scroll",y.current,{passive:!0}),()=>{x.current&&window.removeEventListener("resize",x.current),y.current&&window.removeEventListener("scroll",y.current)}},[k]);const D=n.useCallback(e=>{switch(e.key){case"Enter":case" ":e.preventDefault(),C(!k);break;case"Escape":e.preventDefault(),C(!1);break;case"ArrowDown":e.preventDefault(),k?R(e=>{const t=e+1>=N.length?0:e+1;return w.current=t,t}):C(!0);break;case"ArrowUp":e.preventDefault(),k&&R(e=>{const t=e-1<0?N.length-1:e-1;return w.current=t,t})}},[k,N.length]);n.useEffect(()=>{if(A>=0&&k){const e=b.current?.querySelector(`.custom-select-option[data-index="${A}"]`);e&&e.scrollIntoView({block:"nearest"})}},[A,k]);const I=n.useCallback(e=>{L(e),C(!1),u?.(e)},[u]),$=n.useCallback(e=>{e.preventDefault(),e.stopPropagation(),L(""),R(-1),u?.("")},[u]),H=n.useCallback(()=>{M(!1)},[]),P=n.useCallback(()=>{M(!0)},[]),q=n.useCallback(e=>{d||S||(e.stopPropagation(),C(!k),R(-1))},[k,d,S]),z=""!==E,T=t=>t.icon?e.jsxs(e.Fragment,{children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:t.icon}})," "+t.label]}):t.label;return e.jsxs("div",{ref:h,id:o,className:`custom-select-wrapper ${k?"open":""} ${v?"is-invalid":""} ${d?"is-disabled":""} ${p}`,role:"combobox","aria-expanded":k,"aria-haspopup":"listbox","aria-disabled":d,onKeyDown:D,tabIndex:d?-1:0,children:[e.jsxs("div",{ref:g,className:"custom-select-trigger",onClick:q,onTouchStart:H,onTouchMove:P,children:[e.jsx("span",{className:"custom-select-label",children:T({label:B})}),e.jsx("button",{type:"button",className:"custom-select-clear-btn",onClick:$,style:{display:z?"flex":"none"},"aria-label":"Cancella selezione",disabled:d,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsx("span",{className:"custom-select-arrow","aria-hidden":"true",children:e.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:e.jsx("path",{d:"M1 1L6 6L11 1",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("div",{ref:b,className:"custom-select-dropdown",role:"listbox",children:e.jsx("div",{className:"custom-select-options",children:N.map((t,n)=>e.jsx("div",{className:`custom-select-option ${n===A?"focused":""} ${t.value===E?"selected":""}`,role:"option","aria-selected":t.value===E,"data-value":t.value,"data-index":n,onClick:()=>!d&&I(t.value),onMouseEnter:()=>k&&R(n),children:T(t)},t.value))})}),i&&e.jsx("div",{style:{display:"none"},children:i}),o&&!i&&e.jsx("select",{ref:j,id:o,style:{display:"none"},onChange:e=>{I(e.target.value)},disabled:d,children:N.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})});o.displayName="CustomSelect";export{o as C,s as D};
