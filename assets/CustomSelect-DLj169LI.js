import{j as e}from"./ui-vendor-CgDpQ-gO.js";import{R as t,b as n}from"./react-vendor-bU8fvvPN.js";import{t as r,q as s}from"./index-Dqbc-UpZ.js";class l{static calculatePosition(e,t,n=!1){const r=e.getBoundingClientRect(),s=e.closest(".modal"),l=n||!!s;let o;if(l&&s){const e=s.querySelector(".modal-body");o=(e?e.getBoundingClientRect():s.getBoundingClientRect()).bottom}else o=window.innerHeight;const c=Math.min(l?150:200,t.scrollHeight||200),a=o-r.bottom-20,i=l&&s?s.getBoundingClientRect().top:0,u=r.top-i-20;return{direction:a<c&&u>=c?"up":"down",spaceBelow:a,spaceAbove:u,dropdownHeight:c,isInModal:l,elementId:e.id}}static applyPosition(e,t){e.classList.remove("dropdown-up","dropdown-down");e.classList.add("up"===t.direction?"dropdown-up":"dropdown-down")}static calculateAndApply(e,t,n,r=!1){const s=this.calculatePosition(t,n,r);return this.applyPosition(e,s),s}}const o=t.forwardRef(({id:o,placeholder:c="Seleziona...",value:a,options:i,children:u,onChange:d,disabled:p=!1,className:v="",isInvalid:h=!1},f)=>{const m=n.useRef(null),w=n.useRef(null),g=n.useRef(null),b=n.useRef(null),x=n.useRef(-1),y=n.useRef(null),k=n.useRef(null),j=n.useRef(null),[C,E]=n.useState(!1),[A,L]=n.useState(a||""),[R,S]=n.useState(-1),[B,M]=n.useState(!1),N=n.useCallback(e=>{L(e),E(!1),d?.(e)},[d]);n.useEffect(()=>{if(!w.current&&u&&t.isValidElement(u)&&"select"===u.type){const e=document.querySelectorAll("select");e.length>0&&(w.current=e[e.length-1])}},[u]);const D=n.useMemo(()=>{if(i&&i.length>0)return i;if(w.current){const e=[];return w.current.querySelectorAll("option").forEach(t=>{e.push({value:t.value,label:t.textContent||"",icon:t.getAttribute("data-icon")||void 0})}),e}return[]},[i]),I=n.useMemo(()=>{const e=D.find(e=>e.value===A);return e?.label||c},[A,D,c]);n.useEffect(()=>{void 0!==a&&L(a)},[a]),n.useEffect(()=>{S(-1),A&&D.length>0&&D.some(e=>e.value===A)},[D.length,D]),n.useEffect(()=>{if(w.current){w.current.value=A;const e=new Event("change",{bubbles:!0});w.current.dispatchEvent(e)}j.current&&(j.current.value=A)},[A]),n.useEffect(()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&E(!1)};if(C)return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[C]),n.useEffect(()=>{if(C&&m.current&&b.current&&g.current){const e=l.calculateAndApply?.(m.current,b.current,g.current);e&&window.appLogger?.debug&&window.appLogger.debug("Dropdown aperto "+("up"===e.direction?"verso l'alto":"verso il basso"),{spaceBelow:e.spaceBelow,spaceAbove:e.spaceAbove,dropdownHeight:e.dropdownHeight,isInModal:e.isInModal})}},[C]),n.useEffect(()=>{if(C)return y.current=()=>{g.current&&b.current&&l.calculateAndApply(m.current,b.current,g.current)},k.current=r(()=>{g.current&&b.current&&l.calculateAndApply(m.current,b.current,g.current)},100),window.addEventListener("resize",y.current),window.addEventListener("scroll",k.current,{passive:!0}),()=>{y.current&&window.removeEventListener("resize",y.current),k.current&&window.removeEventListener("scroll",k.current)}},[C]);const $=n.useCallback(e=>{switch(e.key){case"Enter":case" ":e.preventDefault(),C&&-1!==R?N(D[R].value):E(!C);break;case"Escape":e.preventDefault(),E(!1);break;case"ArrowDown":e.preventDefault(),C?S(e=>{const t=e+1>=D.length?0:e+1;return x.current=t,t}):E(!0);break;case"ArrowUp":e.preventDefault(),C&&S(e=>{const t=e-1<0?D.length-1:e-1;return x.current=t,t})}},[C,D,R,N]);n.useEffect(()=>{if(R>=0&&C){const e=g.current?.querySelector(`.custom-select-option[data-index="${R}"]`);e&&e.scrollIntoView({block:"nearest"})}},[R,C]);const H=n.useCallback(e=>{e.preventDefault(),e.stopPropagation(),L(""),S(-1),d?.("")},[d]),P=n.useCallback(()=>{M(!1)},[]),q=n.useCallback(()=>{M(!0)},[]),z=n.useCallback(e=>{p||B||(e.stopPropagation(),E(!C),S(-1))},[C,p,B]),T=""!==A,V=t=>t.icon?e.jsxs(e.Fragment,{children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:s(t.icon,{allowedTags:["svg","path","circle","rect","line","polyline","polygon","i","span"],allowedAttributes:{svg:["viewBox","width","height","fill","stroke","class"],path:["d","fill","stroke","class"],circle:["cx","cy","r","fill","stroke","class"],rect:["x","y","width","height","fill","stroke","class"],i:["class"],span:["class"]},allowComments:!1})}})," "+t.label]}):t.label;return e.jsxs("div",{ref:m,id:o,className:`custom-select-wrapper ${C?"open":""} ${h?"is-invalid":""} ${p?"is-disabled":""} ${v}`,role:"combobox","aria-expanded":C,"aria-haspopup":"listbox","aria-disabled":p,onKeyDown:$,tabIndex:p?-1:0,children:[e.jsxs("div",{ref:b,className:"custom-select-trigger",onClick:z,onTouchStart:P,onTouchMove:q,children:[e.jsx("span",{className:"custom-select-label",children:V({label:I})}),e.jsx("button",{type:"button",className:"custom-select-clear-btn",onClick:H,style:{display:T?"flex":"none"},"aria-label":"Cancella selezione",disabled:p,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsx("span",{className:"custom-select-arrow","aria-hidden":"true",children:e.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:e.jsx("path",{d:"M1 1L6 6L11 1",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("div",{ref:g,className:"custom-select-dropdown",role:"listbox",children:e.jsx("div",{className:"custom-select-options",children:D.map((t,n)=>e.jsx("div",{className:`custom-select-option ${n===R?"focused":""} ${t.value===A?"selected":""}`,role:"option","aria-selected":t.value===A,"data-value":t.value,"data-index":n,onClick:()=>!p&&N(t.value),onMouseEnter:()=>C&&S(n),children:V(t)},t.value))})}),u&&e.jsx("div",{style:{display:"none"},children:u}),o&&!u&&e.jsx("select",{ref:j,id:o,style:{display:"none"},onChange:e=>{N(e.target.value)},disabled:p,children:D.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})});o.displayName="CustomSelect";export{o as C};
