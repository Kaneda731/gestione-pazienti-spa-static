const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ConfirmModal-C-UYHCsR.js","assets/index-IH2gO55r.js","assets/vendor-CQCqr9ER.js","assets/supabase-86D3GPeZ.js","assets/index-CVhQJPCb.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-86D3GPeZ.js";import{s as t,l as n,n as a}from"./index-IH2gO55r.js";import"./vendor-CQCqr9ER.js";const i={get tableBody(){return document.getElementById("diagnosi-table-body")},get form(){return document.getElementById("diagnosi-form")},get input(){return document.getElementById("diagnosi-name")},get saveButton(){return document.getElementById("save-diagnosi-btn")}};function s(e,t){switch(t){case"success":a.success(e);break;case"error":a.error(e);break;case"warning":a.warning(e);break;default:a.info(e)}}let o=null;async function r(){try{!function(e){if(i.tableBody.innerHTML="",0===e.length){const e=i.tableBody.insertRow(),t=document.createElement("td");return t.colSpan=2,t.className="text-center",t.textContent="Nessuna diagnosi trovata.",e.appendChild(t),void 0}e.forEach(e=>{const t=i.tableBody.insertRow(),n=document.createElement("td");n.setAttribute("data-label","Nome Diagnosi"),n.textContent=e.nome,t.appendChild(n);const a=document.createElement("td");a.setAttribute("data-label","Azioni"),a.className="text-end";const s=document.createElement("button");s.className="btn btn-sm btn-warning edit-btn",s.setAttribute("data-id",e.id),s.setAttribute("data-name",e.nome),s.title="Modifica diagnosi",s.innerHTML='<span class="material-icons">edit</span>',a.appendChild(s);const o=document.createElement("button");o.className="btn btn-sm btn-danger delete-btn",o.setAttribute("data-id",e.id),o.title="Elimina diagnosi",o.innerHTML='<span class="material-icons">delete</span>',a.appendChild(o),t.appendChild(a)})}(await async function(){const{data:e,error:a}=await t.from("diagnosi").select("id, nome").order("nome",{ascending:!0});if(a)throw n.error("Errore caricamento diagnosi:",a),new Error("Impossibile caricare le diagnosi.");return e||[]}())}catch(e){s(e.message,"error")}}async function c(e){e.preventDefault();const a=i.input.value.trim();if(!a)return s("Il nome della diagnosi non pu√≤ essere vuoto.","error"),void 0;try{await async function(e,a){let i;if(i=e?await t.from("diagnosi").update({nome:a}).eq("id",e).select().single():await t.from("diagnosi").insert({nome:a}).select().single(),i.error)throw n.error("Errore salvataggio diagnosi:",i.error),new Error("Impossibile salvare la diagnosi.");return i.data}(o,a);s(`Diagnosi ${o?"aggiornata":"aggiunta"} con successo!`,"success"),i.form.reset(),i.saveButton.innerHTML='<span class="material-icons">add</span> Aggiungi Diagnosi',o=null,await r()}catch(c){s(c.message,"error")}}async function d(a){const{ConfirmModal:i}=await e(async()=>{const{ConfirmModal:e}=await import("./ConfirmModal-C-UYHCsR.js");return{ConfirmModal:e}},__vite__mapDeps([0,1,2,3,4])),o=i.forDiagnosisDeletion();if(await o.show())try{await async function(e){const{error:a}=await t.from("diagnosi").delete().eq("id",e);if(a)throw n.error("Errore eliminazione diagnosi:",a),new Error("Impossibile eliminare la diagnosi.")}(a),s("Diagnosi eliminata con successo!","success"),await r()}catch(c){s(c.message,"error")}}function l(e){const t=e.target.closest("button");if(!t)return;const n=t.dataset.id;t.classList.contains("edit-btn")?(o=n,i.input.value=t.dataset.name,i.saveButton.innerHTML='<span class="material-icons">edit</span> Aggiorna',i.input.focus()):t.classList.contains("delete-btn")&&d(n)}async function m(){return i.form.addEventListener("submit",c),i.tableBody.addEventListener("click",l),await r(),()=>{}}export{m as initDiagnosiView};
