import{j as e}from"./ui-vendor-S6RcKJ66.js";import{b as t}from"./react-vendor-Bp2pLdQf.js";import{e as a}from"./patientService-Do5N6GPU.js";import{D as n}from"./DateRangePicker-BggTlU3m.js";function i(e){if(!e)return"";if("string"==typeof e&&/^\d{4}-\d{2}-\d{2}/.test(e))return e.split("T")[0];const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"";return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}const o=[{value:"batterico",label:"Batterico"},{value:"virale",label:"Virale"},{value:"fungino",label:"Fungino"},{value:"parassitario",label:"Parassitario"}],r=({event:r,patientId:s,onSubmit:l,onCancel:d,isSubmitting:c=!1})=>{const v=!!r,m=!!r?.data_fine_evento,[p,_]=t.useState([]),[g,b]=t.useState(!0),[u,h]=t.useState({tipo_evento:"infezione",agente_patogeno_id:r?.agente_patogeno_id??null,tipo_patogeno:r?.tipo_patogeno||"",data_evento:i(r?.data_evento)||"",data_fine_evento:i(r?.data_fine_evento||void 0)||"",note:r?.note||""}),[f,x]=t.useState(m),[j,N]=t.useState({}),z=(new Date).toISOString().split("T")[0];t.useEffect(()=>{(async()=>{try{b(!0);const e=await a.getListaAgentiPatogeno();_(Array.isArray(e)?e:[])}catch(e){console.error("Errore caricamento agenti patogeno:",e)}finally{b(!1)}})()},[]),t.useEffect(()=>{r&&(h({tipo_evento:"infezione",agente_patogeno_id:r.agente_patogeno_id??null,tipo_patogeno:r.tipo_patogeno||"",data_evento:i(r.data_evento),data_fine_evento:i(r.data_fine_evento||void 0)||"",note:r.note||""}),x(!!r.data_fine_evento))},[r]);const S=e=>{const{name:t,value:a}=e.target;h(e=>({...e,[t]:a})),j[t]&&N(e=>{const a={...e};return delete a[t],a})};return e.jsxs("form",{role:"form",onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return u.agente_patogeno_id||(e.tipo_batterio="Il tipo di batterio è obbligatorio"),u.data_evento||(e.data_evento="La data di inizio infezione è obbligatoria"),f&&u.data_fine_evento&&(u.data_fine_evento<u.data_evento&&(e.data_fine_evento="La data di fine non può essere precedente alla data di inizio"),u.data_fine_evento>z&&(e.data_fine_evento="La data di fine non può essere futura")),N(e),0===Object.keys(e).length})())try{const e={paziente_id:s,tipo_evento:"infezione",data_evento:u.data_evento,agente_patogeno_id:u.agente_patogeno_id??void 0,tipo_patogeno:u.tipo_patogeno,data_fine_evento:f?u.data_fine_evento:void 0,note:u.note};await l(e)}catch(t){console.error("Errore durante il salvataggio dell'infezione:",t)}},className:"infection-form",noValidate:!0,children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("h4",{className:"mb-3",children:v?"Modifica Infezione":"Nuova Infezione"})}),e.jsx("div",{className:"col-md-6 text-end",children:e.jsx("span",{className:`badge ${m?"bg-success":"bg-warning"} fs-6`,children:m?"Infezione Risolta":"Infezione Attiva"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"agente_patogeno_id",className:"form-label",children:["Agente Eziologico ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"agente_patogeno_id",name:"agente_patogeno_id",className:"form-select "+(j.tipo_batterio?"is-invalid":""),value:u.agente_patogeno_id?String(u.agente_patogeno_id):"",onChange:e=>{const t=e.target.value?parseInt(e.target.value,10):null;h(e=>({...e,agente_patogeno_id:t})),j.tipo_batterio&&N(e=>{const t={...e};return delete t.tipo_batterio,t})},disabled:c||g,required:!0,"aria-required":"true","aria-invalid":!!j.tipo_batterio,"aria-describedby":j.tipo_batterio?"agente_patogeno-error":"agente_patogeno-help",children:[e.jsx("option",{value:"",children:g?"Caricamento agenti patogeno...":"Seleziona agente eziologico..."}),p.map(t=>e.jsx("option",{value:String(t.id),children:t.nome},t.id))]}),j.tipo_batterio&&e.jsx("div",{id:"agente_patogeno-error",className:"invalid-feedback",role:"alert",children:j.tipo_batterio}),e.jsx("div",{id:"agente_patogeno-help",className:"form-text",children:"Selezionare l'agente responsabile dell'infezione"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"tipo_patogeno",className:"form-label",children:"Tipo Patogeno"}),e.jsxs("select",{id:"tipo_patogeno",name:"tipo_patogeno",className:"form-select",value:u.tipo_patogeno,onChange:S,disabled:c,"aria-describedby":"tipo_patogeno-help",children:[e.jsx("option",{value:"",children:"Seleziona tipo patogeno..."}),o.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsx("div",{id:"tipo_patogeno-help",className:"form-text",children:"Opzionale - Specificare la categoria del patogeno"})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(n,{label:"Data Inizio",value:u.data_evento,onChange:e=>{h(t=>({...t,data_evento:e||""})),j.data_evento&&N(e=>{const t={...e};return delete t.data_evento,t})},isRequired:!0,placeholder:"gg/mm/aaaa",allowInput:!0,clearable:!0,isDisabled:c,isInvalid:!!j.data_evento,errorMessage:j.data_evento})}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2 gap-2",children:[e.jsx("label",{htmlFor:"toggle_resolution",className:"form-label mb-0",children:"Data Fine"}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"toggle_resolution",checked:f,onChange:()=>{x(!f),f&&h(e=>({...e,data_fine_evento:""}))},disabled:c}),e.jsx("label",{className:"form-check-label",htmlFor:"toggle_resolution",children:"Infezione risolta"})]})]}),f&&e.jsx(n,{value:u.data_fine_evento,onChange:e=>{h(t=>({...t,data_fine_evento:e||""})),j.data_fine_evento&&N(e=>{const t={...e};return delete t.data_fine_evento,t})},placeholder:"gg/mm/aaaa",allowInput:!0,clearable:!0,isDisabled:c,isInvalid:!!j.data_fine_evento,errorMessage:j.data_fine_evento})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"note",className:"form-label",children:"Note Cliniche"}),e.jsx("textarea",{id:"note",name:"note",className:"form-control",value:u.note,onChange:S,disabled:c,rows:3,placeholder:"Sintomi, terapia, esami, decorso...","aria-describedby":"note-help"}),e.jsx("div",{id:"note-help",className:"form-text",children:"Opzionale - Informazioni cliniche rilevanti"})]}),e.jsxs("div",{className:"alert alert-info mb-3",children:[e.jsx("h6",{className:"alert-heading",children:"Informazioni"}),e.jsxs("p",{className:"mb-2",children:["Compilare tutti i campi obbligatori contrassegnati con ",e.jsx("span",{className:"text-danger",children:"*"}),". Le date non possono essere future."]}),e.jsx("p",{className:"mb-0",children:"Se l'infezione è risolta, specificare la data di fine. I campi data sono correlati: la data di fine deve essere successiva alla data di inizio."})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:d,disabled:c,children:"Annulla"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Salvataggio..."]}):v?"Aggiorna Infezione":"Salva Infezione"})]})]})},s=({event:o,patientId:r,onSubmit:s,onCancel:l,isSubmitting:d=!1})=>{const c=!!o,[v,m]=t.useState([]),[p,_]=t.useState(!0),[g,b]=t.useState({tipo_evento:"intervento",tipo_intervento_id:o?.tipo_intervento_id??null,descrizione_intervento:o?.descrizione_intervento||"",data_evento:i(o?.data_evento)||"",note:o?.note||""}),[u,h]=t.useState({});(new Date).toISOString().split("T")[0],t.useEffect(()=>{(async()=>{try{_(!0);const e=await a.getListaTipiIntervento();m(Array.isArray(e)?e:[])}catch(e){console.error("Errore caricamento tipi intervento:",e)}finally{_(!1)}})()},[]),t.useEffect(()=>{o&&b({tipo_evento:"intervento",tipo_intervento_id:o.tipo_intervento_id??null,descrizione_intervento:o.descrizione_intervento||"",data_evento:i(o.data_evento),note:o.note||""})},[o]);const f=e=>{const{name:t,value:a}=e.target;b(e=>({...e,[t]:a})),u[t]&&h(e=>{const a={...e};return delete a[t],a})};return e.jsxs("form",{role:"form",onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return g.tipo_intervento_id||(e.tipo_intervento="Il tipo di intervento è obbligatorio"),g.data_evento||(e.data_evento="La data dell'intervento è obbligatoria"),h(e),0===Object.keys(e).length})())try{const e={paziente_id:r,tipo_evento:"intervento",data_evento:g.data_evento,tipo_intervento_id:g.tipo_intervento_id??void 0,descrizione_intervento:g.descrizione_intervento,note:g.note};await s(e)}catch(t){console.error("Errore durante il salvataggio dell'intervento:",t)}},className:"intervention-form",noValidate:!0,children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("h4",{className:"mb-3",children:c?"Modifica Intervento":"Nuovo Intervento"})}),e.jsx("div",{className:"col-md-6 text-end",children:e.jsx("span",{className:"badge bg-primary fs-6",children:"Intervento Chirurgico"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"tipo_intervento_id",className:"form-label",children:["Tipo Intervento ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"tipo_intervento_id",name:"tipo_intervento_id",className:"form-select "+(u.tipo_intervento?"is-invalid":""),value:g.tipo_intervento_id?String(g.tipo_intervento_id):"",onChange:e=>{const t=e.target.value?parseInt(e.target.value,10):null;b(e=>({...e,tipo_intervento_id:t})),u.tipo_intervento&&h(e=>{const t={...e};return delete t.tipo_intervento,t})},disabled:d||p,required:!0,"aria-required":"true","aria-invalid":!!u.tipo_intervento,"aria-describedby":u.tipo_intervento?"tipo_intervento-error":void 0,children:[e.jsx("option",{value:"",children:p?"Caricamento tipi intervento...":"Seleziona tipo intervento..."}),v.map(t=>e.jsx("option",{value:String(t.id),children:t.nome},t.id))]}),u.tipo_intervento&&e.jsx("div",{id:"tipo_intervento-error",className:"invalid-feedback",role:"alert",children:u.tipo_intervento})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"descrizione_intervento",className:"form-label",children:"Descrizione Dettagliata"}),e.jsx("textarea",{id:"descrizione_intervento",name:"descrizione_intervento",className:"form-control "+(u.descrizione_intervento?"is-invalid":""),value:g.descrizione_intervento,onChange:f,disabled:d,rows:4,placeholder:"Descrivere dettagliatamente l'intervento eseguito...","aria-invalid":!!u.descrizione_intervento,"aria-describedby":u.descrizione_intervento?"descrizione_intervento-error":"descrizione_intervento-help"}),u.descrizione_intervento&&e.jsx("div",{id:"descrizione_intervento-error",className:"invalid-feedback",role:"alert",children:u.descrizione_intervento}),e.jsx("div",{id:"descrizione_intervento-help",className:"form-text",children:"Opzionale - Fornire una descrizione dettagliata della procedura"})]}),e.jsx("div",{className:"mb-3",children:e.jsx(n,{label:"Data Intervento",value:g.data_evento,onChange:e=>{b(t=>({...t,data_evento:e||""})),u.data_evento&&h(e=>{const t={...e};return delete t.data_evento,t})},isRequired:!0,placeholder:"gg/mm/aaaa",allowInput:!0,clearable:!0,isDisabled:d,isInvalid:!!u.data_evento,errorMessage:u.data_evento})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"note",className:"form-label",children:"Note Aggiuntive"}),e.jsx("textarea",{id:"note",name:"note",className:"form-control",value:g.note,onChange:f,disabled:d,rows:2,placeholder:"Note aggiuntive sull'intervento...","aria-describedby":"note-help"}),e.jsx("div",{id:"note-help",className:"form-text",children:"Opzionale - Informazioni aggiuntive sull'intervento"})]}),e.jsxs("div",{className:"alert alert-info mb-3",children:[e.jsx("h6",{className:"alert-heading",children:"Informazioni"}),e.jsxs("p",{className:"mb-0",children:["Compilare tutti i campi obbligatori contrassegnati con ",e.jsx("span",{className:"text-danger",children:"*"}),". La data dell'intervento non può essere futura."]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:l,disabled:d,children:"Annulla"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Salvataggio..."]}):c?"Aggiorna Intervento":"Salva Intervento"})]})]})};export{r as I,s as a};
