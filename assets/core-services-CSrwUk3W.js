const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shared-DM1owLfs.js","assets/ui-vendor-CKm97sqn.js","assets/react-vendor-DMMrM9kC.js","assets/shared-DOcGBqNV.css"])))=>i.map(i=>d[i]);
import{D as e,C as t,M as i}from"./ui-vendor-CKm97sqn.js";import{c as r}from"./supabase-D6dgNb7x.js";import{N as n}from"./shared-DM1owLfs.js";const o={},s=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),n=i?.nonce||i?.getAttribute("nonce");r=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in o)return;o[e]=!0;const t=e.endsWith(".css");if(document.querySelector(`link[href="${e}"]${t?'[rel="stylesheet"]':""}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,n&&i.setAttribute("nonce",n),document.head.appendChild(i),t?new Promise((t,r)=>{i.addEventListener("load",t),i.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function c(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var i=function e(){var i=!1;try{i=this instanceof e}catch{}return i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),i}var l,u,d={exports:{}},h={};function m(){if(l)return h;l=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),s=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),m=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,g={};function y(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}function b(){}function v(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var w=v.prototype=new b;w.constructor=v,p(w,y.prototype),w.isPureReactComponent=!0;var S=Array.isArray,E=Object.prototype.hasOwnProperty,_={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function T(t,i,r){var n,o={},s=null,a=null;if(null!=i)for(n in void 0!==i.ref&&(a=i.ref),void 0!==i.key&&(s=""+i.key),i)E.call(i,n)&&!M.hasOwnProperty(n)&&(o[n]=i[n]);var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}if(t&&t.defaultProps)for(n in c=t.defaultProps)void 0===o[n]&&(o[n]=c[n]);return{$$typeof:e,type:t,key:s,ref:a,props:o,_owner:_.current}}function C(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var A=/\/+/g;function N(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(i,r,n,o,s){var a=typeof i;"undefined"!==a&&"boolean"!==a||(i=null);var c=!1;if(null===i)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(i.$$typeof){case e:case t:c=!0}}if(c)return s=s(c=i),i=""===o?"."+N(c,0):o,S(s)?(n="",null!=i&&(n=i.replace(A,"$&/")+"/"),I(s,r,n,"",function(e){return e})):null!=s&&(C(s)&&(s=function(t,i){return{$$typeof:e,type:t.type,key:i,ref:t.ref,props:t.props,_owner:t._owner}}(s,n+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(A,"$&/")+"/")+i)),r.push(s)),1;if(c=0,o=""===o?".":o+":",S(i))for(var l=0;l<i.length;l++){var u=o+N(a=i[l],l);c+=I(a,r,n,u,s)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=m&&e[m]||e["@@iterator"])?e:null}(i),"function"==typeof u)for(i=u.call(i),l=0;!(a=i.next()).done;)c+=I(a=a.value,r,n,u=o+N(a,l++),s);else if("object"===a)throw r=String(i),Error("Objects are not valid as a React child (found: "+("[object Object]"===r?"object with keys {"+Object.keys(i).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return c}function k(e,t,i){if(null==e)return e;var r=[],n=0;return I(e,r,"","",function(e){return t.call(i,e,n++)}),r}function x(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},D={transition:null},P={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:D,ReactCurrentOwner:_};function B(){throw Error("act(...) is not supported in production builds of React.")}return h.Children={map:k,forEach:function(e,t,i){k(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return k(e,function(){t++}),t},toArray:function(e){return k(e,function(e){return e})||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},h.Component=y,h.Fragment=i,h.Profiler=n,h.PureComponent=v,h.StrictMode=r,h.Suspense=c,h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,h.act=B,h.cloneElement=function(t,i,r){if(null==t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=p({},t.props),o=t.key,s=t.ref,a=t._owner;if(null!=i){if(void 0!==i.ref&&(s=i.ref,a=_.current),void 0!==i.key&&(o=""+i.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(l in i)E.call(i,l)&&!M.hasOwnProperty(l)&&(n[l]=void 0===i[l]&&void 0!==c?c[l]:i[l])}var l=arguments.length-2;if(1===l)n.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];n.children=c}return{$$typeof:e,type:t.type,key:o,ref:s,props:n,_owner:a}},h.createContext=function(e){return(e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},h.createElement=T,h.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},h.createRef=function(){return{current:null}},h.forwardRef=function(e){return{$$typeof:a,render:e}},h.isValidElement=C,h.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:x}},h.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},h.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},h.unstable_act=B,h.useCallback=function(e,t){return R.current.useCallback(e,t)},h.useContext=function(e){return R.current.useContext(e)},h.useDebugValue=function(){},h.useDeferredValue=function(e){return R.current.useDeferredValue(e)},h.useEffect=function(e,t){return R.current.useEffect(e,t)},h.useId=function(){return R.current.useId()},h.useImperativeHandle=function(e,t,i){return R.current.useImperativeHandle(e,t,i)},h.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},h.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},h.useMemo=function(e,t){return R.current.useMemo(e,t)},h.useReducer=function(e,t,i){return R.current.useReducer(e,t,i)},h.useRef=function(e){return R.current.useRef(e)},h.useState=function(e){return R.current.useState(e)},h.useSyncExternalStore=function(e,t,i){return R.current.useSyncExternalStore(e,t,i)},h.useTransition=function(){return R.current.useTransition()},h.version="18.3.1",h}function f(){return u||(u=1,d.exports=m()),d.exports}var p=f();const g=a(p),y=function(e,t){for(var i=0;i<t.length;i++){const r=t[i];if("string"!=typeof r&&!Array.isArray(r))for(const t in r)if("default"!==t&&!(t in e)){const i=Object.getOwnPropertyDescriptor(r,t);i&&Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>r[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}({__proto__:null,default:g},[p]);(new class{components;constructor(){this.components={Modal:i,Collapse:t,Dropdown:e}}getComponents(){return this.components}initializeGlobal(){"undefined"!=typeof window&&(window.bootstrap=this.components)}}).initializeGlobal();const b=e=>{let t;const i=new Set,r=(e,r)=>{const n="function"==typeof e?e(t):e;if(!Object.is(n,t)){const e=t;t=(null!=r?r:"object"!=typeof n||null===n)?n:Object.assign({},t,n),i.forEach(i=>i(t,e))}},n=()=>t,o={setState:r,getState:n,getInitialState:()=>s,subscribe:e=>(i.add(e),()=>i.delete(e))},s=t=e(r,n,o);return o},v=e=>e;function w(e,t){let i;try{i=e()}catch(r){return}return{getItem:e=>{var t;const r=e=>null===e?null:JSON.parse(e,void 0),n=null!=(t=i.getItem(e))?t:null;return n instanceof Promise?n.then(r):r(n)},setItem:(e,t)=>i.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>i.removeItem(e)}}const S=e=>t=>{try{const i=e(t);return i instanceof Promise?i:{then:e=>S(e)(i),catch(e){return this}}}catch(i){return{then(e){return this},catch:e=>S(e)(i)}}},E={user:null,session:null,currentPatient:null,currentDepartment:null,filters:{search:"",stato:void 0,reparto:void 0,diagnosi:void 0,infetto:void 0,trasferimento:void 0,page:0,sortColumn:"data_ricovero",sortDirection:"desc"},ui:{loading:!1,theme:"light",sidebarOpen:!1}},_=(e=>{const t=(e=>e?b(e):b)(e),i=e=>function(e,t=v){const i=g.useSyncExternalStore(e.subscribe,g.useCallback(()=>t(e.getState()),[e,t]),g.useCallback(()=>t(e.getInitialState()),[e,t]));return g.useDebugValue(i),i}(t,e);return Object.assign(i,t),i})(((e,t)=>(i,r,n)=>{let o={storage:w(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},s=!1;const a=new Set,c=new Set;let l=o.storage;if(!l)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),i(...e)},r,n);const u=()=>{const e=o.partialize({...r()});return l.setItem(o.name,{state:e,version:o.version})},d=n.setState;n.setState=(e,t)=>(d(e,t),u());const h=e((...e)=>(i(...e),u()),r,n);let m;n.getInitialState=()=>h;const f=()=>{var e,t;if(!l)return;s=!1,a.forEach(e=>{var t;return e(null!=(t=r())?t:h)});const n=(null==(t=o.onRehydrateStorage)?void 0:t.call(o,null!=(e=r())?e:h))||void 0;return S(l.getItem.bind(l))(o.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];if(o.migrate){const t=o.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[n,s]=e;if(m=o.merge(s,null!=(t=r())?t:h),i(m,!0),n)return u()}).then(()=>{null==n?void 0:n(m,void 0),m=r(),s=!0,c.forEach(e=>e(m))}).catch(e=>{null==n?void 0:n(void 0,e)})};return n.persist={setOptions:e=>{o={...o,...e},e.storage&&(l=e.storage)},clearStorage:()=>{null==l?void 0:l.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>f(),hasHydrated:()=>s,onHydrate:e=>(a.add(e),()=>{a.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},o.skipHydration||f(),m||h})((e,t)=>({...E,setState:(t,i)=>e({[t]:i}),setLoading:t=>e(e=>({ui:{...e.ui,loading:t}})),setTheme:t=>e(e=>({ui:{...e.ui,theme:t}})),toggleSidebar:()=>e(e=>({ui:{...e.ui,sidebarOpen:!e.ui.sidebarOpen}})),setUser:t=>e({user:t}),setSession:t=>e({session:t}),setFilters:t=>e(e=>({filters:{...e.filters,...t,page:0}})),setPage:t=>e(e=>({filters:{...e.filters,page:t}})),setSort:i=>{const{filters:r}=t(),n=r.sortColumn===i&&"desc"===r.sortDirection?"asc":"desc";e(e=>({filters:{...e.filters,sortColumn:i,sortDirection:n,page:0}}))},resetFilters:()=>e(e=>({...e,filters:E.filters}))}),{name:"app-storage",storage:w(()=>localStorage),partialize:e=>({ui:{...e.ui,loading:!1,sidebarOpen:!1},filters:e.filters})})),M=()=>{const{user:e,session:t,setUser:i,setSession:r}=_();return{user:e,session:t,isAuthenticated:!!t&&!!e,setUser:i,setSession:r}},T=()=>{const{ui:e,setLoading:t,toggleSidebar:i,setTheme:r}=_();return{uiState:e,setLoading:t,toggleSidebar:i,setTheme:r,currentRoute:_(e=>e.ui.currentRoute),setCurrentRoute:e=>{_.setState(t=>({ui:{...t.ui,currentRoute:e}}))}}},C=()=>[_(e=>e.ui.theme),_(e=>e.setTheme)],A=()=>[_(e=>e.ui.sidebarOpen),_(e=>e.toggleSidebar)],N={NODE_ENV:"production",SUPABASE_URL:"https://aiguzywadjzyrwandgba.supabase.co",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpZ3V6eXdhZGp6eXJ3YW5kZ2JhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyMDM1MzQsImV4cCI6MjA2Njc3OTUzNH0.pezVt3-xxkHBYK2V6ryHUtj_givF_TA9xwEzuK2essw",OAUTH_DEBUG:!1,LOG_LEVEL:"warn",APP_NAME:"PatientTrack",APP_VERSION:"1.0.0",MOBILE_BREAKPOINT:767,FEATURES:{ROLE_BASED_ACCESS:!0}},I=N.LOG_LEVEL;const k=new class{level;levels;constructor(){this.levels={error:0,warn:1,info:2,debug:3};const e=I.toLowerCase();this.level=this.levels[e]??1}sanitizeArgs(e){const t=new Set(["password","token","auth","secret","nome","cognome","codice_fiscale","codice_rad","telefono","email","indirizzo","indirizzo_residenza","citta","cap","note","descrizione"]),i=e=>{if(null==e)return e;if("string"==typeof e)return e.length>200?e.slice(0,200)+"‚Ä¶":e;if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(i);if("object"==typeof e){const r={};for(const[n,o]of Object.entries(e))r[n]=t.has(n)?"[REDACTED]":i(o);return r}return e};return e.map(i)}log(...e){}warn(...e){}error(...e){const t=this.sanitizeArgs(e);console.error(...t)}info(...e){}debug(...e){}group(e){}groupEnd(){}table(e){}time(e){}timeEnd(e){}};let x=null;function R(e){x=e}function D(){document.addEventListener("click",e=>{const t=e.target.closest(".btn-back-menu");if(t){e.preventDefault(),t.style.transform="scale(0.95)",t.style.transition="transform 0.1s ease",setTimeout(()=>{t.style.transform="",t.style.transition=""},150);const i=t.getAttribute("data-view")||"/home",r=i.startsWith("/")?i:`/${i}`;"/home"!==r&&"/"!==r||(sessionStorage.removeItem("editPazienteId"),sessionStorage.removeItem("formData"),sessionStorage.removeItem("currentFilters")),setTimeout(()=>{x?x(r):window.location.pathname=r},100)}})}function P(e){const t=e.startsWith("/")?e:`/${e}`;x?x(t):window.location.pathname=t}const B=r("https://aiguzywadjzyrwandgba.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpZ3V6eXdhZGp6eXJ3YW5kZ2JhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyMDM1MzQsImV4cCI6MjA2Njc3OTUzNH0.pezVt3-xxkHBYK2V6ryHUtj_givF_TA9xwEzuK2essw",{auth:{flowType:"pkce",detectSessionInUrl:!0,persistSession:!0,autoRefreshToken:!0,storage:window.localStorage,storageKey:"supabase.auth.token",debug:!1},global:{headers:{"X-Client-Info":"supabase-js-vite"}}});const $=new class{readyPromise;resolveReady;constructor(){this.readyPromise=new Promise(e=>{this.resolveReady=e}),this.init()}async init(){await this.waitForViteReady(),await this.waitForSupabaseReady(),this.notifyReady()}async waitForViteReady(){return new Promise(e=>{"complete"===document.readyState?(k.log("Vite √® pronto"),e()):window.addEventListener("load",()=>{setTimeout(()=>{k.log("Vite √® pronto (dopo load)"),e()},100)},{once:!0})})}async waitForSupabaseReady(){return new Promise(async e=>{try{await B.auth.getSession(),k.log("Supabase √® pronto"),e()}catch(t){k.error("Errore nell'inizializzazione Supabase:",t),this.clearCorruptedState(),setTimeout(async()=>{try{await B.auth.getSession(),k.log("Supabase √® pronto (dopo retry)"),e()}catch(t){k.error("Errore nel retry Supabase:",t),e()}},500)}})}clearCorruptedState(){k.log("Pulisco stato corrotto...");["supabase.auth.token","sb-aiguzywadjzyrwandgba-auth-token"].forEach(e=>{localStorage.removeItem(e),sessionStorage.removeItem(e)}),document.cookie.split(";").forEach(e=>{const t=e.indexOf("="),i=(t>-1?e.substring(0,t):e).trim();(i.includes("supabase")||i.includes("sb-"))&&(document.cookie=`${i}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`)})}onReady(e){return e?(void this.readyPromise.then(e),void 0):this.readyPromise}notifyReady(){k.log("Middleware Vite-Supabase pronto"),this.resolveReady()}};const O=new class{isInitialized=!1;authState="idle";errorState=null;constructor(){void this.init()}async init(){if(!this.isInitialized){await new Promise(e=>{$.onReady(e)});try{const e=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.substring(1));t.has("access_token")||t.has("refresh_token")||e.has("code")||t.has("error")?(k.log("Rilevato redirect OAuth con parametri reali, gestisco la sessione..."),this.authState="authenticating",await this.handleOAuthCallback()):k.log("Nessun parametro OAuth rilevato, inizializzazione normale"),this.isInitialized=!0}catch(e){k.error("Errore nell'inizializzazione OAuth:",e),this.errorState=e,this.authState="error"}}}async handleOAuthCallback(){try{k.log("Gestisco callback OAuth...");if(new URLSearchParams(window.location.search).has("code")){k.log("Rilevato parametro code, eseguo exchangeCodeForSession...");const{error:e,data:t}=await B.auth.exchangeCodeForSession(window.location.href);if(e)throw k.error("Errore in exchangeCodeForSession:",e),this.clearCorruptedState(),e;k.log("exchangeCodeForSession completato:",!!t?.session)}const{data:e,error:t}=await B.auth.getSession();if(t)throw k.error("Errore nel callback OAuth:",t),this.clearCorruptedState(),t;const i=e.session;if(i){k.log("Sessione OAuth recuperata con successo"),this.authState="authenticated",this.cleanupOAuthUrl();const e=sessionStorage.getItem("redirectUrl");if(e){sessionStorage.removeItem("redirectUrl");P((e.startsWith("#")?e.slice(1):e)||"/home")}else sessionStorage.removeItem("editPazienteId"),sessionStorage.removeItem("formData"),sessionStorage.removeItem("currentFilters"),void P("/home")}return i}catch(e){throw k.error("Errore nella gestione del callback OAuth:",e),this.clearCorruptedState(),e}}clearCorruptedState(){k.log("Pulisco stato corrotto OAuth..."),$.clearCorruptedState(),this.cleanupOAuthUrl(),this.authState="idle",this.errorState=null}cleanupOAuthUrl(){if(window.location.hash.includes("access_token")||window.location.search.includes("code")){const e=window.location.hash.split("&")[0],t=window.location.pathname+(e&&"#"!==e?e:"");window.history.replaceState({},document.title,t),k.log("URL pulito da parametri OAuth, nuovo URL:",t)}}async signInWithGoogle(){try{await $.onReady(),"error"===this.authState&&(k.log("Stato di errore rilevato, pulisco..."),this.clearCorruptedState(),await new Promise(e=>setTimeout(e,100))),this.authState="authenticating";const e=window.location.origin+window.location.pathname+window.location.hash;k.log("Iniziando login OAuth con redirect:",e);const{data:t,error:i}=await B.auth.signInWithOAuth({provider:"google",options:{redirectTo:e,queryParams:{}}});if(i)throw k.error("Errore nella chiamata OAuth:",i),this.authState="error",this.errorState=i,i;return k.log("Login OAuth iniziato con successo:",t),{success:!0,data:t}}catch(e){k.error("Errore completo nel login OAuth:",e);const t=e;401===t?.status&&(k.log("Errore 401 rilevato, pulisco stato corrotto..."),this.clearCorruptedState()),this.authState="error",this.errorState=t??e;return{success:!1,error:t?.message||e?.message||"Errore sconosciuto"}}}getAuthState(){return{state:this.authState,error:this.errorState,isInitialized:this.isInitialized}}},L={session:null,profile:null,isLoading:!0};function z(e,t="editor"){const i=e.email?.split("@")[0]??e.user_metadata?.name??"utente";return{id:e.id,username:i,full_name:e.user_metadata?.full_name||e.user_metadata?.name||e.email||"Utente",role:t,email:e.email,fallback:!0}}async function F(e){try{if("undefined"!=typeof window&&window.__PW_E2E_AUTH_MOCK){e?.user?(L.session=e,L.profile=z(e.user,"admin")):(L.session=null,L.profile=null);try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:e}}))}catch{}return window.dispatchEvent(new CustomEvent("auth-profile-loaded")),void 0}}catch{}if(e?.user){const t=await async function(e){if(!e)return null;try{const{data:t,error:i,status:r}=await B.from("profiles").select("username, full_name, role").eq("id",e.id).maybeSingle();if(i&&406!==r)throw i;const n=t??null;return n?{id:e.id,username:n.username??e.email?.split("@")[0]??"utente",full_name:n.full_name??e.email??"Utente",role:n.role??"editor",email:e.email}:null}catch(t){k.error("Errore nel recuperare il profilo utente:",t),k.warn("üîÑ Uso profilo di fallback per utente:",e.email?.substring(0,3)+"***");try{const t=(await B.rpc("get_user_role_safe",{user_uuid:e.id})).data||"editor";return k.info("‚úÖ Ruolo recuperato con funzione sicura:",t),z(e,t)}catch(i){return k.error("‚ùå Errore nel recupero ruolo sicuro, uso fallback minimo:",i),z(e)}}}(e.user);L.session=e,t?L.profile=t:(k.warn("‚ö†Ô∏è Profilo non disponibile, uso fallback per utente:",e.user.email?.substring(0,3)+"***"),L.profile=z(e.user)),L.profile?.fallback?k.info("‚úÖ Utente autenticato con profilo di fallback:",L.profile.username):k.info("‚úÖ Utente autenticato:",L.profile?.username||"sconosciuto")}else L.session=null,L.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:e}}))}catch{}window.dispatchEvent(new CustomEvent("auth-profile-loaded"))}async function V(){return O.signInWithGoogle()}async function j(){try{L.session=null,L.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:null}}))}catch{}window.dispatchEvent(new CustomEvent("auth-profile-loaded"));try{const{error:e}=await B.auth.signOut();if(e&&"Auth session missing!"!==e.message)throw e}catch(e){const t=e;if("Auth session missing!"!==t?.message&&"AuthSessionMissingError"!==t?.name)throw e;k.warn("Sessione gi√† mancante durante logout, continuando...")}return{success:!0,data:void 0}}catch(t){k.error("Errore durante il signOut:",t),L.session=null,L.profile=null;try{window.dispatchEvent(new CustomEvent("auth:session-changed",{detail:{session:null}}))}catch{}window.dispatchEvent(new CustomEvent("auth-profile-loaded"));return{success:!1,error:(t instanceof Error?t.message:String(t))??"Logout fallito"}}}async function U(e,t){try{const i=t||function(e=32){const t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}(32),{data:r,error:n}=await B.auth.signInWithIdToken({provider:"google",token:e,nonce:i});if(n)throw n;return k.log("Login BYO Google (GIS) via ID token completato"),{success:!0,data:r}}catch(i){k.error("Errore login via ID token:",i);return{success:!1,error:(i instanceof Error?i.message:String(i))??"Errore ID token"}}}async function q(e){O.init(),L.isLoading=!0;try{if("undefined"!=typeof window&&window.__PW_E2E_AUTH_MOCK){const t={access_token:"e2e-token",token_type:"bearer",refresh_token:"e2e-refresh",expires_in:3600,expires_at:Math.floor(Date.now()/1e3)+3600,provider_token:null,provider_refresh_token:null,user:{id:"e2e-user-123",email:"e2e@example.com",app_metadata:{},user_metadata:{name:"E2E User"},aud:"authenticated",created_at:(new Date).toISOString(),confirmed_at:(new Date).toISOString(),email_confirmed_at:(new Date).toISOString(),last_sign_in_at:(new Date).toISOString(),role:"authenticated",is_anonymous:!1,phone:"",phone_confirmed_at:null,recovery_sent_at:null,email_change_sent_at:null,new_email:"",new_phone:"",factors:[],identities:[],raw_app_meta_data:{},raw_user_meta_data:{}}};return await F(t),L.isLoading=!1,e?.(t),k.log("E2E auth mock attivo: sessione e profilo impostati"),void 0}}catch{}let t=null,i=null;for(let n=1;n<=3;n+=1)try{const{data:{session:e},error:r}=await B.auth.getSession();if(!r){t=e;break}if(i=r,k.warn(`Tentativo ${n}/3 - Errore nel recupero sessione:`,r),n<3){await new Promise(e=>setTimeout(e,1e3*n));continue}}catch(r){if(i=r,k.warn(`Tentativo ${n}/3 - Errore critico:`,r),n<3){await new Promise(e=>setTimeout(e,1e3*n));continue}}i&&!t&&k.error("Fallimento definitivo nel recupero sessione dopo",3,"tentativi:",i),k.log("Sessione iniziale recuperata:",t),await F(t),L.isLoading=!1,e?.(t??null),B.auth.onAuthStateChange(async(t,i)=>{k.log("Auth event:",t,"Session:",i),"SIGNED_OUT"===t&&"error"===O.getAuthState().state&&O.clearCorruptedState(),i?.access_token!==L.session?.access_token&&(await F(i),e?.(i))}),k.log("Sistema di autenticazione inizializzato")}function G(){!function(){H(localStorage.getItem("theme")||"light");const e=document.getElementById("theme-toggle"),t=document.getElementById("theme-icon");if(!e||!t)return;e.addEventListener("click",()=>{H("dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?"light":"dark")})}(),function(){const e=document.getElementById("mobile-theme-toggle"),t=document.getElementById("mobile-theme-icon");if(!e||!t)return;function i(){if(!t||!e)return;"dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?(t.textContent="light_mode",e.setAttribute("title","Modalit√† chiara")):(t.textContent="dark_mode",e.setAttribute("title","Modalit√† scura"))}e.addEventListener("click",e=>{e.preventDefault();H("dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?"light":"dark")});new MutationObserver(i).observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),i()}()}function H(e){document.documentElement.setAttribute("data-bs-theme",e),localStorage.setItem("theme",e);const t=document.getElementById("theme-icon"),i=document.getElementById("theme-toggle");t&&i&&("dark"===e?(t.textContent="light_mode",i.setAttribute("title","Modalit√† chiara")):(t.textContent="dark_mode",i.setAttribute("title","Modalit√† scura")));const r=new CustomEvent("theme-change",{detail:{theme:e}});document.dispatchEvent(r),window.dispatchEvent(r)}function J(){return document.documentElement.getAttribute("data-bs-theme")||"light"}let W=null;async function Q({clientId:e}){var t;await(t="https://accounts.google.com/gsi/client",W||(W=new Promise((e,i)=>{if("undefined"!=typeof window){const t=window.google;if(t?.accounts?.id)return e(),void 0}if("undefined"==typeof document)return i(new Error("Google Identity Services requires a browser environment")),void 0;const r=document.createElement("script");r.src=t,r.async=!0,r.defer=!0,r.onload=()=>e(),r.onerror=()=>i(new Error("Failed to load Google Identity Services script")),document.head.appendChild(r)}),W));const i=function(e=32){const t=new Uint8Array(e);return window.crypto.getRandomValues(t),btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}(32),r=window.google;return new Promise((t,n)=>{const o=setTimeout(()=>n(new Error("GIS prompt not available")),4e3),s=setTimeout(()=>n(new Error("Google One Tap timed out")),2e4);try{if(!r?.accounts?.id)throw new Error("Google Identity Services not available on window.google");r.accounts.id.initialize({client_id:e,ux_mode:"popup",itp_support:!0,use_fedcm_for_prompt:!1,callback:e=>{try{e&&e.credential?(clearTimeout(o),clearTimeout(s),t({idToken:e.credential,nonce:i})):e&&e.error&&(clearTimeout(o),clearTimeout(s),n(new Error(e.error)))}catch(r){clearTimeout(o),clearTimeout(s),n(r)}},nonce:i}),r.accounts.id.prompt(e=>{try{if(e?.isNotDisplayed?.()){const t=e.getNotDisplayedReason?.();clearTimeout(o),n(new Error(`GIS not displayed: ${t||"unknown"}`))}else if(e?.isSkippedMoment?.()){const t=e.getSkippedReason?.();clearTimeout(o),n(new Error(`GIS skipped: ${t||"unknown"}`))}else if(e?.isDismissedMoment?.()){const t=e.getDismissedReason?.();clearTimeout(o),n(new Error(`GIS dismissed: ${t||"unknown"}`))}}catch(t){}})}catch(a){clearTimeout(o),clearTimeout(s),n(a)}})}function X(){void window.addEventListener("error",e=>{if(["A listener indicated an asynchronous response by returning true","Extension context invalidated","Could not establish connection","chrome-extension://","moz-extension://"].some(t=>e.message&&e.message.includes(t)))return k.debug("Browser extension error ignored:",e.message),e.preventDefault(),!1;k.error("Application error:",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{const t=e.reason?.message||e.reason?.toString()||"";if(["A listener indicated an asynchronous response by returning true","message channel closed before a response was received","Extension context invalidated","Could not establish connection"].some(e=>t.includes(e)))return k.debug("Browser extension promise rejection ignored:",t),e.preventDefault(),void 0;k.error("Unhandled promise rejection:",e.reason)}),window.appLogger={info:(e,t=null)=>{k.log(`[APP] ${e}`,t||"")},warn:(e,t=null)=>{k.warn(`[APP WARNING] ${e}`,t||"")},error:(e,t=null)=>{k.error("[APP ERROR]",e,t||"")},debug:(e,t=null)=>{"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||k.log(`[APP DEBUG] ${e}`,t||"")},log:(e,t=null)=>{k.log(`[APP LOG] ${e}`,t||"")}}}let Z=null,Y=null;async function K(){return Z||(Y||(Y=(async()=>{try{const{notificationService:e}=await s(async()=>{const{notificationService:e}=await Promise.resolve().then(()=>$e);return{notificationService:e}},void 0);return Z=e,Z&&"function"==typeof Z.init&&await Z.init(),Z}catch(e){if(console.error("Failed to initialize NotificationService:",e),Z)return Z;throw e}})(),Y))}const ee=async(e,t)=>(await K()).success(e,t),te=async(e,t)=>(await K()).info(e,t),ie=async(e,t)=>(await K()).warning(e,t),re=async(e,t)=>(await K()).error(e,t);const ne=new class{notifications=[];settings;subscribers=new Map;cleanupTimer=null;constructor(){this.settings=this.getDefaultSettings(),this.loadPersistedSettings(),this.startAutoCleanup(),k.debug("NotificationStateManager initialized")}getDefaultSettings(){return{maxVisible:5,defaultDuration:5e3,position:"top-right",enableSounds:!1,enableAnimations:!0,autoCleanupInterval:3e5,maxStoredNotifications:50,persistentTypes:["error"],soundVolume:.5,customDurations:{success:4e3,info:5e3,warning:6e3,error:0}}}loadPersistedSettings(){try{const e=localStorage.getItem("notificationSettings");if(e){const t=JSON.parse(e);this.settings={...this.settings,...t}}}catch(e){k.warn("Failed to load persisted notification settings:",e)}}persistSettings(){try{localStorage.setItem("notificationSettings",JSON.stringify(this.settings))}catch(e){k.warn("Failed to persist notification settings:",e)}}subscribe(e){const t=Symbol("notificationSubscriber");return this.subscribers.set(t,e),()=>{this.subscribers.delete(t)}}notifySubscribers(){this.subscribers.forEach((e,t)=>{try{e(this.notifications,this.settings)}catch(i){k.error(`Error in notification subscriber ${String(t)}:`,i)}})}addNotification(e,t,i={}){"number"==typeof i&&(i={duration:i});const r=this.normalizeNotificationType(e),n=void 0!==this.settings.customDurations[r]?this.settings.customDurations[r]:this.settings.defaultDuration,o={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:r,message:t,timestamp:new Date,isVisible:!0,isRemoving:!1,options:{duration:n,persistent:this.settings.persistentTypes.includes(r),...i}};return o.options.persistent&&(o.options.duration=0),k.debug(`[NotificationStateManager] Current notifications before adding: ${this.notifications.length}`,this.notifications),this.handleDeduplication(r,t)?"":(this.notifications=[...this.notifications,o],this.enforceMaxNotifications(),this.notifySubscribers(),k.debug(`[NotificationStateManager] Notification added. New notifications array length: ${this.notifications.length}`,this.notifications),o.id)}handleDeduplication(e,t){try{const i=Date.now(),r=1500;if("success"===e||"info"===e){const n=[...this.notifications].reverse().findIndex(n=>{const o=new Date(n.timestamp).getTime();return n.type===e&&n.message===t&&i-o<=r});if(-1!==n){const e=this.notifications.length-1-n,t=this.notifications[e],i={...t,timestamp:new Date,options:{...t.options,duplicateCount:(t.options.duplicateCount||1)+1}};return this.notifications=[...this.notifications],this.notifications[e]=i,this.notifySubscribers(),!0}}}catch(i){k.warn("Deduplication failed:",i)}return!1}enforceMaxNotifications(){if(this.notifications.length>this.settings.maxStoredNotifications){k.warn(`[NotificationStateManager] Max stored notifications (${this.settings.maxStoredNotifications}) exceeded. Trimming old notifications.`);const e=[...this.notifications].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()).slice(0,this.notifications.length-this.settings.maxStoredNotifications);this.notifications=this.notifications.filter(t=>!e.includes(t)||t.options.persistent&&"error"===t.type),k.debug(`[NotificationStateManager] Notifications after trimming: ${this.notifications.length}`,this.notifications)}}normalizeNotificationType(e){const t=String(e||"").toLowerCase().trim();return t?["error","errore","err","danger","fatal"].includes(t)?"error":["success","ok","successo"].includes(t)?"success":["warning","warn","avviso","alert"].includes(t)?"warning":(["info","informazione","notice"].includes(t),"info"):"info"}removeNotification(e){const t=this.notifications.length;this.notifications=this.notifications.filter(t=>t.id!==e),this.notifications.length!==t&&(k.debug(`[NotificationStateManager] Notification ${e} removed`),this.notifySubscribers())}clearAllNotifications(){this.notifications.length>0&&(this.notifications=[],this.notifySubscribers(),k.debug("[NotificationStateManager] All notifications cleared"))}clearNotificationsByType(e){const t=this.notifications.length;this.notifications=this.notifications.filter(t=>t.type!==e),this.notifications.length!==t&&(k.debug(`[NotificationStateManager] Notifications of type '${e}' cleared`),this.notifySubscribers())}updateSettings(e){const t={...this.settings,...e};this.settings=t,this.persistSettings(),void 0!==e.autoCleanupInterval&&this.startAutoCleanup(),this.notifySubscribers(),k.debug("[NotificationStateManager] Settings updated:",t)}getSettings(){return{...this.settings}}getNotifications(){return[...this.notifications]}getNotificationsByType(e){return this.notifications.filter(t=>t.type===e)}getVisibleNotifications(){return this.notifications.filter(e=>e.isVisible&&!e.isRemoving).slice(-this.settings.maxVisible)}hasErrorNotifications(){return this.notifications.some(e=>"error"===e.type)}getStats(){const e={success:0,error:0,warning:0,info:0};let t=0;return this.notifications.forEach(i=>{e[i.type]=(e[i.type]||0)+1,i.options.persistent&&t++}),{total:this.notifications.length,visible:this.getVisibleNotifications().length,byType:e,persistent:t}}clearOldNotifications(e=3e5){const t=Date.now(),i=this.notifications.length;this.notifications=this.notifications.filter(i=>{const r=new Date(i.timestamp).getTime();if(!Number.isFinite(r))return!0;return!(t-r>e&&!i.options.persistent)});const r=i-this.notifications.length;return r>0&&(k.debug(`[NotificationStateManager] Cleaned up ${r} old notifications`),this.notifySubscribers()),r}startAutoCleanup(){this.cleanupTimer&&clearInterval(this.cleanupTimer);const e=this.settings.autoCleanupInterval;e>0&&(this.cleanupTimer=setInterval(()=>{this.clearOldNotifications()},e),k.debug(`[NotificationStateManager] Auto cleanup started with interval: ${e}ms`))}exportSettings(){return{version:"2.0",timestamp:(new Date).toISOString(),settings:{...this.settings},exportedBy:"NotificationStateManager"}}importSettings(e){try{return!(!e||"object"!=typeof e||!e.settings)&&(e.version&&"2.0"!==e.version&&"1.0"!==e.version&&k.warn(`Unsupported backup version: ${e.version}`),this.settings={...this.getDefaultSettings(),...e.settings},this.persistSettings(),this.startAutoCleanup(),this.notifySubscribers(),k.debug("[NotificationStateManager] Settings imported successfully"),!0)}catch(t){return k.error("Failed to import notification settings:",t),!1}}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.subscribers.clear(),this.notifications=[],k.debug("[NotificationStateManager] Destroyed")}};function oe(e,t){re(e,t).catch(e=>{console.error("Failed to show error notification:",e)})}function se(e,t){ee(e,t).catch(e=>{console.error("Failed to show success notification:",e)})}function ae(e,t){te(e,t).catch(e=>{console.error("Failed to show info notification:",e)})}function ce(e,t){ie(e,t).catch(e=>{console.error("Failed to show warning notification:",e)})}const le={SUCCESS:{icon:"check_circle",ariaRole:"status",ariaLive:"polite",defaultDuration:4e3},ERROR:{icon:"error",ariaRole:"alert",ariaLive:"assertive",defaultDuration:0},WARNING:{icon:"warning",ariaRole:"alert",ariaLive:"assertive",defaultDuration:6e3},INFO:{icon:"info",ariaRole:"status",ariaLive:"polite",defaultDuration:5e3}},ue={maxWidth:768};function de(e,t){if(void 0!==t)return t;const i=le[e.toUpperCase()];return i?i.defaultDuration:5e3}class he{element;duration;type;startTime;animationId;isPaused;pausedTime;isDestroyed;timing;progressBar;progressFill;pauseStartTime;lastLoggedProgress;constructor(e,t=4e3,i="success"){this.element=e,this.duration=t,this.type=i,this.startTime=null,this.animationId=null,this.isPaused=!1,this.pausedTime=0,this.isDestroyed=!1,this.timing=this.createEasingFunction("linear"),this.progressBar=null,this.progressFill=null,this.pauseStartTime=null,this.lastLoggedProgress=-1,this.init()}createEasingFunction(e="linear"){const t={linear:e=>e,easeOut:e=>1-Math.pow(1-e,3),easeIn:e=>Math.pow(e,3),easeInOut:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2};return t[e]||t.linear}init(){if(this.isDestroyed)return;const e=this.element.querySelector(".notification__progress--js-placeholder");e?this.replaceProgressBarPlaceholder(e):this.element.querySelector(".notification__progress")||this.createProgressBar(),this.progressBar=this.element.querySelector(".notification__progress"),this.progressFill=this.element.querySelector(".notification__progress-fill"),this.progressBar&&this.progressFill&&this.start()}replaceProgressBarPlaceholder(e){e.classList.remove("notification__progress--js-placeholder"),e.classList.add("notification__progress--js-controlled"),e.setAttribute("aria-valuenow","100");const t={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"};e.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${t[this.type]||t.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const i=document.createElement("div");i.className="notification__progress-fill";const r={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"};i.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${r[this.type]||r.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,e.innerHTML="",e.appendChild(i)}createProgressBar(){const e={success:"rgba(16, 185, 129, 0.2)",error:"rgba(239, 68, 68, 0.2)",warning:"rgba(245, 158, 11, 0.2)",info:"rgba(6, 182, 212, 0.2)"},t={success:"linear-gradient(90deg, #10b981, #34d399)",error:"linear-gradient(90deg, #ef4444, #f87171)",warning:"linear-gradient(90deg, #f59e0b, #fbbf24)",info:"linear-gradient(90deg, #06b6d4, #22d3ee)"},i=document.createElement("div");i.className="notification__progress notification__progress--js-controlled",i.setAttribute("role","progressbar"),i.setAttribute("aria-label","Tempo rimanente prima della chiusura automatica"),i.setAttribute("aria-valuemin","0"),i.setAttribute("aria-valuemax","100"),i.setAttribute("aria-valuenow","100"),i.style.cssText=`\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 4px;\n            background: ${e[this.type]||e.info};\n            border-radius: 0 0 8px 8px;\n            overflow: hidden;\n            opacity: 1;\n            z-index: 10;\n            will-change: transform;\n        `;const r=document.createElement("div");r.className="notification__progress-fill",r.style.cssText=`\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 100%;\n            background: ${t[this.type]||t.info};\n            opacity: 0.9;\n            transform-origin: left;\n            transform: scaleX(1);\n            transition: none;\n            will-change: transform;\n            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);\n        `,i.appendChild(r),this.element.appendChild(i)}start(){this.isDestroyed||(this.startTime=performance.now(),this.lastLoggedProgress=-1,this.animate({timing:this.timing,draw:e=>this.draw(e),duration:this.duration}))}animate({timing:e,draw:t,duration:i}){if(this.isDestroyed)return;const r=this.startTime,n=o=>{if(this.isDestroyed)return;if(this.isPaused)return this.animationId=requestAnimationFrame(n),void 0;let s=(o-(r??0)-this.pausedTime)/i;s>1&&(s=1),s<0&&(s=0);let a=e(s);t(a),this.updateAccessibility(s),s<1?this.animationId=requestAnimationFrame(n):this.onComplete()};this.animationId=requestAnimationFrame(n)}draw(e){if(this.isDestroyed||!this.progressFill)return;this.progressFill.style.transform=`scaleX(${1-e})`}updateAccessibility(e){if(this.progressBar){const t=Math.round(100*(1-e));this.progressBar.setAttribute("aria-valuenow",t.toString())}}pause(){this.isPaused||this.isDestroyed||(this.isPaused=!0,this.pauseStartTime=performance.now())}resume(){this.isPaused&&!this.isDestroyed&&(this.isPaused=!1,this.pauseStartTime&&(this.pausedTime+=performance.now()-this.pauseStartTime,this.pauseStartTime=null))}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.progressFill&&!this.isDestroyed&&(this.progressFill.style.transform="scaleX(0)")}onComplete(){if(this.isDestroyed)return;const e=new CustomEvent("progressComplete",{detail:{element:this.element,type:this.type,duration:this.duration}});this.element.dispatchEvent(e)}destroy(){this.isDestroyed=!0,this.stop(),this.progressBar&&this.progressBar.parentNode&&this.progressBar.parentNode.removeChild(this.progressBar),this.element=null,this.progressBar=null,this.progressFill=null}}function me(e,t,i){return new he(e,t,i)}let fe=null;function pe(e,t,i=""){try{fe||(fe=n.getInstance({id:"notification-announcer"})),fe.announceNotification?.(e,t,i)}catch(r){const i=document.getElementById("notification-announcer");i&&(i.textContent=`${e}: ${t}`)}}function ge(e,t,{removeNotification:i}){const r=e.querySelector(".notification__close");r&&r.addEventListener("click",e=>{e.stopPropagation(),i(t.id)}),e.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),i(t.id))})}function ye(e,t,{pauseAutoCloseTimer:i}){let r=0;e.addEventListener("touchstart",()=>{r=Date.now()}),e.addEventListener("touchend",()=>{Date.now()-r>500&&i?.(t.id)})}class be{static DEBUG=!1;static notificationQueue=[];static isDOMReady=!1;static domReadyCallbacks=[];static animationSupport=null;static reducedMotionPreference=null;static errorCounts={render:0,animation:0,dom:0,service:0,total:0};static init(){this.checkDOMReady(),this.checkAnimationSupport(),this.checkReducedMotionPreference(),this.setupErrorRecovery(),this.DEBUG&&k.debug("‚úÖ NotificationErrorHandler initialized")}static handleRenderError(e,t,i=null){if(this.errorCounts.render++,this.errorCounts.total++,k.error("‚ùå Notification render error:",e,t),"undefined"!=typeof window&&window.appLogger){const i=window.appLogger;i&&i.error("Notification render failed",{error:e.message,notificationId:t?.id,notificationType:t?.type,stack:e.stack})}try{return i&&"function"==typeof i?i(t):this.createSimpleFallback(t)}catch(r){return k.error("‚ùå Fallback renderer also failed:",r),this.showConsoleFallback(t),null}}static handleAnimationError(e,t,i="unknown"){if(this.errorCounts.animation++,this.errorCounts.total++,k.warn("‚ö†Ô∏è Animation error:",e,i),t)try{t.style.animation="none",t.style.transition="none","entrance"===i?(t.style.opacity="1",t.style.transform="translateX(0)",t.classList.add("notification--visible"),t.classList.remove("notification--entering")):"exit"===i&&(t.style.opacity="0",t.classList.add("notification--hidden"),t.classList.remove("notification--exiting")),this.DEBUG&&k.debug("‚úÖ Animation fallback applied to element")}catch(r){k.error("‚ùå Animation fallback failed:",r)}}static handleServiceError(e,t,i=null){if(this.errorCounts.service++,this.errorCounts.total++,this.errorCounts.service%10==1&&k.error(`‚ùå NotificationService error in ${t} (${this.errorCounts.service} total):`,e),"undefined"!=typeof window&&window.appLogger){const r=window.appLogger;r&&r.error(`NotificationService ${t} failed`,{error:e.message,operation:t,data:i,stack:e.stack})}try{switch(t){case"show":this.recoverFromShowError(i);break;case"remove":this.recoverFromRemoveError(i);break;case"clear":this.recoverFromClearError();break;case"init":this.recoverFromInitError();break;default:k.warn(`‚ö†Ô∏è No recovery strategy for operation: ${t}`)}}catch(r){k.error("‚ùå Error recovery failed:",r)}}static handleDOMError(e,t,i=null){return this.errorCounts.dom++,this.errorCounts.total++,k.error(`‚ùå DOM error in ${t}:`,e),!(!this.isDOMReady&&"render"===t)||(k.debug("üìã DOM not ready, queueing notification"),!1)}static queueNotification(e,t){if(this.isDOMReady)try{return e(t)}catch(i){return this.handleRenderError(i,t)}return this.notificationQueue.push({renderFunction:e,notification:t,timestamp:Date.now()}),this.DEBUG&&k.debug(`üìã Queued notification ${t?.id}, queue size: ${this.notificationQueue.length}`),null}static processNotificationQueue(){if(!this.isDOMReady||0===this.notificationQueue.length)return;k.debug(`üöÄ Processing ${this.notificationQueue.length} queued notifications`);const e=[...this.notificationQueue];this.notificationQueue=[],e.forEach(({renderFunction:e,notification:t,timestamp:i})=>{try{if(Date.now()-i>3e4)return k.warn("‚ö†Ô∏è Skipping old queued notification:",t?.id),void 0;e(t)}catch(r){this.handleRenderError(r,t)}})}static createSimpleFallback(e){const t=document.createElement("div");t.className=`notification notification--${e.type} notification--fallback`,t.setAttribute("data-id",e.id),t.setAttribute("role","error"===e.type?"alert":"status"),t.setAttribute("aria-live","error"===e.type?"assertive":"polite"),t.style.cssText="\n            position: relative;\n            padding: 12px 16px;\n            margin: 8px 0;\n            border-radius: 4px;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 14px;\n            line-height: 1.4;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n            max-width: 400px;\n            word-wrap: break-word;\n        ";const i={success:{bg:"#d4edda",text:"#155724",border:"#c3e6cb"},error:{bg:"#f8d7da",text:"#721c24",border:"#f5c6cb"},warning:{bg:"#fff3cd",text:"#856404",border:"#ffeaa7"},info:{bg:"#d1ecf1",text:"#0c5460",border:"#bee5eb"}},r=i[e.type]||i.info;t.style.backgroundColor=r.bg,t.style.color=r.text,t.style.border=`1px solid ${r.border}`;const n=document.createElement("div");n.style.cssText="display: flex; align-items: flex-start; gap: 8px;";const o=document.createElement("span");o.style.cssText="flex-shrink: 0; font-weight: bold; font-size: 16px;";const s={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"};o.textContent=s[e.type]||s.info;const a=document.createElement("div");if(a.style.cssText="flex: 1; min-width: 0;",e.title){const t=document.createElement("div");t.style.cssText="font-weight: bold; margin-bottom: 4px;",t.textContent=e.title,a.appendChild(t)}const c=document.createElement("div");c.textContent=e.message||`Notifica ${e.type||"info"} - Messaggio non disponibile`,a.appendChild(c);const l=document.createElement("button");return l.style.cssText=`\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            padding: 0;\n            margin-left: 8px;\n            color: ${r.text};\n            opacity: 0.7;\n            flex-shrink: 0;\n        `,l.textContent="√ó",l.setAttribute("aria-label","Chiudi notifica"),l.onclick=()=>{t.remove();try{ne&&"function"==typeof ne.removeNotification&&ne.removeNotification(e.id)}catch(i){k.debug("Could not remove from state:",i)}},n.appendChild(o),n.appendChild(a),n.appendChild(l),t.appendChild(n),this.DEBUG&&k.debug("‚úÖ Created simple fallback notification"),t}static showConsoleFallback(e){const t={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},i=`${t[e.type]||t.info} NOTIFICATION: ${e.message||`Notifica ${e.type||"info"} - Messaggio non disponibile`}`;"error"===e.type?k.error(i):"warning"===e.type?k.warn(i):k.info(i)}static checkDOMReady(){if("undefined"==typeof document)return this.isDOMReady=!1,void 0;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.isDOMReady=!0,this.processNotificationQueue(),this.domReadyCallbacks.forEach(e=>{try{e()}catch(t){k.error("‚ùå DOM ready callback error:",t)}}),this.domReadyCallbacks=[]}):this.isDOMReady=!0}static checkAnimationSupport(){if("undefined"==typeof window||"undefined"==typeof document)return this.animationSupport=!1,void 0;try{const e=document.createElement("div");e.style.animation="test 1s",this.animationSupport=""!==e.style.animation}catch(e){this.animationSupport=!1}this.DEBUG&&k.debug("üé¨ Animation support:",this.animationSupport)}static checkReducedMotionPreference(){if("undefined"==typeof window||!window.matchMedia)return this.reducedMotionPreference=!1,void 0;try{const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.reducedMotionPreference=e.matches,e.addEventListener("change",e=>{this.reducedMotionPreference=e.matches,this.DEBUG&&k.debug("üé¨ Reduced motion preference changed:",this.reducedMotionPreference)})}catch(e){this.reducedMotionPreference=!1}this.DEBUG&&k.debug("üé¨ Reduced motion preference:",this.reducedMotionPreference)}static setupErrorRecovery(){setInterval(()=>{this.cleanupOldQueuedNotifications()},6e4),"undefined"!=typeof window&&window.addEventListener("error",e=>{e.message&&e.message.includes("notification")&&k.warn("‚ö†Ô∏è Possible notification-related error detected")})}static cleanupOldQueuedNotifications(){const e=Date.now(),t=this.notificationQueue.length;this.notificationQueue=this.notificationQueue.filter(t=>e-t.timestamp<6e4);const i=t-this.notificationQueue.length;i>0&&this.DEBUG&&k.debug(`üßπ Cleaned up ${i} old queued notifications`)}static recoverFromShowError(e){k.debug("üîÑ Attempting recovery from show error");try{const t=this.createSimpleFallback(e);if(t){const e=document.querySelector(".notification-container")||document.querySelector("#notification-container")||document.body;if(e)return e.appendChild(t),k.debug("‚úÖ Fallback notification added to DOM"),!0}}catch(t){k.error("‚ùå Show recovery failed:",t)}return this.showConsoleFallback(e),!1}static recoverFromRemoveError(e){k.debug("üîÑ Attempting recovery from remove error");try{const t=document.querySelector(`[data-id="${e}"]`);if(t)return t.remove(),k.debug("‚úÖ Notification removed via DOM recovery"),!0}catch(t){k.error("‚ùå Remove recovery failed:",t)}return!1}static recoverFromClearError(){k.debug("üîÑ Attempting recovery from clear error");try{const e=document.querySelectorAll('.notification, [class*="notification"]');return e.forEach(e=>{try{e.remove()}catch(t){k.debug("Could not remove notification element:",t)}}),k.debug(`‚úÖ Cleared ${e.length} notifications via DOM recovery`),!0}catch(e){k.error("‚ùå Clear recovery failed:",e)}return!1}static recoverFromInitError(){k.debug("üîÑ Attempting recovery from init error");try{let e=document.querySelector(".notification-container");if(!e)return e=document.createElement("div"),e.className="notification-container notification-container--fallback",e.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    z-index: 9999;\n                    pointer-events: none;\n                ",document.body.appendChild(e),k.debug("‚úÖ Fallback notification container created"),!0}catch(e){k.error("‚ùå Init recovery failed:",e)}return!1}static getErrorStats(){return{...this.errorCounts,queueSize:this.notificationQueue.length,isDOMReady:this.isDOMReady,animationSupport:this.animationSupport,reducedMotionPreference:this.reducedMotionPreference}}static resetErrorStats(){this.errorCounts={render:0,animation:0,dom:0,service:0,total:0}}static shouldDisableAnimations(){return!this.animationSupport||!0===this.reducedMotionPreference}static onDOMReady(e){if(this.isDOMReady)try{e()}catch(t){k.error("‚ùå DOM ready callback error:",t)}else this.domReadyCallbacks.push(e)}}function ve(e,{allowHTML:t=!1}={}){if(!t){const t=document.createElement("div");return t.textContent=String(e??""),t.innerHTML}const i=document.createElement("div");i.innerHTML=String(e??"");const r=new Set(["b","strong","i","em","u","br","code","pre","span","p","ul","ol","li","a"]),n=e=>{if(e.nodeType===Node.COMMENT_NODE)return e.remove(),void 0;if(e.nodeType===Node.ELEMENT_NODE){const t=e;if(!r.has(t.tagName.toLowerCase())){const e=t.parentNode;if(!e)return;for(;t.firstChild;)e.insertBefore(t.firstChild,t);return e.removeChild(t),void 0}[...t.attributes].forEach(e=>{const i=e.name.toLowerCase(),r=String(e.value||"");if(i.startsWith("on")||"style"===i)t.removeAttribute(e.name);else if("a"===t.tagName.toLowerCase()&&"href"===i){/^(https?:|mailto:)/i.test(r)||t.removeAttribute("href")}else"href"!==i&&"title"!==i&&t.removeAttribute(e.name)})}let t=e.firstChild;for(;t;){const e=t.nextSibling;n(t),t=e}};return n(i),i.innerHTML}function we({notification:e,_index:t=0,settings:i,timers:r,timerManager:n,progressBarManager:o,removeNotification:s,startAutoCloseTimer:a,pauseAutoCloseTimer:c,resumeAutoCloseTimer:l,announceNotification:u,attachNotificationEvents:d,attachTouchEvents:h,notificationContainer:m,errorHandler:f=be}){try{const t=le[e.type.toUpperCase()]||le.INFO,S=e.options||{},E=de(e.type,S.duration),_=document.createElement("div");let M=`notification notification--${e.type}`;if(E>0&&!S.persistent&&(M+=" notification--autoclose"),_.className=M,_.dataset.id=e.id,_.setAttribute("role",t.ariaRole),_.setAttribute("aria-live",t.ariaLive),_.setAttribute("aria-atomic","true"),_.setAttribute("tabindex","0"),i.enableAnimations&&!f.shouldDisableAnimations())try{_.classList.add("notification--entering"),_.addEventListener("animationend",e=>{(e.animationName.includes("slideIn")||e.animationName.includes("fadeIn"))&&(_.classList.remove("notification--entering"),_.classList.add("notification--visible"))}),_.addEventListener("animationerror",e=>{f.handleAnimationError(new Error("Animation failed"),_,"entrance")})}catch(p){f.handleAnimationError(p instanceof Error?p:new Error(String(p)),_,"entrance")}else _.classList.add("notification--visible","notification--no-animations");let T="";try{T=`\n                <div class="notification__content">\n                    <span class="material-icons notification__icon" aria-hidden="true">${t.icon}</span>\n                    <div class="notification__body">\n                        ${S.title?`<div class="notification__title">${ve(S.title,{allowHTML:!1})}</div>`:""}\n                        <div class="notification__message">${ve(e.message,{allowHTML:!!S.allowHTML})}</div>\n                    </div>\n                </div>\n            `,S.duplicateCount&&S.duplicateCount>1&&(T=T.replace('<span class="material-icons notification__icon" aria-hidden="true">',`<span class="notification__count" aria-label="Ripetuta ${S.duplicateCount} volte">√ó${S.duplicateCount}</span><span class="material-icons notification__icon" aria-hidden="true">`)),(!1!==S.closable||S.actions)&&(T+='<div class="notification__actions">',S.actions&&Array.isArray(S.actions)&&S.actions.forEach((e,t)=>{T+=`\n                            <button class="notification__action-btn ${"primary"===e.style?"notification__action-btn--primary":"secondary"===e.style?"notification__action-btn--secondary":""}" \n                                    data-action-index="${t}"\n                                    aria-label="${ve(e.label,{allowHTML:!1})}">\n                                ${ve(e.label,{allowHTML:!1})}\n                            </button>\n                        `}),!1!==S.closable&&(T+='\n                        <button class="notification__close" \n                                aria-label="Chiudi notifica"\n                                title="Chiudi notifica">\n                            <span class="material-icons" aria-hidden="true">close</span>\n                        </button>\n                    '),T+="</div>");const i=E;i>0&&!S.persistent&&(k.debug(`üîß Creating progress bar placeholder for ${e.type} (${i}ms)`),T+=`\n                    <div class="notification__progress notification__progress--js-placeholder" \n                         aria-hidden="true" \n                         role="progressbar"\n                         aria-label="Tempo rimanente prima della chiusura automatica"\n                         data-duration="${i}"\n                         data-type="${e.type}"></div>\n                `),_.innerHTML=ve(T,{allowHTML:!0})}catch(g){k.error("‚ùå Error building notification HTML:",g),_.innerHTML=ve(`\n                <div class="notification__content">\n                    <span class="notification__icon">!</span>\n                    <div class="notification__body">\n                        <div class="notification__message">${e.message||"Notifica"}</div>\n                    </div>\n                    <button class="notification__close" aria-label="Chiudi">√ó</button>\n                </div>\n            `,{allowHTML:!1})}try{d(_,e,{timers:r,removeNotification:s,pauseAutoCloseTimer:c,resumeAutoCloseTimer:l,notificationContainer:m})}catch(y){k.error("‚ùå Error attaching notification events:",y);const t=_.querySelector(".notification__close");t&&t.addEventListener("click",()=>{try{s(e.id)}catch(t){_.remove()}})}try{window.innerWidth<=ue.maxWidth&&h(_,e,{pauseAutoCloseTimer:c,resumeAutoCloseTimer:l,removeNotification:s})}catch(b){k.error("‚ùå Error attaching touch events:",b)}try{const t=E;if(t>0&&!S.persistent){const i=_.querySelector(".notification__progress--js-placeholder");if(k.debug("üîç Looking for progress bar placeholder:",i),n&&o)window.innerWidth>768&&(_.addEventListener("mouseenter",()=>{try{n.pause(e.id)}catch{}try{o.pause(e.id)}catch{}}),_.addEventListener("mouseleave",()=>{try{n.resume(e.id)}catch{}try{o.resume(e.id)}catch{}})),k.debug(`üïí Managers provided; start deferred until mount (${e.type})`);else if(i){const i=me(_,t,e.type);a(r,e.id,t,()=>{try{s(e.id)}catch(t){k.error("‚ùå Error in progress complete callback:",t),_.parentNode&&_.remove()}}),window.innerWidth>768&&(_.addEventListener("mouseenter",()=>{i&&i.pause()}),_.addEventListener("mouseleave",()=>{i&&i.resume()})),_._progressBarInstance=i,k.debug(`‚úÖ JavaScript progress bar initialized for ${e.type} (${t}ms)`)}else a(r,e.id,t,()=>{try{s(e.id)}catch(t){k.error("‚ùå Error in auto-close callback:",t),_.parentNode&&_.remove()}}),k.debug(`‚úÖ Fallback timer used for ${e.type} (${t}ms)`)}}catch(v){k.error("‚ùå Error setting up auto-close timer:",v)}try{u(e.type,e.message,S.title||"")}catch(w){k.warn("‚ùå Error announcing notification:",w)}return _}catch(S){return k.error("‚ùå Critical error in createNotificationElement:",S),f.createSimpleFallback(e)}}function Se(e){const t=String(e||"").toLowerCase();switch(t){case"errore":case"danger":case"err":case"error":return"error";case"successo":case"ok":case"success":return"success";case"avviso":case"warn":case"warning":return"warning";default:return"info"===t||"informazione"===t?"info":t||"info"}}function Ee(e,t,i,r){if(e.has(t)){const i=e.get(t);i&&clearTimeout(i.timerId)}const n=Date.now(),o=setTimeout(()=>{e.delete(t),r(t)},i);e.set(t,{timerId:o,originalDuration:i,startTime:n,remainingTime:i,isPaused:!1,pausedAt:null,callback:r})}function _e(e,t){const i=e.get(t);i&&!i.isPaused&&(clearTimeout(i.timerId),i.isPaused=!0,i.pausedAt=Date.now(),i.remainingTime=i.remainingTime-(i.pausedAt-i.startTime),k.debug(`‚è∏Ô∏è Timer paused for notification: ${t}`))}function Me(e,t){const i=e.get(t);i&&i.isPaused&&(i.isPaused=!1,i.startTime=Date.now(),i.timerId=setTimeout(()=>{e.delete(t),i.callback&&i.callback(t)},i.remainingTime),k.debug(`‚ñ∂Ô∏è Timer resumed for notification: ${t}`))}function Te(e,t,i){const r=e.get(t);if(r){clearTimeout(r.timerId),e.delete(t);try{"function"==typeof i&&i(t)}catch(n){k.warn("Timer onStop callback error:",n)}k.debug(`‚èπÔ∏è Timer stopped for notification: ${t}`)}}"undefined"!=typeof window&&be.init();class Ce{container;progressBars;constructor(e){this.container=e,this.progressBars=new Map,k.debug("NotificationProgressBarManager initialized")}start(e,t,i){if(t<=0)return null;try{this.stop(e);const r=this.queryElement(e);if(!r)return k.warn(`[ProgressBarManager] Element not found for notification ${e}`),null;const n=this.createProgressBar(r,t,i);return n&&(this.progressBars.set(e,n),r._progressBarInstance=n,k.debug(`[ProgressBarManager] Progress bar started for notification ${e}`)),n}catch(r){return k.error(`[ProgressBarManager] Failed to start progress bar for ${e}:`,r),null}}pause(e){try{const t=this.progressBars.get(e);t&&(t.pause(),k.debug(`[ProgressBarManager] Progress bar paused for notification ${e}`))}catch(t){k.error(`[ProgressBarManager] Failed to pause progress bar for ${e}:`,t)}}resume(e){try{const t=this.progressBars.get(e);t&&(t.resume(),k.debug(`[ProgressBarManager] Progress bar resumed for notification ${e}`))}catch(t){k.error(`[ProgressBarManager] Failed to resume progress bar for ${e}:`,t)}}stop(e){try{const t=this.progressBars.get(e);if(t){t.destroy(),this.progressBars.delete(e);const i=this.queryElement(e);i&&i._progressBarInstance&&(i._progressBarInstance=null),k.debug(`[ProgressBarManager] Progress bar stopped for notification ${e}`)}}catch(t){k.error(`[ProgressBarManager] Failed to stop progress bar for ${e}:`,t)}}pauseAll(){try{this.progressBars.forEach((e,t)=>this.pause(t)),k.debug(`[ProgressBarManager] All progress bars paused (${this.progressBars.size})`)}catch(e){k.error("[ProgressBarManager] Failed to pause all progress bars:",e)}}resumeAll(){try{this.progressBars.forEach((e,t)=>this.resume(t)),k.debug(`[ProgressBarManager] All progress bars resumed (${this.progressBars.size})`)}catch(e){k.error("[ProgressBarManager] Failed to resume all progress bars:",e)}}cleanup(){try{const e=this.progressBars.size;this.progressBars.forEach((e,t)=>this.stop(t)),this.progressBars.clear(),k.debug(`[ProgressBarManager] Cleanup completed (${e} progress bars destroyed)`)}catch(e){k.error("[ProgressBarManager] Failed to cleanup progress bars:",e)}}getStats(){return{active:this.progressBars.size,activeIds:Array.from(this.progressBars.keys())}}isActive(e){return this.progressBars.has(e)}destroy(){this.cleanup(),this.container=null,k.debug("[ProgressBarManager] Manager destroyed")}createProgressBar(e,t,i){try{const r=e.querySelector(".notification__progress--js-placeholder"),n=me(e,t,r?.dataset?.type||e.dataset?.type||"info");if(i){const t=()=>{try{i(e.dataset?.id??"")}catch{}e.removeEventListener("progressComplete",t)};e.addEventListener("progressComplete",t)}return{pause:()=>{try{n?.pause?.()}catch{}},resume:()=>{try{n?.resume?.()}catch{}},destroy:()=>{try{n?.destroy?.()}catch{}},get isPaused(){return Boolean(n?.isPaused)},get isDestroyed(){return Boolean(n?.isDestroyed)},get progress(){try{return n?.progress??0}catch{return 0}}}}catch(r){return k.error("[ProgressBarManager] Failed to create progress bar:",r),null}}queryElement(e){const t=this.container?.querySelector(`[data-id="${e}"]`);return t??null}}class Ae{containerEl;timerManager;progressBarManager;settings;onRemove;timersMap;isRendering;_lastRenderedIds;_renderCount;_lastRenderTime;_avgRenderTime;constructor({containerEl:e,timerManager:t,progressBarManager:i,settings:r,onRemove:n,timersMap:o}){this.containerEl=e||null,this.timerManager=t||null,this.progressBarManager=i||null,this.settings=r||{},this.onRemove="function"==typeof n?n:null,this.timersMap=o||new Map,this.isRendering=!1,this._lastRenderedIds=[],this._renderCount=0,this._lastRenderTime=0,this._avgRenderTime=0}setContainer(e){this.containerEl=e,this.progressBarManager&&(this.progressBarManager.container=e)}render(e=[]){if(Array.isArray(e)&&this.containerEl&&!this.isRendering){this.isRendering=!0;try{const i="undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?()=>window.performance.now():()=>Date.now(),r=i(),n=new Set(e.map(e=>e.id)),o=new Set(this._lastRenderedIds);o.forEach(e=>{if(!n.has(e))try{this.removeElement(e)}catch(t){be.handleDOMError(t,"remove",null)}}),e.forEach(e=>{if(!o.has(e.id))try{this.addElement(e)}catch(t){be.handleRenderError(t,e,e=>{const t=be.createSimpleFallback(e);return null!=t&&null!=this.containerEl&&this.containerEl.appendChild(t),t})}}),e.forEach(e=>{if(o.has(e.id))try{const t=this.getElementById(e.id);if(!t)return;const i=e?.options?.duplicateCount||1;let r=t.querySelector(".notification__count");if(i>1)if(r)r.textContent=`√ó${i}`,r.setAttribute("aria-label",`Ripetuta ${i} volte`);else{const e=t.querySelector(".notification__icon");r=document.createElement("span"),r.className="notification__count",r.setAttribute("aria-label",`Ripetuta ${i} volte`),r.textContent=`√ó${i}`,e&&e.parentNode?e.parentNode.insertBefore(r,e):t.querySelector(".notification__content")?.prepend(r)}else r&&r.remove()}catch(t){}});const s=e.length,a=Number(this.settings?.maxVisible??5),c=Math.max(0,s-a),l=c>0?e.slice(0,c):[];t=e=>{try{this.onRemove?.(e)}catch{}},void l.forEach(e=>{"success"!==e.type&&"info"!==e.type||setTimeout(()=>{t(e.id)},1e3)}),this._lastRenderedIds=e.map(e=>e.id);const u=Math.max(0,i()-r);this._lastRenderTime=u,this._renderCount+=1,this._avgRenderTime=1===this._renderCount?u:(this._avgRenderTime*(this._renderCount-1)+u)/this._renderCount}finally{this.isRendering=!1}var t}}addElement(e){const t=this.createElement(e);if(!t)throw new Error("createElement returned null");this.containerEl.appendChild(t),this.afterMount(e,t)}removeElement(e){const t=this.getElementById(e);t&&t.parentNode&&t.parentNode.removeChild(t)}getStats(){return{renderCount:this._renderCount,averageRenderTime:this._avgRenderTime,lastRenderTime:this._lastRenderTime}}updateSettings(e){this.settings=e||this.settings}createElement(e){try{return we({notification:e,settings:this.settings,timers:this.timersMap,timerManager:this.timerManager,progressBarManager:this.progressBarManager,removeNotification:e=>{try{this.onRemove?.(e)}catch{}},announceNotification:pe,attachNotificationEvents:ge,attachTouchEvents:ye,notificationContainer:{container:this.containerEl},errorHandler:be})}catch(t){k.error("[RenderEngine] Failed to create notification element:",t);try{return be.createSimpleFallback(e)}catch(i){return null}}}afterMount(e,t){try{if(!e||!t)return;const i=e.options||{},r=de(e.type,i.duration);r>0&&!i.persistent&&this.timerManager&&this.progressBarManager&&(this.progressBarManager.start(e.id,r,()=>{try{this.onRemove?.(e.id)}catch{}}),this.timerManager.start(e.id,r),"undefined"!=typeof window&&window.innerWidth>768&&(t.addEventListener("mouseenter",()=>{try{this.timerManager.pause(e.id)}catch{}try{this.progressBarManager.pause(e.id)}catch{}}),t.addEventListener("mouseleave",()=>{try{this.timerManager.resume(e.id)}catch{}try{this.progressBarManager.resume(e.id)}catch{}})))}catch(i){k.error("[RenderEngine] afterMount failed:",i)}}getElementById(e){try{return this.containerEl?.querySelector(`[data-id="${e}"]`)||null}catch(t){return null}}pauseAll(){try{this.timerManager?.pauseAll()}catch{}try{this.progressBarManager?.pauseAll()}catch{}}resumeAll(){try{this.timerManager?.resumeAll()}catch{}try{this.progressBarManager?.resumeAll()}catch{}}cleanupAll(){try{this.timerManager?.stopAll()}catch{}try{this.progressBarManager?.cleanup()}catch{}}removeAnimated(e,t,i){try{const r=this.getElementById(e);if(r&&t)try{r.classList.remove("notification--entering"),r.classList.add("notification--exiting");const t=r.querySelector(".notification__progress");return t&&t.classList.remove("notification__progress--active","notification__progress--paused","notification__progress--resumed"),setTimeout(()=>{try{this.removeElement(e)}catch{}try{i?.()}catch{}},300),void 0}catch{}this.removeElement(e);try{i?.()}catch{}}catch(r){try{i?.()}catch{}}}}function Ne(e){return"object"==typeof e&&null!==e}class Ie{timers;onTimeout;constructor(e){this.timers=new Map,this.onTimeout=e??(e=>k.debug(`Timer expired for notification ${e}`)),k.debug("NotificationTimerManager initialized")}start(e,t,i){try{if(this.stop(e),t<=0)return k.debug(`[TimerManager] No timer set for notification ${e} (duration: ${t})`),!1;const r=i??this.onTimeout;return Ee(this.timers,e,t,e=>{k.debug(`[TimerManager] Timer ${e} expired`),r(e)}),k.debug(`[TimerManager] Timer started for notification ${e} (${t}ms)`),!0}catch(r){return k.error(`[TimerManager] Failed to start timer for ${e}:`,r),!1}}pause(e){try{return this.timers.has(e)?(_e(this.timers,e),k.debug(`[TimerManager] Timer paused for notification ${e}`),!0):(k.debug(`[TimerManager] No timer to pause for notification ${e}`),!1)}catch(t){return k.error(`[TimerManager] Failed to pause timer for ${e}:`,t),!1}}resume(e){try{return this.timers.has(e)?(Me(this.timers,e),k.debug(`[TimerManager] Timer resumed for notification ${e}`),!0):(k.debug(`[TimerManager] No timer to resume for notification ${e}`),!1)}catch(t){return k.error(`[TimerManager] Failed to resume timer for ${e}:`,t),!1}}stop(e,t){try{return!!this.timers.has(e)&&(Te(this.timers,e,t),k.debug(`[TimerManager] Timer stopped for notification ${e}`),!0)}catch(i){return k.error(`[TimerManager] Failed to stop timer for ${e}:`,i),!1}}pauseAll(){let e=0;try{this.timers.forEach((t,i)=>{this.pause(i)&&e++}),k.debug(`[TimerManager] Paused ${e}/${this.timers.size} timers`)}catch(t){k.error("[TimerManager] Failed to pause all timers:",t)}return e}resumeAll(){let e=0;try{this.timers.forEach((t,i)=>{this.resume(i)&&e++}),k.debug(`[TimerManager] Resumed ${e}/${this.timers.size} timers`)}catch(t){k.error("[TimerManager] Failed to resume all timers:",t)}return e}stopAll(e){let t=0;try{Array.from(this.timers.keys()).forEach(i=>{this.stop(i,e)&&t++}),k.debug(`[TimerManager] Stopped ${t} timers`)}catch(i){k.error("[TimerManager] Failed to stop all timers:",i)}return t}cleanupOrphanedTimers(e=[]){let t=0;try{const i=new Set(e);Array.from(this.timers.keys()).forEach(e=>{i.has(e)||this.stop(e)&&t++}),t>0&&k.debug(`[TimerManager] Cleaned up ${t} orphaned timers`)}catch(i){k.error("[TimerManager] Failed to cleanup orphaned timers:",i)}return t}getStats(){try{const e={total:this.timers.size,active:0,paused:0,activeIds:[],pausedIds:[]};return this.timers.forEach((t,i)=>{Ne(t)&&(t.isPaused??t.paused?(e.paused++,e.pausedIds.push(i)):(e.active++,e.activeIds.push(i)))}),e}catch(e){return k.error("[TimerManager] Failed to get stats:",e),{total:0,active:0,paused:0,activeIds:[],pausedIds:[],error:e instanceof Error?e.message:"Unknown error"}}}hasTimer(e){return this.timers.has(e)}isPaused(e){try{const t=this.timers.get(e);return!!Ne(t)&&Boolean(t.isPaused??t.paused)}catch(t){return k.error(`[TimerManager] Failed to check if timer ${e} is paused:`,t),!1}}getRemainingTime(e){try{const t=this.timers.get(e);if(!Ne(t))return-1;if((t.isPaused??t.paused)&&"number"==typeof t.remainingTime)return t.remainingTime;if("number"==typeof t.remainingTime&&"number"==typeof t.startTime){const e=Date.now()-t.startTime;return Math.max(t.remainingTime-e,0)}return-1}catch(t){return k.error(`[TimerManager] Failed to get remaining time for ${e}:`,t),-1}}cleanup(){try{const e=this.stopAll();this.timers.clear(),k.debug(`[TimerManager] Cleanup completed (${e} timers stopped)`)}catch(e){k.error("[TimerManager] Failed to cleanup:",e)}}destroy(){this.cleanup(),this.onTimeout=()=>{},k.debug("[TimerManager] Manager destroyed")}}class ke{onHidden;onVisible;_handler;_attached;constructor({onHidden:e,onVisible:t}={}){this.onHidden="function"==typeof e?e:null,this.onVisible="function"==typeof t?t:null,this._handler=this._handleVisibilityChange.bind(this),this._attached=!1}attach(){this._attached||"undefined"==typeof document||(document.addEventListener("visibilitychange",this._handler,{passive:!0}),this._attached=!0)}detach(){this._attached&&"undefined"!=typeof document&&(document.removeEventListener("visibilitychange",this._handler),this._attached=!1)}_handleVisibilityChange(){try{document.hidden?this.onHidden?.():this.onVisible?.()}catch{}}}class xe{timerManager;progressBarManager;legacyTimersMap;constructor({timerManager:e,progressBarManager:t,legacyTimersMap:i}){this.timerManager=e??null,this.progressBarManager=t??null,this.legacyTimersMap=i??new Map}start(e,t,i){return this.timerManager?this.timerManager.start(e,t,i):!(t<=0)&&(Ee(this.legacyTimersMap,e,t,i),!0)}pause(e){return this.timerManager?this.timerManager.pause(e):!!this.legacyTimersMap.has(e)&&(_e(this.legacyTimersMap,e),!0)}resume(e){return this.timerManager?this.timerManager.resume(e):!!this.legacyTimersMap.has(e)&&(Me(this.legacyTimersMap,e),!0)}stop(e,t){const i=t??(e=>this.progressBarManager?.stop(e));return this.timerManager?this.timerManager.stop(e,i):!!this.legacyTimersMap.has(e)&&(Te(this.legacyTimersMap,e,i),!0)}pauseAll(){if(this.timerManager)return this.timerManager.pauseAll();let e=0;return this.legacyTimersMap.forEach((t,i)=>{this.pause(i)&&e++}),e}resumeAll(){if(this.timerManager)return this.timerManager.resumeAll();let e=0;return this.legacyTimersMap.forEach((t,i)=>{this.resume(i)&&e++}),e}stopAll(e){if(this.timerManager)return this.timerManager.stopAll(e);let t=0;const i=e??(e=>this.progressBarManager?.stop(e));return Array.from(this.legacyTimersMap.keys()).forEach(e=>{this.legacyTimersMap.has(e)&&(Te(this.legacyTimersMap,e,i),t++)}),t}cleanupOrphans(e=[]){if(this.timerManager)return this.timerManager.cleanupOrphanedTimers(e);const t=new Set(e);let i=0;return Array.from(this.legacyTimersMap.keys()).forEach(e=>{t.has(e)||this.legacyTimersMap.has(e)&&(Te(this.legacyTimersMap,e,()=>this.progressBarManager?.stop(e)),i++)}),i}hasTimer(e){return this.timerManager?this.timerManager.hasTimer(e):this.legacyTimersMap.has(e)}}const Re={nome:"Nome",cognome:"Cognome",codice_rad:"Codice RAD",data_ricovero:"Data Ricovero",reparto_appartenenza:"Reparto Appartenenza",reparto_provenienza:"Reparto Provenienza",diagnosi:"Diagnosi",user_id:"Utente"};function De(e,t={}){const i="string"==typeof e?e:e?.message||"",r="object"==typeof e&&e&&"details"in e?e.details:"",n="object"==typeof e&&e&&"code"in e?e.code:void 0,{entity:o="record",operation:s}=t,a=()=>{const e=[/column\s+'([^']+)'/i,/"([^"]+)"\s+column/i,/Key\s*\(([^)]+)\)/i,/column\s+"([^"]+)"/i];for(const t of e){const e=t.exec(i)||(r?t.exec(r):null);if(e&&e[1])return e[1]}};if("23502"===n||/violates not-null constraint/i.test(i)||/null value in column/i.test(i)){const e=a();if("user_id"===e)return"Utente non autenticato. Effettua nuovamente l'accesso e riprova.";if(!e)return"Compila tutti i campi obbligatori.";const t=Re[e]||function(e){return e?e.split("_").filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}(e);return`Il campo "${c=t,c?c.charAt(0).toUpperCase()+c.slice(1):c}" √® obbligatorio.`}var c;if("23505"===n||/duplicate key value violates unique constraint/i.test(i))return/codice_rad/i.test(i)?`Esiste gi√† un ${o} con lo stesso Codice RAD.`:"Alcuni valori devono essere unici: verifica i dati inseriti.";if("23503"===n||/violates foreign key constraint/i.test(i)){const e=a();return`Valore non valido per ${e&&Re[e]?Re[e]:"alcuni campi"}. Seleziona un'opzione corretta e riprova.`}if("23514"===n||/violates check constraint/i.test(i))return"Alcuni dati non rispettano i vincoli richiesti. Verifica i campi e riprova.";if("PGRST301"===n||/JWT|auth|unauth/i.test(i))return"Sessione scaduta o non valida. Effettua l'accesso e riprova.";return`Si √® verificato un errore durante il ${s||"salvataggio"} del ${o}. Verifica i campi e riprova.`}class Pe{static DEBUG=!1;constructor(){this.notificationContainer=null,this.timers=new Map,this.initialized=!1,this.isRendering=!1,this.settings=ne.getSettings(),this._lastRenderedNotificationIds=[],this._renderCount=0,this._lastRenderTime=0,this._averageRenderTime=0,this._unsubscribe=null,this._unsubscribeSettings=null,this.timerManager=null,this.progressBarManager=null,this.renderEngine=null,this.visibilityManager=null,this.timerAdapter=null}flush(){try{const e=ne.getNotifications();this.renderNotifications(e)}catch{}}async init(){if(!this.initialized&&"undefined"!=typeof window)try{await this.#e(),function(){try{fe=n.getInstance({id:"notification-announcer"})}catch(e){if(!document.getElementById("notification-announcer")){const e=document.createElement("div");e.id="notification-announcer",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;",document.body.appendChild(e)}}}(),this._unsubscribe=ne.subscribe(this.#t),this._unsubscribeSettings=ne.subscribe((e,t)=>{try{if(this.settings=t,this.notificationContainer){this.notificationContainer.updateSettings({position:this.settings.position,maxVisible:this.settings.maxVisible})}}catch{}}),this.initialized=!0,this.visibilityManager=new ke({onHidden:()=>{try{this.renderEngine?.pauseAll(),this.#i()}catch{}},onVisible:()=>{try{this.renderEngine?.resumeAll(),this.#r()}catch{}}}),this.visibilityManager.attach()}catch(e){be.handleServiceError(e,"init"),this.initialized=!0}}async#e(){if(this.notificationContainer)return;const{NotificationContainer:e}=await s(async()=>{const{NotificationContainer:e}=await import("./shared-DM1owLfs.js").then(e=>e.w);return{NotificationContainer:e}},__vite__mapDeps([0,1,2,3]));this.notificationContainer=new e({position:this.settings.position,maxVisible:this.settings.maxVisible});const t=this.notificationContainer?.container||null;this.timerManager=new Ie(e=>this.removeNotification(e)),this.progressBarManager=new Ce(t),this.renderEngine=new Ae({containerEl:t,timerManager:this.timerManager,progressBarManager:this.progressBarManager,settings:this.settings,onRemove:e=>this.removeNotification(e),timersMap:this.timers}),this.timerAdapter=new xe({timerManager:this.timerManager,progressBarManager:this.progressBarManager,legacyTimersMap:this.timers})}show(e,t,i={}){try{const r=Se(e),n=String(t||"").trim();if(!n){return this.show(r,`Notifica ${r} - Messaggio non disponibile`,i)}const o=function(e,t){const i=e||{},r=(i.customDurations||{})[t];return(i.persistentTypes||[]).includes(t)?0:"number"==typeof r?r:"number"==typeof i.defaultDuration?i.defaultDuration:5e3}(this.settings,r),s=function(e,t,i){const r=t||{};return{duration:void 0!==r.duration?r.duration:i,closable:!1!==r.closable,position:r.position||e&&e.position,priority:r.priority||0,title:r.title,actions:r.actions,persistent:r.persistent,...r}}(this.settings,i,o);return ne.addNotification(r,n,s)}catch(r){return be.handleServiceError(r,"show",{type:e,message:t,options:i}),be.recoverFromShowError({type:Se(e),message:t,options:i,id:Date.now().toString()})}}success(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("success",e,t)}info(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("info",e,t)}warning(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("warning",e,t)}error(e,t={}){return"number"==typeof t&&(t={duration:t}),this.show("error",e,t)}renderNotifications(e=[]){Array.isArray(e)&&this.notificationContainer&&(this.renderEngine?.setContainer(this.notificationContainer.container),this.renderEngine?.updateSettings(this.settings),this.renderEngine?.render(e))}#n(e){const t=this.renderEngine?.createElement(e)||we({notification:e,settings:this.settings,timers:this.timers,removeNotification:e=>this.removeNotification(e),startAutoCloseTimer:Ee,pauseAutoCloseTimer:_e,resumeAutoCloseTimer:Me,announceNotification:pe,attachNotificationEvents:ge,attachTouchEvents:ye,notificationContainer:this.notificationContainer,errorHandler:be});if(!t)throw new Error("createNotificationElement returned null");this.notificationContainer.addNotification(t);try{this.renderEngine?.afterMount(e,t)}catch{}}#t=this.#o(e=>{Array.isArray(e)&&this.renderNotifications(e)},16);removeNotification(e){try{if(this.timerAdapter?.stop(e,()=>this.progressBarManager?.stop(e)),!this.notificationContainer)return ne.removeNotification(e),void 0;const t=this.settings.enableAnimations&&!be.shouldDisableAnimations();this.renderEngine?.removeAnimated(e,t,()=>this.#s(e))}catch(t){be.handleServiceError(t,"remove",e),be.recoverFromRemoveError(e)}}#s(e){this.#a(e)}#a(e){try{ne.removeNotification(e)}catch{}}clear(){try{this.timerAdapter?.stopAll(e=>this.progressBarManager?.stop(e)),this.timers.clear(),this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications(),ne.clearAllNotifications()}catch(e){be.handleServiceError(e,"clear"),be.recoverFromClearError()}}clearByType(e){ne.getNotifications().forEach(t=>{t.type===e&&this.timerAdapter?.stop(t.id,()=>this.progressBarManager?.stop(t.id))}),ne.clearNotificationsByType(e)}startAutoCloseTimer(e,t){try{this.timerAdapter?.start(e,t,e=>this.removeNotification(e))}catch{}}pauseAutoCloseTimer(e){try{this.timerAdapter?.pause(e)}catch{}}resumeAutoCloseTimer(e){try{this.timerAdapter?.resume(e)}catch{}}stopAutoCloseTimer(e){try{this.timerAdapter?.stop(e,()=>this.progressBarManager?.stop(e))}catch{}}handleAction(e,t){try{const i=ne.getNotifications().find(t=>t.id===e),r=i?.options?.actions?.[t];r&&"function"==typeof r.onClick&&r.onClick({id:e,index:t,notification:i})}catch{}}setCustomDurations(e){this.updateSettings({customDurations:{...this.settings.customDurations||{},...e}})}setPersistentTypes(e){this.updateSettings({persistentTypes:[...e]})}setAutoCleanupInterval(e){this.updateSettings({autoCleanupInterval:e})}updatePosition(e){this.updateSettings({position:e})}setMaxVisible(e){this.updateSettings({maxVisible:e});const t=ne.getNotifications();this.renderNotifications(t)}enableSounds(e=!0){this.updateSettings({enableSounds:!!e})}updateSettings(e){try{const t=this._validateSettings(e);if(ne.updateSettings(t),this.settings=ne.getSettings(),this.notificationContainer){const e={};"position"in t&&(e.position=this.settings.position),"maxVisible"in t&&(e.maxVisible=this.settings.maxVisible),Object.keys(e).length&&this.notificationContainer.updateSettings(e)}return this.renderEngine?.updateSettings(this.settings),!0}catch{return!1}}getStats(){try{return{...ne.getStats(),settings:this.settings,activeTimers:this.timerManager?this.timerManager.timers.size:this.timers.size,containerInitialized:!!this.notificationContainer,serviceInitialized:this.initialized,performance:this.renderEngine?.getStats?.()||{renderCount:this._renderCount,averageRenderTime:this._averageRenderTime,lastRenderTime:this._lastRenderTime}}}catch(e){return{total:0,visible:0,byType:{success:0,error:0,warning:0,info:0},persistent:0,error:e?.message}}}exportSettings(){try{const e=ne.exportSettings();return e.serviceMetadata={version:"2.0",exportedBy:"NotificationService"},e}catch(e){return null}}importSettings(e){try{if(!e||"object"!=typeof e||!e.settings)return!1;e.version&&"1.0"!==e.version&&k.warn(`Versione backup non supportata: ${e.version}`);const t=ne.importSettings(e);return t&&(this.settings=ne.getSettings()),t}catch(t){return!1}}cleanupOldNotifications(e=3e5){try{const t=ne.clearOldNotifications(e),i=new Set(ne.getNotifications().map(e=>e.id));return Array.from(this.timers.keys()).forEach(e=>{i.has(e)||this.timers.delete(e)}),t}catch{return 0}}_validateSettings(e){const t={},i=e=>"number"==typeof e&&!Number.isNaN(e),r=e=>"boolean"==typeof e;if(void 0!==e.maxVisible){if(!Number.isInteger(e.maxVisible)||e.maxVisible<1||e.maxVisible>20)throw new Error("maxVisible must be between 1 and 20");t.maxVisible=e.maxVisible}if(void 0!==e.defaultDuration){if(!i(e.defaultDuration)||e.defaultDuration<0)throw new Error("defaultDuration must be >= 0");t.defaultDuration=e.defaultDuration}if(void 0!==e.position){if(!["top-right","top-left","bottom-right","bottom-left","top-center","bottom-center"].includes(e.position))throw new Error("invalid position");t.position=e.position}if(void 0!==e.enableSounds){if(!r(e.enableSounds))throw new Error("enableSounds must be boolean");t.enableSounds=e.enableSounds}if(void 0!==e.enableAnimations){if(!r(e.enableAnimations))throw new Error("enableAnimations must be boolean");t.enableAnimations=e.enableAnimations}if(void 0!==e.autoCleanupInterval){if(!i(e.autoCleanupInterval)||e.autoCleanupInterval<6e4)throw new Error("autoCleanupInterval must be >= 60000");t.autoCleanupInterval=e.autoCleanupInterval}if(void 0!==e.maxStoredNotifications){if(!Number.isInteger(e.maxStoredNotifications)||e.maxStoredNotifications<10)throw new Error("maxStoredNotifications must be >= 10");t.maxStoredNotifications=e.maxStoredNotifications}if(void 0!==e.persistentTypes){if(!Array.isArray(e.persistentTypes))throw new Error("persistentTypes must be array");t.persistentTypes=[...e.persistentTypes]}if(void 0!==e.soundVolume){if(!i(e.soundVolume)||e.soundVolume<0||e.soundVolume>1)throw new Error("soundVolume must be between 0 and 1");t.soundVolume=e.soundVolume}if(void 0!==e.customDurations){const r=["success","error","warning","info"],n=e.customDurations;if(!n||"object"!=typeof n)throw new Error("customDurations must be object");for(const e of Object.keys(n))if(!r.includes(e)||!i(n[e])||n[e]<0)throw new Error("invalid customDurations entry");t.customDurations={...n}}return t}getNotificationsByType(e){try{return ne.getNotificationsByType(e)}catch{return[]}}getVisibleNotifications(){try{return ne.getVisibleNotifications()}catch{return[]}}hasErrors(){try{return ne.hasErrorNotifications()}catch{return!1}}destroy(){try{try{this.timerAdapter?.stopAll()}catch{}try{this.progressBarManager?.cleanup()}catch{}try{this.timers.forEach((e,t)=>Te(this.timers,t))}catch{}try{this.timers.clear()}catch{}this.notificationContainer?.clearAllNotifications&&this.notificationContainer.clearAllNotifications();try{this.visibilityManager?.detach()}catch{}if("function"==typeof this._unsubscribe){try{this._unsubscribe()}catch{}this._unsubscribe=null}if("function"==typeof this._unsubscribeSettings){try{this._unsubscribeSettings()}catch{}this._unsubscribeSettings=null}try{this.timerManager?.destroy()}catch{}try{this.progressBarManager?.destroy()}catch{}this.renderEngine=null}finally{this.notificationContainer=null,this.initialized=!1}}#c(e){try{this.progressBarManager?.stop(e)}catch{}}#l(e){try{this.progressBarManager?.pause(e)}catch{}}#u(e){try{this.progressBarManager?.resume(e)}catch{}}#i(){try{this.timerAdapter?.pauseAll(),this.progressBarManager?.pauseAll()}catch{}}#r(){try{this.timerAdapter?.resumeAll(),this.progressBarManager?.resumeAll()}catch{}}#o(e,t){let i=!1;return(...r)=>{i||(e.apply(this,r),i=!0,setTimeout(()=>i=!1,t))}}}const Be=new Pe,$e=Object.freeze(Object.defineProperty({__proto__:null,notificationService:Be},Symbol.toStringTag,{value:"Module"}));export{se as A,ce as B,ae as C,De as D,y as R,s as _,p as a,U as b,L as c,Q as d,B as e,V as f,a as g,T as h,C as i,J as j,H as k,k as l,g as m,c as n,A as o,_ as p,R as q,f as r,j as s,N as t,M as u,X as v,G as w,D as x,q as y,oe as z};
