import{a as e}from"./index-DRBZquSG.js";class t{constructor(e,t={}){this.selectElement=e,this.options={placeholder:"Seleziona...",searchable:!1,...t},this.isOpen=!1,this.selectedValue="",this.selectedText="",this.mobileModal=null,this.isScrolling=!1;try{this.init(),this.selectElement.customSelectInstance=this,window.appLogger?.debug("CustomSelect inizializzato",{element:e.id||"unnamed"})}catch(s){throw window.appLogger?.error("Errore inizializzazione CustomSelect",s),s}}init(){this.selectElement.classList.add("custom-select-original"),this.wrapper=this.createWrapper(),this.selectElement.parentNode.insertBefore(this.wrapper,this.selectElement),this.populateOptions(),this.bindEvents(),this.selectElement.value&&this.setValue(this.selectElement.value)}updateOptions(){if(window.appLogger?.debug("Updating options for",{selectId:this.selectElement.id}),this.populateOptions(),this.selectElement.value)this.setValue(this.selectElement.value,!0);else{const e=this.wrapper.querySelector(".custom-select-label");e&&(e.textContent=this.options.placeholder)}}createWrapper(){const t=document.createElement("div");t.className="custom-select-wrapper";const s=this.selectElement.id,o=this.selectElement.name;return s&&(t.id=`${s}-custom-select`),o&&t.setAttribute("data-name",o),t.innerHTML=e(`\n            <div class="custom-select-trigger">\n                <span class="custom-select-label">${this.options.placeholder}</span>\n                <span class="custom-select-arrow">\n                    <svg width="12" height="8" viewBox="0 0 12 8" fill="none">\n                        <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                    </svg>\n                </span>\n            </div>\n            <div class="custom-select-dropdown">\n                <div class="custom-select-options"></div>\n            </div>\n        `),t}populateOptions(){const t=this.wrapper.querySelector(".custom-select-options"),s=this.selectElement.querySelectorAll("option");t.innerHTML="";let o=0;s.forEach((s,i)=>{if(""===s.value&&0!==i)return;o++;const l=document.createElement("div");if(l.className="custom-select-option",l.dataset.value=s.value,s.hasAttribute("data-icon")){let t=s.getAttribute("data-icon");const o=document.createElement("div");for(o.innerHTML=e(t);o.firstChild;)l.appendChild(o.firstChild);l.appendChild(document.createTextNode(" "+s.textContent))}else l.textContent=s.textContent;l.addEventListener("click",()=>{this.mobileModal||this.selectOption(s.value,s.textContent)}),t.appendChild(l)}),o>4&&this.addScrollIndicator()}bindEvents(){const e=this.wrapper.querySelector(".custom-select-trigger");e.addEventListener("touchstart",()=>{this.isScrolling=!1},{passive:!0}),e.addEventListener("touchmove",()=>{this.isScrolling=!0},{passive:!0}),e.addEventListener("click",e=>{try{if(this.isScrolling)return this.isScrolling=!1,void 0;e.stopPropagation(),this.toggle()}catch(t){window.appLogger?.error("Errore nel click handler del CustomSelect:",t)}}),this.outsideClickHandler=e=>{try{this.wrapper.contains(e.target)||this.mobileModal?.contains(e.target)||this.close()}catch(t){window.appLogger?.error("Errore nel outside click handler:",t)}},this.outsideTouchHandler=e=>{try{!this.isOpen||this.wrapper.contains(e.target)||this.mobileModal?.contains(e.target)||setTimeout(()=>{try{this.isOpen&&this.close()}catch(e){window.appLogger?.error("Errore nel timeout del touch handler:",e)}},50)}catch(t){window.appLogger?.error("Errore nel outside touch handler:",t)}},document.addEventListener("click",this.outsideClickHandler),document.addEventListener("touchstart",this.outsideTouchHandler,{passive:!0}),this.wrapper.addEventListener("keydown",e=>{try{this.handleKeyboard(e)}catch(t){window.appLogger?.error("Errore nel keyboard handler:",t)}}),this.resizeHandler=()=>{this.isOpen&&this.adjustDropdownPosition()},window.addEventListener("resize",this.resizeHandler),this.scrollHandler=()=>{this.isOpen&&this.adjustDropdownPosition()},window.addEventListener("scroll",this.scrollHandler,{passive:!0}),this.wrapper.setAttribute("tabindex","0")}handleKeyboard(e){switch(e.key){case"Enter":case" ":e.preventDefault(),this.toggle();break;case"Escape":this.close();break;case"ArrowDown":e.preventDefault(),this.isOpen?this.navigateOptions(1):this.open();break;case"ArrowUp":e.preventDefault(),this.isOpen&&this.navigateOptions(-1)}}navigateOptions(e){const t=this.wrapper.querySelectorAll(".custom-select-option"),s=this.wrapper.querySelector(".custom-select-option.focused");let o=0;if(s){o=Array.from(t).indexOf(s)+e,s.classList.remove("focused")}o<0&&(o=t.length-1),o>=t.length&&(o=0),t[o]&&(t[o].classList.add("focused"),t[o].scrollIntoView({block:"nearest"}))}selectOption(t,s){this.selectedValue=t,this.selectedText=s;const o=this.wrapper.querySelector(".custom-select-label");if(o){const i=this.selectElement.querySelector(`option[value="${t}"]`);if(i&&i.hasAttribute("data-icon")){let t=i.getAttribute("data-icon");o.innerHTML="";const l=document.createElement("div");for(l.innerHTML=e(t);l.firstChild;)o.appendChild(l.firstChild);o.appendChild(document.createTextNode(" "+s))}else o.textContent=s}this.selectElement.value=t;const i=new Event("change",{bubbles:!0});this.selectElement.dispatchEvent(i),this.wrapper.querySelectorAll(".custom-select-option").forEach(e=>{e.classList.remove("focused")}),this.mobileModal||this.close()}setValue(t,s=!1){const o=this.selectElement.querySelector(`option[value="${t}"]`);if(o)if(s){this.selectedValue=t,this.selectedText=o.textContent;const s=this.wrapper.querySelector(".custom-select-label");if(s)if(o.hasAttribute("data-icon")){const t=o.getAttribute("data-icon");s.innerHTML="";const i=document.createElement("div");for(i.innerHTML=e(t);i.firstChild;)s.appendChild(i.firstChild);s.appendChild(document.createTextNode(" "+o.textContent))}else s.textContent=o.textContent;this.selectElement.value=t}else this.selectOption(t,o.textContent)}open(){this.isOpen=!0,this.wrapper.classList.add("open");const e=this.wrapper.closest(".card");if(e&&e.classList.add("overflow-visible"),this.adjustDropdownPosition(),""===this.selectedValue){const e=this.wrapper.querySelector(".custom-select-option");e&&e.classList.add("focused")}}adjustDropdownPosition(){const e=this.wrapper.querySelector(".custom-select-dropdown"),t=this.wrapper.querySelector(".custom-select-trigger");if(!e||!t)return;this.wrapper.classList.remove("dropdown-up","dropdown-down");const s=this.wrapper.closest(".modal"),o=!!s,i=t.getBoundingClientRect();let l;if(o){const e=s.querySelector(".modal-body");l=(e?e.getBoundingClientRect():s.getBoundingClientRect()).bottom}else l=window.innerHeight;const n=Math.min(o?150:200,e.scrollHeight||200),r=l-i.bottom-20,c=i.top-(o?s.getBoundingClientRect().top:0)-20;r<n&&c>=n?(this.wrapper.classList.add("dropdown-up"),window.appLogger?.debug("Dropdown aperto verso l'alto",{spaceBelow:r,spaceAbove:c,dropdownHeight:n,isInModal:o,elementId:this.selectElement.id})):(this.wrapper.classList.add("dropdown-down"),window.appLogger?.debug("Dropdown aperto verso il basso",{spaceBelow:r,spaceAbove:c,dropdownHeight:n,isInModal:o,elementId:this.selectElement.id}))}close(){if(!this.isOpen)return;this.isOpen=!1,this.wrapper.classList.remove("open");const e=this.wrapper.closest(".card");e&&e.classList.remove("overflow-visible"),this.mobileModal?(this.removeMobileModal(),this.enableOtherCustomSelects()):this.wrapper.querySelectorAll(".custom-select-option").forEach(e=>{e.classList.remove("focused")}),document.body.classList.remove("custom-select-modal-open"),this.removeGlobalClickBlocker()}toggle(){this.isOpen?this.close():this.open()}destroy(){this.outsideClickHandler&&document.removeEventListener("click",this.outsideClickHandler),this.outsideTouchHandler&&document.removeEventListener("touchstart",this.outsideTouchHandler),this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.scrollHandler&&window.removeEventListener("scroll",this.scrollHandler),this.removeMobileModal(),this.wrapper.remove(),this.selectElement.style.display=""}disableOtherCustomSelects(){document.querySelectorAll(".custom-select-wrapper").forEach(e=>{e!==this.wrapper&&(e.style.pointerEvents="none")})}enableOtherCustomSelects(){document.querySelectorAll(".custom-select-wrapper").forEach(e=>{e.style.pointerEvents="auto"})}createMobileModal(){this.removeMobileModal(),this.mobileModal=document.createElement("div"),this.mobileModal.className="custom-select-mobile-modal",this.mobileModal.innerHTML="...",document.body.appendChild(this.mobileModal),document.body.classList.add("custom-select-modal-open"),this.addGlobalClickBlocker(),this.bindMobileModalEvents(),setTimeout(()=>{this.mobileModal.classList.add("show")},10)}getMobileOptionsHTML(){}bindMobileModalEvents(){}removeMobileModal(){this.mobileModal&&(this.mobileModal.remove(),this.mobileModal=null),document.body.classList.remove("custom-select-modal-open"),this.removeGlobalClickBlocker()}addScrollIndicator(){}addGlobalClickBlocker(){}removeGlobalClickBlocker(){}}function s(e){const t=document.querySelectorAll(e);t&&0!==t.length&&t.forEach(e=>{e&&e.customSelectInstance&&e.customSelectInstance.updateOptions()})}function o(e='.form-select[data-custom="true"]'){try{document.querySelectorAll(e).forEach(e=>{e.customSelectInstance||new t(e)})}catch(s){window.appLogger?.error("Errore inizializzazione globale custom selects",s)}}export{t as C,o as i,s as u};
