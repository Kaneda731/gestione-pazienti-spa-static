import{j as e}from"./ui-vendor-S6RcKJ66.js";import{R as t,b as r}from"./react-vendor-Bp2pLdQf.js";import{D as n}from"./dropdownPositioner-CpLmXRgY.js";import{t as s}from"./index-DqdNwg8u.js";const l=t.forwardRef(({id:l,placeholder:o="Seleziona...",value:a,options:c,children:u,onChange:i,disabled:d=!1,className:p="",isInvalid:v=!1},f)=>{const h=r.useRef(null),m=r.useRef(null),b=r.useRef(null),x=r.useRef(null),w=r.useRef(-1),g=r.useRef(null),j=r.useRef(null),k=r.useRef(null),[y,E]=r.useState(!1),[C,L]=r.useState(a||""),[A,S]=r.useState(-1),[N,R]=r.useState(!1);r.useEffect(()=>{if(!m.current&&u&&t.isValidElement(u)&&"select"===u.type){const e=document.querySelectorAll("select");e.length>0&&(m.current=e[e.length-1])}},[u]);const D=r.useMemo(()=>{if(c&&c.length>0)return c;if(m.current){const e=[];return m.current.querySelectorAll("option").forEach(t=>{e.push({value:t.value,label:t.textContent||"",icon:t.getAttribute("data-icon")||void 0})}),e}return[]},[c]),M=r.useMemo(()=>{const e=D.find(e=>e.value===C);return e?.label||o},[C,D,o]);r.useEffect(()=>{void 0!==a&&L(a)},[a]),r.useEffect(()=>{S(-1),C&&D.length>0&&D.some(e=>e.value===C)},[D.length,D]),r.useEffect(()=>{if(m.current){m.current.value=C;const e=new Event("change",{bubbles:!0});m.current.dispatchEvent(e)}k.current&&(k.current.value=C)},[C]),r.useEffect(()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&E(!1)};if(y)return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[y]),r.useEffect(()=>{if(y&&h.current&&x.current&&b.current){const e=n.calculateAndApply?.(h.current,x.current,b.current);e&&window.appLogger?.debug&&window.appLogger.debug("Dropdown aperto "+("up"===e.direction?"verso l'alto":"verso il basso"),{spaceBelow:e.spaceBelow,spaceAbove:e.spaceAbove,dropdownHeight:e.dropdownHeight,isInModal:e.isInModal})}},[y]),r.useEffect(()=>{if(y)return g.current=()=>{b.current&&x.current&&n.calculateAndApply(h.current,x.current,b.current)},j.current=s(()=>{b.current&&x.current&&n.calculateAndApply(h.current,x.current,b.current)},100),window.addEventListener("resize",g.current),window.addEventListener("scroll",j.current,{passive:!0}),()=>{g.current&&window.removeEventListener("resize",g.current),j.current&&window.removeEventListener("scroll",j.current)}},[y]);const $=r.useCallback(e=>{switch(e.key){case"Enter":case" ":e.preventDefault(),E(!y);break;case"Escape":e.preventDefault(),E(!1);break;case"ArrowDown":e.preventDefault(),y?S(e=>{const t=e+1>=D.length?0:e+1;return w.current=t,t}):E(!0);break;case"ArrowUp":e.preventDefault(),y&&S(e=>{const t=e-1<0?D.length-1:e-1;return w.current=t,t})}},[y,D.length]);r.useEffect(()=>{if(A>=0&&y){const e=b.current?.querySelector(`.custom-select-option[data-index="${A}"]`);e&&e.scrollIntoView({block:"nearest"})}},[A,y]);const I=r.useCallback(e=>{L(e),E(!1),i?.(e)},[i]),z=r.useCallback(e=>{e.preventDefault(),e.stopPropagation(),L(""),S(-1),i?.("")},[i]),B=r.useCallback(()=>{R(!1)},[]),q=r.useCallback(()=>{R(!0)},[]),H=r.useCallback(e=>{d||N||(e.stopPropagation(),E(!y),S(-1))},[y,d,N]),P=""!==C,T=t=>t.icon?e.jsxs(e.Fragment,{children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:t.icon}})," "+t.label]}):t.label;return e.jsxs("div",{ref:h,id:l,className:`custom-select-wrapper ${y?"open":""} ${v?"is-invalid":""} ${d?"is-disabled":""} ${p}`,role:"combobox","aria-expanded":y,"aria-haspopup":"listbox","aria-disabled":d,onKeyDown:$,tabIndex:d?-1:0,children:[e.jsxs("div",{ref:x,className:"custom-select-trigger",onClick:H,onTouchStart:B,onTouchMove:q,children:[e.jsx("span",{className:"custom-select-label",children:T({label:M})}),e.jsx("button",{type:"button",className:"custom-select-clear-btn",onClick:z,style:{display:P?"flex":"none"},"aria-label":"Cancella selezione",disabled:d,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsx("span",{className:"custom-select-arrow","aria-hidden":"true",children:e.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:e.jsx("path",{d:"M1 1L6 6L11 1",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("div",{ref:b,className:"custom-select-dropdown",role:"listbox",children:e.jsx("div",{className:"custom-select-options",children:D.map((t,r)=>e.jsx("div",{className:`custom-select-option ${r===A?"focused":""} ${t.value===C?"selected":""}`,role:"option","aria-selected":t.value===C,"data-value":t.value,"data-index":r,onClick:()=>!d&&I(t.value),onMouseEnter:()=>y&&S(r),children:T(t)},t.value))})}),u&&e.jsx("div",{style:{display:"none"},children:u}),l&&!u&&e.jsx("select",{ref:k,id:l,style:{display:"none"},onChange:e=>{I(e.target.value)},disabled:d,children:D.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})});l.displayName="CustomSelect";export{l as C};
