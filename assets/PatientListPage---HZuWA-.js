import{n as e,j as t,B as a,o as i,m as s,C as n,f as r,l as o,g as l}from"./shared-DM1owLfs.js";import{u as c,k as d}from"./index-BQsIu8x0.js";import{u as m}from"./useQuery-25yGgNuF.js";import{u as p}from"./useMutation-B5mVti9M.js";import{e as u,l as h,m as v,p as x,a as f,C as g,A as j,z as b}from"./core-services-CSrwUk3W.js";import{p as N}from"./patientService-BUKaJ6EC.js";import{u as y}from"./react-vendor-DMMrM9kC.js";import"./ui-vendor-CKm97sqn.js";import"./supabase-D6dgNb7x.js";async function D(){try{const t=await e("pazienti","tipo_dimissione"),a=["dimissione","trasferimento_interno","trasferimento_esterno","decesso"],i=t.map(e=>null==e?null:String(e)).filter(e=>!!e&&a.includes(e));return Array.from(new Set(i))}catch(t){throw h.error("Error loading transfer values:",t),new Error("Impossibile caricare le opzioni di trasferimento.")}}async function _(){try{const[e,t]=await Promise.all([u.from("pazienti").select("id",{count:"exact",head:!0}).is("data_dimissione",null),u.from("pazienti").select("id",{count:"exact",head:!0}).not("data_dimissione","is",null)]);if(e.error)throw e.error;if(t.error)throw t.error;return{hasActive:(e.count??0)>0,hasDimesso:(t.count??0)>0}}catch(e){throw h.error("Error loading patient status availability:",e),new Error("Impossibile caricare le opzioni di stato.")}}const w={search:"Ricerca",reparto:"Reparto appartenenza",diagnosi:"Diagnosi",stato:"Stato",infetto:"Infetto",trasferimento:"Trasferimento"},I={true:"SÃ¬",false:"No"},z={dimissione:"Dimissione",trasferimento_interno:"Trasferimento interno",trasferimento_esterno:"Trasferimento esterno",decesso:"Decesso"},C=["search","reparto","diagnosi","stato","infetto","trasferimento"];function P(e){return C.map(t=>{const a=e[t];if(null==a||""===a)return null;const i=function(e,t){if(null==t)return"";if("object"==typeof t&&null!==t)return console.warn(`Filter value for "${e}" is an object, skipping:`,t),"";try{const a=String(t);return"search"===e?a.trim():"infetto"===e?I[a]||I[String("true"===a)]||a:"stato"===e?"attivo"===a?"Attivo":"dimesso"===a?"Dimesso":a:"trasferimento"===e&&z[a]||a}catch(a){return console.error(`Error converting filter value for "${e}":`,a,t),""}}(t,a);return i?{key:t,label:w[t]||t,value:i}:null}).filter(e=>null!==e)}const T=({filters:e,onClearFilter:a})=>{const i=P(e);return 0===i.length?null:t.jsxs("div",{className:"d-flex gap-2 mb-3",role:"list",children:[t.jsx("span",{className:"text-muted small",children:"Filtri attivi:"}),i.map(({key:e,label:i,value:s})=>t.jsxs("span",{className:"badge rounded-pill bg-secondary d-inline-flex align-items-center",role:"listitem",children:[i,": ",s,t.jsx("button",{type:"button",className:"btn-close btn-close-white ms-2","aria-label":`Rimuovi filtro ${i}`,onClick:()=>a(e)})]},e))]})};const $=new class{interventionTypes;constructor(){this.interventionTypes=["Chirurgia Ortopedica","Chirurgia Plastica","Chirurgia Vascolare","Chirurgia Generale","Altro"]}calculatePostOperativeDays(e,t=new Date){try{if(!Array.isArray(e))throw new Error("eventiClinici must be an array");const a=this.parseDate(t);if(!a)throw new Error("Invalid reference date");const i=this.filterInterventions(e);if(0===i.length)return{hasInterventions:!1,postOperativeDays:null,lastIntervention:null,displayText:null,allInterventions:[]};const s=this.sortInterventionsByDate(i),n=s[0],r=this.parseDate(n.data_evento);if(!r)throw new Error("Invalid intervention date");const o=this.calculateDaysDifference(r,a);return{hasInterventions:!0,postOperativeDays:o,lastIntervention:n,displayText:this.formatDisplayText(o),allInterventions:s}}catch(a){const e=a instanceof Error?a.message:String(a);return window.appLogger?.error("Error calculating post-operative days:",a),{hasInterventions:!1,postOperativeDays:null,lastIntervention:null,displayText:null,allInterventions:[],error:e}}}calculateForMultiplePatients(e,t=new Date){const a=new Map;return Array.isArray(e)?(e.forEach(e=>{if(e.id&&e.eventi_clinici){const i=this.calculatePostOperativeDays(e.eventi_clinici,t);a.set(e.id,i)}}),a):a}getPostOperativeStatus(e,t=new Date){const a=this.calculatePostOperativeDays(e,t);if(!a.hasInterventions)return{hasStatus:!1,statusText:"",statusClass:"",badgeText:""};const i=a.postOperativeDays,s=this.hasActiveInfection(e);let n="success",r=`PO ${i}`;return s?(n="danger",r=`PO ${i} ðŸ¦ `):i<=7?n="danger":i<=30?n="warning":i<=90&&(n="info"),{hasStatus:!0,statusText:a.displayText,statusClass:n,badgeText:r,days:i,lastIntervention:a.lastIntervention,hasActiveInfection:s}}hasActiveInfection(e){return!!Array.isArray(e)&&e.some(e=>"infezione"===e.tipo_evento&&e.data_evento&&!e.data_fine_evento)}filterInterventions(e){return e.filter(e=>"intervento"===e.tipo_evento&&e.data_evento&&e.tipo_intervento)}sortInterventionsByDate(e){return e.sort((e,t)=>{const a=this.parseDate(e.data_evento),i=this.parseDate(t.data_evento);return a&&i?i.getTime()-a.getTime():0})}calculateDaysDifference(e,t){const a=t.getTime()-e.getTime(),i=Math.floor(a/864e5);return Math.max(0,i)}formatDisplayText(e){return 0===e?"Giorno dell'intervento":1===e?"Giorno post-operatorio 1":`Giorno post-operatorio ${e}`}getDetailedPostOperativeInfo(e,t=new Date){const a=this.calculatePostOperativeDays(e,t);if(!a.hasInterventions)return{hasInterventions:!1,summary:"Nessun intervento chirurgico registrato",details:[]};const i=this.parseDate(t);if(!i)return{hasInterventions:!1,summary:"Data riferimento non valida",details:[]};const s=a.allInterventions.map((e,t)=>{const a=this.parseDate(e.data_evento),s=a?this.calculateDaysDifference(a,i):0;return{date:e.data_evento,type:e.tipo_intervento||"N/A",description:e.descrizione_intervento||"",daysSince:s,displayText:this.formatDisplayText(s),isLatest:0===t}});return{hasInterventions:!0,currentPostOpDay:a.postOperativeDays??void 0,currentDisplayText:a.displayText??void 0,lastInterventionDate:a.lastIntervention?.data_evento,lastInterventionType:a.lastIntervention?.tipo_intervento??void 0,totalInterventions:a.allInterventions.length,summary:`${a.displayText} (${a.allInterventions.length} interventi totali)`,details:s}}isInCriticalPostOpPeriod(e,t=7,a=new Date){const i=this.calculatePostOperativeDays(e,a);if(!i.hasInterventions)return{isCritical:!1,reason:"No interventions recorded"};const s=i.postOperativeDays||0,n=s<=t;return{isCritical:n,postOpDays:s,criticalThreshold:t,reason:n?`Patient is ${s} days post-operative (â‰¤${t} days)`:`Patient is ${s} days post-operative (>${t} days)`}}parseDate(e){if(!e)return null;if(e instanceof Date)return isNaN(e.getTime())?null:e;if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}$/.test(e)){const t=new Date(e+"T00:00:00.000Z");return isNaN(t.getTime())?null:t}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(e)){const t=e.split("/"),a=parseInt(t[0],10),i=parseInt(t[1],10)-1,s=parseInt(t[2],10),n=new Date(s,i,a);return isNaN(n.getTime())?null:n}const t=new Date(e);return isNaN(t.getTime())?null:t}return null}validateInterventionEvent(e){const t=[];if(!e)return t.push("Event object is required"),{isValid:!1,errors:t};if("intervento"!==e.tipo_evento&&t.push('Event type must be "intervento"'),e.data_evento){const a=this.parseDate(e.data_evento);a?a>new Date&&t.push("Event date cannot be in the future"):t.push("Invalid event date format")}else t.push("Event date is required");return e.tipo_intervento||t.push("Intervention type is required"),{isValid:0===t.length,errors:t}}getPostOperativeStatistics(e,t=new Date){if(!Array.isArray(e))return{totalPatients:0,patientsWithInterventions:0,criticalPeriod:0,earlyRecovery:0,lateRecovery:0,averagePostOpDays:0};let a=0,i=0,s=0,n=0,r=0;return e.forEach(e=>{if(e.eventi_clinici){const o=this.calculatePostOperativeDays(e.eventi_clinici,t);o.hasInterventions&&null!==o.postOperativeDays&&(a++,r+=o.postOperativeDays,o.postOperativeDays<=7?i++:o.postOperativeDays<=30?s++:n++)}}),{totalPatients:e.length,patientsWithInterventions:a,criticalPeriod:i,earlyRecovery:s,lateRecovery:n,averagePostOpDays:a>0?Math.round(r/a):0}}};const O=new Map;function A(e){if(!e)return!1;if(O.has(e.id))return O.get(e.id);let t=!1;return!0===e.infetto?t=!0:e.eventi_clinici&&Array.isArray(e.eventi_clinici)&&(t=$.hasActiveInfection(e.eventi_clinici)),O.set(e.id,t),t}const E=({patient:e,onEdit:i,onDelete:s,onDischarge:n,onReactivate:r,onAddIntervention:o,onAddInfection:l,onViewEvents:c})=>{const d=(m=e.eventi_clinici??[],p=new Date,$.getPostOperativeStatus(m,p));var m,p;const u=function(e){return A(e)?"patient-card-infected":""}(e);return t.jsx("div",{className:`card mb-3 ${e.data_dimissione?"border-danger":"border-success"} ${u}`,title:u?"Paziente con infezione attiva":void 0,children:t.jsxs("div",{className:"card-body",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[t.jsxs("div",{children:[t.jsxs("h5",{className:"card-title mb-1",children:[e.nome," ",e.cognome]}),u&&t.jsxs("span",{className:"badge bg-danger mb-2",children:[t.jsx("span",{className:"material-icons fs-6 me-1",style:{verticalAlign:"middle"},"aria-hidden":"true",children:"coronavirus"}),"Infezione Attiva"]})]}),d?.hasStatus&&t.jsx("span",{className:`badge bg-${d.statusClass??"success"}`,children:d.badgeText??""})]}),t.jsxs("p",{className:"card-text",children:[e.diagnosi," â€¢ ",e.reparto_appartenenza]}),t.jsxs("div",{className:"patient-card-actions d-flex gap-2",children:[i&&t.jsx(a,{variant:"secondary",className:"patient-card-action-btn",onClick:()=>i(e),children:"Modifica"}),s&&t.jsx(a,{variant:"danger",className:"patient-card-action-btn",onClick:()=>s(e),children:"Elimina"}),n&&!e.data_dimissione&&t.jsx(a,{variant:"warning",className:"patient-card-action-btn",onClick:()=>n(e),children:"Dimetti"}),r&&e.data_dimissione&&t.jsx(a,{variant:"success",className:"patient-card-action-btn",onClick:()=>r(e),children:"Riattiva"})]}),t.jsxs("div",{className:"mt-3 patient-card-actions d-flex gap-2",children:[o&&t.jsx(a,{variant:"outline-primary",className:"patient-card-action-btn",onClick:()=>o(e),children:"Intervento"}),l&&t.jsx(a,{variant:"outline-warning",className:"patient-card-action-btn",onClick:()=>l(e),children:"Infezione"}),c&&t.jsx(a,{variant:"outline-info",className:"patient-card-action-btn",onClick:()=>c(e),children:"Timeline"})]})]})})},S=e=>{if(!e)return"-";const t="string"==typeof e?new Date(e):e;return Number.isNaN(t.getTime())?"-":t.toLocaleDateString("it-IT")},k=({patient:e,onSelect:i,onDelete:s,onEdit:n,onDischarge:r,onReactivate:o,showActions:l=!1})=>{const c=!!e.data_dimissione,d=function(e){return A(e)?"table-row-infected":""}(e);return t.jsxs("tr",{className:d,onClick:()=>i?.(e),style:{cursor:i?"pointer":"default"},title:d?"Paziente con infezione attiva":void 0,children:[t.jsx("td",{children:e.cognome||"-"}),t.jsx("td",{children:e.nome||"-"}),t.jsx("td",{children:S(e.data_nascita)}),t.jsx("td",{children:S(e.data_ricovero)}),t.jsx("td",{children:e.diagnosi||"-"}),t.jsx("td",{children:e.reparto_appartenenza||"-"}),t.jsx("td",{children:(()=>{const a=(e=>{const t=e.eventi_clinici?.filter(e=>"intervento"===e.tipo_evento)?.sort((e,t)=>{const a=new Date(e.data_evento).getTime();return new Date(t.data_evento).getTime()-a})[0];if(!t?.data_evento)return"-";const a=new Date(t.data_evento);if(Number.isNaN(a.getTime()))return"-";const i=(new Date).getTime()-a.getTime(),s=Math.floor(i/864e5);return s>=0?`PO ${s}`:"-"})(e);return"-"===a?"-":t.jsx("span",{className:"badge bg-info text-dark",title:`Giorno post-operatorio ${a.replace("PO ","")}`,children:a})})()}),t.jsx("td",{children:t.jsx("span",c?{className:"badge bg-secondary",children:"Dimesso"}:{className:"badge bg-success",children:"Attivo"})}),t.jsx("td",{children:(()=>{const a=(e=>{if(!e.data_dimissione)return null;let t="";"trasferimento_esterno"===e.tipo_dimissione?t="Esterno":"trasferimento_interno"===e.tipo_dimissione?t="Interno":"decesso"===e.tipo_dimissione?t="Decesso":"dimissione"===e.tipo_dimissione&&(t="Dimissione");let a="";return e.reparto_destinazione?a=e.reparto_destinazione:e.clinica_destinazione&&(a=e.clinica_destinazione),{type:t,destination:a,note:e.note||void 0}})(e);return a?t.jsxs("div",{className:"small",children:[t.jsx("strong",{children:a.type}),a.destination&&t.jsxs(t.Fragment,{children:[" â†’ ",t.jsx("span",{children:a.destination})]}),a.note&&t.jsxs("div",{className:"text-muted",children:["(",a.note,")"]})]}):"-"})()}),l&&t.jsx("td",{children:t.jsxs("div",{className:"patient-table-actions d-flex gap-2",children:[n&&t.jsx(a,{variant:"link",onClick:()=>n(e),title:`Modifica paziente ${e.nome} ${e.cognome}`,"aria-label":`Modifica paziente ${e.nome} ${e.cognome}`,className:"patient-table-action-btn",children:t.jsx("span",{className:"material-icons fs-5","aria-hidden":"true",children:"edit"})}),r&&!c&&t.jsx(a,{variant:"link",onClick:()=>r(e),title:`Dimetti paziente ${e.nome} ${e.cognome}`,"aria-label":`Dimetti paziente ${e.nome} ${e.cognome}`,className:"patient-table-action-btn text-warning",children:t.jsx("span",{className:"material-icons fs-5","aria-hidden":"true",children:"event_available"})}),o&&c&&t.jsx(a,{variant:"link",onClick:()=>o(e),title:`Riattiva paziente ${e.nome} ${e.cognome}`,"aria-label":`Riattiva paziente ${e.nome} ${e.cognome}`,className:"patient-table-action-btn text-success",children:t.jsx("span",{className:"material-icons fs-5","aria-hidden":"true",children:"undo"})}),s&&t.jsx(a,{variant:"link",onClick:()=>s(e),title:`Elimina paziente ${e.nome} ${e.cognome}`,"aria-label":`Elimina paziente ${e.nome} ${e.cognome}`,className:"patient-table-action-btn text-danger",children:t.jsx("span",{className:"material-icons fs-5","aria-hidden":"true",children:"delete"})})]})})]},e.id)},R=({patients:e,loading:s=!1,onSelect:n,onDelete:r,onEdit:o,onDischarge:l,onReactivate:c,onAddIntervention:d,onAddInfection:m,onViewEvents:p,onResetFilters:u,showActions:h=!1,emptyMessage:v="Nessun paziente disponibile"})=>{const x=i()>=1200;return s?t.jsxs("div",{className:"text-center p-5",role:"status","aria-live":"polite","aria-busy":"true",children:[t.jsx("div",{className:"spinner-border text-primary mb-3",role:"presentation",children:t.jsx("span",{className:"visually-hidden",children:"Caricamento pazienti in corso..."})}),t.jsx("p",{className:"text-muted mb-0",children:"Caricamento pazienti in corso..."}),t.jsx("div",{className:"mt-4",children:[1,2,3].map(e=>t.jsx("div",{className:"card mb-2 placeholder-glow",children:t.jsxs("div",{className:"card-body",children:[t.jsx("span",{className:"placeholder col-7"}),t.jsx("span",{className:"placeholder col-4 ms-2"}),t.jsx("span",{className:"placeholder col-6"})]})},e))})]}):e.length?t.jsx("div",x?{className:"table-responsive",style:{maxHeight:"70vh",overflowY:"auto"},children:t.jsxs("table",{className:"table table-hover align-middle","aria-label":"Elenco pazienti",children:[t.jsx("thead",{className:"table-light",style:{position:"sticky",top:0,zIndex:10},children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"Cognome"}),t.jsx("th",{scope:"col",children:"Nome"}),t.jsx("th",{scope:"col",children:"Data Nascita"}),t.jsx("th",{scope:"col",children:"Data Ricovero"}),t.jsx("th",{scope:"col",children:"Diagnosi"}),t.jsx("th",{scope:"col",children:"Reparto appartenenza"}),t.jsx("th",{scope:"col",children:"Post-Op"}),t.jsx("th",{scope:"col",children:"Stato"}),t.jsx("th",{scope:"col",children:"Trasferimento"}),h&&t.jsx("th",{scope:"col",children:"Azioni"})]})}),t.jsx("tbody",{children:e.map(e=>t.jsx(k,{patient:e,onSelect:n,onDelete:r,onEdit:o,onDischarge:l,onReactivate:c,showActions:h},e.id))})]})}:{children:e.map(e=>t.jsx(E,{patient:e,onEdit:o,onDelete:r,onDischarge:l,onReactivate:c,onAddIntervention:d,onAddInfection:m,onViewEvents:p},e.id))}):t.jsxs("div",{className:"empty-state text-center py-5",children:[t.jsx("span",{className:"material-icons fs-1","aria-hidden":"true",children:"group_off"}),t.jsx("p",{className:"mb-1",children:v}),t.jsx("p",{className:"text-muted mb-3",children:"Aggiorna i filtri o reimposta la ricerca per visualizzare nuovi risultati."}),u&&t.jsxs(a,{variant:"outline-primary",size:"sm",onClick:u,children:[t.jsx("span",{className:"material-icons me-1",style:{verticalAlign:"text-bottom"},children:"refresh"}),"Resetta filtri"]})]})};const F=new class{async getPatientStats(e={}){try{const t=u.from("pazienti").select("id"),{data:a,error:i}=await t;if(i)throw i;const s=(a||[]).length;let n=u.from("pazienti").select("id, data_dimissione, reparto_appartenenza");if(e.search&&(n=n.or(`nome.ilike.%${e.search}%,cognome.ilike.%${e.search}%,rad.ilike.%${e.search}%`)),e.reparto&&(n=n.eq("reparto_appartenenza",e.reparto)),e.diagnosi&&(n=n.eq("diagnosi",e.diagnosi)),e.stato&&("attivo"===e.stato?n=n.is("data_dimissione",null):"dimesso"===e.stato&&(n=n.not("data_dimissione","is",null))),void 0!==e.infetto){const t="true"===e.infetto||"false"!==e.infetto&&null;null!==t&&(n=n.eq("infetto",t))}e.trasferimento&&(n=n.eq("tipo_dimissione",e.trasferimento));const{data:r,error:o}=await n;if(o)throw o;const l=r||[],c={total:s,ricoverati:l.filter(e=>!e.data_dimissione).length,dimessi:l.filter(e=>e.data_dimissione).length};return e.reparto&&(c.perReparto=l.length),c}catch(t){throw h.error("Error loading patient statistics:",t),t}}},M=[{value:void 0,label:"Tutti"},{value:"attivo",label:"Attivi"},{value:"dimesso",label:"Dimessi"}],q=[{value:void 0,label:"Tutti"},{value:"dimissione",label:"Dimissioni"},{value:"trasferimento_interno",label:"Trasferimenti interni"},{value:"trasferimento_esterno",label:"Trasferimenti esterni"},{value:"decesso",label:"Decessi"}],V=[{value:"data_ricovero",label:"Data ricovero"},{value:"cognome",label:"Cognome"},{value:"nome",label:"Nome"},{value:"data_nascita",label:"Data nascita"}];const G=()=>{const e=y(),i=c(),{filters:u,setFilters:h,setPage:v,setSort:w,resetFilters:I}=x(),[z,C]=f.useState(u.search||""),[P,$]=f.useState(!1),[O,A]=f.useState({title:"",body:"",onConfirm:()=>{}}),[E,S]=f.useState(null),k=f.useRef(null),{data:M,isPending:q,isError:G,isFetching:K}=m({queryKey:["patients",u],queryFn:()=>{const{page:e,sortColumn:t,sortDirection:a,...i}=u;return N.getPatientsWithClinicalEvents(i,{page:e,limit:10,sortColumn:t,sortDirection:a})},placeholderData:d}),{data:B}=m({queryKey:["patientStats",u],queryFn:()=>F.getPatientStats(u),initialData:{total:0,ricoverati:0,dimessi:0}}),{data:J}=m({queryKey:["patientFilterOptions"],queryFn:async()=>{const[e,t,a,i,s]=await Promise.all([r(),o(),_(),D(),l()]);return{diagnosiOptions:e,repartoOptions:t,statusOptions:Q(a),transferOptions:H(i),infectionOptions:U(s)}},staleTime:3e5}),L=(e,t)=>p({mutationFn:t=>N[e](t),onSuccess:()=>{j(t),i.invalidateQueries({queryKey:["patients"]})},onError:e=>{const t=e instanceof Error?e.message:"Si Ã¨ verificato un errore";b(t)},onSettled:()=>{$(!1)}}),W=L("deletePatient","Paziente eliminato con successo"),Y=L("dischargePatient","Paziente dimesso con successo"),Z=L("reactivatePatient","Paziente riattivato con successo"),X=e=>{h({...e,page:0})},ee=()=>{C(""),I(),g?.("Filtri resettati",{timeout:1500,position:"top-center"}),setTimeout(()=>k.current?.focus(),100)},te=f.useMemo(()=>function(e,t){let a=null;return(...i)=>{a&&clearTimeout(a),a=setTimeout(()=>e(...i),t)}}(e=>{X({search:e})},500),[]),ae=e=>{if(!M)return;const t=u.page??0,a="prev"===e?Math.max(t-1,0):t+1;"prev"===e&&!M.hasPrevPage||"next"===e&&!M.hasNextPage||v(a)},ie=(e,t,a)=>{A({title:e,body:t,onConfirm:a}),$(!0)},se=(t,a)=>{const{id:i}=a;switch(t){case"add-intervention":e(`/eventi-clinici?action=add&type=intervento&paziente=${i}`);break;case"add-infection":e(`/eventi-clinici?action=add&type=infezione&paziente=${i}`);break;case"view-events":e(`/eventi-clinici?paziente=${i}`)}},ne=async e=>{S(e);try{await("csv"===e?N.exportPatients(u):N.exportPatientsJSON(u)),j(`File ${e.toUpperCase()} scaricato con successo`)}catch(t){const e=t instanceof Error?t.message:"Errore durante l'esportazione";b(e)}finally{S(null)}},re=f.useMemo(()=>{let e=0;return u.search&&e++,u.reparto&&e++,u.diagnosi&&e++,u.stato&&e++,void 0!==u.infetto&&e++,u.trasferimento&&e++,e},[u]);return t.jsxs("div",{className:"patient-list-page-container",children:[t.jsx(s,{isOpen:P,title:O.title,body:O.body,onConfirm:O.onConfirm,onCancel:()=>$(!1)}),t.jsx("div",{className:"patient-list-hero",children:t.jsxs("div",{className:"patient-list-hero-content",children:[t.jsx("h1",{className:"patient-list-title",children:"Elenco Pazienti"}),t.jsx("p",{className:"patient-list-subtitle",children:"Gestisci pazienti, filtra per stato e esporta la lista"})]})}),B&&t.jsxs("div",{className:"patient-stats-grid",children:[t.jsxs("div",{className:"patient-stat-card",children:[t.jsx("div",{className:"stat-icon",children:t.jsx("span",{className:"material-icons","aria-hidden":"true",children:"people"})}),t.jsx("div",{className:"stat-value",children:B.total}),t.jsx("div",{className:"stat-label",children:"Totale Pazienti"})]}),t.jsxs("div",{className:"patient-stat-card",children:[t.jsx("div",{className:"stat-icon",children:t.jsx("span",{className:"material-icons","aria-hidden":"true",children:"hotel"})}),t.jsx("div",{className:"stat-value",children:B.ricoverati}),t.jsx("div",{className:"stat-label",children:"Ricoverati"})]}),t.jsxs("div",{className:"patient-stat-card stat-discharged",children:[t.jsx("div",{className:"stat-icon",children:t.jsx("span",{className:"material-icons","aria-hidden":"true",children:"logout"})}),t.jsx("div",{className:"stat-value",children:B.dimessi}),t.jsx("div",{className:"stat-label",children:"Dimessi"})]}),u.reparto&&void 0!==B.perReparto&&t.jsxs("div",{className:"patient-stat-card",children:[t.jsx("div",{className:"stat-icon",children:t.jsx("span",{className:"material-icons","aria-hidden":"true",children:"business"})}),t.jsx("div",{className:"stat-value",children:B.perReparto}),t.jsxs("div",{className:"stat-label",children:["In ",u.reparto]})]})]}),t.jsxs("section",{className:"patient-filters-card",role:"search","aria-label":"Filtri ricerca pazienti",children:[t.jsxs("div",{className:"patient-filters-header",children:[t.jsxs("div",{className:"filters-title-wrapper",children:[t.jsx("span",{className:"material-icons","aria-hidden":"true",children:"filter_list"}),t.jsx("h2",{className:"filters-title",children:"Filtri Ricerca"})]}),re>0&&t.jsxs("span",{className:"active-filters-badge",children:[re," attivi"]})]}),t.jsxs("div",{className:"patient-filters-body",children:[t.jsxs("div",{className:"row g-3 align-items-end patient-filters",children:[t.jsxs("div",{className:"col-12 col-md-6 col-xl-4",children:[t.jsx("label",{className:"form-label",htmlFor:"patient-search",children:"Cerca paziente"}),t.jsx("input",{ref:k,id:"patient-search",type:"search",className:"form-control",value:z,onChange:e=>{const t=e.target.value;C(t),te(t)},placeholder:"Nome, cognome, RAD..."})]}),t.jsxs("div",{className:"col-12 col-md-6 col-xl-4",children:[t.jsx("label",{className:"form-label",htmlFor:"patient-department",children:"Reparto"}),t.jsx(n,{id:"patient-department",value:u.reparto??"",options:[{value:"",label:"Tutti"},...(J?.repartoOptions??[]).map(e=>({value:e,label:e}))],onChange:e=>X({reparto:e||void 0}),placeholder:"Tutti"})]}),t.jsxs("div",{className:"col-12 col-md-6 col-xl-4",children:[t.jsx("label",{className:"form-label",htmlFor:"patient-diagnosis",children:"Diagnosi"}),t.jsx(n,{id:"patient-diagnosis",value:u.diagnosi??"",options:[{value:"",label:"Tutti"},...(J?.diagnosiOptions??[]).map(e=>({value:e.nome,label:e.nome}))],onChange:e=>X({diagnosi:e||void 0}),placeholder:"Tutti"})]}),t.jsxs("div",{className:"col-12 col-md-6 col-xl-4",children:[t.jsx("label",{className:"form-label",htmlFor:"patient-status",children:"Stato"}),t.jsx(n,{id:"patient-status",value:u.stato??"",options:(J?.statusOptions??[]).map(e=>({value:e.value??"",label:e.label})),onChange:e=>X({stato:e||void 0}),placeholder:"Tutti"})]})]}),t.jsx("div",{className:"filters-actions",children:t.jsxs(a,{variant:"outline-secondary",onClick:ee,children:[t.jsx("span",{className:"material-icons me-1","aria-hidden":"true",children:"refresh"}),"Resetta Filtri"]})})]})]}),t.jsxs("section",{className:"mb-3",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2",children:[t.jsx(T,{filters:u,onClearFilter:e=>{"search"===e&&C(""),h({[e]:void 0})}}),M&&M.totalCount>0&&t.jsxs("div",{className:"text-muted small",children:["Mostrando ",t.jsx("strong",{children:M.patients.length})," di ",t.jsx("strong",{children:M.totalCount}),M.totalCount>10&&t.jsxs("span",{children:[" (pagina ",(u.page??0)+1," di ",M.totalPages,")"]})]})]}),t.jsxs("div",{className:"sort-controls-card",children:[t.jsxs("div",{className:"sort-selector",children:[t.jsx("label",{className:"sort-control-label",id:"sort-selector-label",children:"Ordina per:"}),t.jsx("div",{className:"sort-selector-buttons",role:"group","aria-labelledby":"sort-selector-label",children:V.map(e=>{const a=u.sortColumn===e.value,i=a?"asc"===u.sortDirection?"arrow_upward":"arrow_downward":"unfold_more",s=a?"asc"===u.sortDirection?"in ordine crescente":"in ordine decrescente":"senza ordine applicato";return t.jsxs("button",{type:"button",className:"btn sort-selector-button"+(a?" sort-selector-button--active":""),onClick:()=>(e=>{w(e)})(e.value),"aria-pressed":a,"aria-label":`Ordina per ${e.label} ${s}`,children:[e.label,t.jsxs("span",{className:"visually-hidden",children:[" ",s]}),t.jsx("span",{className:"material-icons","aria-hidden":"true",children:i})]},e.value)})})]}),M&&M.totalCount>0&&t.jsxs("div",{className:"export-controls",children:[t.jsx("label",{className:"sort-control-label",id:"export-controls-label",children:"Esporta:"}),t.jsxs("div",{className:"export-buttons",role:"group","aria-labelledby":"export-controls-label",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary export-button",onClick:()=>ne("csv"),disabled:null!==E,children:t.jsxs(t.Fragment,"csv"===E?{children:[t.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),t.jsx("span",{children:"CSV"})]}:{children:[t.jsx("span",{className:"material-icons","aria-hidden":"true",children:"download"}),t.jsx("span",{children:"CSV"})]})}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary export-button",onClick:()=>ne("json"),disabled:null!==E,children:t.jsxs(t.Fragment,"json"===E?{children:[t.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),t.jsx("span",{children:"JSON"})]}:{children:[t.jsx("span",{className:"material-icons","aria-hidden":"true",children:"code"}),t.jsx("span",{children:"JSON"})]})})]})]})]})]}),G&&t.jsx("div",{className:"alert alert-danger",children:"Errore nel caricamento."}),t.jsx(R,{patients:M?.patients??[],loading:q||K,onDelete:e=>{ie("Conferma Eliminazione",`Sei sicuro di voler eliminare il paziente ${e.nome} ${e.cognome}?`,()=>W.mutate(e.id))},onDischarge:e=>{ie("Conferma Dimissione",`Sei sicuro di voler dimettere il paziente ${e.nome} ${e.cognome}?`,()=>Y.mutate(e.id))},onReactivate:e=>{ie("Conferma Riattivazione",`Sei sicuro di voler riattivare il paziente ${e.nome} ${e.cognome}?`,()=>Z.mutate(e.id))},onEdit:t=>{sessionStorage.setItem("editPazienteId",t.id),e("/inserimento")},onAddIntervention:e=>se("add-intervention",e),onAddInfection:e=>se("add-infection",e),onViewEvents:e=>se("view-events",e),onResetFilters:ee,showActions:!0}),M&&M.totalPages>1&&t.jsx("nav",{className:"patient-pagination",children:t.jsxs("ul",{className:"pagination mb-0",children:[t.jsx("li",{className:"page-item "+(M.hasPrevPage?"":"disabled"),children:t.jsx("button",{className:"page-link",onClick:()=>ae("prev"),disabled:!M.hasPrevPage,children:"â€¹"})}),t.jsx("li",{className:"page-item active",children:t.jsxs("span",{className:"page-link",children:["Pagina ",(u.page??0)+1," di ",M.totalPages]})}),t.jsx("li",{className:"page-item "+(M.hasNextPage?"":"disabled"),children:t.jsx("button",{className:"page-link",onClick:()=>ae("next"),disabled:!M.hasNextPage,children:"â€º"})})]})})]})},K={attivo:"Attivi",dimesso:"Dimessi"},B={dimissione:"Dimissioni",trasferimento_interno:"Trasferimenti interni",trasferimento_esterno:"Trasferimenti esterni",decesso:"Decessi"},J=["dimissione","trasferimento_interno","trasferimento_esterno","decesso"],L={true:"SÃ¬",false:"No"},W=[{value:void 0,label:"Tutti"},{value:"true",label:L.true},{value:"false",label:L.false}];function Q(e){if(!e)return M;const t=[{value:void 0,label:"Tutti"}];return e.hasActive&&t.push({value:"attivo",label:K.attivo}),e.hasDimesso&&t.push({value:"dimesso",label:K.dimesso}),t.length>1?t:M}function H(e){if(!e||0===e.length)return q;const t=Array.from(new Set(e));return t.sort((e,t)=>J.indexOf(e)-J.indexOf(t)),[{value:void 0,label:"Tutti"},...t.map(e=>({value:e,label:B[e]??e}))]}function U(e){if(!e||0===e.length)return W;const t=Array.from(new Set(e)),a=["true","false"].filter(e=>t.includes(e)),i=[{value:void 0,label:"Tutti"}];return a.forEach(e=>{i.push({value:e,label:L[e]})}),i}const Y=v.memo(G);export{G as PatientListPage,Y as default};
