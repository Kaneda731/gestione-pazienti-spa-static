import{r as e,j as s}from"./auth-feature-BcTinZZO.js";import{n as a,b as n}from"./core-services-qaelRMFP.js";import{g as i,s as t,d as l}from"./diagnoses-feature-BZOTD9Lb.js";import{u as o}from"./react-vendor-DjwQKAdz.js";import"./shared-CpQNZA6K.js";import"./ui-vendor-DUoRcVAi.js";import"./supabase-B_x5r1Gl.js";const r=()=>{const r=o(),[c,d]=e.useState([]),[m,u]=e.useState(!0),[h,x]=e.useState({nome:""}),[b,j]=e.useState(null),[g,p]=e.useState(!1);e.useEffect(()=>{N()},[]);const N=async()=>{try{u(!0);const e=await i();d(e)}catch(e){const s=e instanceof Error?e.message:"Impossibile caricare le diagnosi.";a(s)}finally{u(!1)}};return s.jsx("div",{className:"container py-4",children:s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[s.jsxs("h3",{className:"mb-0",children:[s.jsx("span",{className:"material-icons me-2",style:{verticalAlign:"text-bottom"},children:"medical_information"}),"Gestione Diagnosi"]}),s.jsxs("button",{className:"btn btn-back-menu btn-sm",onClick:()=>r("/#/home"),children:[s.jsx("span",{className:"material-icons me-1",style:{verticalAlign:"text-bottom"},children:"arrow_back"}),"Torna al Menu"]})]}),s.jsxs("div",{className:"card-body",children:[s.jsx("form",{onSubmit:async e=>{e.preventDefault();const s=h.nome.trim();if(!s)return a("Il nome della diagnosi non puÃ² essere vuoto."),void 0;p(!0);try{await t(b,s);n(`Diagnosi ${b?"aggiornata":"aggiunta"} con successo!`),x({nome:""}),j(null),await N()}catch(i){const e=i instanceof Error?i.message:"Impossibile salvare la diagnosi.";a(e)}finally{p(!1)}},className:"mb-4 modern-form",children:s.jsxs("div",{className:"diagnosi-form-container d-flex gap-2",children:[s.jsx("input",{type:"text",id:"diagnosi-name-input",className:"form-control",placeholder:"Nome nuova diagnosi",value:h.nome,onChange:e=>x({nome:e.target.value}),required:!0,disabled:g}),s.jsxs("div",{className:"d-flex gap-2",children:[b&&s.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>{x({nome:""}),j(null)},disabled:g,children:[s.jsx("span",{className:"material-icons",children:"cancel"}),"Annulla"]}),s.jsxs("button",{type:"submit",className:"btn btn-primary",disabled:g||!h.nome.trim(),children:[s.jsx("span",{className:"material-icons",children:b?"edit":"add"}),s.jsx("span",{children:b?"Aggiorna":"Aggiungi Diagnosi"})]})]})]})}),s.jsx("div",{className:"table-responsive",children:m?s.jsx("div",{className:"text-center py-4",children:s.jsx("div",{className:"spinner-border text-primary",role:"status",children:s.jsx("span",{className:"visually-hidden",children:"Caricamento..."})})}):0===c.length?s.jsx("div",{className:"text-center py-5",children:s.jsx("p",{className:"text-muted mb-0",children:"Nessuna diagnosi trovata."})}):s.jsxs("table",{className:"table table-striped",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Nome Diagnosi"}),s.jsx("th",{className:"text-end",children:"Azioni"})]})}),s.jsx("tbody",{children:c.map(e=>s.jsxs("tr",{children:[s.jsx("td",{"data-label":"Nome Diagnosi",children:e.nome}),s.jsxs("td",{"data-label":"Azioni",className:"text-end",children:[s.jsx("button",{className:"btn btn-sm btn-warning me-2",onClick:()=>(e=>{x({nome:e.nome}),j(e.id),setTimeout(()=>{const e=document.getElementById("diagnosi-name-input");e&&e.focus()},100)})(e),title:"Modifica diagnosi",children:s.jsx("span",{className:"material-icons",children:"edit"})}),s.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>(async e=>{if(window.confirm(`Sei sicuro di voler eliminare la diagnosi "${e.nome}"?`))try{await l(e.id),n("Diagnosi eliminata con successo!"),await N()}catch(s){const e=s instanceof Error?s.message:"Impossibile eliminare la diagnosi.";a(e)}})(e),title:"Elimina diagnosi",children:s.jsx("span",{className:"material-icons",children:"delete"})})]})]},e.id))})]})})]})]})})};export{r as DiagnosiPage,r as default};
